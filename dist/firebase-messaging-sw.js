importScripts("https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js");importScripts("https://www.gstatic.com/firebasejs/10.7.1/firebase-messaging-compat.js");const l={apiKey:"AIzaSyCbAU10zAKrvv9WJtapj1uBTQhKAlZrhXg",authDomain:"baby-footv2.firebaseapp.com",projectId:"baby-footv2",storageBucket:"baby-footv2.appspot.com",messagingSenderId:"630738367010",appId:"1:630738367010:web:8070effcead46645d7507b"};firebase.initializeApp(l);const f=firebase.messaging(),s="v3.0.0",a=`babyfoot-app-${s}`,h=`assets-${s}`,p=`images-${s}`,g=["/","/index.html","/manifest.webmanifest","/icons/logo-192.png","/icons/logo-512.png"];self.addEventListener("install",e=>{console.log("ğŸš€ [SW] Installation..."),e.waitUntil(caches.open(a).then(n=>n.addAll(g)).then(()=>console.log("âœ… [SW] Installation rÃ©ussie")).catch(n=>console.error("âŒ [SW] Erreur installation:",n))),self.skipWaiting()});self.addEventListener("activate",e=>{console.log("ğŸ”„ [SW] Activation..."),e.waitUntil(caches.keys().then(n=>Promise.all(n.filter(t=>t.startsWith("babyfoot-")&&t!==a).map(t=>(console.log("ğŸ—‘ï¸ [SW] Suppression:",t),caches.delete(t))))).then(()=>console.log("âœ… [SW] Activation rÃ©ussie"))),self.clients.claim()});async function d(e,n){try{const t=await fetch(e);return t.ok&&(await caches.open(n)).put(e,t.clone()),t}catch(t){const o=await(await caches.open(n)).match(e);if(o)return console.log("ğŸ“¦ [SW] Cache offline:",e.url),o;throw t}}async function c(e,n){const t=await caches.open(n),i=await t.match(e);if(i)return i;const o=await fetch(e);return o.ok&&t.put(e,o.clone()),o}self.addEventListener("fetch",e=>{const{request:n}=e,t=new URL(n.url);n.method==="GET"&&(t.hostname.includes("firebase")||t.hostname.includes("googleapis.com")||t.protocol.includes("-extension:")||e.respondWith((async()=>{var i,o;try{return t.pathname.startsWith("/images/cards/")?await c(n,p):t.pathname.match(/\.(css|js|woff2?|png|jpg|svg|ico)$/)||t.pathname.startsWith("/icons/")?await c(n,h):(i=n.headers.get("accept"))!=null&&i.includes("text/html")||t.pathname==="/"?await d(n,a):await fetch(n)}catch(r){if((o=n.headers.get("accept"))!=null&&o.includes("text/html"))return await(await caches.open(a)).match("/index.html")||new Response("Offline",{status:503});throw r}})()))});f.onBackgroundMessage(e=>{var i,o;console.log("ğŸ“© [FCM] Notification en arriÃ¨re-plan:",e);const n=((i=e.notification)==null?void 0:i.title)||"Baby-Foot App",t={body:((o=e.notification)==null?void 0:o.body)||"Nouvelle notification",icon:"/icons/logo-192.png",badge:"/icons/logo-192.png",vibrate:[200,100,200],data:e.data||{},requireInteraction:!1};return self.registration.showNotification(n,t)});self.addEventListener("notificationclick",e=>{console.log("ğŸ‘† [FCM] Notification cliquÃ©e"),e.notification.close(),e.waitUntil(clients.matchAll({type:"window",includeUncontrolled:!0}).then(n=>{for(const t of n)if(t.url.includes(self.registration.scope)&&"focus"in t)return t.focus();if(clients.openWindow)return clients.openWindow("/")}))});self.addEventListener("message",e=>{e.data==="SKIP_WAITING"&&self.skipWaiting(),e.data==="CLEAR_CACHE"&&e.waitUntil(caches.keys().then(n=>Promise.all(n.map(t=>caches.delete(t)))))});console.log("âœ… [SW] Service Worker chargÃ© et prÃªt !");
