var fl=Object.defineProperty;var pl=(s,t,r)=>t in s?fl(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r;var Sr=(s,t,r)=>pl(s,typeof t!="symbol"?t+"":t,r);import{r as m,j as e,R as gl,e as bl}from"./vendor-react-BxsbldMV.js";import{V as jn,R as wn,A as Nn,C as Cn,T as Sn,D as kn,P as vl,a as _n,b as yl,S as jl,c as wl,d as En,e as Nl,f as Cl,g as Rn,h as Sl,i as kl,j as $n,k as _l,l as An,I as El,L as Mn,m as Tn,n as Pn,o as Rl,O as On,p as $l,q as Ln,r as Al,s as In,t as Dn,u as Ml,v as Tl,w as Fn,x as Pl,y as zn,z as Bn,B as Ol,E as Un,F as qn,G as Vn,H as Gn,J as Hn,K as Ll,M as Zn,N as Il,Q as Wn,U as Qn,W as Dl,X as Jn,Y as Fl,Z as Yn,_ as Kn,$ as zl,a0 as Bl,a1 as Xn,a2 as Ul,a3 as ql}from"./vendor-radix-DZuMzuN9.js";import{c as ei,X as Fe,$ as Vl,L as ue,T as ds,R as Gl,H as ia,B as Ts,D as Wt,C as at,M as Fs,a as Pe,U as Ee,b as js,d as ti,e as Vs,A as pr,f as oa,g as si,Z as jt,h as Oe,G as Hl,S as Ps,i as it,P as ri,j as ai,k as is,l as Zl,m as Wl,n as dt,F as gr,o as Ql,p as Jl,q as Mt,r as wt,s as ni,t as Gt,u as Ht,v as Pt,w as Qt,I as Zt,x as ws,y as us,z as Yl,E as Kl,J as Xl,K as ec,Y as tc,N as sc,O as rc,Q as ac,V as nc,W as ms,_ as Ma,a0 as $t,a1 as Rs,a2 as $s,a3 as as,a4 as lt,a5 as Ns,a6 as Gs,a7 as Jt,a8 as ii,a9 as oi,aa as Ta,ab as xs,ac as li,ad as Gr,ae as ci,af as ir,ag as er,ah as ic,ai as oc,aj as lc,ak as kr,al as qt,am as ns,an as di,ao as cc,ap as Pa,aq as dc,ar as uc,as as mc,at as xc}from"./vendor-ui-CUyU4sRp.js";import{u as Hs,N as hc,a as fc,b as ht,L as As,c as pc,B as gc,R as bc,d as ze}from"./vendor-router-o6rgvikh.js";import{i as vc,g as yc,c as la,d as jc,e as wc,o as Nc,s as _r,f as ui,u as Cc,h as Re,r as S,j as Sc,k as z,l as et,m as ca,n as oe,p as kc,q as _c,t as mt,v as os,w as Ec,x as Rc,y as mi,z as or,A as xi,B as lr}from"./vendor-firebase-CWnkKim8.js";import{A as nt,m as W}from"./vendor-framer-IsYYbCxk.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function r(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=r(a);fetch(a.href,i)}})();const $c=1,Ac=1e6;let Er=0;function Mc(){return Er=(Er+1)%Number.MAX_SAFE_INTEGER,Er.toString()}const Rr=new Map,Oa=s=>{if(Rr.has(s))return;const t=setTimeout(()=>{Rr.delete(s),Os({type:"REMOVE_TOAST",toastId:s})},Ac);Rr.set(s,t)},Tc=(s,t)=>{switch(t.type){case"ADD_TOAST":return{...s,toasts:[t.toast,...s.toasts].slice(0,$c)};case"UPDATE_TOAST":return{...s,toasts:s.toasts.map(r=>r.id===t.toast.id?{...r,...t.toast}:r)};case"DISMISS_TOAST":{const{toastId:r}=t;return r?Oa(r):s.toasts.forEach(n=>{Oa(n.id)}),{...s,toasts:s.toasts.map(n=>n.id===r||r===void 0?{...n,open:!1}:n)}}case"REMOVE_TOAST":return t.toastId===void 0?{...s,toasts:[]}:{...s,toasts:s.toasts.filter(r=>r.id!==t.toastId)}}},tr=[];let sr={toasts:[]};function Os(s){sr=Tc(sr,s),tr.forEach(t=>{t(sr)})}function $({...s}){const t=Mc(),r=a=>Os({type:"UPDATE_TOAST",toast:{...a,id:t}}),n=()=>Os({type:"DISMISS_TOAST",toastId:t});return Os({type:"ADD_TOAST",toast:{...s,id:t,open:!0,onOpenChange:a=>{a||n()}}}),{id:t,dismiss:n,update:r}}function hi(){const[s,t]=m.useState(sr);return m.useEffect(()=>(tr.push(t),()=>{const r=tr.indexOf(t);r>-1&&tr.splice(r,1)}),[s]),{...s,toast:$,dismiss:r=>Os({type:"DISMISS_TOAST",toastId:r})}}const La=s=>typeof s=="boolean"?`${s}`:s===0?"0":s,Ia=ei,br=(s,t)=>r=>{var n;if((t==null?void 0:t.variants)==null)return Ia(s,r==null?void 0:r.class,r==null?void 0:r.className);const{variants:a,defaultVariants:i}=t,o=Object.keys(a).map(d=>{const u=r==null?void 0:r[d],h=i==null?void 0:i[d];if(u===null)return null;const p=La(u)||La(h);return a[d][p]}),l=r&&Object.entries(r).reduce((d,u)=>{let[h,p]=u;return p===void 0||(d[h]=p),d},{}),c=t==null||(n=t.compoundVariants)===null||n===void 0?void 0:n.reduce((d,u)=>{let{class:h,className:p,...f}=u;return Object.entries(f).every(x=>{let[g,y]=x;return Array.isArray(y)?y.includes({...i,...l}[g]):{...i,...l}[g]===y})?[...d,h,p]:d},[]);return Ia(s,o,c,r==null?void 0:r.class,r==null?void 0:r.className)},da="-",Pc=s=>{const t=Lc(s),{conflictingClassGroups:r,conflictingClassGroupModifiers:n}=s;return{getClassGroupId:o=>{const l=o.split(da);return l[0]===""&&l.length!==1&&l.shift(),fi(l,t)||Oc(o)},getConflictingClassGroupIds:(o,l)=>{const c=r[o]||[];return l&&n[o]?[...c,...n[o]]:c}}},fi=(s,t)=>{var o;if(s.length===0)return t.classGroupId;const r=s[0],n=t.nextPart.get(r),a=n?fi(s.slice(1),n):void 0;if(a)return a;if(t.validators.length===0)return;const i=s.join(da);return(o=t.validators.find(({validator:l})=>l(i)))==null?void 0:o.classGroupId},Da=/^\[(.+)\]$/,Oc=s=>{if(Da.test(s)){const t=Da.exec(s)[1],r=t==null?void 0:t.substring(0,t.indexOf(":"));if(r)return"arbitrary.."+r}},Lc=s=>{const{theme:t,prefix:r}=s,n={nextPart:new Map,validators:[]};return Dc(Object.entries(s.classGroups),r).forEach(([i,o])=>{Hr(o,n,i,t)}),n},Hr=(s,t,r,n)=>{s.forEach(a=>{if(typeof a=="string"){const i=a===""?t:Fa(t,a);i.classGroupId=r;return}if(typeof a=="function"){if(Ic(a)){Hr(a(n),t,r,n);return}t.validators.push({validator:a,classGroupId:r});return}Object.entries(a).forEach(([i,o])=>{Hr(o,Fa(t,i),r,n)})})},Fa=(s,t)=>{let r=s;return t.split(da).forEach(n=>{r.nextPart.has(n)||r.nextPart.set(n,{nextPart:new Map,validators:[]}),r=r.nextPart.get(n)}),r},Ic=s=>s.isThemeGetter,Dc=(s,t)=>t?s.map(([r,n])=>{const a=n.map(i=>typeof i=="string"?t+i:typeof i=="object"?Object.fromEntries(Object.entries(i).map(([o,l])=>[t+o,l])):i);return[r,a]}):s,Fc=s=>{if(s<1)return{get:()=>{},set:()=>{}};let t=0,r=new Map,n=new Map;const a=(i,o)=>{r.set(i,o),t++,t>s&&(t=0,n=r,r=new Map)};return{get(i){let o=r.get(i);if(o!==void 0)return o;if((o=n.get(i))!==void 0)return a(i,o),o},set(i,o){r.has(i)?r.set(i,o):a(i,o)}}},pi="!",zc=s=>{const{separator:t,experimentalParseClassName:r}=s,n=t.length===1,a=t[0],i=t.length,o=l=>{const c=[];let d=0,u=0,h;for(let y=0;y<l.length;y++){let j=l[y];if(d===0){if(j===a&&(n||l.slice(y,y+i)===t)){c.push(l.slice(u,y)),u=y+i;continue}if(j==="/"){h=y;continue}}j==="["?d++:j==="]"&&d--}const p=c.length===0?l:l.substring(u),f=p.startsWith(pi),x=f?p.substring(1):p,g=h&&h>u?h-u:void 0;return{modifiers:c,hasImportantModifier:f,baseClassName:x,maybePostfixModifierPosition:g}};return r?l=>r({className:l,parseClassName:o}):o},Bc=s=>{if(s.length<=1)return s;const t=[];let r=[];return s.forEach(n=>{n[0]==="["?(t.push(...r.sort(),n),r=[]):r.push(n)}),t.push(...r.sort()),t},Uc=s=>({cache:Fc(s.cacheSize),parseClassName:zc(s),...Pc(s)}),qc=/\s+/,Vc=(s,t)=>{const{parseClassName:r,getClassGroupId:n,getConflictingClassGroupIds:a}=t,i=[],o=s.trim().split(qc);let l="";for(let c=o.length-1;c>=0;c-=1){const d=o[c],{modifiers:u,hasImportantModifier:h,baseClassName:p,maybePostfixModifierPosition:f}=r(d);let x=!!f,g=n(x?p.substring(0,f):p);if(!g){if(!x){l=d+(l.length>0?" "+l:l);continue}if(g=n(p),!g){l=d+(l.length>0?" "+l:l);continue}x=!1}const y=Bc(u).join(":"),j=h?y+pi:y,M=j+g;if(i.includes(M))continue;i.push(M);const P=a(g,x);for(let w=0;w<P.length;++w){const I=P[w];i.push(j+I)}l=d+(l.length>0?" "+l:l)}return l};function Gc(){let s=0,t,r,n="";for(;s<arguments.length;)(t=arguments[s++])&&(r=gi(t))&&(n&&(n+=" "),n+=r);return n}const gi=s=>{if(typeof s=="string")return s;let t,r="";for(let n=0;n<s.length;n++)s[n]&&(t=gi(s[n]))&&(r&&(r+=" "),r+=t);return r};function Hc(s,...t){let r,n,a,i=o;function o(c){const d=t.reduce((u,h)=>h(u),s());return r=Uc(d),n=r.cache.get,a=r.cache.set,i=l,l(c)}function l(c){const d=n(c);if(d)return d;const u=Vc(c,r);return a(c,u),u}return function(){return i(Gc.apply(null,arguments))}}const Te=s=>{const t=r=>r[s]||[];return t.isThemeGetter=!0,t},bi=/^\[(?:([a-z-]+):)?(.+)\]$/i,Zc=/^\d+\/\d+$/,Wc=new Set(["px","full","screen"]),Qc=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Jc=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Yc=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Kc=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Xc=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,pt=s=>ls(s)||Wc.has(s)||Zc.test(s),St=s=>Cs(s,"length",od),ls=s=>!!s&&!Number.isNaN(Number(s)),$r=s=>Cs(s,"number",ls),_s=s=>!!s&&Number.isInteger(Number(s)),ed=s=>s.endsWith("%")&&ls(s.slice(0,-1)),we=s=>bi.test(s),kt=s=>Qc.test(s),td=new Set(["length","size","percentage"]),sd=s=>Cs(s,td,vi),rd=s=>Cs(s,"position",vi),ad=new Set(["image","url"]),nd=s=>Cs(s,ad,cd),id=s=>Cs(s,"",ld),Es=()=>!0,Cs=(s,t,r)=>{const n=bi.exec(s);return n?n[1]?typeof t=="string"?n[1]===t:t.has(n[1]):r(n[2]):!1},od=s=>Jc.test(s)&&!Yc.test(s),vi=()=>!1,ld=s=>Kc.test(s),cd=s=>Xc.test(s),dd=()=>{const s=Te("colors"),t=Te("spacing"),r=Te("blur"),n=Te("brightness"),a=Te("borderColor"),i=Te("borderRadius"),o=Te("borderSpacing"),l=Te("borderWidth"),c=Te("contrast"),d=Te("grayscale"),u=Te("hueRotate"),h=Te("invert"),p=Te("gap"),f=Te("gradientColorStops"),x=Te("gradientColorStopPositions"),g=Te("inset"),y=Te("margin"),j=Te("opacity"),M=Te("padding"),P=Te("saturate"),w=Te("scale"),I=Te("sepia"),O=Te("skew"),N=Te("space"),R=Te("translate"),F=()=>["auto","contain","none"],A=()=>["auto","hidden","clip","visible","scroll"],B=()=>["auto",we,t],_=()=>[we,t],J=()=>["",pt,St],U=()=>["auto",ls,we],X=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],pe=()=>["solid","dashed","dotted","double","none"],ge=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],ye=()=>["start","end","center","between","around","evenly","stretch"],ee=()=>["","0",we],se=()=>["auto","avoid","all","avoid-page","page","left","right","column"],H=()=>[ls,we];return{cacheSize:500,separator:":",theme:{colors:[Es],spacing:[pt,St],blur:["none","",kt,we],brightness:H(),borderColor:[s],borderRadius:["none","","full",kt,we],borderSpacing:_(),borderWidth:J(),contrast:H(),grayscale:ee(),hueRotate:H(),invert:ee(),gap:_(),gradientColorStops:[s],gradientColorStopPositions:[ed,St],inset:B(),margin:B(),opacity:H(),padding:_(),saturate:H(),scale:H(),sepia:ee(),skew:H(),space:_(),translate:_()},classGroups:{aspect:[{aspect:["auto","square","video",we]}],container:["container"],columns:[{columns:[kt]}],"break-after":[{"break-after":se()}],"break-before":[{"break-before":se()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...X(),we]}],overflow:[{overflow:A()}],"overflow-x":[{"overflow-x":A()}],"overflow-y":[{"overflow-y":A()}],overscroll:[{overscroll:F()}],"overscroll-x":[{"overscroll-x":F()}],"overscroll-y":[{"overscroll-y":F()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[g]}],"inset-x":[{"inset-x":[g]}],"inset-y":[{"inset-y":[g]}],start:[{start:[g]}],end:[{end:[g]}],top:[{top:[g]}],right:[{right:[g]}],bottom:[{bottom:[g]}],left:[{left:[g]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",_s,we]}],basis:[{basis:B()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",we]}],grow:[{grow:ee()}],shrink:[{shrink:ee()}],order:[{order:["first","last","none",_s,we]}],"grid-cols":[{"grid-cols":[Es]}],"col-start-end":[{col:["auto",{span:["full",_s,we]},we]}],"col-start":[{"col-start":U()}],"col-end":[{"col-end":U()}],"grid-rows":[{"grid-rows":[Es]}],"row-start-end":[{row:["auto",{span:[_s,we]},we]}],"row-start":[{"row-start":U()}],"row-end":[{"row-end":U()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",we]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",we]}],gap:[{gap:[p]}],"gap-x":[{"gap-x":[p]}],"gap-y":[{"gap-y":[p]}],"justify-content":[{justify:["normal",...ye()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...ye(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...ye(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[M]}],px:[{px:[M]}],py:[{py:[M]}],ps:[{ps:[M]}],pe:[{pe:[M]}],pt:[{pt:[M]}],pr:[{pr:[M]}],pb:[{pb:[M]}],pl:[{pl:[M]}],m:[{m:[y]}],mx:[{mx:[y]}],my:[{my:[y]}],ms:[{ms:[y]}],me:[{me:[y]}],mt:[{mt:[y]}],mr:[{mr:[y]}],mb:[{mb:[y]}],ml:[{ml:[y]}],"space-x":[{"space-x":[N]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[N]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",we,t]}],"min-w":[{"min-w":[we,t,"min","max","fit"]}],"max-w":[{"max-w":[we,t,"none","full","min","max","fit","prose",{screen:[kt]},kt]}],h:[{h:[we,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[we,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[we,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[we,t,"auto","min","max","fit"]}],"font-size":[{text:["base",kt,St]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",$r]}],"font-family":[{font:[Es]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",we]}],"line-clamp":[{"line-clamp":["none",ls,$r]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",pt,we]}],"list-image":[{"list-image":["none",we]}],"list-style-type":[{list:["none","disc","decimal",we]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[s]}],"placeholder-opacity":[{"placeholder-opacity":[j]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[s]}],"text-opacity":[{"text-opacity":[j]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...pe(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",pt,St]}],"underline-offset":[{"underline-offset":["auto",pt,we]}],"text-decoration-color":[{decoration:[s]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:_()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",we]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",we]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[j]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...X(),rd]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",sd]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},nd]}],"bg-color":[{bg:[s]}],"gradient-from-pos":[{from:[x]}],"gradient-via-pos":[{via:[x]}],"gradient-to-pos":[{to:[x]}],"gradient-from":[{from:[f]}],"gradient-via":[{via:[f]}],"gradient-to":[{to:[f]}],rounded:[{rounded:[i]}],"rounded-s":[{"rounded-s":[i]}],"rounded-e":[{"rounded-e":[i]}],"rounded-t":[{"rounded-t":[i]}],"rounded-r":[{"rounded-r":[i]}],"rounded-b":[{"rounded-b":[i]}],"rounded-l":[{"rounded-l":[i]}],"rounded-ss":[{"rounded-ss":[i]}],"rounded-se":[{"rounded-se":[i]}],"rounded-ee":[{"rounded-ee":[i]}],"rounded-es":[{"rounded-es":[i]}],"rounded-tl":[{"rounded-tl":[i]}],"rounded-tr":[{"rounded-tr":[i]}],"rounded-br":[{"rounded-br":[i]}],"rounded-bl":[{"rounded-bl":[i]}],"border-w":[{border:[l]}],"border-w-x":[{"border-x":[l]}],"border-w-y":[{"border-y":[l]}],"border-w-s":[{"border-s":[l]}],"border-w-e":[{"border-e":[l]}],"border-w-t":[{"border-t":[l]}],"border-w-r":[{"border-r":[l]}],"border-w-b":[{"border-b":[l]}],"border-w-l":[{"border-l":[l]}],"border-opacity":[{"border-opacity":[j]}],"border-style":[{border:[...pe(),"hidden"]}],"divide-x":[{"divide-x":[l]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[l]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[j]}],"divide-style":[{divide:pe()}],"border-color":[{border:[a]}],"border-color-x":[{"border-x":[a]}],"border-color-y":[{"border-y":[a]}],"border-color-s":[{"border-s":[a]}],"border-color-e":[{"border-e":[a]}],"border-color-t":[{"border-t":[a]}],"border-color-r":[{"border-r":[a]}],"border-color-b":[{"border-b":[a]}],"border-color-l":[{"border-l":[a]}],"divide-color":[{divide:[a]}],"outline-style":[{outline:["",...pe()]}],"outline-offset":[{"outline-offset":[pt,we]}],"outline-w":[{outline:[pt,St]}],"outline-color":[{outline:[s]}],"ring-w":[{ring:J()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[s]}],"ring-opacity":[{"ring-opacity":[j]}],"ring-offset-w":[{"ring-offset":[pt,St]}],"ring-offset-color":[{"ring-offset":[s]}],shadow:[{shadow:["","inner","none",kt,id]}],"shadow-color":[{shadow:[Es]}],opacity:[{opacity:[j]}],"mix-blend":[{"mix-blend":[...ge(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":ge()}],filter:[{filter:["","none"]}],blur:[{blur:[r]}],brightness:[{brightness:[n]}],contrast:[{contrast:[c]}],"drop-shadow":[{"drop-shadow":["","none",kt,we]}],grayscale:[{grayscale:[d]}],"hue-rotate":[{"hue-rotate":[u]}],invert:[{invert:[h]}],saturate:[{saturate:[P]}],sepia:[{sepia:[I]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[r]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[c]}],"backdrop-grayscale":[{"backdrop-grayscale":[d]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[u]}],"backdrop-invert":[{"backdrop-invert":[h]}],"backdrop-opacity":[{"backdrop-opacity":[j]}],"backdrop-saturate":[{"backdrop-saturate":[P]}],"backdrop-sepia":[{"backdrop-sepia":[I]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[o]}],"border-spacing-x":[{"border-spacing-x":[o]}],"border-spacing-y":[{"border-spacing-y":[o]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",we]}],duration:[{duration:H()}],ease:[{ease:["linear","in","out","in-out",we]}],delay:[{delay:H()}],animate:[{animate:["none","spin","ping","pulse","bounce",we]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[w]}],"scale-x":[{"scale-x":[w]}],"scale-y":[{"scale-y":[w]}],rotate:[{rotate:[_s,we]}],"translate-x":[{"translate-x":[R]}],"translate-y":[{"translate-y":[R]}],"skew-x":[{"skew-x":[O]}],"skew-y":[{"skew-y":[O]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",we]}],accent:[{accent:["auto",s]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",we]}],"caret-color":[{caret:[s]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":_()}],"scroll-mx":[{"scroll-mx":_()}],"scroll-my":[{"scroll-my":_()}],"scroll-ms":[{"scroll-ms":_()}],"scroll-me":[{"scroll-me":_()}],"scroll-mt":[{"scroll-mt":_()}],"scroll-mr":[{"scroll-mr":_()}],"scroll-mb":[{"scroll-mb":_()}],"scroll-ml":[{"scroll-ml":_()}],"scroll-p":[{"scroll-p":_()}],"scroll-px":[{"scroll-px":_()}],"scroll-py":[{"scroll-py":_()}],"scroll-ps":[{"scroll-ps":_()}],"scroll-pe":[{"scroll-pe":_()}],"scroll-pt":[{"scroll-pt":_()}],"scroll-pr":[{"scroll-pr":_()}],"scroll-pb":[{"scroll-pb":_()}],"scroll-pl":[{"scroll-pl":_()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",we]}],fill:[{fill:[s,"none"]}],"stroke-w":[{stroke:[pt,St,$r]}],stroke:[{stroke:[s,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},ud=Hc(dd);function me(...s){return ud(ei(s))}const za=[{threshold:0,rate:.1},{threshold:100,rate:.15},{threshold:1e3,rate:.19},{threshold:2e3,rate:.23}];function Zr(s){let t=za[0].rate;for(const r of za)if(s>=r.threshold)t=r.rate;else break;return t}const md=vl,yi=m.forwardRef(({className:s,...t},r)=>e.jsx(jn,{ref:r,className:me("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",s),...t}));yi.displayName=jn.displayName;const xd=br("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),ji=m.forwardRef(({className:s,variant:t,...r},n)=>e.jsx(wn,{ref:n,className:me(xd({variant:t}),s),...r}));ji.displayName=wn.displayName;const hd=m.forwardRef(({className:s,...t},r)=>e.jsx(Nn,{ref:r,className:me("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",s),...t}));hd.displayName=Nn.displayName;const wi=m.forwardRef(({className:s,...t},r)=>e.jsx(Cn,{ref:r,className:me("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",s),"toast-close":"",...t,children:e.jsx(Fe,{className:"h-4 w-4"})}));wi.displayName=Cn.displayName;const Ni=m.forwardRef(({className:s,...t},r)=>e.jsx(Sn,{ref:r,className:me("text-sm font-semibold",s),...t}));Ni.displayName=Sn.displayName;const Ci=m.forwardRef(({className:s,...t},r)=>e.jsx(kn,{ref:r,className:me("text-sm opacity-90",s),...t}));Ci.displayName=kn.displayName;function fd(){const{toasts:s}=hi();return e.jsxs(md,{children:[s.map(function({id:t,title:r,description:n,action:a,...i}){return e.jsxs(ji,{...i,children:[e.jsxs("div",{className:"grid gap-1",children:[r&&e.jsx(Ni,{children:r}),n&&e.jsx(Ci,{children:n})]}),a,e.jsx(wi,{})]},t)}),e.jsx(yi,{})]})}var Ba=["light","dark"],pd="(prefers-color-scheme: dark)",gd=m.createContext(void 0),bd={setTheme:s=>{},themes:[]},vd=()=>{var s;return(s=m.useContext(gd))!=null?s:bd};m.memo(({forcedTheme:s,storageKey:t,attribute:r,enableSystem:n,enableColorScheme:a,defaultTheme:i,value:o,attrs:l,nonce:c})=>{let d=i==="system",u=r==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${l.map(x=>`'${x}'`).join(",")})`};`:`var d=document.documentElement,n='${r}',s='setAttribute';`,h=a?Ba.includes(i)&&i?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${i}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",p=(x,g=!1,y=!0)=>{let j=o?o[x]:x,M=g?x+"|| ''":`'${j}'`,P="";return a&&y&&!g&&Ba.includes(x)&&(P+=`d.style.colorScheme = '${x}';`),r==="class"?g||j?P+=`c.add(${M})`:P+="null":j&&(P+=`d[s](n,${M})`),P},f=s?`!function(){${u}${p(s)}}()`:n?`!function(){try{${u}var e=localStorage.getItem('${t}');if('system'===e||(!e&&${d})){var t='${pd}',m=window.matchMedia(t);if(m.media!==t||m.matches){${p("dark")}}else{${p("light")}}}else if(e){${o?`var x=${JSON.stringify(o)};`:""}${p(o?"x[e]":"e",!0)}}${d?"":"else{"+p(i,!1,!1)+"}"}${h}}catch(e){}}()`:`!function(){try{${u}var e=localStorage.getItem('${t}');if(e){${o?`var x=${JSON.stringify(o)};`:""}${p(o?"x[e]":"e",!0)}}else{${p(i,!1,!1)};}${h}}catch(t){}}();`;return m.createElement("script",{nonce:c,dangerouslySetInnerHTML:{__html:f}})});const yd=({...s})=>{const{theme:t="system"}=vd();return e.jsx(Vl,{theme:t,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...s})},jd=yl,wd=m.forwardRef(({className:s,sideOffset:t=4,...r},n)=>e.jsx(_n,{ref:n,sideOffset:t,className:me("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...r}));wd.displayName=_n.displayName;const cs=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,Ot=globalThis,Ls="10.32.1";function ua(){return ma(Ot),Ot}function ma(s){const t=s.__SENTRY__=s.__SENTRY__||{};return t.version=t.version||Ls,t[Ls]=t[Ls]||{}}function xa(s,t,r=Ot){const n=r.__SENTRY__=r.__SENTRY__||{},a=n[Ls]=n[Ls]||{};return a[s]||(a[s]=t())}const Nd="Sentry Logger ",Ua={};function Cd(s){if(!("console"in Ot))return s();const t=Ot.console,r={},n=Object.keys(Ua);n.forEach(a=>{const i=Ua[a];r[a]=t[a],t[a]=i});try{return s()}finally{n.forEach(a=>{t[a]=r[a]})}}function Sd(){fa().enabled=!0}function kd(){fa().enabled=!1}function Si(){return fa().enabled}function _d(...s){ha("log",...s)}function Ed(...s){ha("warn",...s)}function Rd(...s){ha("error",...s)}function ha(s,...t){cs&&Si()&&Cd(()=>{Ot.console[s](`${Nd}[${s}]:`,...t)})}function fa(){return cs?xa("loggerSettings",()=>({enabled:!1})):{enabled:!1}}const rr={enable:Sd,disable:kd,isEnabled:Si,log:_d,warn:Ed,error:Rd},$d=Object.prototype.toString;function Ad(s,t){return $d.call(s)===`[object ${t}]`}function Md(s){return Ad(s,"Object")}function Td(s){return!!(s!=null&&s.then&&typeof s.then=="function")}function Pd(s,t,r){try{Object.defineProperty(s,t,{value:r,writable:!0,configurable:!0})}catch{cs&&rr.log(`Failed to add non-enumerable property "${t}" to object`,s)}}function Od(s,t=0){return typeof s!="string"||t===0||s.length<=t?s:`${s.slice(0,t)}...`}function Ld(){const s=Ot;return s.crypto||s.msCrypto}let Ar;function Id(){return Math.random()*16}function Is(s=Ld()){try{if(s!=null&&s.randomUUID)return s.randomUUID().replace(/-/g,"")}catch{}return Ar||(Ar="10000000100040008000"+1e11),Ar.replace(/[018]/g,t=>(t^(Id()&15)>>t/4).toString(16))}const ki=1e3;function _i(){return Date.now()/ki}function Dd(){const{performance:s}=Ot;if(!(s!=null&&s.now)||!s.timeOrigin)return _i;const t=s.timeOrigin;return()=>(t+s.now())/ki}let qa;function Fd(){return(qa??(qa=Dd()))()}function zd(s,t={}){if(t.user&&(!s.ipAddress&&t.user.ip_address&&(s.ipAddress=t.user.ip_address),!s.did&&!t.did&&(s.did=t.user.id||t.user.email||t.user.username)),s.timestamp=t.timestamp||Fd(),t.abnormal_mechanism&&(s.abnormal_mechanism=t.abnormal_mechanism),t.ignoreDuration&&(s.ignoreDuration=t.ignoreDuration),t.sid&&(s.sid=t.sid.length===32?t.sid:Is()),t.init!==void 0&&(s.init=t.init),!s.did&&t.did&&(s.did=`${t.did}`),typeof t.started=="number"&&(s.started=t.started),s.ignoreDuration)s.duration=void 0;else if(typeof t.duration=="number")s.duration=t.duration;else{const r=s.timestamp-s.started;s.duration=r>=0?r:0}t.release&&(s.release=t.release),t.environment&&(s.environment=t.environment),!s.ipAddress&&t.ipAddress&&(s.ipAddress=t.ipAddress),!s.userAgent&&t.userAgent&&(s.userAgent=t.userAgent),typeof t.errors=="number"&&(s.errors=t.errors),t.status&&(s.status=t.status)}function Ei(s,t,r=2){if(!t||typeof t!="object"||r<=0)return t;if(s&&Object.keys(t).length===0)return s;const n={...s};for(const a in t)Object.prototype.hasOwnProperty.call(t,a)&&(n[a]=Ei(n[a],t[a],r-1));return n}function Va(){return Is()}const Wr="_sentrySpan";function Ga(s,t){t?Pd(s,Wr,t):delete s[Wr]}function Ha(s){return s[Wr]}const Bd=100;class Lt{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._attributes={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext={traceId:Va(),sampleRand:Math.random()}}clone(){const t=new Lt;return t._breadcrumbs=[...this._breadcrumbs],t._tags={...this._tags},t._attributes={...this._attributes},t._extra={...this._extra},t._contexts={...this._contexts},this._contexts.flags&&(t._contexts.flags={values:[...this._contexts.flags.values]}),t._user=this._user,t._level=this._level,t._session=this._session,t._transactionName=this._transactionName,t._fingerprint=this._fingerprint,t._eventProcessors=[...this._eventProcessors],t._attachments=[...this._attachments],t._sdkProcessingMetadata={...this._sdkProcessingMetadata},t._propagationContext={...this._propagationContext},t._client=this._client,t._lastEventId=this._lastEventId,Ga(t,Ha(this)),t}setClient(t){this._client=t}setLastEventId(t){this._lastEventId=t}getClient(){return this._client}lastEventId(){return this._lastEventId}addScopeListener(t){this._scopeListeners.push(t)}addEventProcessor(t){return this._eventProcessors.push(t),this}setUser(t){return this._user=t||{email:void 0,id:void 0,ip_address:void 0,username:void 0},this._session&&zd(this._session,{user:t}),this._notifyScopeListeners(),this}getUser(){return this._user}setTags(t){return this._tags={...this._tags,...t},this._notifyScopeListeners(),this}setTag(t,r){return this.setTags({[t]:r})}setAttributes(t){return this._attributes={...this._attributes,...t},this._notifyScopeListeners(),this}setAttribute(t,r){return this.setAttributes({[t]:r})}removeAttribute(t){return t in this._attributes&&(delete this._attributes[t],this._notifyScopeListeners()),this}setExtras(t){return this._extra={...this._extra,...t},this._notifyScopeListeners(),this}setExtra(t,r){return this._extra={...this._extra,[t]:r},this._notifyScopeListeners(),this}setFingerprint(t){return this._fingerprint=t,this._notifyScopeListeners(),this}setLevel(t){return this._level=t,this._notifyScopeListeners(),this}setTransactionName(t){return this._transactionName=t,this._notifyScopeListeners(),this}setContext(t,r){return r===null?delete this._contexts[t]:this._contexts[t]=r,this._notifyScopeListeners(),this}setSession(t){return t?this._session=t:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(t){if(!t)return this;const r=typeof t=="function"?t(this):t,n=r instanceof Lt?r.getScopeData():Md(r)?t:void 0,{tags:a,attributes:i,extra:o,user:l,contexts:c,level:d,fingerprint:u=[],propagationContext:h}=n||{};return this._tags={...this._tags,...a},this._attributes={...this._attributes,...i},this._extra={...this._extra,...o},this._contexts={...this._contexts,...c},l&&Object.keys(l).length&&(this._user=l),d&&(this._level=d),u.length&&(this._fingerprint=u),h&&(this._propagationContext=h),this}clear(){return this._breadcrumbs=[],this._tags={},this._attributes={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._session=void 0,Ga(this,void 0),this._attachments=[],this.setPropagationContext({traceId:Va(),sampleRand:Math.random()}),this._notifyScopeListeners(),this}addBreadcrumb(t,r){var i;const n=typeof r=="number"?r:Bd;if(n<=0)return this;const a={timestamp:_i(),...t,message:t.message?Od(t.message,2048):t.message};return this._breadcrumbs.push(a),this._breadcrumbs.length>n&&(this._breadcrumbs=this._breadcrumbs.slice(-n),(i=this._client)==null||i.recordDroppedEvent("buffer_overflow","log_item")),this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(t){return this._attachments.push(t),this}clearAttachments(){return this._attachments=[],this}getScopeData(){return{breadcrumbs:this._breadcrumbs,attachments:this._attachments,contexts:this._contexts,tags:this._tags,attributes:this._attributes,extra:this._extra,user:this._user,level:this._level,fingerprint:this._fingerprint||[],eventProcessors:this._eventProcessors,propagationContext:this._propagationContext,sdkProcessingMetadata:this._sdkProcessingMetadata,transactionName:this._transactionName,span:Ha(this)}}setSDKProcessingMetadata(t){return this._sdkProcessingMetadata=Ei(this._sdkProcessingMetadata,t,2),this}setPropagationContext(t){return this._propagationContext=t,this}getPropagationContext(){return this._propagationContext}captureException(t,r){const n=(r==null?void 0:r.event_id)||Is();if(!this._client)return cs&&rr.warn("No client configured on scope - will not capture exception!"),n;const a=new Error("Sentry syntheticException");return this._client.captureException(t,{originalException:t,syntheticException:a,...r,event_id:n},this),n}captureMessage(t,r,n){const a=(n==null?void 0:n.event_id)||Is();if(!this._client)return cs&&rr.warn("No client configured on scope - will not capture message!"),a;const i=(n==null?void 0:n.syntheticException)??new Error(t);return this._client.captureMessage(t,r,{originalException:t,syntheticException:i,...n,event_id:a},this),a}captureEvent(t,r){const n=(r==null?void 0:r.event_id)||Is();return this._client?(this._client.captureEvent(t,{...r,event_id:n},this),n):(cs&&rr.warn("No client configured on scope - will not capture event!"),n)}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach(t=>{t(this)}),this._notifyingListeners=!1)}}function Ud(){return xa("defaultCurrentScope",()=>new Lt)}function qd(){return xa("defaultIsolationScope",()=>new Lt)}class Vd{constructor(t,r){let n;t?n=t:n=new Lt;let a;r?a=r:a=new Lt,this._stack=[{scope:n}],this._isolationScope=a}withScope(t){const r=this._pushScope();let n;try{n=t(r)}catch(a){throw this._popScope(),a}return Td(n)?n.then(a=>(this._popScope(),a),a=>{throw this._popScope(),a}):(this._popScope(),n)}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getIsolationScope(){return this._isolationScope}getStackTop(){return this._stack[this._stack.length-1]}_pushScope(){const t=this.getScope().clone();return this._stack.push({client:this.getClient(),scope:t}),t}_popScope(){return this._stack.length<=1?!1:!!this._stack.pop()}}function hs(){const s=ua(),t=ma(s);return t.stack=t.stack||new Vd(Ud(),qd())}function Gd(s){return hs().withScope(s)}function Hd(s,t){const r=hs();return r.withScope(()=>(r.getStackTop().scope=s,t(s)))}function Za(s){return hs().withScope(()=>s(hs().getIsolationScope()))}function Zd(){return{withIsolationScope:Za,withScope:Gd,withSetScope:Hd,withSetIsolationScope:(s,t)=>Za(t),getCurrentScope:()=>hs().getScope(),getIsolationScope:()=>hs().getIsolationScope()}}function Ri(s){const t=ma(s);return t.acs?t.acs:Zd()}function $i(){const s=ua();return Ri(s).getCurrentScope()}function Wd(){const s=ua();return Ri(s).getIsolationScope()}function Qd(s){if(s)return Jd(s)?{captureContext:s}:Kd(s)?{captureContext:s}:s}function Jd(s){return s instanceof Lt||typeof s=="function"}const Yd=["user","level","extra","contexts","tags","fingerprint","propagationContext"];function Kd(s){return Object.keys(s).some(t=>Yd.includes(t))}function Xd(s,t){return $i().captureException(s,Qd(t))}function eu(s,t){const r=typeof t=="string"?t:void 0,n=typeof t!="string"?{captureContext:t}:void 0;return $i().captureMessage(s,r,n)}function Ai(s){Wd().setUser(s)}const b={log:(...s)=>{},warn:(...s)=>{},error:(...s)=>{console.error(...s),s[0]instanceof Error?Xd(s[0],{extra:{additionalData:s.slice(1)}}):typeof s[0]=="string"&&eu(s[0],{level:"error",extra:{additionalData:s.slice(1)}})},info:(...s)=>{},debug:(...s)=>{}},tu={apiKey:"AIzaSyCbAU10zAKrvv9WJtapj1uBTQhKAlZrhXg",authDomain:"baby-footv2.firebaseapp.com",databaseURL:"https://baby-footv2-default-rtdb.firebaseio.com",projectId:"baby-footv2",storageBucket:"baby-footv2.firebasestorage.app",messagingSenderId:"630738367010",appId:"1:630738367010:web:8070effcead46645d7507b",measurementId:"G-PCFZ8HZ8C4"},vr=vc(tu);typeof window<"u"&&yc(vr);const Vt=la(vr),su="BAJ02eLWbYkPyz_w3S304RHeltRnL-5l7T9to_ruWiLDjJor9rmc7YEZ_xvGj27TCkIwtxDecQ8JopCIVAmrGvw",k=jc(vr);let pa=null;if(typeof window<"u")try{pa=wc(vr)}catch{}const ru=()=>{{console.warn("Sentry DSN not found. Error monitoring is disabled. Add VITE_SENTRY_DSN to your .env.local to enable Sentry.");return}},au=(s,t,r)=>{Ai({id:s,username:t,email:r})},Mr=()=>{Ai(null)},nu={username:"un",email:"em",avatar:"av",createdAt:"ca",elo1v1:"e1",elo2v2:"e2",eloGlobal:"eg",wins1v1:"w1",losses1v1:"l1",wins2v2:"w2",losses2v2:"l2",winsMixed:"wm",lossesMixed:"lm",winStreak:"ws",thursdayWins:"tw",betWins:"bw",fortune:"f",totalEarned:"te",bettingGains:"bg",role:"r",banned:"b",bannedAt:"ba",bannedBy:"bb",theme:"t",banner:"bn",title:"ti",effect:"ef",lastActive:"la",clubId:"ci",team1:"t1",team2:"t2",matchType:"mt",score1:"s1",score2:"s2",timestamp:"ts",recordedBy:"rb",suspicious:"su",fromBetting:"fb",status:"st",createdBy:"cb",startedAt:"sa",finishedAt:"fa",bets:"b",totalBetsTeam1:"tb1",totalBetsTeam2:"tb2",change:"c",reason:"rs",unlocked:"u",unlockedAt:"ua",progress:"p"};Object.fromEntries(Object.entries(nu).map(([s,t])=>[t,s]));const iu={player:0,agent:1,admin:2},ou={0:"player",1:"agent",2:"admin"},lu={"1v1":0,"2v2":1,mixed:2},cu={tueur_gamelle:"tg",roi_jeudi:"rj",millionnaire:"ml",collectionneur:"cl",parieur_fou:"pf"};function fs(s){return Math.floor(s/1e3)}function du(s){return s*1e3}function uu(s){const t=s.toLowerCase();return t.includes("bonus quotidien")||t.includes("daily")?0:t.includes("match")&&!t.includes("pari")?1:t.includes("gain pari")?2:t.includes("perte pari")?3:t.includes("achat")&&t.includes("shop")?4:t.includes("contribution")||t.includes("club")?5:t.includes("badge")?6:t.includes("lootbox")?7:t.includes("challenge")||t.includes("dÃ©fi")?8:t.includes("admin")||t.includes("ajustement")?9:t.includes("taxe")||t.includes("tax")?10:t.includes("booster")?11:t.includes("tournoi")&&t.includes("frais")?12:t.includes("tournoi")&&(t.includes("gain")||t.includes("rÃ©compense"))?13:t.includes("vente")&&t.includes("carte")?14:t.includes("achat")&&t.includes("carte")?15:9}function zs(s){return s?1:0}function mu(s){return s===1}function xu(s){const t={};return s.username&&(t.un=s.username),s.email&&(t.em=s.email),s.avatar&&(t.av=s.avatar),s.createdAt&&(t.ca=fs(s.createdAt)),s.elo1v1!==void 0?t.e1=s.elo1v1:s.eloRating!==void 0&&(t.e1=s.eloRating),s.elo2v2!==void 0?t.e2=s.elo2v2:s.eloRating!==void 0&&(t.e2=s.eloRating),s.eloGlobal!==void 0?t.eg=s.eloGlobal:s.eloRating!==void 0&&(t.eg=s.eloRating),s.wins1v1!==void 0?t.w1=s.wins1v1:s.wins!==void 0&&(t.w1=s.wins),s.losses1v1!==void 0?t.l1=s.losses1v1:s.losses!==void 0&&(t.l1=s.losses),s.wins2v2!==void 0?t.w2=s.wins2v2:s.wins!==void 0&&(t.w2=s.wins),s.losses2v2!==void 0?t.l2=s.losses2v2:s.losses!==void 0&&(t.l2=s.losses),s.winsMixed!==void 0&&(t.wm=s.winsMixed),s.lossesMixed!==void 0&&(t.lm=s.lossesMixed),s.winStreak!==void 0&&(t.ws=s.winStreak),s.thursdayWins!==void 0&&(t.tw=s.thursdayWins),s.betWins!==void 0&&(t.bw=s.betWins),s.fortune!==void 0&&(t.f=s.fortune),s.totalEarned!==void 0&&(t.te=s.totalEarned),s.bettingGains!==void 0&&(t.bg=s.bettingGains),s.role&&(t.r=iu[s.role]??0),s.banned!==void 0&&(t.b=zs(s.banned)),s.cards&&(t.cards=s.cards),s.inventory&&(t.inventory=s.inventory),s.friends&&(t.friends=s.friends),s.settings&&(t.settings=s.settings),s.lastBonusClaim!==void 0&&(t.lastBonusClaim=fs(s.lastBonusClaim)),s.totalDailyBonus!==void 0&&(t.totalDailyBonus=s.totalDailyBonus),s.dailyBonusStreak!==void 0&&(t.dailyBonusStreak=s.dailyBonusStreak),s.hasSeenTutorial!==void 0&&(t.hasSeenTutorial=zs(s.hasSeenTutorial)),s.clubId&&(t.clubId=s.clubId),t}function Yt(s){const t={};return s.un&&(t.username=s.un),s.em&&(t.email=s.em),s.av&&(t.avatar=s.av),s.ca&&(t.createdAt=du(s.ca)),s.e1!==void 0&&(t.elo1v1=s.e1),s.e2!==void 0&&(t.elo2v2=s.e2),s.eg!==void 0&&(t.eloGlobal=s.eg),s.w1!==void 0&&(t.wins1v1=s.w1),s.l1!==void 0&&(t.losses1v1=s.l1),s.w2!==void 0&&(t.wins2v2=s.w2),s.l2!==void 0&&(t.losses2v2=s.l2),s.wm!==void 0&&(t.winsMixed=s.wm),s.lm!==void 0&&(t.lossesMixed=s.lm),s.ws!==void 0&&(t.winStreak=s.ws),s.tw!==void 0&&(t.thursdayWins=s.tw),s.bw!==void 0&&(t.betWins=s.bw),s.f!==void 0&&(t.fortune=s.f),s.te!==void 0&&(t.totalEarned=s.te),s.bg!==void 0&&(t.bettingGains=s.bg),s.r!==void 0&&(t.role=ou[s.r]||"player"),s.b!==void 0&&(t.banned=mu(s.b)),s.cards&&(t.cards=s.cards),s.inventory&&(t.inventory=s.inventory),s.friends&&(t.friends=s.friends),s.settings&&(t.settings=s.settings),t}function Mi(s){return{t1:s.team1,t2:s.team2,mt:lu[s.matchType]??0,s1:s.score1,s2:s.score2,ts:fs(s.timestamp||Date.now()),rb:s.recordedBy,su:zs(s.suspicious||!1),fb:zs(s.fromBetting||!1)}}function hu(s){return{ts:fs(s.timestamp||Date.now()),f:s.fortune,c:s.change,rs:uu(s.reason)}}function fu(s){return{u:zs(s.unlocked),ua:fs(s.unlockedAt||Date.now()),p:s.progress||0}}const Ti=m.createContext(void 0);function Ae(){const s=m.useContext(Ti);if(s===void 0)throw new Error("useAuth must be used within an AuthProvider");return s}function pu({children:s}){const[t,r]=m.useState(null),[n,a]=m.useState(null),[i,o]=m.useState(!0),l=async p=>{var f;try{const x=S(k,`users/${p}`),g=await z(x);if(g.exists()){const y=g.val();if(y.banned===!0){await _r(Vt),$({title:"ðŸš« Compte banni",description:"Votre compte a Ã©tÃ© banni. Contactez un administrateur.",variant:"destructive"}),r(null),a(null),Mr();return}a(y),p&&au(p,y.username,((f=Vt.currentUser)==null?void 0:f.email)||void 0)}}catch(x){b.error("Error fetching user profile:",x)}};m.useEffect(()=>{const p=Nc(Vt,f=>{r(f),f?setTimeout(()=>{l(f.uid)},0):(a(null),Mr()),o(!1)});return()=>p()},[]);const h={user:t,userProfile:n,loading:i,login:async(p,f)=>{try{const g=(await Sc(Vt,p,f)).user.uid,y=S(k,`users/${g}`),j=await z(y);return j.exists()&&j.val().banned===!0?(await _r(Vt),{error:"ðŸš« Ce compte a Ã©tÃ© banni. Contactez un administrateur pour plus d'informations."}):{error:null}}catch(x){let g="Une erreur est survenue lors de la connexion.";switch(x.code){case"auth/invalid-email":g="Adresse email invalide.";break;case"auth/user-disabled":g="Ce compte a Ã©tÃ© dÃ©sactivÃ©.";break;case"auth/user-not-found":g="Aucun compte trouvÃ© avec cette adresse email.";break;case"auth/wrong-password":g="Mot de passe incorrect.";break;case"auth/invalid-credential":g="Email ou mot de passe incorrect.";break;case"auth/too-many-requests":g="Trop de tentatives. RÃ©essayez plus tard.";break}return{error:g}}},signup:async(p,f,x)=>{try{b.log("ðŸ“ CrÃ©ation du compte pour:",p);const y=(await ui(Vt,p,f)).user;await Cc(y,{displayName:x});const j={username:x,eloRating:1e3,wins:0,losses:0,fortune:100,totalEarned:0,role:"player",banned:!1,hasSeenTutorial:!1,createdAt:new Date().toISOString()},M=Date.now(),P=24*60*60*1e3,w=xu({username:x,eloRating:1e3,wins:0,losses:0,fortune:100,totalEarned:0,role:"player",banned:!1,hasSeenTutorial:!1,createdAt:M,lastBonusClaim:M-P,totalDailyBonus:0,dailyBonusStreak:0,winStreak:0,thursdayWins:0,betWins:0});return await Re(S(k,`users/${y.uid}`),w),a(j),b.log("âœ… Profil crÃ©Ã© avec succÃ¨s pour:",y.uid),{error:null,userId:y.uid}}catch(g){b.error("âŒ Erreur inscription:",g);let y="Une erreur est survenue lors de l'inscription.";switch(g.code){case"auth/email-already-in-use":y="Cette adresse email est dÃ©jÃ  utilisÃ©e.";break;case"auth/invalid-email":y="Adresse email invalide.";break;case"auth/operation-not-allowed":y="L'inscription par email n'est pas activÃ©e.";break;case"auth/weak-password":y="Le mot de passe doit contenir au moins 6 caractÃ¨res.";break}return{error:y}}},logout:async()=>{try{await _r(Vt),a(null),Mr()}catch(p){b.error("Error signing out:",p)}}};return e.jsx(Ti.Provider,{value:h,children:s})}const gu=m.createContext(void 0),Wa={theme_purple:{primary:"270 100% 50%",secondary:"280 100% 50%",background:"270 20% 5%"},theme_green:{primary:"142 76% 36%",secondary:"142 76% 46%",background:"142 20% 5%"},theme_gold:{primary:"38 92% 50%",secondary:"45 93% 58%",background:"38 20% 5%"}};function bu({children:s}){const{user:t}=Ae(),[r,n]=m.useState(""),[a,i]=m.useState(""),[o,l]=m.useState("");m.useEffect(()=>{if(!t)return;(async()=>{try{const u=S(k,`users/${t.uid}`),h=await z(u);if(h.exists()){const p=h.val(),f=p.equippedTheme||"",x=p.equippedBanner||"",g=p.equippedEffect||"";n(f),i(x),l(g),f&&Wa[f]&&c(f)}}catch(u){b.error("Erreur chargement items Ã©quipÃ©s:",u)}})()},[t]);const c=d=>{const u=Wa[d];u&&(document.documentElement.style.setProperty("--primary",u.primary),document.documentElement.style.setProperty("--secondary",u.secondary),document.documentElement.style.setProperty("--background",u.background),n(d))};return e.jsx(gu.Provider,{value:{currentTheme:r,currentBanner:a,currentEffect:o,applyTheme:c},children:s})}function Qe({children:s}){const{user:t,loading:r}=Ae(),n=Hs();return r?e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-background",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(ue,{className:"h-10 w-10 animate-spin text-primary"}),e.jsx("p",{className:"text-muted-foreground",children:"Chargement..."})]})}):t?e.jsx(e.Fragment,{children:s}):e.jsx(hc,{to:"/auth",state:{from:n},replace:!0})}const ga=br("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-semibold transition-all duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-[0_0_20px_hsla(180,100%,50%,0.4)]",destructive:"bg-secondary text-secondary-foreground hover:bg-secondary/90 shadow-[0_0_20px_hsla(300,100%,50%,0.4)]",outline:"border border-border bg-transparent hover:bg-muted hover:border-primary hover:text-primary",secondary:"bg-muted text-foreground hover:bg-muted/80",ghost:"hover:bg-muted hover:text-foreground",link:"text-primary underline-offset-4 hover:underline",neon:"bg-transparent border-2 border-primary text-primary hover:bg-primary hover:text-primary-foreground shadow-[0_0_10px_hsla(180,100%,50%,0.4),inset_0_0_10px_hsla(180,100%,50%,0.1)]","neon-magenta":"bg-transparent border-2 border-secondary text-secondary hover:bg-secondary hover:text-secondary-foreground shadow-[0_0_10px_hsla(300,100%,50%,0.4),inset_0_0_10px_hsla(300,100%,50%,0.1)]",gaming:"bg-gradient-to-r from-primary/20 to-secondary/20 border border-primary/50 text-foreground hover:border-primary hover:from-primary/30 hover:to-secondary/30"},size:{default:"h-11 px-5 py-2",sm:"h-9 rounded-md px-3 text-xs",lg:"h-12 rounded-lg px-8 text-base",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),T=m.forwardRef(({className:s,variant:t,size:r,asChild:n=!1,...a},i)=>{const o=n?jl:"button";return e.jsx(o,{className:me(ga({variant:t,size:r,className:s})),ref:i,...a})});T.displayName="Button";const L=m.forwardRef(({className:s,...t},r)=>e.jsx("div",{ref:r,className:me("rounded-xl border border-border bg-card text-card-foreground shadow-lg backdrop-blur-sm transition-all duration-300 hover:border-primary/30",s),...t}));L.displayName="Card";const xe=m.forwardRef(({className:s,...t},r)=>e.jsx("div",{ref:r,className:me("flex flex-col space-y-1.5 p-6",s),...t}));xe.displayName="CardHeader";const he=m.forwardRef(({className:s,...t},r)=>e.jsx("h3",{ref:r,className:me("text-xl font-semibold leading-none tracking-tight",s),...t}));he.displayName="CardTitle";const ba=m.forwardRef(({className:s,...t},r)=>e.jsx("p",{ref:r,className:me("text-sm text-muted-foreground",s),...t}));ba.displayName="CardDescription";const V=m.forwardRef(({className:s,...t},r)=>e.jsx("div",{ref:r,className:me("p-6 pt-0",s),...t}));V.displayName="CardContent";const vu=m.forwardRef(({className:s,...t},r)=>e.jsx("div",{ref:r,className:me("flex items-center p-6 pt-0",s),...t}));vu.displayName="CardFooter";class yu extends m.Component{constructor(r){super(r);Sr(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});Sr(this,"handleGoHome",()=>{window.location.href="/"});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(r){return{hasError:!0,error:r,errorInfo:null}}componentDidCatch(r,n){b.error("ErrorBoundary caught an error:",r,n),this.setState({error:r,errorInfo:n})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-background p-4",children:e.jsxs(L,{className:"max-w-md w-full",children:[e.jsx(xe,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"rounded-full bg-destructive/20 p-2",children:e.jsx(ds,{className:"h-6 w-6 text-destructive"})}),e.jsx(he,{className:"text-xl",children:"Une erreur est survenue"})]})}),e.jsxs(V,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"DÃ©solÃ©, une erreur inattendue s'est produite. Veuillez rÃ©essayer."}),!1,e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(T,{onClick:this.handleReset,variant:"outline",className:"flex-1",children:[e.jsx(Gl,{className:"h-4 w-4 mr-2"}),"RÃ©essayer"]}),e.jsxs(T,{onClick:this.handleGoHome,className:"flex-1",children:[e.jsx(ia,{className:"h-4 w-4 mr-2"}),"Accueil"]})]})]})]})}):this.props.children}}const ju=br("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function le({className:s,variant:t,...r}){return e.jsx("div",{className:me(ju({variant:t}),s),...r})}const wu=Nl,Nu=Cl,Pi=m.forwardRef(({className:s,align:t="center",sideOffset:r=4,...n},a)=>e.jsx(wl,{children:e.jsx(En,{ref:a,align:t,sideOffset:r,className:me("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...n})}));Pi.displayName=En.displayName;const Oi=m.forwardRef(({className:s,children:t,...r},n)=>e.jsxs(Rn,{ref:n,className:me("relative overflow-hidden",s),...r,children:[e.jsx(Sl,{className:"h-full w-full rounded-[inherit]",children:t}),e.jsx(Li,{}),e.jsx(kl,{})]}));Oi.displayName=Rn.displayName;const Li=m.forwardRef(({className:s,orientation:t="vertical",...r},n)=>e.jsx($n,{ref:n,orientation:t,className:me("flex touch-none select-none transition-colors",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",t==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...r,children:e.jsx(_l,{className:"relative flex-1 rounded-full bg-border"})}));Li.displayName=$n.displayName;const Ii=()=>{const{user:s}=Ae(),[t,r]=m.useState([]),[n,a]=m.useState(!1),i=m.useRef(0);m.useEffect(()=>{"Notification"in window&&Notification.permission==="default"&&Notification.requestPermission()},[]);const o=(x=200)=>{"vibrate"in navigator&&navigator.vibrate(x)},l=x=>{if("Notification"in window&&Notification.permission==="granted"){const g=new window.Notification(x.title,{body:x.message,icon:"/favicon.ico",badge:"/favicon.ico",tag:x.id,requireInteraction:!1,silent:!1});o([100,50,100]),setTimeout(()=>g.close(),5e3),g.onclick=()=>{window.focus(),g.close(),x.relatedId&&b.log("Navigation vers:",x.relatedId)}}};m.useEffect(()=>{if(!s)return;const x=S(k,`notifications/${s.uid}`);return et(x,g=>{if(g.exists()){const y=g.val(),j=Object.entries(y).map(([w,I])=>!I||typeof I!="object"?null:{id:w,...I}).filter(w=>w!==null);j.sort((w,I)=>I.createdAt-w.createdAt);const M=j.filter(w=>!w.read).length;if(M>i.current){const w=j.filter(I=>!I.read).sort((I,O)=>O.createdAt-I.createdAt)[0];w&&Date.now()-w.createdAt<1e4&&l(w)}i.current=M,r(j)}else r([]),i.current=0}),()=>{ca(x)}},[s]);const c=t.filter(x=>!x.read).length,d=async x=>{if(s)try{await oe(S(k),{[`notifications/${s.uid}/${x}/read`]:!0})}catch(g){b.error("Erreur marquage notification:",g)}},u=async()=>{if(s)try{const x={};t.forEach(g=>{g.read||(x[`notifications/${s.uid}/${g.id}/read`]=!0)}),Object.keys(x).length>0&&await oe(S(k),x)}catch(x){b.error("Erreur marquage toutes notifications:",x)}},h=async x=>{if(s)try{await oe(S(k),{[`notifications/${s.uid}/${x}`]:null})}catch(g){b.error("Erreur suppression notification:",g)}},p=x=>{switch(x){case"offer_received":case"offer_countered":return e.jsx(Fs,{className:"h-4 w-4 text-blue-500"});case"offer_accepted":return e.jsx(at,{className:"h-4 w-4 text-green-500"});case"offer_rejected":return e.jsx(Fe,{className:"h-4 w-4 text-red-500"});case"listing_sold":return e.jsx(Wt,{className:"h-4 w-4 text-yellow-500"});default:return e.jsx(Ts,{className:"h-4 w-4"})}},f=x=>{const g=Math.floor((Date.now()-x)/1e3);if(g<60)return"Ã€ l'instant";const y=Math.floor(g/60);if(y<60)return`Il y a ${y}min`;const j=Math.floor(y/60);return j<24?`Il y a ${j}h`:`Il y a ${Math.floor(j/24)}j`};return s?e.jsxs(wu,{open:n,onOpenChange:a,children:[e.jsx(Nu,{asChild:!0,children:e.jsxs(T,{variant:"outline",size:"icon",className:"relative",children:[e.jsx(Ts,{className:"h-4 w-4"}),e.jsx(nt,{children:c>0&&e.jsx(W.div,{initial:{scale:0},animate:{scale:1},exit:{scale:0},className:"absolute -top-1 -right-1",children:e.jsx(le,{className:"h-5 w-5 p-0 flex items-center justify-center bg-red-500 text-white text-xs",children:c>9?"9+":c})})})]})}),e.jsxs(Pi,{className:"w-80 p-0",align:"end",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsx("h3",{className:"font-semibold",children:"Notifications"}),c>0&&e.jsx(T,{variant:"ghost",size:"sm",onClick:u,className:"text-xs",children:"Tout marquer comme lu"})]}),e.jsx(Oi,{className:"h-96",children:t.length===0?e.jsxs("div",{className:"p-8 text-center text-muted-foreground text-sm",children:[e.jsx(Ts,{className:"h-12 w-12 mx-auto mb-2 opacity-20"}),e.jsx("p",{children:"Aucune notification"})]}):e.jsx("div",{className:"divide-y",children:t.map(x=>!x||!x.type?null:e.jsx(W.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:`p-4 hover:bg-muted/50 transition-colors cursor-pointer ${x.read?"":"bg-blue-500/5"}`,onClick:()=>{x.read||d(x.id)},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-1",children:p(x.type)}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("p",{className:"text-sm font-medium leading-tight",children:x.title}),!x.read&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500 flex-shrink-0 mt-1"})]}),e.jsx("p",{className:"text-xs text-muted-foreground leading-tight",children:x.message}),e.jsxs("div",{className:"flex items-center justify-between pt-1",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:f(x.createdAt)}),e.jsx(T,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:g=>{g.stopPropagation(),h(x.id)},children:e.jsx(Fe,{className:"h-3 w-3"})})]})]})]})},x.id))})})]})]}):null};function Di(){return"serviceWorker"in navigator&&"Notification"in window&&(window.location.protocol==="https:"||window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")}async function Qa(s){if(!Di())return null;try{const t=await Notification.requestPermission();if(b.log("ðŸ“± [FCM] RÃ©sultat permission:",t),t!=="granted")return b.log("âŒ [FCM] Permission refusÃ©e par l'utilisateur"),null;b.log("ðŸ”‘ [FCM] Tentative d'obtention du token...");const r=await _c(pa,{vapidKey:su});return b.log("ðŸ”‘ [FCM] Token obtenu:",r?"OUI âœ…":"NON âŒ"),r?(b.log("âœ… [FCM] Token FCM complet:",r),b.log("ðŸ’¾ [FCM] Sauvegarde du token dans Firebase Database..."),await oe(S(k,`users/${s}`),{fcmToken:r,fcmTokenUpdatedAt:Date.now()}),b.log("âœ… [FCM] Token sauvegardÃ© avec succÃ¨s dans Firebase !"),b.log("ðŸ“ [FCM] Chemin: users/"+s+"/fcmToken"),r):(b.log("âŒ [FCM] Impossible d'obtenir le token (messaging non initialisÃ© ?)"),null)}catch(t){return b.error("âŒ [FCM] Erreur lors de l'obtention du token:",t),t instanceof Error&&(b.error("âŒ [FCM] Message d'erreur:",t.message),b.error("âŒ [FCM] Stack:",t.stack)),null}}function Cu(s){if(Di())try{kc(pa,t=>{b.log("ðŸ“© [FCM] Message reÃ§u en premier plan:",t),s(t),"vibrate"in navigator&&(navigator.vibrate([100,50,100]),b.log("ðŸ“³ [FCM] Vibration dÃ©clenchÃ©e"))}),b.log("âœ… [FCM] Listeners configurÃ©s avec succÃ¨s")}catch(t){b.error("âŒ [FCM] Erreur lors de la configuration des listeners:",t)}}const Su=()=>{const{user:s}=Ae(),t=m.useRef(!1),r=m.useRef(!1);m.useEffect(()=>!s||t.current?void 0:(t.current=!0,b.log("ðŸ”” [useNotifications] Initialisation pour:",s.uid),(async()=>{const a=Notification.permission;a==="granted"?await Qa(s.uid):a==="default"&&await Qa(s.uid)&&$({title:"âœ… Notifications activÃ©es",description:"Vous recevrez les notifications mÃªme quand l'app est fermÃ©e",duration:4e3})})(),r.current||(r.current=!0,Cu(a=>{var i,o,l;b.log("ðŸ“¬ [useNotifications] Message reÃ§u:",(i=a.notification)==null?void 0:i.title),$({title:((o=a.notification)==null?void 0:o.title)||"Notification",description:((l=a.notification)==null?void 0:l.body)||"",duration:5e3})})),()=>{t.current=!1}),[s])},ku={initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20}},_u={type:"tween",ease:"anticipate",duration:.3};function Be({children:s}){return e.jsx(W.div,{initial:"initial",animate:"animate",exit:"exit",variants:ku,transition:_u,className:"w-full",children:s})}const Eu=[{id:"daily_play_matches",title:"Joueur actif",description:"Jouer 3 matchs",category:"match",target:3,reward:{fortune:10}},{id:"daily_win_1v1",title:"MaÃ®tre du duel",description:"Gagner 2 matchs en 1v1",category:"win_1v1",target:2,reward:{fortune:15}},{id:"daily_win_2v2",title:"Esprit d'Ã©quipe",description:"Gagner 2 matchs en 2v2",category:"win_2v2",target:2,reward:{fortune:15}},{id:"daily_claim_bonus",title:"Assidu",description:"RÃ©cupÃ©rer le bonus quotidien",category:"progression",target:1,reward:{fortune:5}},{id:"daily_open_pack",title:"Collectionneur",description:"Ouvrir 1 pack de cartes",category:"collection",target:1,reward:{fortune:20}},{id:"daily_chat_message",title:"Social",description:"Envoyer 5 messages dans le chat",category:"social",target:5,reward:{fortune:8}}],Ru=[{id:"weekly_win_matches",title:"Champion de la semaine",description:"Gagner 10 matchs",category:"win_any",target:10,reward:{fortune:100,packs:1}},{id:"weekly_elo_gain",title:"Ascension",description:"Gagner 50 points d'ELO",category:"progression",target:50,reward:{fortune:80,badge:"weekly_climber"}},{id:"weekly_tournament",title:"CompÃ©titeur",description:"Participer au tournoi hebdomadaire",category:"match",target:1,reward:{fortune:50}},{id:"weekly_collection",title:"MaÃ®tre collectionneur",description:"Collecter 5 nouvelles cartes",category:"collection",target:5,reward:{fortune:150,packs:2}}];function Qr(){const s=Date.now(),t=new Date;return t.setHours(23,59,59,999),Eu.sort(()=>Math.random()-.5).slice(0,4).map(n=>({...n,id:`${n.id}_${s}`,type:"daily",progress:0,completed:!1,expiresAt:t.getTime()}))}function Jr(){const s=Date.now(),t=new Date,r=(8-t.getDay())%7||7;return t.setDate(t.getDate()+r),t.setHours(23,59,59,999),Ru.map(n=>({...n,id:`${n.id}_${s}`,type:"weekly",progress:0,completed:!1,expiresAt:t.getTime()}))}async function yr(s){try{const t=S(k,`quests/${s}`),r=await z(t),n=Date.now(),a=new Date().setHours(0,0,0,0),i=Au();let o;return r.exists()?(o=r.val(),o.lastDailyReset<a&&(b.log("ðŸ”„ RÃ©initialisation quÃªtes quotidiennes pour:",s),o.daily=Qr(),o.lastDailyReset=a),o.lastWeeklyReset<i&&(b.log("ðŸ”„ RÃ©initialisation quÃªtes hebdomadaires pour:",s),o.weekly=Jr(),o.lastWeeklyReset=i)):o={daily:Qr(),weekly:Jr(),special:[],lastDailyReset:a,lastWeeklyReset:i},await Re(t,o),o}catch(t){throw b.error("Erreur checkAndResetQuests:",t),t}}async function $u(s,t,r=1){try{const n=await yr(s);let a=!1;if(["daily","weekly","special"].forEach(i=>{n[i].forEach(l=>{l.category===t&&!l.completed&&(l.progress=Math.min(l.progress+r,l.target),l.progress>=l.target&&(l.completed=!0,b.log("âœ… QuÃªte complÃ©tÃ©e:",l.title)),a=!0)})}),a){const i=S(k,`quests/${s}`);await Re(i,n)}}catch(n){b.error("Erreur updateQuestProgress:",n)}}async function Fi(s,t,r){var n,a;try{const i=await yr(s),o=i[t],l=o.findIndex(p=>p.id===r);if(l===-1)return{success:!1,error:"QuÃªte introuvable"};const c=o[l];if(!c.completed)return{success:!1,error:"QuÃªte non complÃ©tÃ©e"};if(c.claimedAt)return{success:!1,error:"RÃ©compense dÃ©jÃ  rÃ©clamÃ©e"};c.claimedAt=Date.now();const d=S(k,`users/${s}`),u=await z(d);if(u.exists()){const p=u.val(),f={};c.reward.fortune&&(f.fortune=(p.fortune||0)+c.reward.fortune,f.totalEarned=(p.totalEarned||0)+c.reward.fortune),c.reward.packs&&(f["inventory/packs/common"]=(((a=(n=p.inventory)==null?void 0:n.packs)==null?void 0:a.common)||0)+c.reward.packs),c.reward.badge&&(f[`badges/${c.reward.badge}`]={unlockedAt:Date.now(),type:"quest"}),await oe(d,f)}const h=S(k,`quests/${s}`);return await Re(h,i),{success:!0,reward:c.reward}}catch(i){return b.error("Erreur claimQuestReward:",i),{success:!1,error:"Erreur serveur"}}}function Au(){const s=new Date,t=s.getDay(),r=s.getDate()-t+(t===0?-6:1),n=new Date(s.setDate(r));return n.setHours(0,0,0,0),n.getTime()}async function zi(s){return yr(s)}const Mu=Object.freeze(Object.defineProperty({__proto__:null,checkAndResetQuests:yr,claimQuestReward:Fi,generateDailyQuests:Qr,generateWeeklyQuests:Jr,getUserQuests:zi,updateQuestProgress:$u},Symbol.toStringTag,{value:"Module"})),va=s=>{const[t,r]=m.useState(null),[n,a]=m.useState(!0),[i,o]=m.useState(!1);m.useEffect(()=>{if(!s){a(!1);return}(async()=>{try{const p=await zi(s);r(p)}catch(p){b.error("Erreur chargement quÃªtes:",p)}finally{a(!1)}})();const u=S(k,`quests/${s}`),h=et(u,p=>{p.exists()&&r(p.val())});return()=>h()},[s]);const l=async(d,u)=>{if(!(!s||i)){o(!0);try{const h=await Fi(s,d,u);h.success&&h.reward?$({title:"ðŸŽ‰ RÃ©compense rÃ©cupÃ©rÃ©e !",description:`${h.reward.fortune?`+${h.reward.fortune} Fortune`:""}${h.reward.packs?` +${h.reward.packs} Pack(s)`:""}${h.reward.badge?" +Badge spÃ©cial":""}`}):$({title:"Erreur",description:h.error||"Impossible de rÃ©cupÃ©rer la rÃ©compense",variant:"destructive"})}catch(h){b.error("Erreur rÃ©cupÃ©ration rÃ©compense:",h),$({title:"Erreur",description:"Une erreur est survenue",variant:"destructive"})}finally{o(!1)}}},c=t?{dailyCompleted:t.daily.filter(d=>d.completed).length,dailyTotal:t.daily.length,weeklyCompleted:t.weekly.filter(d=>d.completed).length,weeklyTotal:t.weekly.length,dailyProgress:Math.round(t.daily.filter(d=>d.completed).length/t.daily.length*100),weeklyProgress:Math.round(t.weekly.filter(d=>d.completed).length/t.weekly.length*100)}:null;return{quests:t,isLoading:n,isClaiming:i,claimReward:l,stats:c}},Tu=()=>{const{user:s}=Ae(),{quests:t}=va(s==null?void 0:s.uid);if(!t)return null;const r=[...t.daily.filter(n=>n.completed&&!n.claimedAt),...t.weekly.filter(n=>n.completed&&!n.claimedAt)].length;return r===0?null:e.jsx("div",{className:"absolute -top-1 -right-1 flex h-5 w-5 items-center justify-center rounded-full bg-red-500 text-[10px] font-bold text-white border-2 border-card animate-pulse",children:r>9?"9+":r})},Pu=[{to:"/",icon:ia,label:"Accueil",badge:null},{to:"/leaderboard",icon:Pe,label:"Classement",badge:null},{to:"/match",icon:Ee,label:"Match",badge:null},{to:"/quests",icon:js,label:"QuÃªtes",badge:Tu},{to:"/babydex",icon:ti,label:"BabyDex",badge:null},{to:"/profile",icon:Vs,label:"Profil",badge:null}];function Ou(){return e.jsx("nav",{className:"fixed bottom-0 left-0 right-0 z-50 border-t border-border bg-card/95 backdrop-blur-lg",children:e.jsx("div",{className:"mx-auto max-w-lg overflow-x-auto",children:e.jsx("div",{className:"flex h-16 items-center justify-around px-1",children:Pu.map(s=>e.jsx(fc,{to:s.to,className:({isActive:t})=>me("relative flex flex-col items-center justify-center gap-1 px-2 py-1 text-[11px] font-medium transition-colors",t?"text-primary":"text-muted-foreground hover:text-foreground"),children:({isActive:t})=>e.jsxs(e.Fragment,{children:[t&&e.jsx(W.div,{layoutId:"activeTab",className:"absolute inset-0 rounded-lg bg-primary/10",initial:!1,transition:{type:"spring",stiffness:500,damping:30}}),e.jsxs("div",{className:"relative",children:[e.jsx(s.icon,{className:me("h-5 w-5 transition-all",t&&"text-glow-cyan")}),s.badge&&e.jsx(s.badge,{})]}),e.jsx("span",{className:"relative z-10",children:s.label})]})},s.to))})})})}function Lu(){const s=ht();return Hs().pathname==="/"?null:e.jsx(T,{variant:"ghost",size:"icon",onClick:()=>s(-1),"aria-label":"Retour Ã  la page prÃ©cÃ©dente",className:"h-9 w-9",children:e.jsx(pr,{className:"h-5 w-5"})})}const $e=({children:s})=>{const{logout:t}=Ae(),r=ht(),n=async()=>{await t(),r("/auth")};return e.jsxs("div",{className:"min-h-screen bg-background pb-20",children:[e.jsx("header",{className:"sticky top-0 z-50 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:e.jsxs("div",{className:"container flex h-14 items-center justify-between px-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Lu,{}),e.jsx(T,{variant:"ghost",size:"icon",onClick:()=>r("/"),"aria-label":"Retour Ã  l'accueil",children:e.jsx(ia,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-xl font-bold",children:"Baby-Foot App"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ii,{}),e.jsx(T,{variant:"ghost",size:"icon",onClick:()=>r("/profile"),"aria-label":"Voir mon profil",children:e.jsx(Vs,{className:"h-5 w-5"})}),e.jsx(T,{variant:"ghost",size:"icon",onClick:n,"aria-label":"Se dÃ©connecter",children:e.jsx(oa,{className:"h-5 w-5"})})]})]})}),e.jsx("main",{className:"container px-4 py-6",children:s}),e.jsx(Ou,{})]})};async function Iu(s=10){try{const t=S(k,"matches"),r=await z(t);if(!r.exists())return[];const n=[];return r.forEach(a=>{n.push({id:a.key,...a.val()})}),n.sort((a,i)=>(i.timestamp||0)-(a.timestamp||0)).slice(0,s)}catch(t){return b.error("Erreur chargement matchs:",t),[]}}function Bi(s,t=10){const r=S(k,"matches");return et(r,a=>{const i=[];a.forEach(o=>{i.push({id:o.key,...o.val()})}),s(i.sort((o,l)=>(l.timestamp||0)-(o.timestamp||0)).slice(0,t))})}async function Du(){try{const s=S(k,"matchQueue"),t=await z(s);if(!t.exists())return[];const r=[];return t.forEach(n=>{r.push({id:n.key,...n.val()})}),r}catch(s){return b.error("Erreur chargement queue:",s),[]}}function Ui(s){const t=S(k,"matchQueue");return et(t,n=>{const a=[];n.forEach(i=>{a.push({id:i.key,...i.val()})}),s(a)})}async function qi(){try{const s=await z(S(k,"users")),t=await z(S(k,"matches")),r=[];s.forEach(o=>{r.push(o.val())});const n=r.length,a=r.length>0?Math.round(r.reduce((o,l)=>o+(l.eloRating||1e3),0)/r.length):0,i=t.size;return{totalPlayers:n,averageElo:a,totalMatches:i}}catch(s){return b.error("Erreur chargement stats:",s),{totalPlayers:0,averageElo:0,totalMatches:0}}}function Fu(s){let t=null,r=null;const n=async()=>{const a=await qi();s(a)};return t=et(S(k,"users"),()=>{n()}),r=et(S(k,"matches"),()=>{n()}),()=>{t==null||t(),r==null||r()}}const zu="modulepreload",Bu=function(s){return"/"+s},Ja={},rt=function(t,r,n){let a=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));a=Promise.allSettled(r.map(c=>{if(c=Bu(c),c in Ja)return;Ja[c]=!0;const d=c.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":zu,d||(h.as="script"),h.crossOrigin="",h.href=c,l&&h.setAttribute("nonce",l),document.head.appendChild(h),d)return new Promise((p,f)=>{h.addEventListener("load",p),h.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return a.then(o=>{for(const l of o||[])l.status==="rejected"&&i(l.reason);return t().catch(i)})},ps={season1:{N831:{nom:"Lilwenn.png",rarity:"Bronze-NR"},R174:{nom:"Cloe.png",rarity:"Bronze-NR"},J665:{nom:"Romane.png",rarity:"Bronze-R"},D384:{nom:"Maxence.png",rarity:"Bronze-R"},W350:{nom:"Ioana.png",rarity:"Silver-NR"},B298:{nom:"Eli-jah.png",rarity:"Silver-R"},Y912:{nom:"Kathell.png",rarity:"Silver-R"},U934:{nom:"Shana.png",rarity:"Silver-R"},Z473:{nom:"Faustin.png",rarity:"Silver-NR"},M483:{nom:"Abel.png",rarity:"Silver-R"},C407:{nom:"Lola.png",rarity:"Silver-NR"},Q493:{nom:"Lucas.png",rarity:"Silver-NR"},H997:{nom:"Yoris.png",rarity:"Gold-NR"},U532:{nom:"Prune.png",rarity:"Gold-NR"},S849:{nom:"Thais.png",rarity:"Gold-R"},K006:{nom:"Adams.png",rarity:"Gold-R"},F825:{nom:"Ambre.png",rarity:"Gold-R"},T209:{nom:"Marceau.png",rarity:"Espoir"},Q514:{nom:"Mathys.png",rarity:"Espoir"},L276:{nom:"Thimeo.png",rarity:"Icone"},C478:{nom:"Mael.png",rarity:"Icone"},X118:{nom:"Nathael.png",rarity:"Future-star"},A621:{nom:"Enzo.png",rarity:"Hist.Maker"},T294:{nom:"Larry.png",rarity:"God"},Q574:{nom:"Chenaie.png",rarity:"Createur"},U986:{nom:"BouBou.png",rarity:"BouBou"},U956:{nom:"Dracaufeu.png",rarity:"PikaPika"}},season2:{S2N001:{nom:"Player1.png",rarity:"Bronze-NR"},S2N002:{nom:"Player2.png",rarity:"Bronze-NR"},S2R001:{nom:"Player3.png",rarity:"Bronze-R"},S2R002:{nom:"Player4.png",rarity:"Bronze-R"},S2W001:{nom:"Player5.png",rarity:"Silver-NR"},S2B001:{nom:"Player6.png",rarity:"Silver-R"},S2Y001:{nom:"Player7.png",rarity:"Silver-R"},S2U001:{nom:"Player8.png",rarity:"Silver-R"},S2Z001:{nom:"Player9.png",rarity:"Silver-NR"},S2M001:{nom:"Player10.png",rarity:"Silver-R"},S2C001:{nom:"Player11.png",rarity:"Silver-NR"},S2Q001:{nom:"Player12.png",rarity:"Silver-NR"},S2H001:{nom:"Player13.png",rarity:"Gold-NR"},S2U002:{nom:"Player14.png",rarity:"Gold-NR"},S2S001:{nom:"Player15.png",rarity:"Gold-R"},S2K001:{nom:"Player16.png",rarity:"Gold-R"},S2F001:{nom:"Player17.png",rarity:"Gold-R"},S2T001:{nom:"Player18.png",rarity:"Espoir"},S2Q002:{nom:"Player19.png",rarity:"Espoir"},S2L001:{nom:"Player20.png",rarity:"Icone"},S2C002:{nom:"Player21.png",rarity:"Icone"},S2X001:{nom:"Player22.png",rarity:"Future-star"},S2A001:{nom:"Player23.png",rarity:"Hist.Maker"},S2T002:{nom:"Player24.png",rarity:"God"},S2Q003:{nom:"Player25.png",rarity:"Createur"},S2U003:{nom:"Player26.png",rarity:"BouBou"},S2U004:{nom:"Player27.png",rarity:"PikaPika"}}},Uu={"Bronze-NR":40,"Bronze-R":25,"Silver-NR":15,"Silver-R":10,"Gold-NR":5,"Gold-R":3,Espoir:2,Icone:1.5,"Future-star":.8,God:1,Createur:.5,PikaPika:.2,BouBou:.1,"Hist.Maker":.1};function qu(s,t=new Set){const r=ps[s];if(!r)return null;const n=Object.entries(r).filter(([c])=>!t.has(c));if(n.length===0)return null;let a=0;const i=n.map(([c,d])=>{const u=Uu[d.rarity]||1;return a+=u,{code:c,...d,weight:u}});let o=Math.random()*a;for(const c of i)if(o-=c.weight,o<=0)return{code:c.code,nom:c.nom,rarity:c.rarity,season:s};const l=i[0];return{code:l.code,nom:l.nom,rarity:l.rarity,season:s}}function Vu(s,t){const r=[],n=new Set,a=t*10;let i=0;for(;r.length<t&&i<a;){i++;const o=qu(s,n);if(o&&!n.has(o.code))r.push(o),n.add(o.code);else if(!o){b.error(`âŒ Impossible de tirer une carte aprÃ¨s ${i} tentatives`);break}}return r.length<t&&b.warn(`âš ï¸ Seulement ${r.length}/${t} cartes tirÃ©es`),r}function Et(s){const t=s.trim().toLowerCase();return t.includes("bronze")?"bronze":t.includes("silver")?"silver":t.includes("gold")?"gold":t==="espoir"?"espoir":t==="icone"?"icone":t==="future-star"?"future-star":["god","pikapika","boubou","hist.maker"].includes(t)?"god":t==="createur"?"creator":"unknown"}const Vi=["God","Createur","PikaPika","BouBou","Hist.Maker","Future-star","Icone"];function Gu(s){return Vi.some(t=>s.toLowerCase()===t.toLowerCase())}function Gi(){return Object.keys(ps).sort()}function ss(s){return{season1:"Saison 1",season2:"Saison 2",season3:"Saison 3"}[s]||s}function Hi(s){for(const[t,r]of Object.entries(ps))if(r[s])return{code:s,nom:r[s].nom,rarity:r[s].rarity,season:t,found:!0};return null}const Zs=Object.freeze(Object.defineProperty({__proto__:null,ULTRA_RARE_RARITIES:Vi,codeToCardMap:ps,drawCards:Vu,getAvailableSeasons:Gi,getCardByCode:Hi,getRarityCategory:Et,getSeasonDisplayName:ss,isUltraRare:Gu},Symbol.toStringTag,{value:"Module"}));async function Hu(s){try{const t=S(k,`users/${s}/cards`),r=await z(t);return r.exists()?r.val():{}}catch(t){return b.error("âŒ Erreur chargement quantitÃ©s:",t),{}}}async function Zu(s,t="season1"){try{const n=S(k,`users/${s}`),{drawCards:a,getAvailableSeasons:i,codeToCardMap:o}=await rt(async()=>{const{drawCards:f,getAvailableSeasons:x,codeToCardMap:g}=await Promise.resolve().then(()=>Zs);return{drawCards:f,getAvailableSeasons:x,codeToCardMap:g}},void 0);let l=[];if(t==="mixed"){const f=i();for(let x=0;x<5;x++){const g=f[Math.floor(Math.random()*f.length)],y=a(g,1);y.length>0&&l.push({...y[0],season:g})}}else{if(!o[t])throw new Error(`Saison "${t}" introuvable`);l=a(t,5).map(x=>({...x,season:t}))}if(l.length===0)throw new Error("Ã‰chec du tirage des cartes");const d=(await z(n)).val()||{},u=d.cards||{};let h=d.totalBabyCards||0;const p={};return l.forEach(f=>{const x=(u[f.code]||0)+1;p[`cards/${f.code}`]=x,h++}),p.totalBabyCards=h,p.lastBoosterOpened=new Date().toISOString(),await oe(n,p),l}catch(n){throw b.error("âŒ Erreur openBoosterPack:",n),n}}async function Zi(s){try{const t=await Hu(s);let r=0,n=0,a=0,i=0;const o={},{codeToCardMap:l,isUltraRare:c}=await rt(async()=>{const{codeToCardMap:d,isUltraRare:u}=await Promise.resolve().then(()=>Zs);return{codeToCardMap:d,isUltraRare:u}},void 0);for(const[d,u]of Object.entries(l)){o[d]=0;for(const[h,p]of Object.entries(t))p>0&&u[h]&&(r+=p,n++,o[d]++,c(u[h].rarity)&&(a+=p,i++))}return{totalCards:r,uniqueCards:n,rareCards:a,ultraRareCards:i,cardsBySeason:o}}catch{return{totalCards:0,uniqueCards:0,rareCards:0,ultraRareCards:0,cardsBySeason:{}}}}const It=m.forwardRef(({className:s,value:t,...r},n)=>e.jsx(An,{ref:n,className:me("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...r,children:e.jsx(El,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})}));It.displayName=An.displayName;const Wu=()=>{const{user:s}=Ae(),{quests:t,stats:r}=va(s==null?void 0:s.uid);if(!t)return null;const n=t.daily.find(i=>!i.completed),a=((r==null?void 0:r.dailyCompleted)||0)+((r==null?void 0:r.weeklyCompleted)||0);return e.jsx(W.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3},children:e.jsx(As,{to:"/quests",children:e.jsxs(L,{className:"group cursor-pointer hover:border-primary/50 transition-all overflow-hidden relative",children:[a>0&&e.jsx("div",{className:"absolute top-0 right-0 w-16 h-16 bg-primary/10 rounded-bl-full"}),e.jsx(V,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10 text-primary group-hover:scale-110 transition-transform",children:e.jsx(js,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h3",{className:"font-semibold text-foreground flex items-center gap-2",children:["QuÃªtes du jour",a>0&&e.jsxs("span",{className:"text-xs bg-primary/20 text-primary px-2 py-0.5 rounded-full font-bold",children:[a," âœ“"]})]}),e.jsx(si,{className:"h-4 w-4 text-muted-foreground group-hover:text-primary group-hover:translate-x-1 transition-all"})]}),n?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-muted-foreground mb-2",children:[n.title,": ",n.description]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(It,{value:n.progress/n.target*100,className:"flex-1 h-1.5"}),e.jsxs("span",{className:"text-xs text-muted-foreground whitespace-nowrap",children:[n.progress,"/",n.target]})]})]}):e.jsxs("div",{className:"flex items-center gap-2 text-sm text-primary",children:[e.jsx(Pe,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Toutes les quÃªtes quotidiennes complÃ©tÃ©es !"})]})]})]})})]})})})},Qu=()=>{const{user:s}=Ae(),[t,r]=m.useState({totalPlayers:0,averageElo:0,totalMatches:0}),[n,a]=m.useState([]),[i,o]=m.useState([]),[l,c]=m.useState({totalCards:0,uniqueCards:48}),[d,u]=m.useState(!0);m.useEffect(()=>{(async()=>{try{const[M,P,w]=await Promise.all([qi(),Iu(3),Du()]);if(r(M),a(P),o(w),s){const I=await Zi(s.uid);c(I)}}catch(M){b.error("Erreur chargement donnÃ©es:",M)}finally{u(!1)}})();const g=Fu(r),y=Bi(M=>{a(M.slice(0,3))},3),j=Ui(o);return()=>{g(),y(),j()}},[s]);const h=x=>{const y=Date.now()-x,j=Math.floor(y/6e4),M=Math.floor(y/36e5),P=Math.floor(y/864e5);return j<1?"Ã€ l'instant":j<60?`Il y a ${j} min`:M<24?`Il y a ${M}h`:`Il y a ${P}j`},p=()=>{const x=[];return n.forEach(g=>{if(!g.team1Names||!g.team2Names)return;const y=g.score1>g.score2?g.team1Names.join(" & "):g.team2Names.join(" & ");x.push({text:`${y} a gagnÃ© ${g.score1}-${g.score2}`,time:h(g.timestamp),type:"match"})}),s&&l.uniqueCards>0&&x.push({text:`${l.uniqueCards} cartes uniques collectÃ©es`,time:"Collection",type:"card"}),x.slice(0,3)};if(d)return e.jsx($e,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Chargement..."})]})})});const f=p();return e.jsxs($e,{children:[e.jsxs(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mb-8 text-center",children:[e.jsx(W.div,{animate:{rotate:[0,5,-5,0]},transition:{duration:2,repeat:1/0},className:"mb-4 text-6xl",children:"âš½"}),e.jsxs("h1",{className:"mb-2 text-3xl font-bold text-foreground",children:["Baby-Foot ",e.jsx("span",{className:"text-primary text-glow-cyan",children:"App"})]}),e.jsx("p",{className:"text-muted-foreground",children:"CompÃ©tition â€¢ Collection â€¢ CommunautÃ©"})]}),e.jsxs(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"mb-6 grid grid-cols-3 gap-3",children:[e.jsx(L,{className:"text-center",children:e.jsxs(V,{className:"p-4",children:[e.jsx(jt,{className:"mx-auto mb-2 h-6 w-6 text-primary"}),d?e.jsx(ue,{className:"mx-auto mb-2 h-5 w-5 animate-spin"}):e.jsx("p",{className:"text-2xl font-bold text-foreground",children:t.averageElo}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ELO Moyen"})]})}),e.jsx(L,{className:"text-center",children:e.jsxs(V,{className:"p-4",children:[e.jsx(Ee,{className:"mx-auto mb-2 h-6 w-6 text-secondary"}),d?e.jsx(ue,{className:"mx-auto mb-2 h-5 w-5 animate-spin"}):e.jsx("p",{className:"text-2xl font-bold text-foreground",children:t.totalPlayers}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Joueurs"})]})}),e.jsx(L,{className:"text-center",children:e.jsxs(V,{className:"p-4",children:[e.jsx(Pe,{className:"mx-auto mb-2 h-6 w-6 text-rarity-gold"}),d?e.jsx(ue,{className:"mx-auto mb-2 h-5 w-5 animate-spin"}):e.jsx("p",{className:"text-2xl font-bold text-foreground",children:t.totalMatches}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Matchs"})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(W.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.2},children:e.jsx(As,{to:"/match",children:e.jsx(L,{className:"group cursor-pointer overflow-hidden transition-all hover:neon-border-cyan",children:e.jsxs(V,{className:"flex items-center gap-4 p-4",children:[e.jsx("div",{className:"rounded-xl bg-primary/20 p-3 transition-all group-hover:glow-cyan",children:e.jsx(Ee,{className:"h-8 w-8 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-foreground",children:"Rejoindre un match"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[i.length," joueur",i.length!==1?"s":""," en attente"]})]}),e.jsx(T,{variant:"neon",size:"sm",children:"Jouer"})]})})})}),e.jsx(Wu,{}),e.jsx(W.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4},children:e.jsx(As,{to:"/leaderboard",children:e.jsx(L,{className:"group cursor-pointer overflow-hidden transition-all hover:border-rarity-gold/50",children:e.jsxs(V,{className:"flex items-center gap-4 p-4",children:[e.jsx("div",{className:"rounded-xl bg-rarity-gold/20 p-3",children:e.jsx(Pe,{className:"h-8 w-8 text-rarity-gold"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-foreground",children:"Classement"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Voir le top des joueurs"})]}),e.jsx(Oe,{className:"h-5 w-5 text-muted-foreground"})]})})})}),e.jsx(W.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4},children:e.jsx(As,{to:"/babydex",children:e.jsx(L,{className:"group cursor-pointer overflow-hidden transition-all hover:neon-border-magenta",children:e.jsxs(V,{className:"flex items-center gap-4 p-4",children:[e.jsx("div",{className:"rounded-xl bg-secondary/20 p-3 transition-all group-hover:glow-magenta",children:e.jsx(ti,{className:"h-8 w-8 text-secondary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-foreground",children:"BabyDex"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s?`${l.uniqueCards}/${l.uniqueCards} cartes collectÃ©es`:"Collection de cartes"})]}),e.jsx(T,{variant:"neon-magenta",size:"sm",children:"Ouvrir"})]})})})}),e.jsx(W.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.5},children:e.jsx(As,{to:"/tournament",children:e.jsx(L,{className:"group cursor-pointer overflow-hidden transition-all hover:border-yellow-500/50 bg-gradient-to-r from-yellow-500/5 to-orange-500/5",children:e.jsxs(V,{className:"flex items-center gap-4 p-4",children:[e.jsx("div",{className:"rounded-xl bg-yellow-500/20 p-3",children:e.jsx(Pe,{className:"h-8 w-8 text-yellow-500"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold text-foreground",children:"Tournoi Quotidien"}),e.jsx("span",{className:"px-2 py-0.5 text-xs font-bold bg-yellow-500 text-black rounded-full",children:"NOUVEAU"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"13h00 - 14h15 â€¢ Frais 50â‚£"})]}),e.jsx(T,{variant:"outline",size:"sm",className:"border-yellow-500/50 text-yellow-500 hover:bg-yellow-500/10",children:"S'inscrire"})]})})})})]}),e.jsxs(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"mt-6",children:[e.jsx("h2",{className:"mb-4 text-lg font-semibold text-foreground",children:"ActivitÃ© rÃ©cente"}),e.jsx("div",{className:"space-y-2",children:f.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Aucune activitÃ© rÃ©cente"}):f.map((x,g)=>e.jsxs(W.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.6+g*.1},className:"flex items-center gap-3 rounded-lg bg-surface-alt p-3",children:[e.jsxs("span",{className:"text-lg",children:[x.type==="match"&&"âš½",x.type==="card"&&"ðŸƒ"]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-foreground",children:x.text}),e.jsx("p",{className:"text-xs text-muted-foreground",children:x.time})]})]},g))})]})]})},Ss=Rl,Xt=m.forwardRef(({className:s,...t},r)=>e.jsx(Mn,{ref:r,className:me("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...t}));Xt.displayName=Mn.displayName;const He=m.forwardRef(({className:s,...t},r)=>e.jsx(Tn,{ref:r,className:me("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",s),...t}));He.displayName=Tn.displayName;const Je=m.forwardRef(({className:s,...t},r)=>e.jsx(Pn,{ref:r,className:me("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...t}));Je.displayName=Pn.displayName;async function Wi(s,t,r,n,a){try{const i=S(k,"clubs"),o=mt(i),l=o.key,c={id:l,name:r,logo:n,color:a,founderId:s,members:{[s]:{userId:s,username:t,role:"founder",joinedAt:Date.now(),contributions:0}},treasury:0,totalEarnings:0,createdAt:Date.now(),bonuses:{}};return await Re(o,c),await oe(S(k,`users/${s}`),{clubId:l}),b.log(`âœ… Club crÃ©Ã©: ${l} par ${s}`),l}catch(i){throw b.error("Erreur crÃ©ation club:",i),new Error("Impossible de crÃ©er le club.")}}async function Qi(s,t,r){try{const n=S(k,`clubs/${s}`);if(!(await z(n)).exists())throw new Error("Club introuvable.");const i=S(k,`users/${t}`),o=await z(i);if(o.exists()&&o.val().clubId)throw new Error("Vous Ãªtes dÃ©jÃ  membre d'un autre club.");const l={userId:t,username:r,role:"member",joinedAt:Date.now(),contributions:0},c={};c[`clubs/${s}/members/${t}`]=l,c[`users/${t}/clubId`]=s,await oe(S(k),c),b.log(`âœ… ${t} a rejoint le club ${s}`)}catch(n){throw b.error("Erreur rejoindre club:",n),n}}async function Ji(s,t,r){var n,a;try{const i=S(k,`users/${s}`),o=await z(i);if(!o.exists())throw new Error("Utilisateur introuvable");const c=o.val().fortune||0;if(c<r)throw new Error("Fonds insuffisants");const d=S(k,`clubs/${t}`),u=await z(d);if(!u.exists())throw new Error("Club introuvable");const h=u.val();if(!h.members||!h.members[s])throw new Error("Vous devez Ãªtre membre du club pour contribuer");const p=((a=(n=h.members)==null?void 0:n[s])==null?void 0:a.contributions)||0,f=c-r,x={};x[`users/${s}/fortune`]=f,x[`clubs/${t}/treasury`]=(h.treasury||0)+r,x[`clubs/${t}/members/${s}/contributions`]=p+r,await oe(S(k),x),b.log(`âœ… Contribution de ${r}â‚¬ ajoutÃ©e au club ${t} par ${s}`),await Ve(s,f,-r,`Contribution club ${t}`)}catch(i){throw b.error("Erreur contribution club:",i),i}}async function Yi(s,t,r){try{const n=S(k,`clubs/${s}`),a=await z(n);if(!a.exists())throw new Error("Club introuvable.");const i=a.val();if((i.treasury||0)<r)throw new Error("TrÃ©sorerie insuffisante pour acheter ce bonus.");if(i.bonuses[t])throw new Error("Ce bonus est dÃ©jÃ  actif.");const o={};o.treasury=(i.treasury||0)-r,o[`bonuses/${t}`]=!0,await oe(n,o),b.log(`âœ… Bonus ${t} achetÃ© pour le club ${s}`)}catch(n){throw b.error("Erreur achat bonus club:",n),n}}async function Ki(s,t){try{const r={};r[`clubs/${s}/members/${t}`]=null,r[`users/${t}/clubId`]=null,await oe(S(k),r),b.log(`âœ… ${t} a quittÃ© le club ${s}`)}catch(r){throw b.error("Erreur quitter club:",r),new Error("Impossible de quitter le club.")}}function Xi(s,t){const r=S(k,`clubs/${s}`);return et(r,a=>{if(a.exists()){const i=a.val();i.members||(i.members={}),t(i)}else t(null)},a=>{b.error("Erreur d'Ã©coute des donnÃ©es du club:",a),t(null)})}async function Ve(s,t,r,n){try{const a=S(k,`fortuneHistory/${s}`),i=mt(a),o=hu({timestamp:Date.now(),fortune:t,change:r,reason:n});await Re(i,o);const l=await z(a);if(l.exists()){const c=l.val(),d=fs(Date.now()-30*24*60*60*1e3),u={};Object.entries(c).forEach(([h,p])=>{p.ts<d&&(u[`fortuneHistory/${s}/${h}`]=null)}),Object.keys(u).length>0&&await oe(S(k),u)}}catch(a){b.error("Erreur ajout historique:",a)}}async function eo(s,t=30){try{const r=S(k,`fortuneHistory/${s}`),n=await z(r);if(!n.exists())return[];const a=Object.values(n.val()),i=Date.now()-t*24*60*60*1e3;return a.filter(o=>o.timestamp>=i).sort((o,l)=>o.timestamp-l.timestamp)}catch(r){return b.error("Erreur lors de la rÃ©cupÃ©ration de l'historique de fortune:",r),[]}}async function to(s){try{if(!s||s.trim().length<2)return[];const t=S(k,"users"),r=await z(t);if(!r.exists())return[];const n=r.val(),a=s.toLowerCase().trim(),i=[];return Object.keys(n).forEach(o=>{const l=n[o];l.username&&l.username.toLowerCase().includes(a)&&i.push({id:o,username:l.username,role:l.role||"player",eloRating:l.eloRating||l.eloGlobal||1e3,wins:l.wins||0,losses:l.losses||0,fortune:l.fortune||0,totalEarned:l.totalEarned||0,createdAt:l.createdAt||new Date().toISOString(),clubId:l.clubId})}),i.sort((o,l)=>{const c=o.username.toLowerCase().startsWith(a),d=l.username.toLowerCase().startsWith(a);return c&&!d?-1:!c&&d?1:o.username.localeCompare(l.username)}),i.slice(0,20)}catch(t){return b.error("Erreur recherche utilisateurs:",t),[]}}const Ju={lootbox_starter:{common:70,rare:25,epic:4,legendary:.9,mythic:.1},lootbox_silver:{common:40,rare:40,epic:15,legendary:4,mythic:1},lootbox_gold:{common:20,rare:35,epic:30,legendary:12,mythic:3},lootbox_diamond:{common:5,rare:20,epic:35,legendary:30,mythic:10},lootbox_mythic:{common:0,rare:10,epic:30,legendary:40,mythic:20}},Yu={common:{min:10,max:50},rare:{min:50,max:150},epic:{min:150,max:300},legendary:{min:300,max:600},mythic:{min:600,max:1200}};function Ku(s){const t=Ju[s];if(!t)return"common";const r=Math.random()*100;let n=0;for(const[a,i]of Object.entries(t))if(n+=i,r<=n)return a;return"common"}function Xu(s,t){const r=qe.filter(a=>a.rarity===s&&a.type!=="lootbox"&&!t.includes(a.id));if(r.length===0){const a=["mythic","legendary","epic","rare","common"],i=a.indexOf(s);for(let o=i+1;o<a.length;o++){const l=qe.filter(c=>c.rarity===a[o]&&c.type!=="lootbox"&&!t.includes(c.id));if(l.length>0)return{item:l[Math.floor(Math.random()*l.length)],rarity:a[o]}}return null}return{item:r[Math.floor(Math.random()*r.length)],rarity:s}}function em(s){const t=qe.find(a=>a.id===s),r=(t==null?void 0:t.rarity)||"common",n=Yu[r];return Math.floor(Math.random()*(n.max-n.min+1))+n.min}function ya(s,t){return s!=null&&s.lootbox&&typeof s.lootbox[t]=="number"?s.lootbox[t]:typeof(s==null?void 0:s[t])=="number"?s[t]:0}async function so(s,t){var r;try{const n=S(k,`users/${s}`),a=await z(n);if(!a.exists())throw new Error("Utilisateur non trouvÃ©");const i=a.val(),o=i.inventory||{},l=ya(o,t);if(l<=0)throw new Error("Vous ne possÃ©dez pas cette lootbox");if(!qe.find(y=>y.id===t))throw new Error("Lootbox introuvable");const d=[],u=[];for(let y=0;y<3;y++){const j=Ku(t),M=Xu(j,u);if(M){const{item:P,rarity:w}=M;u.push(P.id);const I=!!((r=o[P.type])!=null&&r[P.id]);d.push({itemId:P.id,itemName:P.name,rarity:w,type:P.type,isNew:!I})}}const h=em(t),p={},f=l-1;f<=0?(p[`inventory/lootbox/${t}`]=null,o[t]&&(p[`inventory/${t}`]=null)):(p[`inventory/lootbox/${t}`]=f,o[t]&&(p[`inventory/${t}`]=null)),d.forEach(y=>{y.isNew&&(p[`inventory/${y.type}/${y.itemId}`]={obtainedAt:Date.now(),source:"lootbox",lootboxId:t})});const g=(i.fortune||0)+h;return p.fortune=g,await oe(n,p),b.log(`âœ… Lootbox ${t} ouverte par ${s}:`,{rewards:d.map(y=>`${y.itemName} (${y.rarity})`),fortuneBonus:h,newItems:d.filter(y=>y.isNew).length}),h!==0&&await Ve(s,g,h,`Bonus lootbox: ${t}`),{rewards:d,fortuneBonus:h}}catch(n){throw b.error("âŒ Erreur lors de l'ouverture de la lootbox:",n),n}}async function ro(s,t,r){try{const n=S(k,`users/${s}`),a=await z(n);if(!a.exists())throw new Error("Utilisateur non trouvÃ©");const i=a.val(),o=i.fortune||0;if(o<r)throw new Error("Fonds insuffisants");const l=i.inventory||{},c=ya(l,t),d=o-r,u={fortune:d,[`inventory/lootbox/${t}`]:c+1};l[t]&&(u[`inventory/${t}`]=null),await oe(n,u),b.log(`âœ… Lootbox ${t} achetÃ©e par ${s} (total: ${c+1})`),await Ve(s,d,-r,`Achat lootbox: ${t}`)}catch(n){throw b.error("âŒ Erreur lors de l'achat de la lootbox:",n),n}}async function jr(s){try{const t=S(k,`userBadges/${s}`),r=await z(t);if(!r.exists())return[];const n=r.val();return Object.keys(n).map(a=>({id:a,...n[a],unlocked:n[a].unlocked||!1,progress:n[a].progress||0}))}catch(t){return b.error("Erreur lors de la rÃ©cupÃ©ration des badges:",t),[]}}const tm=[{id:"tueur_gamelle",name:"Tueur de Gamelles",description:"Gagner 10 matchs d'affilÃ©e",icon:"ðŸ”¥",rarity:"epic",reward:100,check:async s=>{const t=S(k,`users/${s}`),r=await z(t);return r.exists()?(r.val().winStreak||0)>=10:!1}},{id:"roi_jeudi",name:"Roi du Jeudi",description:"Gagner 5 matchs un jeudi",icon:"ðŸ‘‘",rarity:"rare",reward:50,check:async s=>{const t=S(k,`users/${s}`),r=await z(t);return r.exists()?(r.val().thursdayWins||0)>=5:!1}},{id:"millionnaire",name:"Millionnaire",description:"Atteindre 1000â‚¬ de fortune",icon:"ðŸ’°",rarity:"legendary",reward:200,check:async s=>{const t=S(k,`users/${s}`),r=await z(t);return r.exists()?(r.val().fortune||0)>=1e3:!1}},{id:"collectionneur",name:"Collectionneur",description:"PossÃ©der 50 cartes uniques",icon:"ðŸŽ´",rarity:"epic",reward:150,check:async s=>{const t=S(k,`users/${s}`),r=await z(t);if(!r.exists())return!1;const a=r.val().cards||{};return Object.keys(a).filter(o=>a[o]>0).length>=50}},{id:"parieur_fou",name:"Parieur Fou",description:"Gagner 10 paris",icon:"ðŸŽ²",rarity:"rare",reward:75,check:async s=>{const t=S(k,`users/${s}`),r=await z(t);return r.exists()?(r.val().betWins||0)>=10:!1}}];async function ao(s){try{const t=[],n=(await jr(s)).map(a=>a.id);for(const a of tm){if(n.includes(a.id))continue;if(await a.check(s)){b.log(`âœ… [ACHIEVEMENTS] Badge dÃ©bloquÃ©: ${a.name} (${a.reward}â‚¬)`);const o=cu[a.id]||a.id,l=S(k,`userBadges/${s}/${o}`),c=fu({unlocked:!0,unlockedAt:Date.now(),progress:100});await Re(l,c);const d={id:a.id,name:a.name,icon:a.icon,unlocked:!0,unlockedAt:Date.now(),progress:100};if(a.reward>0){const u=S(k,`users/${s}`),h=await z(u);if(h.exists()){const x=(h.val().fortune||0)+a.reward;await oe(u,{fortune:x}),await Ve(s,x,a.reward,`Badge dÃ©bloquÃ©: ${a.name}`),b.log(`ðŸ’° [ACHIEVEMENTS] RÃ©compense ajoutÃ©e: +${a.reward}â‚¬ (nouveau solde: ${x}â‚¬)`)}}t.push(d)}}return t}catch(t){return b.error("Erreur vÃ©rification achievements:",t),[]}}const sm=[{id:"avatar_default",name:"Avatar Classique",description:"L'avatar par dÃ©faut",type:"avatar",price:0,rarity:"common",icon:"ðŸ˜Š"},{id:"avatar_king",name:"Roi",description:"Avatar royal avec couronne dorÃ©e",type:"avatar",price:150,rarity:"rare",icon:"ðŸ‘‘"},{id:"avatar_ninja",name:"Ninja",description:"Discret et rapide",type:"avatar",price:200,rarity:"rare",icon:"ðŸ¥·"},{id:"avatar_wizard",name:"Magicien",description:"MaÃ®tre des arcanes",type:"avatar",price:250,rarity:"epic",icon:"ðŸ§™"},{id:"avatar_robot",name:"Robot",description:"Technologie avancÃ©e",type:"avatar",price:180,rarity:"rare",icon:"ðŸ¤–"},{id:"avatar_alien",name:"Alien",description:"Venu d'une autre galaxie",type:"avatar",price:300,rarity:"epic",icon:"ðŸ‘½"},{id:"avatar_dragon",name:"Dragon",description:"Puissance lÃ©gendaire",type:"avatar",price:500,rarity:"legendary",icon:"ðŸ‰"},{id:"avatar_phoenix",name:"PhÃ©nix",description:"RenaÃ®t de ses cendres",type:"avatar",price:450,rarity:"legendary",icon:"ðŸ”¥"},{id:"avatar_ghost",name:"FantÃ´me",description:"MystÃ©rieux et insaisissable",type:"avatar",price:220,rarity:"epic",icon:"ðŸ‘»"},{id:"avatar_pirate",name:"Pirate",description:"Chasseur de trÃ©sors",type:"avatar",price:170,rarity:"rare",icon:"ðŸ´â€â˜ ï¸"},{id:"avatar_astronaut",name:"Astronaute",description:"Explorateur spatial",type:"avatar",price:280,rarity:"epic",icon:"ðŸ‘¨â€ðŸš€"},{id:"avatar_vampire",name:"Vampire",description:"Immortel de la nuit",type:"avatar",price:320,rarity:"epic",icon:"ðŸ§›"},{id:"avatar_knight",name:"Chevalier",description:"Gardien du royaume",type:"avatar",price:190,rarity:"rare",icon:"âš”ï¸"},{id:"avatar_samurai",name:"SamouraÃ¯",description:"Guerrier honorable",type:"avatar",price:350,rarity:"epic",icon:"ðŸ—¾"},{id:"avatar_cyborg",name:"Cyborg",description:"Fusion homme-machine",type:"avatar",price:400,rarity:"legendary",icon:"ðŸ¦¾"},{id:"avatar_demon",name:"DÃ©mon",description:"Seigneur des tÃ©nÃ¨bres",type:"avatar",price:550,rarity:"legendary",icon:"ðŸ˜ˆ"},{id:"avatar_angel",name:"Ange",description:"Messager cÃ©leste",type:"avatar",price:500,rarity:"legendary",icon:"ðŸ‘¼"},{id:"avatar_zeus",name:"Zeus",description:"Dieu de l'Olympe",type:"avatar",price:800,rarity:"mythic",icon:"âš¡ðŸ‘‘"},{id:"avatar_reaper",name:"Faucheuse",description:"Gardien des Ã¢mes",type:"avatar",price:600,rarity:"legendary",icon:"ðŸ’€"},{id:"avatar_titan",name:"Titan",description:"Colosse ancestral",type:"avatar",price:900,rarity:"mythic",icon:"â›°ï¸"}],rm=[{id:"theme_default",name:"ThÃ¨me Par DÃ©faut",description:"Le thÃ¨me classique",type:"theme",price:0,rarity:"common",preview:"#6366f1",icon:"ðŸŽ¨"},{id:"theme_ocean",name:"OcÃ©an Profond",description:"Ambiance sous-marine",type:"theme",price:200,rarity:"rare",preview:"#1e40af",icon:"ðŸŒŠ"},{id:"theme_sunset",name:"Coucher de Soleil",description:"Tons chauds orangÃ©s",type:"theme",price:180,rarity:"rare",preview:"#ea580c",icon:"ðŸŒ…"},{id:"theme_forest",name:"ForÃªt EnchantÃ©e",description:"Vert naturel",type:"theme",price:220,rarity:"epic",preview:"#15803d",icon:"ðŸŒ²"},{id:"theme_neon",name:"NÃ©on Cyberpunk",description:"Style futuriste",type:"theme",price:350,rarity:"epic",preview:"#a855f7",icon:"âš¡"},{id:"theme_gold",name:"Or Royal",description:"Luxe et prestige",type:"theme",price:500,rarity:"legendary",preview:"#d97706",icon:"ðŸ‘‘"},{id:"theme_ice",name:"Glace Arctique",description:"Froid cristallin",type:"theme",price:250,rarity:"epic",preview:"#0ea5e9",icon:"â„ï¸"},{id:"theme_lava",name:"Lave Volcanique",description:"Chaleur intense",type:"theme",price:280,rarity:"epic",preview:"#dc2626",icon:"ðŸŒ‹"},{id:"theme_space",name:"Espace Infini",description:"Cosmos mystÃ©rieux",type:"theme",price:400,rarity:"legendary",preview:"#1e1b4b",icon:"ðŸŒŒ"},{id:"theme_sakura",name:"Sakura",description:"Fleurs de cerisier",type:"theme",price:300,rarity:"epic",preview:"#ec4899",icon:"ðŸŒ¸"},{id:"theme_matrix",name:"Matrix",description:"Code vert",type:"theme",price:450,rarity:"legendary",preview:"#22c55e",icon:"ðŸ’»"},{id:"theme_blood",name:"Sang Noir",description:"TÃ©nÃ¨bres profondes",type:"theme",price:550,rarity:"legendary",preview:"#7f1d1d",icon:"ðŸ©¸"},{id:"theme_rainbow",name:"Arc-en-ciel",description:"Toutes les couleurs",type:"theme",price:600,rarity:"legendary",preview:"#ff00ff",icon:"ðŸŒˆ"},{id:"theme_diamond",name:"Diamant",description:"Luxe absolu",type:"theme",price:800,rarity:"mythic",preview:"#38bdf8",icon:"ðŸ’Ž"},{id:"theme_cosmic",name:"Cosmique",description:"Galaxies infinies",type:"theme",price:1e3,rarity:"mythic",preview:"#4c1d95",icon:"âœ¨"}],am=[{id:"banner_default",name:"BanniÃ¨re Simple",description:"BanniÃ¨re de dÃ©part",type:"banner",price:0,rarity:"common",icon:"ðŸ“‹",preview:"linear-gradient(135deg, #1e293b 0%, #334155 100%)"},{id:"banner_stars",name:"Ciel Ã‰toilÃ©",description:"Ã‰toiles scintillantes",type:"banner",price:150,rarity:"rare",icon:"â­",preview:"linear-gradient(135deg, #0f172a 0%, #1e3a8a 50%, #312e81 100%)"},{id:"banner_fire",name:"Flammes",description:"BanniÃ¨re enflammÃ©e",type:"banner",price:200,rarity:"rare",icon:"ðŸ”¥",preview:"linear-gradient(135deg, #7f1d1d 0%, #dc2626 50%, #ea580c 100%)"},{id:"banner_lightning",name:"Ã‰clair",description:"BanniÃ¨re Ã©lectrique",type:"banner",price:250,rarity:"epic",icon:"âš¡",preview:"linear-gradient(135deg, #581c87 0%, #7c3aed 50%, #06b6d4 100%)"},{id:"banner_rainbow",name:"Arc-en-ciel",description:"BanniÃ¨re multicolore",type:"banner",price:180,rarity:"rare",icon:"ðŸŒˆ",preview:"linear-gradient(135deg, #dc2626 0%, #ea580c 20%, #eab308 40%, #22c55e 60%, #3b82f6 80%, #a855f7 100%)"},{id:"banner_galaxy",name:"Galaxie",description:"BanniÃ¨re cosmique",type:"banner",price:400,rarity:"legendary",icon:"ðŸŒŒ",preview:"linear-gradient(135deg, #0c4a6e 0%, #7c3aed 50%, #ec4899 100%)"},{id:"banner_diamond",name:"Diamant",description:"Luxe cristallin",type:"banner",price:500,rarity:"legendary",icon:"ðŸ’Ž",preview:"linear-gradient(135deg, #0c4a6e 0%, #06b6d4 50%, #e0f2fe 100%)"},{id:"banner_sakura",name:"Fleurs de Cerisier",description:"Ã‰lÃ©gance japonaise",type:"banner",price:280,rarity:"epic",icon:"ðŸŒ¸",preview:"linear-gradient(135deg, #9f1239 0%, #ec4899 50%, #fce7f3 100%)"},{id:"banner_dragon",name:"Dragon DorÃ©",description:"Mythique",type:"banner",price:450,rarity:"legendary",icon:"ðŸ²",preview:"linear-gradient(135deg, #78350f 0%, #f59e0b 50%, #fef3c7 100%)"},{id:"banner_ocean",name:"Vagues OcÃ©aniques",description:"Aquatique",type:"banner",price:220,rarity:"epic",icon:"ðŸŒŠ",preview:"linear-gradient(135deg, #0c4a6e 0%, #0891b2 50%, #06b6d4 100%)"},{id:"banner_aurora",name:"Aurore BorÃ©ale",description:"Lumineuse magique",type:"banner",price:350,rarity:"epic",icon:"ðŸŒŒ",preview:"linear-gradient(135deg, #064e3b 0%, #10b981 33%, #06b6d4 66%, #a855f7 100%)"},{id:"banner_blood",name:"Lune Sanglante",description:"Nocturne mystique",type:"banner",price:380,rarity:"epic",icon:"ðŸŒ™",preview:"linear-gradient(135deg, #450a0a 0%, #7f1d1d 50%, #dc2626 100%)"},{id:"banner_gold",name:"Or ImpÃ©rial",description:"Richesse absolue",type:"banner",price:600,rarity:"legendary",icon:"ðŸ†",preview:"linear-gradient(135deg, #713f12 0%, #f59e0b 50%, #fef3c7 100%)"},{id:"banner_phoenix",name:"PhÃ©nix CÃ©leste",description:"Renaissance Ã©ternelle",type:"banner",price:700,rarity:"mythic",icon:"ðŸ”¥ðŸ¦…",preview:"linear-gradient(135deg, #dc2626 0%, #f97316 25%, #facc15 50%, #f97316 75%, #dc2626 100%)"},{id:"banner_infinity",name:"Infini",description:"Au-delÃ  du temps",type:"banner",price:900,rarity:"mythic",icon:"â™¾ï¸",preview:"linear-gradient(135deg, #1e1b4b 0%, #5b21b6 25%, #ec4899 50%, #5b21b6 75%, #1e1b4b 100%)"}],nm=[{id:"effect_none",name:"Aucun Effet",description:"Pas d'effet visuel",type:"effect",price:0,rarity:"common",icon:"âšª"},{id:"effect_sparkles",name:"Ã‰tincelles",description:"Particules brillantes",type:"effect",price:100,rarity:"common",icon:"âœ¨"},{id:"effect_glow",name:"Aura Lumineuse",description:"Halo colorÃ©",type:"effect",price:150,rarity:"rare",icon:"ðŸ’«"},{id:"effect_fire",name:"Flammes",description:"Feu animÃ©",type:"effect",price:200,rarity:"rare",icon:"ðŸ”¥"},{id:"effect_ice",name:"Cristaux de Glace",description:"Effet de gel",type:"effect",price:220,rarity:"epic",icon:"â„ï¸"},{id:"effect_lightning",name:"Ã‰lectricitÃ©",description:"Ã‰clairs animÃ©s",type:"effect",price:250,rarity:"epic",icon:"âš¡"},{id:"effect_rainbow",name:"Arc-en-ciel",description:"Effet multicolore",type:"effect",price:180,rarity:"rare",icon:"ðŸŒˆ"},{id:"effect_stars",name:"Ã‰toiles Filantes",description:"TraÃ®nÃ©e d'Ã©toiles",type:"effect",price:300,rarity:"epic",icon:"â­"},{id:"effect_portal",name:"Portail",description:"Effet dimensionnel",type:"effect",price:400,rarity:"legendary",icon:"ðŸŒ€"},{id:"effect_crown",name:"Couronne Flottante",description:"Couronne dorÃ©e",type:"effect",price:350,rarity:"legendary",icon:"ðŸ‘‘"},{id:"effect_wings",name:"Ailes d'Ange",description:"Ailes lumineuses",type:"effect",price:500,rarity:"legendary",icon:"ðŸª½"},{id:"effect_shadow",name:"Ombre Vivante",description:"Ombre qui bouge",type:"effect",price:280,rarity:"epic",icon:"ðŸŒ‘"},{id:"effect_sakura",name:"PÃ©tales de Sakura",description:"Fleurs qui tombent",type:"effect",price:320,rarity:"epic",icon:"ðŸŒ¸"},{id:"effect_smoke",name:"FumÃ©e Mystique",description:"Brume magique",type:"effect",price:260,rarity:"epic",icon:"ðŸ’¨"},{id:"effect_galaxy",name:"Tourbillon Galactique",description:"Ã‰toiles qui tournent",type:"effect",price:450,rarity:"legendary",icon:"ðŸŒŒ"},{id:"effect_blood",name:"Aura Sanguine",description:"Rouge pulsant",type:"effect",price:380,rarity:"epic",icon:"ðŸ©¸"},{id:"effect_divine",name:"LumiÃ¨re Divine",description:"Rayons cÃ©lestes",type:"effect",price:600,rarity:"legendary",icon:"â˜€ï¸"},{id:"effect_demon",name:"Flammes DÃ©moniaques",description:"Feu noir",type:"effect",price:550,rarity:"legendary",icon:"ðŸ˜ˆ"},{id:"effect_cosmic",name:"Ã‰nergie Cosmique",description:"Pouvoir ultime",type:"effect",price:800,rarity:"mythic",icon:"ðŸ’¥"},{id:"effect_infinity",name:"Boucle Infinie",description:"Symbole infini",type:"effect",price:1e3,rarity:"mythic",icon:"â™¾ï¸"}],im=[{id:"lootbox_starter",name:"Coffre DÃ©butant",description:"Cartes Bronze/Silver/Gold",type:"lootbox",price:100,rarity:"common",icon:"ðŸ“¦"},{id:"lootbox_silver",name:"BoÃ®te ArgentÃ©e",description:"Cartes Silver/Gold/Platinum",type:"lootbox",price:250,rarity:"rare",icon:"ðŸŽ"},{id:"lootbox_gold",name:"Coffre DorÃ©",description:"Cartes Gold/Platinum/Diamond",type:"lootbox",price:500,rarity:"epic",icon:"ðŸ’°"},{id:"lootbox_diamond",name:"Coffre Diamant",description:"Cartes Platinum/Diamond/Black",type:"lootbox",price:1e3,rarity:"legendary",icon:"ðŸ’Ž"},{id:"lootbox_mythic",name:"Coffre Mythique",description:"Cartes lÃ©gendaires garanties",type:"lootbox",price:2e3,rarity:"mythic",icon:"âœ¨"}],om=[{id:"title_newbie",name:"Bronze de Parking",description:"Pour ceux qui dÃ©couvrent encore le kick-off.",type:"title",price:0,rarity:"common",icon:"ðŸ¥‰",preview:"Bronze de Parking"},{id:"title_veteran",name:"Tryhard Platine",description:"Toujours en ranked, jamais en freeplay.",type:"title",price:300,rarity:"rare",icon:"ðŸ’¿",preview:"Tryhard Platine"},{id:"title_champion",name:"Champion de Garage",description:"Smurf ou gÃ©nie incompris, on ne sait pas.",type:"title",price:600,rarity:"epic",icon:"ðŸ†",preview:"Champion de Garage"},{id:"title_legend",name:"LÃ©gende du Reset",description:"Flip, musty, breezi... tout y passe.",type:"title",price:900,rarity:"legendary",icon:"âœ¨",preview:"LÃ©gende du Reset"},{id:"title_millionaire",name:"Marchand dâ€™Octanes",description:"RL Garage ouvert 24/7.",type:"title",price:1200,rarity:"legendary",icon:"ðŸš—",preview:"Marchand dâ€™Octanes"},{id:"title_godlike",name:"Insane Freestyler",description:"Clip ou leave, jamais entre les deux.",type:"title",price:2e3,rarity:"mythic",icon:"ðŸŽ¥",preview:"Insane Freestyler"},{id:"title_strategist",name:"Cerveau de la Rot",description:"Toujours dernier, jamais dans le mur.",type:"title",price:700,rarity:"epic",icon:"ðŸ§ ",preview:"Cerveau de la Rot"},{id:"title_gambler",name:"DÃ©mon de la SoloQ",description:"3 mates tiltÃ©s, 0 problÃ¨me.",type:"title",price:500,rarity:"rare",icon:"ðŸ˜ˆ",preview:"DÃ©mon de la SoloQ"},{id:"title_collector",name:"Full White Dealer",description:"Fennec, Octane, Interstellarâ€¦ tout en titanium.",type:"title",price:1600,rarity:"legendary",icon:"âšª",preview:"Full White Dealer"},{id:"title_immortal",name:"Le Goat du Baby",description:"Jamais AFK, jamais tilt, toujours clutch.",type:"title",price:3e3,rarity:"mythic",icon:"ðŸ",preview:"Le GOAT du Baby"}],qe=[...sm,...rm,...am,...nm,...im,...om];async function no(s,t,r,n){var a,i,o;try{const l=S(k,`users/${s}`),c=await z(l);if(!c.exists())throw new Error("Utilisateur introuvable");const d=c.val(),u=d.fortune||0;if(u<n)throw new Error("Fonds insuffisants");if((i=(a=d.inventory)==null?void 0:a[r])!=null&&i[t])throw new Error("Vous possÃ©dez dÃ©jÃ  cet item");const h={},p=u-n;h[`users/${s}/fortune`]=p,h[`users/${s}/inventory/${r}/${t}`]={obtainedAt:Date.now(),source:"shop",price:n},!(((o=d.inventory)==null?void 0:o[r])&&Object.keys(d.inventory[r]).length>0)&&r!=="lootbox"&&(h[`users/${s}/${r}`]=t),await oe(S(k),h);const x=qe.find(g=>g.id===t);await Ve(s,p,-n,`Achat boutique: ${(x==null?void 0:x.name)||t}`)}catch(l){throw b.error("Erreur achat article:",l),l}}async function ja(s,t,r){var n,a;try{const i=S(k,`users/${s}`),o=await z(i);if(!o.exists())throw new Error("Utilisateur introuvable");if(!((a=(n=o.val().inventory)==null?void 0:n[r])==null?void 0:a[t]))throw new Error("Vous ne possÃ©dez pas cet item");const d={avatar:"avatar",theme:"theme",banner:"banner",effect:"effect",title:"title",badge:"badge",lootbox:null}[r];if(!d)throw new Error("Ce type d'article n'est pas Ã©quipable.");const u={};u[`users/${s}/${d}`]=t,await oe(S(k),u)}catch(i){throw b.error("Erreur Ã©quiper article:",i),i}}const io=Object.freeze(Object.defineProperty({__proto__:null,SHOP_ITEMS:qe,addFortuneHistoryEntry:Ve,buyClubBonus:Yi,buyLootbox:ro,buyShopItem:no,checkAchievements:ao,contributeToClub:Ji,createClub:Wi,equipItem:ja,getFortuneHistory:eo,getLootboxCount:ya,getUserBadges:jr,joinClub:Qi,leaveClub:Ki,onClubDataUpdate:Xi,openLootbox:so,searchUsers:to},Symbol.toStringTag,{value:"Module"}));async function lm(s){var r,n,a;const t={xpBoost:!1,fortuneBoost:!1,premiumCards:!1};try{const i=S(k,`users/${s}`),o=await z(i);if(!o.exists())return t;const c=o.val().clubId;if(!c)return t;const d=S(k,`clubs/${c}`),u=await z(d);if(!u.exists())return t;const h=u.val();return{xpBoost:((r=h.bonuses)==null?void 0:r.xpBoost)||!1,fortuneBoost:((n=h.bonuses)==null?void 0:n.fortuneBoost)||!1,premiumCards:((a=h.bonuses)==null?void 0:a.premiumCards)||!1}}catch(i){return b.error("Erreur rÃ©cupÃ©ration bonus club:",i),t}}function oo(s,t){const r=s-t,n=Math.round(r*1.2);return t+n}function cm(s){return Math.round(s*1.15)}const Yr=lm,Js=[{name:"Bronze",minElo:0,maxElo:1099,color:"#CD7F32",icon:"ðŸ¥‰"},{name:"Argent",minElo:1100,maxElo:1299,color:"#C0C0C0",icon:"ðŸ¥ˆ"},{name:"Or",minElo:1300,maxElo:1499,color:"#FFD700",icon:"ðŸ¥‡"},{name:"Platine",minElo:1500,maxElo:1699,color:"#E5E4E2",icon:"ðŸ’Ž"},{name:"Diamant",minElo:1700,maxElo:1899,color:"#B9F2FF",icon:"ðŸ’ "},{name:"MaÃ®tre",minElo:1900,maxElo:2099,color:"#9B59B6",icon:"ðŸ‘‘"},{name:"Grand MaÃ®tre",minElo:2100,maxElo:2299,color:"#E74C3C",icon:"âš¡"},{name:"Challenger",minElo:2300,maxElo:9999,color:"#F39C12",icon:"ðŸ”¥"}];function Ws(s){return typeof s!="number"||isNaN(s)||s<0?Js[0]:Js.find(r=>s>=r.minElo&&s<=r.maxElo)||Js[Js.length-1]}async function dm(s,t,r,n,a){try{const i=S(k,`matchQueue/${s}`);await Re(i,{id:s,username:t,elo1v1:r,elo2v2:n,eloGlobal:a,joinedAt:Date.now()}),Ec(i).remove()}catch(i){throw b.error("Erreur lors de l'ajout Ã  la queue:",i),new Error("Impossible de rejoindre la file d'attente")}}async function um(s){try{const t=S(k,`matchQueue/${s}`);await os(t)}catch(t){throw b.error("Erreur lors du retrait de la queue:",t),new Error("Impossible de quitter la file d'attente")}}function lo(s,t){return s===1&&t===1?"1v1":s===2&&t===2?"2v2":"mixed"}async function mm(s,t,r){try{if(!Array.isArray(s)||!Array.isArray(t))throw new Error("Ã‰quipes invalides");if(s.length===0||t.length===0)throw new Error("Les Ã©quipes doivent contenir au moins un joueur");if(s.length>2||t.length>2)throw new Error("Maximum 2 joueurs par Ã©quipe");if(s.filter(j=>t.includes(j)).length>0)throw new Error("Un joueur ne peut pas Ãªtre dans les deux Ã©quipes");const a=S(k,"users"),i=await z(a);if(!i.exists())throw new Error("Aucun utilisateur trouvÃ©");const o=i.val(),l={};Object.keys(o).forEach(j=>{l[j]=Yt(o[j])});const d=[...s,...t].filter(j=>!l[j]);if(d.length>0)throw new Error(`Joueur(s) introuvable(s): ${d.join(", ")}`);const u=s.map(j=>{var M;return((M=l[j])==null?void 0:M.username)||"Unknown"}),h=t.map(j=>{var M;return((M=l[j])==null?void 0:M.username)||"Unknown"}),p=lo(s.length,t.length),f=S(k,"bettingMatches"),x=mt(f),g=x.key,y={id:g,team1:s,team2:t,team1Names:u,team2Names:h,matchType:p,status:"open",createdAt:Date.now(),createdBy:r,bets:{},totalBetsTeam1:0,totalBetsTeam2:0};return await Re(x,y),g}catch(n){throw b.error("Erreur lors de la crÃ©ation du match:",n),n}}async function xm(s,t,r,n,a){var i,o,l;try{if(!s||!t||!r)throw new Error("ParamÃ¨tres invalides");if(n<=0||n>1e4)throw new Error("Le montant doit Ãªtre entre 1â‚¬ et 10000â‚¬");if(a!==1&&a!==2)throw new Error("Ã‰quipe invalide");const c=S(k,`bettingMatches/${s}`),d=S(k,`users/${t}`);b.log("ðŸ” [PARI] Chargement des donnÃ©es...");const[u,h]=await Promise.all([z(c),z(d)]);if(!u.exists())throw new Error("Match introuvable");if(!h.exists())throw new Error("Utilisateur introuvable");const p=u.val(),f=h.val();if(b.log(`âœ… [PARI] DonnÃ©es chargÃ©es - Match status: ${p.status}, User fortune: ${f.fortune}â‚¬`),p.status!=="open")throw new Error("Les paris sont fermÃ©s pour ce match");if(Array.isArray(p.team1)&&p.team1.includes(t)||Array.isArray(p.team2)&&p.team2.includes(t))throw new Error("Vous ne pouvez pas parier sur un match oÃ¹ vous jouez");if(f.banned===!0)throw new Error("Compte banni");const g=f.fortune||0,y=(i=p.bets)==null?void 0:i[t],j=y?g+y.amount:g;if(b.log(`ðŸ’° [PARI] Fortune avant: ${g}â‚¬, Disponible: ${j}â‚¬`),j<n)throw new Error(`Vous n'avez pas assez d'argent (${j}â‚¬ disponibles)`);if(g<0||g>1e6)throw new Error("Fortune invalide");const M=j-n;let P=p.totalBetsTeam1||0,w=p.totalBetsTeam2||0;y&&(y.teamBet===1?P-=y.amount:w-=y.amount,b.log(`ðŸ”„ [PARI] Ancien pari trouvÃ©: ${y.amount}â‚¬ sur Ã©quipe ${y.teamBet}`)),a===1?P+=n:w+=n,b.log(`ðŸ“Š [PARI] Nouveaux totaux - Ã‰quipe 1: ${P}â‚¬, Ã‰quipe 2: ${w}â‚¬`);const I={};I[`users/${t}/fortune`]=M,I[`bettingMatches/${s}/bets/${t}`]={userId:t,username:r,amount:n,teamBet:a,timestamp:Date.now()},I[`bettingMatches/${s}/totalBetsTeam1`]=P,I[`bettingMatches/${s}/totalBetsTeam2`]=w,b.log("ðŸ’¾ [PARI] Application des mises Ã  jour atomiques..."),await oe(S(k),I),b.log(`âœ… [PARI] Fortune aprÃ¨s dÃ©duction: ${M}â‚¬`);const O=M-g;if(O!==0){const N=`Pari sur match: ${((o=p.team1Names)==null?void 0:o.join(" & "))??"Ã‰quipe 1"} vs ${((l=p.team2Names)==null?void 0:l.join(" & "))??"Ã‰quipe 2"}`;await Ve(t,M,O,N),b.log(`ðŸ“ [PARI] Historique ajoutÃ©: ${O}â‚¬`)}b.log("âœ… [PARI] Pari placÃ© avec succÃ¨s!")}catch(c){throw b.error("âŒ [PARI] Erreur:",c),c}}async function hm(s){try{const t=S(k,`bettingMatches/${s}`);b.log("ðŸ” [START MATCH] Chargement des donnÃ©es du match...");const r=await z(t);if(!r.exists())throw new Error("Match introuvable");const n=r.val();if(b.log(`âœ… [START MATCH] Match chargÃ© - Status: ${n.status}`),n.status!=="open")throw new Error("Le match n'est pas en attente de dÃ©marrage");const a={};a[`bettingMatches/${s}/status`]="playing",a[`bettingMatches/${s}/startedAt`]=Date.now(),b.log("ðŸ’¾ [START MATCH] Application de la mise Ã  jour..."),await oe(S(k),a),b.log("âœ… [START MATCH] Match dÃ©marrÃ© avec succÃ¨s!")}catch(t){throw b.error("âŒ [START MATCH] Erreur:",t),t}}function fm(s){return s<1300?40:s<1700?32:s<2100?24:16}function co(s,t,r){(typeof s!="number"||isNaN(s)||s<0)&&(s=1e3),(typeof t!="number"||isNaN(t)||t<0)&&(t=1e3);const n=fm(s),a=1/(1+Math.pow(10,(t-s)/400)),o=Math.round(n*((r?1:0)-a)),l=s+o;return Math.max(0,l)}async function pm(s,t,r){var n,a,i,o,l,c;try{if(typeof t!="number"||typeof r!="number")throw new Error("Scores invalides");if(!Number.isInteger(t)||!Number.isInteger(r))throw new Error("Les scores doivent Ãªtre des nombres entiers");if(t<0||r<0||t>100||r>100)throw new Error("Les scores doivent Ãªtre entre 0 et 100");if(t===r)throw new Error("Le score ne peut pas Ãªtre Ã©gal");const d=S(k,`bettingMatches/${s}`),u=await z(d);if(!u.exists())throw new Error("Match introuvable");const h=u.val();if(h.status==="finished")throw new Error("Ce match est dÃ©jÃ  terminÃ©");b.log(`ðŸ“Š [FIN MATCH] Total paris - Ã‰quipe 1: ${h.totalBetsTeam1}â‚¬, Ã‰quipe 2: ${h.totalBetsTeam2}â‚¬`),b.log(`ðŸ“Š [FIN MATCH] Nombre de parieurs: ${Object.keys(h.bets||{}).length}`);const p=await uo(h.team1,h.team2,t,r),f=S(k,"users");if(!(await z(f)).exists())throw new Error("Aucun utilisateur trouvÃ©");const g=h.matchType,y=[...h.team1,...h.team2],j=await ho(y),M=y.filter(E=>!j[E]);if(M.length>0)throw new Error(`Joueur(s) introuvable(s): ${M.join(", ")}`);const P=j,w=E=>{const Q=P[E];if(!Q)return 1e3;switch(g){case"1v1":return Q.elo1v1||1e3;case"2v2":return Q.elo2v2||1e3;case"mixed":return Q.eloGlobal||1e3}},I=h.team1.map(E=>{const Q=P[E];if(!Q)throw new Error(`Joueur ${E} introuvable`);return{id:E,username:Q.username||"Unknown",eloRating:w(E),wins:Q[`wins${g==="1v1"?"1v1":g==="2v2"?"2v2":"Mixed"}`]||0,losses:Q[`losses${g==="1v1"?"1v1":g==="2v2"?"2v2":"Mixed"}`]||0}}),O=h.team2.map(E=>{const Q=P[E];if(!Q)throw new Error(`Joueur ${E} introuvable`);return{id:E,username:Q.username||"Unknown",eloRating:w(E),wins:Q[`wins${g==="1v1"?"1v1":g==="2v2"?"2v2":"Mixed"}`]||0,losses:Q[`losses${g==="1v1"?"1v1":g==="2v2"?"2v2":"Mixed"}`]||0}}),N=I.reduce((E,Q)=>E+Q.eloRating,0)/I.length,R=O.reduce((E,Q)=>E+Q.eloRating,0)/O.length,F=t>r,A=[],B={},_=async(E,Q,ae)=>{if(p)return;let C=co(E.eloRating,Q,ae);const q=C-E.eloRating;(await Yr(E.id)).xpBoost&&ae&&(C=oo(C,E.eloRating),b.log(`ðŸŽ¯ [Bonus Club] ${E.username}: ELO ${E.eloRating} â†’ ${C} (avec bonus +20%)`));const v=C-E.eloRating,Z=g==="1v1"?"elo1v1":g==="2v2"?"elo2v2":"eloGlobal";B[`users/${E.id}/${Z}`]=C;const K=P[E.id];if(!K)throw new Error(`Utilisateur ${E.id} introuvable`);const ne=g==="1v1"?C:K.elo1v1||1e3,Se=g==="2v2"?C:K.elo2v2||1e3,Me=g==="mixed"?C:K.eloGlobal||1e3,Ge=[];(g==="1v1"||K.elo1v1!==void 0)&&Ge.push(ne),(g==="2v2"||K.elo2v2!==void 0)&&Ge.push(Se),(g==="mixed"||K.eloGlobal!==void 0)&&Ge.push(Me);const tt=Ge.length>0?Math.round(Ge.reduce((We,ts)=>We+ts,0)/Ge.length):1e3;B[`users/${E.id}/eloGlobal`]=tt;const st=`wins${g==="1v1"?"1v1":g==="2v2"?"2v2":"Mixed"}`,Xe=`losses${g==="1v1"?"1v1":g==="2v2"?"2v2":"Mixed"}`;B[`users/${E.id}/${st}`]=ae?E.wins+1:E.wins,B[`users/${E.id}/${Xe}`]=ae?E.losses:E.losses+1;const Ct=K.winStreak||0;ae?B[`users/${E.id}/winStreak`]=Ct+1:B[`users/${E.id}/winStreak`]=0;const ft=new Date().getDay()===4;if(ae&&ft){const We=K.thursdayWins||0;B[`users/${E.id}/thursdayWins`]=We+1}const ks=Ws(C);A.push({userId:E.id,username:E.username,oldElo:E.eloRating,newElo:C,eloChange:v,matchType:g,rank:ks})};await Promise.all([...I.map(E=>_(E,R,F)),...O.map(E=>_(E,N,!F))]);const J=F?1:2,U=h.totalBetsTeam1+h.totalBetsTeam2,X=J===1?h.totalBetsTeam1:h.totalBetsTeam2,pe=J===1?h.totalBetsTeam2:h.totalBetsTeam1,ge={},ye=[];if(b.log(`ðŸ† [FIN MATCH] Ã‰quipe gagnante: ${J}`),b.log(`ðŸ’° [FIN MATCH] Pot gagnant: ${X}â‚¬, Pot perdant: ${pe}â‚¬, Total: ${U}â‚¬`),h.bets&&Object.keys(h.bets).length>0)for(const[E,Q]of Object.entries(h.bets))if(b.log(`ðŸ‘¤ [FIN MATCH] Traitement pari de ${Q.username}: ${Q.amount}â‚¬ sur Ã©quipe ${Q.teamBet}`),Q.teamBet===J)if(X>0){const ae=U/X,C=Math.max(ae,1.1),q=Math.round(Q.amount*C);ge[E]=q;const Y=q-Q.amount;b.log(`âœ… [FIN MATCH] ${Q.username} GAGNE ${q}â‚¬ (mise: ${Q.amount}â‚¬, profit: ${Y}â‚¬, cote: ${C.toFixed(2)}x)`);const v=S(k,`users/${E}`),Z=await z(v);if(Z.exists()){const K=Z.val(),ne=K.fortune||0,Se=K.bettingGains||0,Me=await Yr(E);let Ge=q;Me.fortuneBoost&&(Ge=cm(q),b.log(`ðŸ’° [Bonus Club] ${Q.username}: Gain ${q}â‚¬ â†’ ${Ge}â‚¬ (avec bonus +15%)`));const tt=ne+Ge,st=Ge-Q.amount;B[`users/${E}/fortune`]=tt,B[`users/${E}/bettingGains`]=Se+st,B[`users/${E}/totalEarned`]=(K.totalEarned||0)+st;const Xe=K.betWins||0;B[`users/${E}/betWins`]=Xe+1,ye.push(Ve(E,tt,Ge,`Gain pari: ${((n=h.team1Names)==null?void 0:n.join(" & "))??"Ã‰quipe 1"} vs ${((a=h.team2Names)==null?void 0:a.join(" & "))??"Ã‰quipe 2"}`))}}else{ge[E]=Q.amount,b.log(`ðŸ”„ [FIN MATCH] ${Q.username} REMBOURSÃ‰ ${Q.amount}â‚¬ (aucun pari sur Ã©quipe gagnante)`);const ae=S(k,`users/${E}`),C=await z(ae);if(C.exists()){const v=(C.val().fortune||0)+Q.amount;B[`users/${E}/fortune`]=v,ye.push(Ve(E,v,Q.amount,`Remboursement pari: ${((i=h.team1Names)==null?void 0:i.join(" & "))??"Ã‰quipe 1"} vs ${((o=h.team2Names)==null?void 0:o.join(" & "))??"Ã‰quipe 2"}`))}}else{ge[E]=-Q.amount,b.log(`âŒ [FIN MATCH] ${Q.username} PERD ${Q.amount}â‚¬`);const ae=S(k,`users/${E}`),C=await z(ae);if(C.exists()){const q=C.val(),Y=q.fortune||0,v=q.bettingGains||0;B[`users/${E}/bettingGains`]=v-Q.amount,ye.push(Ve(E,Y,0,`Perte pari: ${((l=h.team1Names)==null?void 0:l.join(" & "))??"Ã‰quipe 1"} vs ${((c=h.team2Names)==null?void 0:c.join(" & "))??"Ã‰quipe 2"} (-${Q.amount}â‚¬)`))}}b.log("ðŸ“Š [FIN MATCH] RÃ©sumÃ© des gains:",ge);const ee=S(k,"matches"),se=mt(ee),H=Mi({team1:h.team1,team2:h.team2,matchType:g,score1:t,score2:r,timestamp:Date.now(),recordedBy:h.createdBy,fromBetting:!0,suspicious:p});B[`matches/${se.key}`]=H,B[`bettingMatches/${s}/status`]="finished",B[`bettingMatches/${s}/score1`]=t,B[`bettingMatches/${s}/score2`]=r,B[`bettingMatches/${s}/finishedAt`]=Date.now(),await oe(S(k),B),await Promise.all(ye),xo();const{checkAchievements:fe}=await rt(async()=>{const{checkAchievements:E}=await Promise.resolve().then(()=>io);return{checkAchievements:E}},void 0),D=[...h.team1,...h.team2];return await Promise.all(D.map(async E=>{try{await fe(E)}catch(Q){b.error(`Erreur vÃ©rification achievements pour ${E}:`,Q)}})),b.log("âœ… [FIN MATCH] Match terminÃ© avec succÃ¨s!"),{eloUpdates:A,winnings:ge}}catch(d){throw b.error("âŒ [FIN MATCH] Erreur:",d),d}}async function gm(s,t,r,n,a){try{if(!a)throw new Error("Utilisateur non authentifiÃ©");if(!Array.isArray(s)||!Array.isArray(t))throw new Error("Ã‰quipes invalides");if(s.length===0||t.length===0)throw new Error("Les Ã©quipes doivent contenir au moins un joueur");if(s.length>2||t.length>2)throw new Error("Maximum 2 joueurs par Ã©quipe");if(typeof r!="number"||typeof n!="number")throw new Error("Scores invalides");if(!Number.isInteger(r)||!Number.isInteger(n))throw new Error("Les scores doivent Ãªtre des nombres entiers");if(r<0||n<0||r>100||n>100)throw new Error("Les scores doivent Ãªtre entre 0 et 100");if(r===n)throw new Error("Le score ne peut pas Ãªtre Ã©gal");if(s.filter(_=>t.includes(_)).length>0)throw new Error("Un joueur ne peut pas Ãªtre dans les deux Ã©quipes");const o=s.filter((_,J)=>s.indexOf(_)!==J),l=t.filter((_,J)=>t.indexOf(_)!==J);if(o.length>0||l.length>0)throw new Error("Un joueur ne peut pas Ãªtre deux fois dans la mÃªme Ã©quipe");const c=await uo(s,t,r,n),d=lo(s.length,t.length),u=[...s,...t],h=await ho(u),p=u.filter(_=>!h[_]);if(p.length>0)throw new Error(`Joueur(s) introuvable(s): ${p.join(", ")}`);const f=h,x=_=>{const J=f[_];if(!J)return 1e3;switch(d){case"1v1":return J.elo1v1||1e3;case"2v2":return J.elo2v2||1e3;case"mixed":return J.eloGlobal||1e3}},g=s.map(_=>{const J=f[_];if(!J)throw new Error(`Joueur ${_} introuvable`);return{id:_,username:J.username||"Unknown",eloRating:x(_),wins:J[`wins${d==="1v1"?"1v1":d==="2v2"?"2v2":"Mixed"}`]||0,losses:J[`losses${d==="1v1"?"1v1":d==="2v2"?"2v2":"Mixed"}`]||0}}),y=t.map(_=>{const J=f[_];if(!J)throw new Error(`Joueur ${_} introuvable`);return{id:_,username:J.username||"Unknown",eloRating:x(_),wins:J[`wins${d==="1v1"?"1v1":d==="2v2"?"2v2":"Mixed"}`]||0,losses:J[`losses${d==="1v1"?"1v1":d==="2v2"?"2v2":"Mixed"}`]||0}}),j=g.reduce((_,J)=>_+J.eloRating,0)/g.length,M=y.reduce((_,J)=>_+J.eloRating,0)/y.length,P=r>n,w=[],I={},O=async(_,J,U)=>{if(c)return;let X=co(_.eloRating,J,U);const pe=X-_.eloRating;(await Yr(_.id)).xpBoost&&U&&(X=oo(X,_.eloRating),b.log(`ðŸŽ¯ [Bonus Club] ${_.username}: ELO ${_.eloRating} â†’ ${X} (avec bonus +20%)`));const ye=X-_.eloRating,ee=d==="1v1"?"elo1v1":d==="2v2"?"elo2v2":"eloGlobal";I[`users/${_.id}/${ee}`]=X;const se=f[_.id];if(!se)throw new Error(`Utilisateur ${_.id} introuvable lors de la mise Ã  jour ELO`);const H=d==="1v1"?X:se.elo1v1||1e3,fe=d==="2v2"?X:se.elo2v2||1e3,D=d==="mixed"?X:se.eloGlobal||1e3,E=[];(d==="1v1"||se.elo1v1!==void 0)&&E.push(H),(d==="2v2"||se.elo2v2!==void 0)&&E.push(fe),(d==="mixed"||se.eloGlobal!==void 0)&&E.push(D);const Q=E.length>0?Math.round(E.reduce((K,ne)=>K+ne,0)/E.length):1e3;I[`users/${_.id}/eloGlobal`]=Q;const ae=`wins${d==="1v1"?"1v1":d==="2v2"?"2v2":"Mixed"}`,C=`losses${d==="1v1"?"1v1":d==="2v2"?"2v2":"Mixed"}`;I[`users/${_.id}/${ae}`]=U?_.wins+1:_.wins,I[`users/${_.id}/${C}`]=U?_.losses:_.losses+1;const q=se.winStreak||0;U?I[`users/${_.id}/winStreak`]=q+1:I[`users/${_.id}/winStreak`]=0;const v=new Date().getDay()===4;if(U&&v){const K=se.thursdayWins||0;I[`users/${_.id}/thursdayWins`]=K+1}const Z=Ws(X);w.push({userId:_.id,username:_.username,oldElo:_.eloRating,newElo:X,eloChange:ye,matchType:d,rank:Z})};await Promise.all([...g.map(_=>O(_,M,P)),...y.map(_=>O(_,j,!P))]);const N=S(k,"matches"),R=mt(N),F=Mi({team1:s,team2:t,matchType:d,score1:r,score2:n,timestamp:Date.now(),recordedBy:a,suspicious:c,fromBetting:!1});I[`matches/${R.key}`]=F,await oe(S(k),I),xo();const{checkAchievements:A}=await rt(async()=>{const{checkAchievements:_}=await Promise.resolve().then(()=>io);return{checkAchievements:_}},void 0);await Promise.all(u.map(async _=>{try{await A(_)}catch(J){b.error(`Erreur vÃ©rification achievements pour ${_}:`,J)}}));const{updateQuestProgress:B}=await rt(async()=>{const{updateQuestProgress:_}=await Promise.resolve().then(()=>Mu);return{updateQuestProgress:_}},void 0);if(await Promise.all(u.map(async _=>{try{await B(_,"match",1),(P&&s.includes(_)||!P&&t.includes(_))&&(d==="1v1"?await B(_,"win_1v1",1):d==="2v2"&&await B(_,"win_2v2",1),await B(_,"win_any",1))}catch(J){b.error(`Erreur mise Ã  jour quÃªtes pour ${_}:`,J)}})),d==="1v1")try{const{updateRivalry:_,notifyRivalryMilestone:J}=await rt(async()=>{const{updateRivalry:pe,notifyRivalryMilestone:ge}=await Promise.resolve().then(()=>yn);return{updateRivalry:pe,notifyRivalryMilestone:ge}},void 0);await _(s[0],t[0],f[s[0]].username,f[t[0]].username,P);const{getRivalryBetween:U}=await rt(async()=>{const{getRivalryBetween:pe}=await Promise.resolve().then(()=>yn);return{getRivalryBetween:pe}},void 0),X=await U(s[0],t[0]);if(X&&[10,20,50].includes(X.totalMatches)){const pe=X.intensity==="legendary"?"LÃ‰GENDAIRE":X.intensity==="heated"?"INTENSE":"CASUAL";await J(s[0],f[t[0]].username,pe,X.totalMatches),await J(t[0],f[s[0]].username,pe,X.totalMatches)}}catch(_){b.error("Erreur mise Ã  jour rivalitÃ©:",_)}return{eloUpdates:w}}catch(i){throw b.error("Erreur lors de l'enregistrement du match:",i),i}}function Ys(s,t){if(!Array.isArray(s)||!Array.isArray(t)||s.length!==t.length)return!1;const r=new Set(s),n=new Set(t);if(r.size!==n.size)return!1;for(const a of r)if(!n.has(a))return!1;return!0}async function uo(s,t,r,n){try{const a=S(k,"matches"),i=await z(a);if(!i.exists())return!1;const o=Date.now(),l=6*60*60*1e3;let c=0;i.forEach(u=>{const h=u.val();if(!h||!Array.isArray(h.team1)||!Array.isArray(h.team2)||!h.timestamp||o-h.timestamp>l)return;const p=Ys(h.team1,s)&&Ys(h.team2,t),f=Ys(h.team1,t)&&Ys(h.team2,s);(p||f)&&c++});const d=Math.abs(r-n);return c>=5||c>=3&&d>=10}catch(a){return b.error("Erreur dÃ©tection match suspicieux:",a),!1}}async function bm(){try{const s=S(k,"bettingMatches"),t=await z(s);if(!t.exists())return[];const r=[];return t.forEach(n=>{const a={id:n.key,...n.val()};(a.status==="open"||a.status==="playing")&&r.push(a)}),r.sort((n,a)=>a.createdAt-n.createdAt)}catch(s){return b.error("Erreur lors de la rÃ©cupÃ©ration des matchs:",s),[]}}const ar=new Map,vm=3e4;async function mo(s=!0){const t="all_players",r=ar.get(t);if(s&&r&&Date.now()-r.timestamp<vm)return r.data;try{const n=S(k,"users"),a=await z(n);if(!a.exists()){const l=[];return ar.set(t,{data:l,timestamp:Date.now()}),l}const i=a.val(),o=Object.entries(i).map(([l,c])=>{const d=Yt(c);return{id:l,username:d.username||"Unknown",elo1v1:d.elo1v1||1e3,elo2v2:d.elo2v2||1e3,eloGlobal:d.eloGlobal||1e3}});return ar.set(t,{data:o,timestamp:Date.now()}),o}catch(n){return b.error("Erreur lors de la rÃ©cupÃ©ration des joueurs:",n),r?r.data:[]}}function xo(){ar.clear()}async function ho(s){const t={};return await Promise.all(s.map(async r=>{try{const n=S(k,`users/${r}`),a=await z(n);if(a.exists()){const i=a.val(),o=Yt(i);t[r]={id:r,username:o.username||"Unknown",elo1v1:o.elo1v1||1e3,elo2v2:o.elo2v2||1e3,eloGlobal:o.eloGlobal||1e3,wins1v1:o.wins1v1||0,losses1v1:o.losses1v1||0,wins2v2:o.wins2v2||0,losses2v2:o.losses2v2||0,winsMixed:o.winsMixed||0,lossesMixed:o.lossesMixed||0}}}catch(n){b.error(`Erreur chargement joueur ${r}:`,n)}})),t}function Ks({className:s,variant:t="default"}){const r="animate-pulse bg-muted rounded",n={default:"h-4 w-full",circular:"h-12 w-12 rounded-full",text:"h-4 w-3/4",card:"h-32 w-full rounded-lg"};return e.jsx("div",{className:me(r,n[t],s)})}function ym(){return e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((s,t)=>e.jsx("div",{className:"rounded-lg border border-border bg-surface-alt p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Ks,{variant:"circular",className:"h-12 w-12"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(Ks,{className:"h-4 w-32"}),e.jsx(Ks,{className:"h-3 w-24"})]}),e.jsx(Ks,{className:"h-8 w-16"})]})},t))})}const jm=s=>s===1?"text-rarity-gold":s===2?"text-rarity-silver":s===3?"text-rarity-bronze":"text-muted-foreground",wm=s=>s===1?"ðŸ‘‘":s===2?"ðŸ¥ˆ":s===3?"ðŸ¥‰":s,Nm=(s,t)=>{const r=t==="1v1"?s.wins1v1:t==="2v2"?s.wins2v2:s.winsMixed,n=t==="1v1"?s.losses1v1:t==="2v2"?s.losses2v2:s.lossesMixed,a=r+n;return a===0?0:Math.round(r/a*100)},nr=s=>{const t=Ws(s);return e.jsxs(le,{style:{backgroundColor:`${t.color}20`,borderColor:t.color,color:t.color},className:"border",children:[e.jsx("span",{className:"mr-1",children:t.icon}),t.name]})},Cm=gl.memo(({player:s,rank:t,index:r,selectedMode:n})=>{const a=n==="1v1"?s.elo1v1:n==="2v2"?s.elo2v2:s.eloGlobal,o=Nm(s,n==="1v1"?"1v1":n==="2v2"?"2v2":"mixed");return e.jsx(W.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1+r*.05},className:`rounded-lg border p-4 ${t<=3?"border-primary/40 bg-gradient-to-r from-primary/10 to-transparent":"border-border bg-surface-alt"}`,children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`flex h-12 w-12 items-center justify-center rounded-lg bg-surface font-bold ${jm(t)}`,children:wm(t)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"font-semibold text-foreground",children:s.username}),nr(a)]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["WR: ",o,"%"]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:[n==="1v1"&&`${s.wins1v1}V - ${s.losses1v1}D`,n==="2v2"&&`${s.wins2v2}V - ${s.losses2v2}D`,n==="global"&&`${s.winsMixed}V - ${s.lossesMixed}D`]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:a}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ELO"})]})]})})},(s,t)=>s.player.id===t.player.id&&s.player.elo1v1===t.player.elo1v1&&s.player.elo2v2===t.player.elo2v2&&s.player.eloGlobal===t.player.eloGlobal&&s.rank===t.rank&&s.selectedMode===t.selectedMode),Sm=()=>{const[s,t]=m.useState([]),[r,n]=m.useState(!0),[a,i]=m.useState("global"),[o,l]=m.useState(1),c=20;m.useEffect(()=>{const x=S(k,"users"),g=et(x,y=>{if(!y.exists()){t([]),n(!1);return}const j=[];y.forEach(M=>{const P=M.val(),w=Yt(P);j.push({id:M.key,username:w.username||"Joueur",elo1v1:w.elo1v1||w.eloRating||1e3,elo2v2:w.elo2v2||w.eloRating||1e3,eloGlobal:w.eloGlobal||w.eloRating||1e3,wins1v1:w.wins1v1||0,losses1v1:w.losses1v1||0,wins2v2:w.wins2v2||0,losses2v2:w.losses2v2||0,winsMixed:w.winsMixed||0,lossesMixed:w.lossesMixed||0})}),t(j),n(!1)},y=>{b.error("Erreur chargement leaderboard:",y),n(!1)});return()=>g()},[]);const d=m.useMemo(()=>{const x=a==="1v1"?"elo1v1":a==="2v2"?"elo2v2":"eloGlobal";return[...s].sort((g,y)=>y[x]-g[x])},[s,a]),u=m.useMemo(()=>{const x={Bronze:0,Argent:0,Or:0,Platine:0,Diamant:0,MaÃ®tre:0,"G.MaÃ®tre":0,Challenger:0},g=a==="1v1"?"elo1v1":a==="2v2"?"elo2v2":"eloGlobal";s.forEach(j=>{const M=j[g],P=Ws(M);x.hasOwnProperty(P.name)&&x[P.name]++});const y=s.length||1;return Object.entries(x).map(([j,M])=>({name:j,percentage:Math.round(M/y*100)}))},[s,a]),h=m.useMemo(()=>d.slice(0,3),[d]),p=m.useMemo(()=>{const x=(o-1)*c;return d.slice(x,x+c)},[d,o]),f=m.useMemo(()=>Math.ceil(d.length/c),[d.length]);return r?e.jsx($e,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"rounded-xl bg-rarity-gold/20 p-3",children:e.jsx(Pe,{className:"h-6 w-6 text-rarity-gold"})}),e.jsxs("div",{children:[e.jsx("div",{className:"h-7 w-32 bg-muted animate-pulse rounded mb-2"}),e.jsx("div",{className:"h-4 w-24 bg-muted animate-pulse rounded"})]})]}),e.jsx(ym,{})]})}):e.jsxs($e,{children:[e.jsxs(W.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"rounded-xl bg-rarity-gold/20 p-3",children:e.jsx(Pe,{className:"h-6 w-6 text-rarity-gold"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Classement"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Saison 1 - Multi-Modes"})]})]}),e.jsx(Ss,{value:a,onValueChange:x=>i(x),className:"w-full",children:e.jsxs(Xt,{className:"grid w-full grid-cols-3",children:[e.jsxs(He,{value:"global",className:"gap-2",children:[e.jsx(Hl,{className:"h-4 w-4"}),"Global"]}),e.jsxs(He,{value:"1v1",className:"gap-2",children:[e.jsx(Ps,{className:"h-4 w-4"}),"1v1"]}),e.jsxs(He,{value:"2v2",className:"gap-2",children:[e.jsx(Ee,{className:"h-4 w-4"}),"2v2"]})]})})]}),h.length>0&&e.jsxs(W.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.1},className:"mb-6 flex items-end justify-center gap-2",children:[h[1]&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"mb-2 flex h-16 w-16 items-center justify-center rounded-full border-4 border-rarity-silver bg-surface-alt",children:e.jsx("span",{className:"text-2xl",children:"ðŸ¥ˆ"})}),e.jsx("p",{className:"text-sm font-medium text-foreground mb-1",children:h[1].username}),nr(a==="1v1"?h[1].elo1v1:a==="2v2"?h[1].elo2v2:h[1].eloGlobal),e.jsx("div",{className:"mt-2 h-20 w-20 rounded-t-lg bg-gradient-to-b from-rarity-silver/40 to-rarity-silver/20 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl font-bold text-rarity-silver",children:a==="1v1"?h[1].elo1v1:a==="2v2"?h[1].elo2v2:h[1].eloGlobal})})]}),h[0]&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(W.div,{animate:{y:[0,-5,0]},transition:{duration:2,repeat:1/0},className:"mb-2",children:e.jsx("span",{className:"text-3xl",children:"ðŸ‘‘"})}),e.jsx("div",{className:"mb-2 flex h-20 w-20 items-center justify-center rounded-full border-4 border-rarity-gold bg-surface-alt glow-gold",children:e.jsx("span",{className:"text-3xl",children:"ðŸ†"})}),e.jsx("p",{className:"font-semibold text-foreground mb-1",children:h[0].username}),nr(a==="1v1"?h[0].elo1v1:a==="2v2"?h[0].elo2v2:h[0].eloGlobal),e.jsx("div",{className:"mt-2 h-28 w-24 rounded-t-lg bg-gradient-to-b from-rarity-gold/40 to-rarity-gold/20 flex items-center justify-center",children:e.jsx("span",{className:"text-3xl font-bold text-rarity-gold",children:a==="1v1"?h[0].elo1v1:a==="2v2"?h[0].elo2v2:h[0].eloGlobal})})]}),h[2]&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"mb-2 flex h-14 w-14 items-center justify-center rounded-full border-4 border-rarity-bronze bg-surface-alt",children:e.jsx("span",{className:"text-xl",children:"ðŸ¥‰"})}),e.jsx("p",{className:"text-sm font-medium text-foreground mb-1",children:h[2].username}),nr(a==="1v1"?h[2].elo1v1:a==="2v2"?h[2].elo2v2:h[2].eloGlobal),e.jsx("div",{className:"mt-2 h-16 w-18 rounded-t-lg bg-gradient-to-b from-rarity-bronze/40 to-rarity-bronze/20 flex items-center justify-center px-6",children:e.jsx("span",{className:"text-xl font-bold text-rarity-bronze",children:a==="1v1"?h[2].elo1v1:a==="2v2"?h[2].elo2v2:h[2].eloGlobal})})]})]}),e.jsx(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"mb-6",children:e.jsxs(L,{children:[e.jsx(xe,{children:e.jsx(he,{className:"text-lg",children:"Distribution des Rangs"})}),e.jsx(V,{children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:[{name:"Bronze",icon:"ðŸ¥‰",color:"#CD7F32"},{name:"Argent",icon:"ðŸ¥ˆ",color:"#C0C0C0"},{name:"Or",icon:"ðŸ¥‡",color:"#FFD700"},{name:"Platine",icon:"ðŸ’Ž",color:"#E5E4E2"},{name:"Diamant",icon:"ðŸ’ ",color:"#B9F2FF"},{name:"MaÃ®tre",icon:"ðŸ‘‘",color:"#9B59B6"},{name:"G.MaÃ®tre",icon:"âš¡",color:"#E74C3C"},{name:"Challenger",icon:"ðŸ”¥",color:"#F39C12"}].map(x=>{const g=u.find(y=>y.name===x.name);return e.jsxs("div",{className:"flex flex-col items-center rounded-lg border border-border bg-surface-alt p-2",children:[e.jsx("span",{className:"text-2xl mb-1",children:x.icon}),e.jsx("span",{className:"text-xs font-medium",style:{color:x.color},children:x.name}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[(g==null?void 0:g.percentage)||0,"%"]})]},x.name)})})})]})}),e.jsx("div",{className:"space-y-3",children:p.length>0?p.map((x,g)=>{const y=(o-1)*c+g+1;return e.jsx(Cm,{player:x,rank:y,index:g,selectedMode:a},x.id)}):e.jsx(L,{children:e.jsx(V,{className:"p-8 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"Aucun joueur trouvÃ©"})})})}),f>1&&e.jsxs("div",{className:"mt-6 flex items-center justify-center gap-2",children:[e.jsx(T,{variant:"outline",size:"sm",onClick:()=>l(x=>Math.max(1,x-1)),disabled:o===1,children:"PrÃ©cÃ©dent"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",o," sur ",f]}),e.jsx(T,{variant:"outline",size:"sm",onClick:()=>l(x=>Math.min(f,x+1)),disabled:o===f,children:"Suivant"})]})]})};function km({queuedPlayers:s,isInQueue:t,onJoinQueue:r,onLeaveQueue:n,isJoining:a=!1,isLeaving:i=!1}){return e.jsxs(L,{className:"overflow-hidden",children:[e.jsx(xe,{className:"border-b border-border bg-surface-alt/50",children:e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-5 w-5 text-primary"}),"File d'attente",e.jsxs("span",{className:"ml-auto rounded-full bg-primary/20 px-3 py-1 text-sm text-primary",children:[s.length,"/4"]})]})}),e.jsxs(V,{className:"p-4",children:[e.jsx("div",{className:"mb-6 grid grid-cols-4 gap-2",children:[0,1,2,3].map(o=>{const l=s[o];return e.jsx(W.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:o*.1},className:`flex aspect-square flex-col items-center justify-center rounded-xl border-2 border-dashed transition-all ${l?"border-primary bg-primary/10 neon-border-cyan":"border-border bg-surface-alt"}`,children:l?e.jsxs(e.Fragment,{children:[e.jsx(Vs,{className:"h-8 w-8 text-primary"}),e.jsx("span",{className:"mt-1 text-xs font-medium truncate w-full text-center px-1",children:l.username}),e.jsx("span",{className:"text-[10px] text-primary",children:l.eloRating})]}):e.jsxs(e.Fragment,{children:[e.jsx(it,{className:"h-6 w-6 text-muted-foreground"}),e.jsx("span",{className:"mt-1 text-xs text-muted-foreground",children:"En attente"})]})},o)})}),t?e.jsx(T,{variant:"neon-magenta",className:"w-full",onClick:n,disabled:i,children:i?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"mr-2 h-4 w-4 animate-spin"}),"DÃ©part..."]}):"Quitter la file"}):e.jsx(T,{variant:"neon",className:"w-full",onClick:r,disabled:a,children:a?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"mr-2 h-4 w-4 animate-spin"}),"Rejoindre..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ri,{className:"mr-2 h-4 w-4"}),"Rejoindre la file"]})}),s.length===4&&e.jsx(W.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mt-4 rounded-lg bg-primary/20 p-3 text-center",children:e.jsx("p",{className:"font-semibold text-primary text-glow-cyan",children:"ðŸŽ® Match prÃªt Ã  dÃ©marrer !"})})]})]})}const _m=()=>{const{user:s,userProfile:t}=Ae(),r=ht(),[n,a]=m.useState(!1),[i,o]=m.useState([]),[l,c]=m.useState([]),[d,u]=m.useState(!0),[h,p]=m.useState(!0),[f,x]=m.useState(!1),[g,y]=m.useState(!1),{elo1v1:j=1e3,elo2v2:M=1e3,eloGlobal:P=1e3}=t;m.useEffect(()=>{u(!0);const R=Ui(F=>{if(o(F),u(!1),s){const A=F.some(B=>B.id===s.uid);a(A)}});return()=>R()},[s]),m.useEffect(()=>{p(!0);const R=Bi(F=>{c(F),p(!1)},10);return()=>R()},[]);const w=async()=>{if(!s||!t){$({title:"Erreur",description:"Vous devez Ãªtre connectÃ©",variant:"destructive"});return}x(!0);try{await dm(s.uid,t.username,j,M,P),$({title:"File d'attente",description:"Vous avez rejoint la file d'attente!"})}catch(R){b.error("Erreur:",R),$({title:"Erreur",description:"Impossible de rejoindre la file",variant:"destructive"})}finally{x(!1)}},I=async()=>{if(s){y(!0);try{await um(s.uid),$({title:"File d'attente",description:"Vous avez quittÃ© la file d'attente."})}catch(R){b.error("Erreur:",R),$({title:"Erreur",description:"Impossible de quitter la file",variant:"destructive"})}finally{y(!1)}}},O=R=>{try{return(typeof R=="string"?new Date(R):new Date(R)).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Date inconnue"}},N=(R,F)=>{const A=F===1?R.team1:R.team2,B=F===1?R.team1Names:R.team2Names;return B&&Array.isArray(B)?B.join(" & "):A&&A.length>0&&typeof A[0]=="string"?A.join(" & "):`Ã‰quipe ${F}`};return e.jsxs($e,{children:[e.jsxs(W.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"rounded-xl bg-primary/20 p-3",children:e.jsx(Ps,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Match"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Trouvez une partie"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto",children:[e.jsxs(T,{onClick:()=>r("/record-match"),variant:"outline",className:"gap-2 w-full sm:w-auto",children:[e.jsx(ai,{className:"h-4 w-4"}),"Enregistrer Match"]}),e.jsxs(T,{onClick:()=>r("/betting"),variant:"neon",className:"gap-2 w-full sm:w-auto",children:[e.jsx(is,{className:"h-4 w-4"}),"Match avec Paris"]})]})]}),e.jsx(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"mb-6",children:d?e.jsx(L,{children:e.jsxs(V,{className:"flex items-center justify-center p-8",children:[e.jsx(ue,{className:"h-6 w-6 animate-spin text-primary"}),e.jsx("p",{className:"ml-3 text-muted-foreground",children:"Chargement de la file..."})]})}):e.jsx(km,{queuedPlayers:i,isInQueue:n,onJoinQueue:w,onLeaveQueue:I,isJoining:f,isLeaving:g})}),e.jsx(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"mb-6",children:e.jsx(L,{className:"border-rarity-gold/30 bg-gradient-to-r from-rarity-gold/10 to-transparent",children:e.jsxs(V,{className:"flex items-center gap-4 p-4",children:[e.jsx("div",{className:"rounded-xl bg-rarity-gold/20 p-3",children:e.jsx(Zl,{className:"h-6 w-6 text-rarity-gold"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-foreground",children:"Tournoi du Jeudi"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"DÃ©but dans 2h (13:00)"})]}),e.jsx(T,{onClick:()=>r("/tournament"),variant:"outline",size:"sm",className:"border-rarity-gold text-rarity-gold hover:bg-rarity-gold/10",children:"S'inscrire"})]})})}),e.jsx(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:e.jsxs(L,{children:[e.jsx(xe,{className:"border-b border-border",children:e.jsxs(he,{className:"flex items-center gap-2 text-lg",children:[e.jsx(Wl,{className:"h-5 w-5 text-muted-foreground"}),"Matchs rÃ©cents"]})}),e.jsx(V,{className:"p-4",children:h?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(ue,{className:"h-6 w-6 animate-spin text-primary"}),e.jsx("p",{className:"ml-3 text-muted-foreground",children:"Chargement des matchs..."})]}):e.jsx("div",{className:"space-y-4",children:l.length>0?l.map((R,F)=>e.jsxs(W.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4+F*.1},className:"rounded-lg bg-surface-alt p-4 hover:bg-surface-alt/70 transition-colors",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:O(R.date)}),e.jsx("span",{className:R.score1>R.score2?"text-primary":"text-red-500",children:R.score1>R.score2?"Ã‰quipe 1 gagne":"Ã‰quipe 2 gagne"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1 text-center",children:e.jsx("p",{className:"text-sm font-medium text-foreground",children:N(R,1)})}),e.jsxs("div",{className:"mx-4 flex items-center gap-2",children:[e.jsx("span",{className:`text-2xl font-bold ${R.score1>R.score2?"text-primary text-glow-cyan":"text-muted-foreground"}`,children:R.score1}),e.jsx("span",{className:"text-muted-foreground",children:"-"}),e.jsx("span",{className:`text-2xl font-bold ${R.score2>R.score1?"text-red-500":"text-muted-foreground"}`,children:R.score2})]}),e.jsx("div",{className:"flex-1 text-center",children:e.jsx("p",{className:"text-sm font-medium text-foreground",children:N(R,2)})})]})]},R.id)):e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Aucun match rÃ©cent"})})})]})})]})};async function Qs(s,t,r,n,a){try{const i=`${Date.now()}_${Math.random().toString(36).substr(2,9)}`;await oe(S(k),{[`notifications/${s}/${i}`]:{userId:s,type:t,title:r,message:n,relatedId:a,read:!1,createdAt:Date.now()}})}catch(i){b.error("Erreur crÃ©ation notification:",i)}}async function Em(s,t,r,n,a){if(!s)throw new Error("Utilisateur non authentifiÃ©");if(a<=0)throw new Error("Le prix doit Ãªtre supÃ©rieur Ã  0");const i=S(k,`users/${s}`),o=S(k),l=await z(i);if(!l.exists())throw new Error("Utilisateur introuvable");const u=((l.val()||{}).cards||{})[t]||0;if(u<=0)throw new Error("Vous ne possÃ©dez pas cette carte");const p=mt(S(k,"cardMarket")).key,f={};f[`users/${s}/cards/${t}`]=u-1,f[`cardMarket/${p}`]={cardCode:t,cardName:r,rarity:n,sellerId:s,price:a,createdAt:Date.now(),status:"open",views:0,offersCount:0},await oe(o,f)}async function Rm(){const s=S(k,"cardMarket"),t=await z(s);if(!t.exists())return[];const r=t.val(),n=[];for(const[a,i]of Object.entries(r)){const o=i;o.status==="open"&&n.push({id:a,cardCode:o.cardCode,cardName:o.cardName,rarity:o.rarity,sellerId:o.sellerId,price:o.price,createdAt:o.createdAt,status:o.status,buyerId:o.buyerId,views:o.views||0,offersCount:o.offersCount||0})}return n.sort((a,i)=>i.createdAt-a.createdAt)}async function $m(s){const t=S(k,`cardMarket/${s}`),r=await z(t);if(!r.exists())return;const a=r.val().views||0;await oe(S(k),{[`cardMarket/${s}/views`]:a+1})}async function Am(s,t){const r=S(k,`cardMarket/${t}`),n=await z(r);if(!n.exists())throw new Error("Annonce introuvable");const a=n.val();if(a.sellerId!==s)throw new Error("Vous ne pouvez pas annuler cette annonce");if(a.status!=="open")throw new Error("Cette annonce n'est plus ouverte");const i=S(k),o=S(k,`users/${s}`),l=await z(o),u=((l.exists()?l.val():{}).cards||{})[a.cardCode]||0,h={};h[`users/${s}/cards/${a.cardCode}`]=u+1,h[`cardMarket/${t}/status`]="cancelled",await oe(i,h)}async function Mm(s,t){if(!s)throw new Error("Utilisateur non authentifiÃ©");const r=S(k,`cardMarket/${t}`),n=await z(r);if(!n.exists())throw new Error("Annonce introuvable");const a=n.val();if(a.status!=="open")throw new Error("Cette annonce n'est plus disponible");if(a.sellerId===s)throw new Error("Vous ne pouvez pas acheter votre propre annonce");const i=S(k,`users/${a.sellerId}`),o=S(k,`users/${s}`),[l,c]=await Promise.all([z(i),z(o)]);if(!c.exists())throw new Error("Acheteur introuvable");if(!l.exists())throw new Error("Vendeur introuvable");const d=l.val()||{},u=c.val()||{},h=u.fortune||0;if(h<a.price)throw new Error("Fonds insuffisants pour acheter cette carte");const f=(u.cards||{})[a.cardCode]||0,x=d.fortune||0,g=h-a.price,y=x+a.price,j={};j[`users/${s}/fortune`]=g,j[`users/${s}/cards/${a.cardCode}`]=f+1,j[`users/${a.sellerId}/fortune`]=y,j[`cardMarket/${t}/status`]="sold",j[`cardMarket/${t}/buyerId`]=s,j[`cardMarket/${t}/finalPrice`]=a.price,j[`cardMarket/${t}/soldAt`]=Date.now();try{await oe(S(k),j)}catch(w){throw b.error("âŒ Erreur lors de la transaction:",w),new Error("La transaction a Ã©chouÃ©. Aucune modification n'a Ã©tÃ© effectuÃ©e.")}((await z(o)).val()||{}).fortune!==g&&b.error("âš ï¸ ALERTE: La fortune de l'acheteur ne correspond pas!");try{await Promise.all([Ve(s,g,-a.price,`Achat carte: ${a.cardName}`),Ve(a.sellerId,y,a.price,`Vente carte: ${a.cardName}`)])}catch(w){b.error("âš ï¸ Erreur historique (non bloquant):",w)}try{await Qs(a.sellerId,"listing_sold","Carte vendue ! ðŸŽ‰",`Votre ${a.cardName} a Ã©tÃ© vendue pour ${a.price}â‚¬`,t)}catch(w){b.error("âš ï¸ Erreur notification (non bloquant):",w)}try{await yo(a.cardCode,a.price)}catch(w){b.error("âš ï¸ Erreur stats (non bloquant):",w)}}async function Tm(s,t,r,n){if(!s)throw new Error("Utilisateur non authentifiÃ©");if(r<=0)throw new Error("Le montant doit Ãªtre supÃ©rieur Ã  0");const a=S(k,`cardMarket/${t}`),i=await z(a);if(!i.exists())throw new Error("Annonce introuvable");const o=i.val();if(o.status!=="open")throw new Error("Cette annonce n'est plus disponible");if(o.sellerId===s)throw new Error("Vous ne pouvez pas faire une offre sur votre propre annonce");const l=S(k,`users/${s}`);if((((await z(l)).val()||{}).fortune||0)<r)throw new Error("Fonds insuffisants pour cette offre");const p=mt(S(k,"cardOffers")).key,f=Date.now(),x=f+48*60*60*1e3,g={id:p,listingId:t,buyerId:s,sellerId:o.sellerId,amount:r,message:n,status:"pending",createdAt:f,expiresAt:x},y=o.offersCount||0;return await oe(S(k),{[`cardOffers/${p}`]:g,[`cardMarket/${t}/offersCount`]:y+1}),await Qs(o.sellerId,"offer_received","Nouvelle offre reÃ§ue ðŸ’°",`Une offre de ${r}â‚¬ a Ã©tÃ© faite pour votre ${o.cardName}`,p),p}async function fo(s,t){const r=S(k,`cardOffers/${t}`),n=await z(r);if(!n.exists())throw new Error("Offre introuvable");const a=n.val();if(a.sellerId!==s)throw new Error("Vous n'Ãªtes pas le vendeur de cette annonce");if(a.status!=="pending")throw new Error("Cette offre n'est plus valide");if(Date.now()>a.expiresAt)throw new Error("Cette offre a expirÃ©");const i=S(k,`cardMarket/${a.listingId}`),l=(await z(i)).val(),c=S(k,`users/${a.buyerId}`),d=S(k,`users/${s}`),[u,h]=await Promise.all([z(c),z(d)]),p=u.val()||{},f=h.val()||{},x=p.fortune||0,g=f.fortune||0;if(x<a.amount)throw new Error("L'acheteur n'a plus les fonds suffisants");const j=(p.cards||{})[l.cardCode]||0;await oe(S(k),{[`users/${a.buyerId}/fortune`]:x-a.amount,[`users/${a.buyerId}/cards/${l.cardCode}`]:j+1}),await oe(S(k),{[`users/${s}/fortune`]:g+a.amount}),await oe(S(k),{[`cardMarket/${a.listingId}/status`]:"sold",[`cardMarket/${a.listingId}/buyerId`]:a.buyerId,[`cardMarket/${a.listingId}/finalPrice`]:a.amount,[`cardOffers/${t}/status`]:"accepted"}),await Promise.all([Ve(a.buyerId,x-a.amount,-a.amount,`Achat carte: ${l.cardName} (offre acceptÃ©e)`),Ve(s,g+a.amount,a.amount,`Vente carte: ${l.cardName} (offre acceptÃ©e)`)]),await Qs(a.buyerId,"offer_accepted","Offre acceptÃ©e ! âœ…",`Votre offre de ${a.amount}â‚¬ pour ${l.cardName} a Ã©tÃ© acceptÃ©e`,t),await yo(l.cardCode,a.amount)}async function po(s,t){const r=S(k,`cardOffers/${t}`),n=await z(r);if(!n.exists())throw new Error("Offre introuvable");const a=n.val();if(a.sellerId!==s)throw new Error("Vous n'Ãªtes pas le vendeur");if(a.status!=="pending")throw new Error("Cette offre n'est plus valide");await oe(S(k),{[`cardOffers/${t}/status`]:"rejected"});const i=S(k,`cardMarket/${a.listingId}`),l=(await z(i)).val();await Qs(a.buyerId,"offer_rejected","Offre rejetÃ©e âŒ",`Votre offre de ${a.amount}â‚¬ pour ${l.cardName} a Ã©tÃ© rejetÃ©e`,t)}async function go(s,t,r){const n=S(k,`cardOffers/${t}`),a=await z(n);if(!a.exists())throw new Error("Offre introuvable");const i=a.val();if(i.sellerId!==s)throw new Error("Vous n'Ãªtes pas le vendeur");if(i.status!=="pending")throw new Error("Cette offre n'est plus valide");if(r<=0)throw new Error("Le montant doit Ãªtre supÃ©rieur Ã  0");await oe(S(k),{[`cardOffers/${t}/status`]:"countered",[`cardOffers/${t}/counterOffer`]:r});const o=S(k,`cardMarket/${i.listingId}`),c=(await z(o)).val();await Qs(i.buyerId,"offer_countered","Contre-offre reÃ§ue ðŸ”„",`Le vendeur propose ${r}â‚¬ pour ${c.cardName} (votre offre: ${i.amount}â‚¬)`,t)}async function bo(s){const t=S(k,"cardOffers"),r=await z(t);if(!r.exists())return[];const n=r.val(),a=[];for(const[i,o]of Object.entries(n))o.sellerId===s&&o.status==="pending"&&a.push({...o,id:i});return a.sort((i,o)=>o.createdAt-i.createdAt)}async function vo(s){const t=S(k,"cardOffers"),r=await z(t);if(!r.exists())return[];const n=r.val(),a=[];for(const[i,o]of Object.entries(n))o.buyerId===s&&a.push({...o,id:i});return a.sort((i,o)=>o.createdAt-i.createdAt)}async function yo(s,t){const r=S(k,`marketStats/${s}`),n=await z(r),a=Date.now();let i;if(n.exists()){i=n.val(),i.totalSales+=1,i.lastSalePrice=t,i.lastSaleDate=a,i.priceHistory.push({date:a,price:t});const o=a-30*24*60*60*1e3;i.priceHistory=i.priceHistory.filter(c=>c.date>o);const l=i.priceHistory.map(c=>c.price);i.averagePrice=l.reduce((c,d)=>c+d,0)/l.length,i.lowestPrice=Math.min(...l),i.highestPrice=Math.max(...l)}else i={cardCode:s,totalSales:1,lastSalePrice:t,lastSaleDate:a,averagePrice:t,lowestPrice:t,highestPrice:t,priceHistory:[{date:a,price:t}]};await oe(S(k),{[`marketStats/${s}`]:i})}async function wr(s){const t=S(k,`marketStats/${s}`),r=await z(t);if(!r.exists())return null;const n=r.val();b.log("ðŸ“Š [getMarketStats] Type priceHistory:",typeof n.priceHistory),b.log("ðŸ“Š [getMarketStats] priceHistory:",n.priceHistory);let a=[];return n.priceHistory&&(Array.isArray(n.priceHistory)?(a=n.priceHistory,b.log("âœ… [getMarketStats] priceHistory est un array:",a.length,"entrÃ©es")):typeof n.priceHistory=="object"&&(a=Object.values(n.priceHistory),b.log("ðŸ”„ [getMarketStats] priceHistory converti d'objet vers array:",a.length,"entrÃ©es"))),a=a.filter(o=>o&&typeof o=="object"&&typeof o.date=="number"&&typeof o.price=="number"&&o.price>0),b.log("âœ… [getMarketStats] priceHistory filtrÃ©:",a.length,"entrÃ©es valides"),{cardCode:n.cardCode||s,totalSales:n.totalSales||0,lastSalePrice:n.lastSalePrice,lastSaleDate:n.lastSaleDate,averagePrice:n.averagePrice||0,lowestPrice:n.lowestPrice||0,highestPrice:n.highestPrice||0,priceHistory:a}}async function Pm(s){const t=await wr(s);if(!t||t.totalSales===0)return 10;const r=Date.now()-7*24*60*60*1e3,n=t.priceHistory.filter(a=>a.date>r).map(a=>a.price);return n.length===0?Math.round(t.averagePrice):Math.round(n.reduce((a,i)=>a+i,0)/n.length)}const je=m.forwardRef(({className:s,type:t,...r},n)=>e.jsx("input",{type:t,className:me("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:n,...r}));je.displayName="Input";const _t=50,Om=2*60*60*1e3,Ya={bronze:1,silver:2,gold:3,espoir:4,icone:5,"future-star":6,god:7,creator:8,unknown:0},Kr={bronze:"Bronze",silver:"Silver",gold:"Gold",espoir:"Espoir",icone:"IcÃ´ne","future-star":"Future Star",god:"GOD",creator:"CRÃ‰ATEUR",unknown:"Inconnu"},Lm=({season:s,nom:t,alt:r,className:n})=>{const[a,i]=m.useState(!1),o=`/images/cards/${s}/${t}`;return a?e.jsx("div",{className:me("flex items-center justify-center bg-muted/50",n),children:e.jsxs("div",{className:"text-center p-2",children:[e.jsx("span",{className:"text-xl mb-1 block",children:"âš½"}),e.jsx("p",{className:"text-[8px] text-muted-foreground uppercase",children:t})]})}):e.jsx("img",{src:o,alt:r,className:n,onError:()=>i(!0),loading:"lazy"})};function Tr({rarity:s,season:t,nom:r,owned:n=!0,onClick:a}){return e.jsx(W.div,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:a,className:me("relative cursor-pointer overflow-hidden rounded-xl p-1 transition-all",`card-rarity-${s}`,!n&&"opacity-40 grayscale"),children:e.jsxs("div",{className:"relative aspect-[3/4] overflow-hidden rounded-lg bg-background/50 backdrop-blur-sm",children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(Lm,{season:t,nom:r,alt:r,className:"h-full w-full object-cover"})}),e.jsx("div",{className:me("absolute right-2 top-2 rounded-full px-2 py-0.5 text-[10px] font-bold uppercase shadow-lg z-10",s==="bronze"&&"bg-amber-600/90 text-white",s==="silver"&&"bg-gray-400/90 text-background",s==="gold"&&"bg-yellow-500/90 text-background",s==="espoir"&&"bg-blue-500/90 text-white",s==="icone"&&"bg-purple-500/90 text-white",s==="future-star"&&"bg-cyan-500/90 text-white",s==="god"&&"bg-purple-600/90 text-white",s==="creator"&&"bg-pink-600/90 text-white",s==="unknown"&&"bg-gray-500/90 text-white"),children:Kr[s]}),!n&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-background/60",children:e.jsx("span",{className:"text-2xl",children:"ðŸ”’"})})]})})}const Im=()=>{const{user:s}=Ae(),[t,r]=m.useState("season1"),[n,a]=m.useState("all"),[i,o]=m.useState(!1),[l,c]=m.useState(!0),[d,u]=m.useState([]),[h,p]=m.useState([]),[f,x]=m.useState(0),[g,y]=m.useState(null),[j,M]=m.useState(""),[P,w]=m.useState(!1),[I,O]=m.useState(0),[N,R]=m.useState(null),[F,A]=m.useState(!1),[B,_]=m.useState(""),[J,U]=m.useState([]),[X,pe]=m.useState(!1),ge=m.useCallback(async()=>{if(s){c(!0);try{const H=S(k,`users/${s.uid}`),fe=await z(H);if(fe.exists()){const D=fe.val();O(D.fortune||0),R(D.lastFreeBooster||null);const E=D.cards||{},{codeToCardMap:Q}=await rt(async()=>{const{codeToCardMap:q}=await Promise.resolve().then(()=>Zs);return{codeToCardMap:q}},void 0),ae=Gi();U(ae);const C=[];for(const q of ae){const Y=Q[q]||{};for(const[v,Z]of Object.entries(Y)){const K=E[v]||0;C.push({code:v,nom:Z.nom,rarity:Z.rarity,season:q,ownedCount:K,owned:K>0})}}u(C.sort((q,Y)=>q.season.localeCompare(Y.season)||q.code.localeCompare(Y.code)))}}catch{$({title:"Erreur",description:"Impossible de charger la collection.",variant:"destructive"})}finally{c(!1)}}},[s]);m.useEffect(()=>{ge()},[ge]),m.useEffect(()=>{const fe=setInterval(()=>{if(!N){A(!0);return}const D=Om-(Date.now()-N);if(D<=0)A(!0),_("");else{A(!1);const E=Math.floor(D/36e5),Q=Math.floor(D%36e5/6e4),ae=Math.floor(D%6e4/1e3);_(`${E}h ${Q}m ${ae}s`)}},1e3);return()=>clearInterval(fe)},[N]);const ye=async(H=!1)=>{if(s){if(!H&&I<_t){$({title:"Pas assez d'argent",description:`Il vous faut ${_t}â‚¬`,variant:"destructive"});return}if(!(H&&!F)){o(!0),pe(H);try{const fe=H?"mixed":t,D=await Zu(s.uid,fe);p(D.sort((Q,ae)=>Ya[Et(Q.rarity)]-Ya[Et(ae.rarity)])),x(0);const E=H?{lastFreeBooster:Date.now()}:{fortune:I-_t};if(await oe(S(k,`users/${s.uid}`),E),H)R(Date.now());else{const Q=I-_t;await Ve(s.uid,Q,-_t,`Achat de booster (${ss(t)})`),O(ae=>ae-_t)}await ge()}catch{$({title:"Erreur",description:"ProblÃ¨me avec le booster.",variant:"destructive"})}finally{o(!1)}}}},ee=m.useMemo(()=>{let H=d.filter(fe=>fe.season===t);return n!=="all"&&(H=H.filter(fe=>Et(fe.rarity)===n)),H},[d,t,n]),se=async()=>{if(!s||!g)return;const H=Number(j);if(!H||H<=0){$({title:"Prix invalide",variant:"destructive"});return}w(!0);try{await Em(s.uid,g.code,g.nom,g.rarity,H),$({title:"Carte mise en vente âœ…"}),y(null),await ge()}catch(fe){$({title:"Erreur",description:fe.message,variant:"destructive"})}finally{w(!1)}};return e.jsxs($e,{children:[e.jsxs("div",{className:"container mx-auto p-4 max-w-7xl",children:[e.jsxs("div",{className:"mb-8 flex flex-col md:flex-row md:items-end justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Ma Collection"}),e.jsx("p",{className:"text-muted-foreground",children:"GÃ©rez vos cartes et ouvrez des boosters"})]}),e.jsx("div",{className:"bg-primary/10 px-4 py-2 rounded-xl border border-primary/20",children:e.jsxs("p",{className:"text-primary font-bold text-xl flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ’°"})," ",I.toLocaleString(),"â‚¬"]})})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-6 bg-muted/30 p-2 rounded-lg inline-flex",children:J.map(H=>e.jsx(T,{variant:t===H?"default":"ghost",onClick:()=>r(H),className:"rounded-md",children:ss(H)},H))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 mb-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(T,{onClick:()=>ye(!1),disabled:i||I<_t,className:"flex-1 h-14 text-lg font-bold shadow-lg shadow-primary/20",children:[i?e.jsx(ue,{className:"animate-spin mr-2"}):e.jsx(dt,{className:"mr-2"}),"Booster ",ss(t)," (",_t,"â‚¬)"]}),e.jsxs(T,{onClick:()=>ye(!0),disabled:i||!F,variant:"secondary",className:"flex-1 h-14 text-lg font-bold",children:[e.jsx(it,{className:"mr-2 h-5 w-5"}),F?"Pack Gratuit (S1+S2)":B]})]}),e.jsxs("div",{className:"flex flex-wrap gap-1 items-center justify-end",children:[e.jsxs("span",{className:"text-xs font-medium text-muted-foreground mr-2 flex items-center gap-1",children:[e.jsx(gr,{className:"h-3 w-3"})," FILTRER:"]}),["all","bronze","silver","gold","espoir","icone","future-star","god","creator"].map(H=>e.jsx(T,{size:"sm",variant:n===H?"default":"outline",onClick:()=>a(H),className:"text-[10px] h-7 px-2 uppercase font-bold",children:H==="all"?"Tous":Kr[H]},H))]})]}),l?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx(ue,{className:"animate-spin h-10 w-10 text-primary mb-4"}),e.jsx("p",{className:"text-muted-foreground animate-pulse",children:"Chargement de votre deck..."})]}):e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-4",children:ee.map(H=>e.jsxs("div",{className:"relative",children:[H.ownedCount>1&&e.jsxs("div",{className:"absolute -top-2 -right-2 z-20 bg-primary text-white text-[10px] rounded-full h-6 w-6 flex items-center justify-center font-bold border-2 border-background shadow-md",children:["x",H.ownedCount]}),e.jsx(Tr,{rarity:Et(H.rarity),season:H.season,nom:H.nom,owned:H.owned,onClick:()=>y(H)})]},H.code))})]}),e.jsx(nt,{children:g&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4",onClick:()=>y(null),children:e.jsx(W.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"w-full max-w-sm",onClick:H=>H.stopPropagation(),children:e.jsxs(L,{className:"overflow-hidden border-2 border-slate-800",children:[e.jsxs(xe,{className:"relative pb-2 bg-slate-900/50",children:[e.jsx(T,{variant:"ghost",size:"icon",className:"absolute right-2 top-2 text-muted-foreground hover:text-white",onClick:()=>y(null),children:e.jsx(Fe,{className:"h-4 w-4"})}),e.jsxs("div",{className:"text-center space-y-1",children:[e.jsx(he,{className:"text-xl font-bold",children:g.nom.replace(".png","").replace(".jpg","")}),e.jsxs("p",{className:"text-[10px] font-mono text-primary uppercase tracking-widest opacity-70",children:["ID: ",g.code]})]})]}),e.jsxs(V,{className:"space-y-4 pt-6",children:[e.jsxs("div",{className:"w-48 mx-auto relative group",children:[e.jsxs("div",{className:"absolute -top-2 -right-2 z-10 bg-slate-950 border border-slate-700 px-2 py-0.5 rounded text-[9px] font-mono text-white shadow-xl",children:["#",g.code]}),e.jsx(Tr,{rarity:Et(g.rarity),season:g.season,nom:g.nom,owned:g.owned})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-muted/50 p-2 rounded-lg text-center border border-slate-800",children:[e.jsx("p",{className:"text-muted-foreground mb-0.5",children:"RaretÃ©"}),e.jsx("p",{className:"font-bold",children:Kr[Et(g.rarity)]})]}),e.jsxs("div",{className:"bg-muted/50 p-2 rounded-lg text-center border border-slate-800",children:[e.jsx("p",{className:"text-muted-foreground mb-0.5",children:"Saison"}),e.jsx("p",{className:"font-bold",children:ss(g.season)})]})]}),g.owned&&e.jsxs("div",{className:"pt-4 border-t border-slate-800 space-y-3",children:[e.jsx("p",{className:"text-sm font-semibold text-center",children:"Mettre en vente sur le marchÃ©"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(je,{type:"number",placeholder:"Prix",value:j,onChange:H=>M(H.target.value),className:"pr-8"}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground",children:"â‚¬"})]}),e.jsx(T,{onClick:se,disabled:P,children:P?e.jsx(ue,{className:"animate-spin h-4 w-4"}):"Lister"})]})]})]})]})})})}),e.jsx(nt,{children:h.length>0&&e.jsxs("div",{className:"fixed inset-0 z-[60] flex flex-col items-center justify-center bg-black/95 p-4 overflow-hidden",children:[e.jsxs(W.div,{initial:{y:-50,opacity:0},animate:{y:0,opacity:1},className:"text-center mb-8",children:[e.jsx("h2",{className:"text-primary text-3xl font-black italic tracking-tighter mb-2",children:X?"PACK MIXTE DÃ‰BLOQUÃ‰ !":"NOUVEAU BOOSTER !"}),e.jsx("div",{className:"h-1 w-32 bg-primary mx-auto rounded-full"})]}),e.jsxs(W.div,{initial:{rotateY:90,scale:.5,opacity:0},animate:{rotateY:0,scale:1,opacity:1},transition:{type:"spring",damping:12},className:"w-72 sm:w-80",children:[e.jsx(Tr,{rarity:Et(h[f].rarity),season:h[f].season,nom:h[f].nom}),e.jsxs("div",{className:"mt-6 text-center",children:[e.jsx("p",{className:"text-white font-bold text-2xl mb-1",children:h[f].nom.split(".")[0]}),e.jsx("p",{className:"text-primary/80 font-medium uppercase tracking-widest text-xs",children:ss(h[f].season)})]})]},f),e.jsxs("div",{className:"flex gap-4 mt-12 w-full max-w-xs",children:[e.jsxs(T,{disabled:f===0,onClick:()=>x(H=>H-1),variant:"outline",className:"flex-1 bg-white/5 border-white/10 text-white",children:[e.jsx(Ql,{className:"mr-2"})," PrÃ©cÃ©dent"]}),f===h.length-1?e.jsx(T,{onClick:()=>p([]),className:"flex-1 font-bold",children:"Terminer"}):e.jsxs(T,{onClick:()=>x(H=>H+1),className:"flex-1 font-bold",children:["Suivant ",e.jsx(Jl,{className:"ml-2"})]})]}),e.jsxs("p",{className:"text-white/30 text-xs mt-8",children:["Carte ",f+1," sur ",h.length]})]})})]})};function Dm(s,t=500){const[r,n]=m.useState(s);return m.useEffect(()=>{const a=setTimeout(()=>{n(s)},t);return()=>{clearTimeout(a)}},[s,t]),r}const Fm=({username:s,role:t,eloRating:r,rank:n,equippedAvatar:a,equippedBanner:i,equippedTitle:o})=>{const c={player:{label:"Joueur",color:"bg-blue-500",icon:wt},agent:{label:"Agent",color:"bg-purple-500",icon:Mt},admin:{label:"Admin",color:"bg-yellow-500",icon:Mt}}[t],d=c.icon,u=a?qe.find(g=>g.id===a):null,h=(u==null?void 0:u.icon)||"ðŸ˜Š",p=i?qe.find(g=>g.id===i):null,f=o?qe.find(g=>g.id===o):null,x=Ws(r);return e.jsxs(L,{className:"relative overflow-hidden",children:[p&&e.jsxs("div",{className:"absolute inset-0",children:[e.jsx("div",{className:"w-full h-full",style:{background:p.preview||"linear-gradient(135deg, #1e293b 0%, #334155 100%)"}}),e.jsx("div",{className:"absolute inset-0 bg-black/40"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-9xl opacity-20",children:p.icon})]}),e.jsx("div",{className:"relative p-6",children:e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"h-24 w-24 rounded-full bg-gradient-to-br from-primary to-secondary flex items-center justify-center text-5xl shadow-xl border-4 border-background",children:h}),e.jsx("div",{className:`absolute -bottom-1 -right-1 ${c.color} rounded-full p-2 shadow-lg border-2 border-background`,children:e.jsx(d,{className:"h-4 w-4 text-white"})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex flex-col gap-1 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:s}),e.jsx(le,{variant:"outline",className:`${c.color} text-white border-0`,children:c.label})]}),f&&e.jsxs("div",{className:"inline-flex items-center gap-2 mt-1 px-3 py-1 rounded-full bg-gradient-to-r from-sky-500/30 via-cyan-500/30 to-indigo-500/30 border border-cyan-400/60 shadow-md backdrop-blur",children:[e.jsx("span",{className:"text-lg drop-shadow",children:f.icon}),e.jsx("span",{className:"text-[11px] font-semibold tracking-wide uppercase text-cyan-100 drop-shadow-sm",children:f.preview||f.name})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"h-4 w-4 text-primary"}),e.jsxs("span",{className:"text-sm",children:["ELO: ",e.jsx("span",{className:"font-bold text-foreground",children:r})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Mt,{className:"h-4 w-4 text-yellow-500"}),e.jsxs("span",{className:"text-sm",children:["Rang:"," ",e.jsxs("span",{className:"font-bold",style:{color:x.color},children:[x.icon," ",x.name]})]})]})]})]})]})})]})};function zm({wins:s,losses:t,fortune:r,totalEarned:n}){const a=s+t>0?Math.round(s/(s+t)*100):0,i=[{label:"Victoires",value:s,icon:Pe,color:"text-primary",bgColor:"bg-primary/10"},{label:"DÃ©faites",value:t,icon:Fe,color:"text-secondary",bgColor:"bg-secondary/10"},{label:"Win Rate",value:`${a}%`,icon:ni,color:"text-rarity-gold",bgColor:"bg-rarity-gold/10"},{label:"Fortune",value:`${r}â‚¬`,icon:Gt,color:"text-primary",bgColor:"bg-primary/10"}];return e.jsx("div",{className:"grid grid-cols-2 gap-3",children:i.map((o,l)=>e.jsx(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:l*.1},children:e.jsx(L,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`rounded-lg p-2 ${o.bgColor}`,children:e.jsx(o.icon,{className:`h-5 w-5 ${o.color}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:o.label}),e.jsx("p",{className:`text-xl font-bold ${o.color}`,children:o.value})]})]})})},o.label))})}const Pr={common:"bg-gray-500",rare:"bg-blue-500",epic:"bg-purple-500",legendary:"bg-orange-500"},Ka={common:"Commun",rare:"Rare",epic:"Ã‰pique",legendary:"LÃ©gendaire"},Xs=[{id:"tueur_gamelle",name:"Tueur de Gamelles",description:"Gagner 10 matchs d'affilÃ©e",icon:"ðŸ”¥",rarity:"epic",reward:100},{id:"roi_jeudi",name:"Roi du Jeudi",description:"Gagner 5 matchs un jeudi",icon:"ðŸ‘‘",rarity:"rare",reward:50},{id:"millionnaire",name:"Millionnaire",description:"Atteindre 1000â‚¬ de fortune",icon:"ðŸ’°",rarity:"legendary",reward:200},{id:"collectionneur",name:"Collectionneur",description:"PossÃ©der 50 cartes uniques",icon:"ðŸŽ´",rarity:"epic",reward:150},{id:"parieur_fou",name:"Parieur Fou",description:"Gagner 10 paris",icon:"ðŸŽ²",rarity:"rare",reward:75}];function Bm({userId:s}){const[t,r]=m.useState([]),[n,a]=m.useState(!0),[i,o]=m.useState(!1),[l,c]=m.useState(null);m.useEffect(()=>{s&&d()},[s]);const d=async()=>{try{const f=await jr(s);r(f||[])}catch(f){b.error("Erreur chargement badges:",f),r([])}finally{a(!1)}},u=async()=>{o(!0);try{const f=await ao(s);f&&f.length>0?(await d(),f.forEach(x=>{const g=Xs.find(y=>y.id===x.id);$({title:"ðŸŽ‰ Nouveau badge dÃ©bloquÃ© !",description:`${x.icon} ${x.name} - +${(g==null?void 0:g.reward)||0}â‚¬`})})):$({title:"Aucun nouveau badge",description:"Continue Ã  jouer pour dÃ©bloquer plus de badges !"})}catch(f){b.error("Erreur vÃ©rification achievements:",f),$({title:"Erreur",description:"Impossible de vÃ©rifier les achievements",variant:"destructive"})}finally{o(!1)}},h=t.map(f=>f.id),p=Math.round(t.length/Xs.length*100);return n?e.jsx(L,{children:e.jsx(V,{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):e.jsxs(L,{children:[e.jsxs(xe,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ht,{className:"h-5 w-5 text-primary"}),e.jsx(he,{children:"Badges & SuccÃ¨s"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"ComplÃ©tion"}),e.jsxs("p",{className:"text-lg font-bold text-primary",children:[p,"%"]})]}),e.jsx(T,{variant:"outline",size:"sm",onClick:u,disabled:i,children:i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary mr-2"}),"VÃ©rification..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Pt,{className:"h-4 w-4 mr-2"}),"VÃ©rifier"]})})]})]}),e.jsx(It,{value:p,className:"mt-2"})]}),e.jsxs(V,{children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3",children:Xs.map(f=>{const x=h.includes(f.id),g=t.find(j=>j.id===f.id),y=l===f.id;return e.jsxs(W.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},whileHover:{scale:1.05},className:"relative",onMouseEnter:()=>c(f.id),onMouseLeave:()=>c(null),children:[e.jsxs("div",{className:`relative p-3 rounded-lg border-2 transition-all cursor-help ${x?"border-primary bg-primary/5":"border-border bg-surface-alt opacity-60"}`,children:[e.jsx("div",{className:`absolute top-1 right-1 w-2 h-2 rounded-full ${Pr[f.rarity]}`}),e.jsx("div",{className:`text-4xl text-center mb-2 ${!x&&"grayscale"}`,children:x?f.icon:"ðŸ”’"}),e.jsx("p",{className:"text-xs font-bold text-center mb-1 line-clamp-2",children:f.name}),x?e.jsx("div",{className:"text-center",children:e.jsx(le,{variant:"default",className:"text-[10px] py-0 px-1 bg-green-500",children:"âœ“"})}):e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(Qt,{className:"h-3 w-3 text-muted-foreground"})})]}),y&&e.jsx(W.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 z-50 pointer-events-none",children:e.jsxs("div",{className:"bg-popover border-2 border-primary/50 rounded-lg p-3 shadow-2xl whitespace-nowrap min-w-[200px]",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 pb-2 border-b border-border",children:[e.jsx("span",{className:"text-2xl",children:x?f.icon:"ðŸ”’"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-bold text-foreground",children:f.name}),e.jsx(le,{className:`${Pr[f.rarity]} text-white text-[10px] mt-0.5`,children:Ka[f.rarity]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Zt,{className:"h-3 w-3 text-primary mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:f.description})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-border",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"RÃ©compense"}),e.jsxs("span",{className:"text-sm font-bold text-primary",children:[f.reward,"â‚¬"]})]}),x&&g&&e.jsxs("div",{className:"flex items-center justify-between pt-1",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"DÃ©bloquÃ© le"}),e.jsx("span",{className:"text-xs text-green-400 font-medium",children:new Date(g.unlockedAt).toLocaleDateString("fr-FR",{day:"2-digit",month:"short",year:"numeric"})})]})]}),e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 -mt-[1px]",children:e.jsx("div",{className:"border-8 border-transparent border-t-primary/50"})})]})})]},f.id)})}),t.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ht,{className:"h-12 w-12 mx-auto mb-3 text-muted-foreground opacity-50"}),e.jsx("p",{className:"text-muted-foreground mb-3",children:"Aucun badge dÃ©bloquÃ© pour le moment"}),e.jsx(T,{onClick:u,disabled:i,children:"VÃ©rifier mes accomplissements"})]}),t.length>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-border",children:[e.jsx("h4",{className:"text-sm font-semibold mb-2",children:"Badges rÃ©cents"}),e.jsx("div",{className:"space-y-2",children:t.sort((f,x)=>x.unlockedAt-f.unlockedAt).slice(0,3).map(f=>{const x=Xs.find(g=>g.id===f.id);return x?e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg bg-surface-alt",children:[e.jsx("div",{className:"text-2xl",children:x.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:x.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:x.description}),e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:new Date(f.unlockedAt).toLocaleDateString("fr-FR")})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(le,{className:Pr[x.rarity],children:Ka[x.rarity]}),e.jsxs("p",{className:"text-xs text-primary font-bold mt-1",children:["+",x.reward,"â‚¬"]})]})]},f.id):null})})]})]})]})}async function Nt(s,t,r,n,a,i){try{const o=S(k,`notifications/${s}`),l=mt(o);await oe(l,{type:t,title:r,message:n,relatedId:a||"",read:!1,createdAt:Date.now(),imageUrl:(i==null?void 0:i.imageUrl)||"",actionUrl:(i==null?void 0:i.actionUrl)||"",priority:(i==null?void 0:i.priority)||"normal"}),b.log(`âœ… Notification envoyÃ©e Ã  ${s}: ${r}`)}catch(o){throw b.error("âŒ Erreur crÃ©ation notification:",o),o}}async function jo(s,t,r){await Nt(s,"offer_accepted","Offre acceptÃ©e âœ…",`${t} a acceptÃ© votre offre pour ${r}`,void 0)}async function wo(s,t,r){await Nt(s,"offer_rejected","Offre refusÃ©e",`${t} a refusÃ© votre offre pour ${r}`,void 0)}async function No(s,t,r,n){await Nt(s,"offer_countered","Contre-offre reÃ§ue",`${t} propose ${r}â‚¬ pour ${n}`,void 0)}async function Co(s,t,r,n){await Nt(s,"new_message",`Message de ${t}`,r,n)}async function So(s,t,r){const n=r>0?`+${r} ELO`:`${r} ELO`;await Nt(s,"match_completed","Match terminÃ©",`${t} â€¢ ${n}`,void 0)}async function ko(s,t,r){await Nt(s,"tournament_starting","Tournoi sur le point de commencer",`${t} dÃ©bute ${r}`,void 0)}async function _o(s,t,r){await Nt(s,t?"bet_won":"bet_lost",t?"Pari gagnÃ©! ðŸŽ‰":"Pari perdu",t?`Vous avez gagnÃ© ${r}â‚¬!`:`Vous avez perdu ${r}â‚¬`,void 0)}async function cr(s,t,r){await Nt(s,"admin_announcement",`ðŸ“¢ ${t}`,r,void 0)}const wa=Object.freeze(Object.defineProperty({__proto__:null,default:Nt,notifyAdminAnnouncement:cr,notifyBetResult:_o,notifyMatchCompleted:So,notifyNewMessage:Co,notifyOfferAccepted:jo,notifyOfferCountered:No,notifyOfferRejected:wo,notifyTournamentStarting:ko},Symbol.toStringTag,{value:"Module"})),Um=s=>{switch(s){case"tournament_entry":return"ðŸŽ«";case"tournament_prize":return"ðŸ†";case"match_win":return"âœ…";case"match_loss":return"âŒ";case"bet_win":return"ðŸ’°";case"bet_loss":return"ðŸ“‰";case"daily_bonus":return"ðŸŽ";case"admin_adjustment":return"âš™ï¸";case"card_sale":return"ðŸ’³";case"card_purchase":return"ðŸ›’";case"shop_purchase":return"ðŸ›ï¸";default:return"ðŸ’µ"}},qm=(s,t)=>t==="tournament_entry"?"text-orange-500":t==="tournament_prize"||s>0?"text-green-500":s<0?"text-red-500":"text-muted-foreground";function Vm({userId:s}){var x,g;const[t,r]=m.useState([]),[n,a]=m.useState(7),[i,o]=m.useState(!0);m.useEffect(()=>{l()},[s,n]);const l=async()=>{o(!0);try{const y=await eo(s,n);r(y)}catch(y){b.error("Erreur chargement historique:",y)}finally{o(!1)}},c=((x=t[t.length-1])==null?void 0:x.fortune)||0,d=((g=t[0])==null?void 0:g.fortune)||0,u=c-d,h=d>0?(u/d*100).toFixed(1):0,p=t.map(y=>({date:new Date(y.timestamp).toLocaleDateString("fr-FR",{month:"short",day:"numeric"}),fortune:y.fortune,timestamp:y.timestamp})),f=({active:y,payload:j})=>y&&j&&j.length?e.jsxs("div",{className:"bg-card border border-border p-3 rounded-lg shadow-lg",children:[e.jsxs("p",{className:"font-bold text-primary",children:[j[0].value,"â‚¬"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:j[0].payload.date})]}):null;return i?e.jsx(L,{children:e.jsx(V,{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):t.length===0?e.jsxs(L,{children:[e.jsx(xe,{children:e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"h-5 w-5 text-primary"}),"Historique de Fortune"]})}),e.jsxs(V,{className:"text-center py-8",children:[e.jsx(ws,{className:"h-12 w-12 mx-auto mb-3 text-muted-foreground opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:"Aucune donnÃ©e d'historique disponible"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Commence Ã  jouer pour voir ton Ã©volution !"})]})]}):e.jsxs(L,{children:[e.jsx(xe,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"h-5 w-5 text-primary"}),e.jsx(he,{children:"Historique de Fortune"})]}),e.jsx("div",{className:"flex gap-2",children:[1,7,30].map(y=>e.jsxs("button",{onClick:()=>a(y),className:`px-3 py-1 rounded-lg text-sm font-medium transition-colors ${n===y?"bg-primary text-primary-foreground":"bg-surface-alt text-muted-foreground hover:bg-surface"}`,children:[y,"j"]},y))})]})}),e.jsxs(V,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-surface-alt",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Ã‰volution"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:`text-xl font-bold ${u>=0?"text-green-500":"text-red-500"}`,children:[u>=0?"+":"",u,"â‚¬"]}),u>=0?e.jsx(Oe,{className:"h-4 w-4 text-green-500"}):e.jsx(us,{className:"h-4 w-4 text-red-500"})]}),e.jsxs("p",{className:`text-xs ${u>=0?"text-green-500":"text-red-500"}`,children:[u>=0?"+":"",h,"%"]})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-surface-alt",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Transactions"}),e.jsx("p",{className:"text-xl font-bold",children:t.length}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.filter(y=>y.change>0).length," â†‘ / ",t.filter(y=>y.change<0).length," â†“"]})]})]}),e.jsx("div",{className:"h-48 w-full",children:e.jsx(Yl,{width:"100%",height:"100%",children:e.jsxs(Kl,{data:p,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"fortuneGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"hsl(var(--primary))",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"hsl(var(--primary))",stopOpacity:0})]})}),e.jsx(Xl,{strokeDasharray:"3 3",stroke:"hsl(var(--border))",opacity:.3}),e.jsx(ec,{dataKey:"date",stroke:"hsl(var(--muted-foreground))",style:{fontSize:"10px"},tick:{fill:"hsl(var(--muted-foreground))"}}),e.jsx(tc,{stroke:"hsl(var(--muted-foreground))",style:{fontSize:"10px"},tick:{fill:"hsl(var(--muted-foreground))"}}),e.jsx(sc,{content:e.jsx(f,{})}),e.jsx(rc,{type:"monotone",dataKey:"fortune",stroke:"hsl(var(--primary))",strokeWidth:2,fill:"url(#fortuneGradient)"})]})})}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-border",children:[e.jsx("h4",{className:"text-sm font-semibold mb-2",children:"Transactions rÃ©centes"}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:t.slice(-5).reverse().map((y,j)=>{var M,P,w;return e.jsxs(W.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:j*.05},className:"flex items-center justify-between p-2 rounded-lg bg-surface-alt text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:Um(y.type||"")}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-xs",children:y.reason}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:new Date(y.timestamp).toLocaleDateString("fr-FR",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"})}),((M=y.metadata)==null?void 0:M.position)&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Position: ",y.metadata.position," â€¢ Cagnotte: ",y.metadata.prizePool,"â‚¬"]}),((P=y.metadata)==null?void 0:P.mode)==="duo"&&((w=y.metadata)==null?void 0:w.partnerName)&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Avec ",y.metadata.partnerName]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:`font-bold text-xs ${qm(y.change,y.type||"")}`,children:[y.change>0?"+":"",y.change,"â‚¬"]})})]},j)})})]})]})]})}function Gm({userId:s}){var u,h,p;const t=ht(),[r,n]=m.useState(null),[a,i]=m.useState(!0),[o,l]=m.useState(0);m.useEffect(()=>{c()},[s]);const c=async()=>{var f;i(!0);try{const x=S(k,`users/${s}`),g=await z(x);if(g.exists()){const y=g.val();if(y.clubId){const j=S(k,`clubs/${y.clubId}`),M=await z(j);if(M.exists()){const P=M.val();n({id:y.clubId,...P}),l(((f=P.members)==null?void 0:f.length)||0)}}}}catch(x){b.error("Erreur chargement club:",x)}finally{i(!1)}};if(a)return e.jsx(L,{children:e.jsx(V,{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});if(!r)return e.jsxs(L,{children:[e.jsx(xe,{children:e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-5 w-5 text-primary"}),"Mon Club"]})}),e.jsxs(V,{className:"text-center py-8",children:[e.jsx(Ee,{className:"h-12 w-12 mx-auto mb-3 text-muted-foreground opacity-50"}),e.jsx("p",{className:"text-muted-foreground mb-3",children:"Tu ne fais partie d'aucun club"}),e.jsx(T,{onClick:()=>t("/clubs"),variant:"neon",children:"CrÃ©er ou rejoindre un club"})]})]});const d=r.bonuses?Object.values(r.bonuses).filter(Boolean).length:0;return e.jsxs(L,{className:"relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-1",style:{backgroundColor:r.color}}),e.jsx(xe,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-5 w-5 text-primary"}),e.jsx(he,{children:"Mon Club"})]}),e.jsx(T,{variant:"ghost",size:"sm",onClick:()=>t("/clubs"),children:e.jsx(ac,{className:"h-4 w-4"})})]})}),e.jsx(V,{children:e.jsxs(W.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4 p-3 rounded-lg bg-surface-alt",children:[e.jsx("div",{className:"text-4xl w-14 h-14 flex items-center justify-center rounded-lg",style:{backgroundColor:r.color+"20"},children:r.logo}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-lg",children:r.name}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(Ee,{className:"h-3 w-3"}),o," membre",o>1?"s":""]}),r.founderId===s&&e.jsxs(le,{variant:"outline",className:"text-xs",children:[e.jsx(Mt,{className:"h-3 w-3 mr-1"}),"Fondateur"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-surface-alt",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"TrÃ©sorerie"}),e.jsxs("p",{className:"text-xl font-bold text-primary",children:[r.treasury||0,"â‚¬"]})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-surface-alt",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total gagnÃ©"}),e.jsxs("p",{className:"text-xl font-bold text-green-500",children:[r.totalEarnings||0,"â‚¬"]})]})]}),d>0?e.jsxs("div",{className:"p-3 rounded-lg bg-primary/5 border border-primary/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Oe,{className:"h-4 w-4 text-primary"}),e.jsx("p",{className:"text-sm font-semibold",children:"Bonus actifs"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[((u=r.bonuses)==null?void 0:u.xpBoost)&&e.jsx(le,{variant:"default",className:"text-xs",children:"+20% ELO"}),((h=r.bonuses)==null?void 0:h.fortuneBoost)&&e.jsx(le,{variant:"default",className:"text-xs",children:"+15% Fortune"}),((p=r.bonuses)==null?void 0:p.premiumCards)&&e.jsx(le,{variant:"default",className:"text-xs",children:"x2 Cartes rares"})]})]}):e.jsx("div",{className:"p-3 rounded-lg bg-surface-alt",children:e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Aucun bonus actif â€¢ Contribuez pour dÃ©bloquer des avantages"})}),e.jsx(T,{onClick:()=>t("/clubs"),variant:"outline",className:"w-full",children:"Voir le club"})]})})]})}const Ue=Ml,dr=Tl,Hm=$l,Eo=m.forwardRef(({className:s,...t},r)=>e.jsx(On,{ref:r,className:me("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...t}));Eo.displayName=On.displayName;const Le=m.forwardRef(({className:s,children:t,...r},n)=>e.jsxs(Hm,{children:[e.jsx(Eo,{}),e.jsxs(Ln,{ref:n,className:me("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...r,children:[t,e.jsxs(Al,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[e.jsx(Fe,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Le.displayName=Ln.displayName;const Ie=({className:s,...t})=>e.jsx("div",{className:me("flex flex-col space-y-1.5 text-center sm:text-left",s),...t});Ie.displayName="DialogHeader";const De=m.forwardRef(({className:s,...t},r)=>e.jsx(In,{ref:r,className:me("text-lg font-semibold leading-none tracking-tight",s),...t}));De.displayName=In.displayName;const Ye=m.forwardRef(({className:s,...t},r)=>e.jsx(Dn,{ref:r,className:me("text-sm text-muted-foreground",s),...t}));Ye.displayName=Dn.displayName;const Zm={common:"bg-gray-500",rare:"bg-blue-500",epic:"bg-purple-500",legendary:"bg-orange-500"};function Wm({friendId:s,friendUsername:t,isOpen:r,onClose:n,onRemoveFriend:a,canRemove:i=!0}){const[o,l]=m.useState(null),[c,d]=m.useState([]),[u,h]=m.useState({totalCards:0,uniqueCards:0,rareCards:0}),[p,f]=m.useState(null),[x,g]=m.useState(!0);m.useEffect(()=>{!r||!s||y()},[r,s]);const y=async()=>{var I;g(!0);try{const O=S(k,`users/${s}`),N=await z(O);if(N.exists()){const R=N.val(),F=Yt(R);l({username:F.username||t,role:F.role||"player",eloRating:F.eloRating||1e3,wins:F.wins||0,losses:F.losses||0,fortune:F.fortune||0,totalEarned:F.totalEarned||0,createdAt:F.createdAt||new Date().toISOString(),clubId:F.clubId});const A=await jr(s);d(A||[]);const B=await Zi(s);if(h(B),F.clubId){const _=S(k,`clubs/${F.clubId}`),J=await z(_);if(J.exists()){const U=J.val();f({name:U.name,logo:U.logo,color:U.color,memberCount:((I=U.members)==null?void 0:I.length)||0})}}else f(null)}}catch(O){b.error("Erreur chargement profil ami:",O),$({title:"Erreur",description:"Impossible de charger le profil",variant:"destructive"})}finally{g(!1)}},j=()=>{a&&o&&(a(s,o.username),n())};if(!r)return null;const M={player:{label:"Joueur",icon:Pe,color:"text-primary"},agent:{label:"Agent",icon:ms,color:"text-yellow-500"},admin:{label:"Admin",icon:Mt,color:"text-gold"}},P=o&&o.wins+o.losses>0?Math.round(o.wins/(o.wins+o.losses)*100):0,w=Math.round(c.length/5*100);return e.jsx(Ue,{open:r,onOpenChange:n,children:e.jsxs(Le,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ie,{children:e.jsxs(De,{className:"flex items-center justify-between",children:[e.jsxs("span",{children:["Profil de ",t]}),i&&a&&e.jsxs(T,{variant:"ghost",size:"sm",onClick:j,className:"text-destructive hover:text-destructive",children:[e.jsx(nc,{className:"h-4 w-4 mr-2"}),"Retirer"]})]})}),x?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ue,{className:"h-8 w-8 animate-spin text-primary"})}):o?e.jsxs("div",{className:"space-y-6",children:[e.jsx(L,{children:e.jsx(V,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx(W.div,{whileHover:{scale:1.05},className:"relative",children:e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-primary to-secondary flex items-center justify-center text-3xl font-bold shadow-lg",children:o.username.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h2",{className:"text-2xl font-bold",children:o.username}),e.jsxs(le,{variant:"outline",className:"gap-1",children:[(()=>{const I=M[o.role].icon;return I?e.jsx(I,{className:`h-3 w-3 ${M[o.role].color}`}):null})(),M[o.role].label]})]}),e.jsx("div",{className:"flex items-center gap-4 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(jt,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-muted-foreground",children:"ELO:"}),e.jsx("span",{className:"font-bold text-primary",children:o.eloRating})]})})]})]})})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(L,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"rounded-lg p-2 bg-primary/10",children:e.jsx(Pe,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Victoires"}),e.jsx("p",{className:"text-xl font-bold text-primary",children:o.wins})]})]})}),e.jsx(L,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"rounded-lg p-2 bg-secondary/10",children:e.jsx(Fe,{className:"h-5 w-5 text-secondary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"DÃ©faites"}),e.jsx("p",{className:"text-xl font-bold text-secondary",children:o.losses})]})]})}),e.jsx(L,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"rounded-lg p-2 bg-gold/10",children:e.jsx(ni,{className:"h-5 w-5 text-gold"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Win Rate"}),e.jsxs("p",{className:"text-xl font-bold text-gold",children:[P,"%"]})]})]})}),e.jsx(L,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"rounded-lg p-2 bg-primary/10",children:e.jsx(Gt,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Fortune"}),e.jsxs("p",{className:"text-xl font-bold text-primary",children:[o.fortune,"â‚¬"]})]})]})})]}),e.jsx(L,{children:e.jsxs(V,{className:"p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold mb-3 flex items-center gap-2",children:[e.jsx(ms,{className:"h-4 w-4 text-primary"}),"Collection de Cartes"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"text-center p-3 rounded-lg bg-surface-alt",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:u.totalCards}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total"})]}),e.jsxs("div",{className:"text-center p-3 rounded-lg bg-surface-alt",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:u.uniqueCards}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Uniques"})]}),e.jsxs("div",{className:"text-center p-3 rounded-lg bg-surface-alt",children:[e.jsx("p",{className:"text-2xl font-bold text-gold",children:u.rareCards}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Rares"})]})]})]})}),p&&e.jsx(L,{children:e.jsxs(V,{className:"p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold mb-3 flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4 text-primary"}),"Club"]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-surface-alt",children:[e.jsx("div",{className:"text-3xl w-12 h-12 flex items-center justify-center rounded-lg",style:{backgroundColor:p.color+"20"},children:p.logo}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-bold",children:p.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[p.memberCount," membre",p.memberCount>1?"s":""]})]})]})]})}),e.jsx(L,{children:e.jsxs(V,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(Ht,{className:"h-4 w-4 text-primary"}),"Badges & SuccÃ¨s"]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[w,"% complet"]})]}),e.jsx(It,{value:w,className:"mb-4"}),c.length>0?e.jsx("div",{className:"grid grid-cols-5 gap-2",children:c.map(I=>e.jsxs(W.div,{whileHover:{scale:1.05},className:"relative p-2 rounded-lg border-2 border-primary bg-primary/5",children:[e.jsx("div",{className:`absolute top-0.5 right-0.5 w-1.5 h-1.5 rounded-full ${Zm[I.rarity]}`}),e.jsx("div",{className:"text-2xl text-center mb-1",children:I.icon}),e.jsx("p",{className:"text-[10px] font-bold text-center line-clamp-1",children:I.name})]},I.id))}):e.jsx("p",{className:"text-center text-muted-foreground text-sm py-4",children:"Aucun badge dÃ©bloquÃ©"})]})}),e.jsx(L,{children:e.jsxs(V,{className:"p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold mb-3 flex items-center gap-2",children:[e.jsx(wt,{className:"h-4 w-4 text-primary"}),"Informations"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Membre depuis"}),e.jsx("span",{className:"font-medium",children:new Date(o.createdAt).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric"})})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total gagnÃ©"}),e.jsxs("span",{className:"font-medium text-green-500",children:[o.totalEarned,"â‚¬"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Matchs jouÃ©s"}),e.jsx("span",{className:"font-medium",children:o.wins+o.losses})]})]})]})})]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"Profil introuvable"})})]})})}const bt=m.forwardRef(({className:s,...t},r)=>e.jsx(Fn,{className:me("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",s),...t,ref:r,children:e.jsx(Pl,{className:me("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));bt.displayName=Fn.displayName;const Qm=br("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),vt=m.forwardRef(({className:s,...t},r)=>e.jsx(zn,{ref:r,className:me(Qm(),s),...t}));vt.displayName=zn.displayName;async function Jm(s,t,r){try{const n=S(k,`users/${r}`);if(!(await z(n)).exists())throw new Error("Utilisateur introuvable");const i=S(k,`friendRequests/${s}_${r}`);if((await z(i)).exists())throw new Error("Demande d'ami dÃ©jÃ  envoyÃ©e");const l=S(k,`friends/${s}/${r}`);if((await z(l)).exists())throw new Error("Vous Ãªtes dÃ©jÃ  amis");const d=`${s}_${r}`,u={id:d,from:s,fromUsername:t,to:r,status:"pending",timestamp:Date.now()};await Re(S(k,`friendRequests/${d}`),u)}catch(n){throw b.error("Erreur lors de l'envoi de la demande:",n),n}}async function Ym(s){try{const t=S(k,`friendRequests/${s}`),r=await z(t);if(!r.exists())throw new Error("Demande introuvable");const n=r.val(),a=S(k,`users/${n.from}`),i=S(k,`users/${n.to}`),[o,l]=await Promise.all([z(a),z(i)]);if(!o.exists()||!l.exists())throw new Error("Utilisateur introuvable");const c=o.val(),d=l.val(),u=Yt(c),h=Yt(d),p={};p[`friends/${n.from}/${n.to}`]={id:n.to,username:h.username,eloRating:h.eloRating||1e3,avatar:h.avatar||null,addedAt:Date.now()},p[`friends/${n.to}/${n.from}`]={id:n.from,username:u.username,eloRating:u.eloRating||1e3,avatar:u.avatar||null,addedAt:Date.now()},p[`friendRequests/${s}/status`]="accepted",await oe(S(k),p)}catch(t){throw b.error("Erreur lors de l'acceptation:",t),t}}async function Km(s){try{await oe(S(k,`friendRequests/${s}`),{status:"declined"})}catch(t){throw b.error("Erreur lors du refus:",t),t}}async function Xm(s,t){try{const r={};r[`friends/${s}/${t}`]=null,r[`friends/${t}/${s}`]=null,await oe(S(k),r)}catch(r){throw b.error("Erreur lors de la suppression:",r),r}}async function Ro(s){try{const t=S(k,`friends/${s}`),r=await z(t);if(!r.exists())return[];const n=r.val(),a=[];for(const[i,o]of Object.entries(n)){const l=o,c=S(k,`userStatus/${i}`),d=await z(c),u=d.exists()?d.val().status:"offline",h=d.exists()?d.val().lastSeen:null;a.push({id:i,username:l.username||"Unknown",eloRating:l.eloRating||1e3,avatar:l.avatar,status:u,lastSeen:h})}return a}catch(t){return b.error("Erreur lors de la rÃ©cupÃ©ration des amis:",t),[]}}async function Or(s){try{const t=S(k,"friendRequests"),r=await z(t);if(!r.exists())return[];const n=r.val(),a=[];for(const[i,o]of Object.entries(n)){const l=o;l.to===s&&l.status==="pending"&&a.push({...l,id:i})}return a.sort((i,o)=>o.timestamp-i.timestamp)}catch(t){return b.error("Erreur lors de la rÃ©cupÃ©ration des demandes:",t),[]}}function ex(s,t){const r=S(k,`friends/${s}`);return et(r,async a=>{if(!a.exists()){t([]);return}const i=a.val(),o=[];for(const[l,c]of Object.entries(i)){const d=c,u=S(k,`userStatus/${l}`),h=await z(u),p=h.exists()?h.val().status:"offline",f=h.exists()?h.val().lastSeen:null;o.push({id:l,username:d.username||"Unknown",eloRating:d.eloRating||1e3,avatar:d.avatar,status:p,lastSeen:f})}t(o)})}const Lr={notifications:{enabled:!0,matchReminders:!0,friendRequests:!0,achievements:!0},sound:{enabled:!0,volume:50},privacy:{profilePublic:!0,showStats:!0,allowFriendRequests:!0,showOnlineStatus:!0},appearance:{darkMode:!0,language:"fr"}};async function $o(s){try{const t=S(k,`userSettings/${s}`),r=await z(t);return r.exists()?r.val():(await Re(t,Lr),Lr)}catch(t){return b.error("Erreur lors de la rÃ©cupÃ©ration des paramÃ¨tres:",t),Lr}}async function tx(s,t){try{const r=S(k,`userSettings/${s}`),n=await $o(s),a={...n,...t,notifications:{...n.notifications,...t.notifications},sound:{...n.sound,...t.sound},privacy:{...n.privacy,...t.privacy},appearance:{...n.appearance,...t.appearance}};await Re(r,a)}catch(r){throw b.error("Erreur lors de la mise Ã  jour des paramÃ¨tres:",r),r}}async function sx(s,t){try{const r=S(k,"users"),n=await z(r);if(!n.exists())return[];const a=n.val(),i=[];for(const[o,l]of Object.entries(a)){const c=l;if(o===t)continue;const d=c.username||"";d.toLowerCase().includes(s.toLowerCase())&&i.push({id:o,username:d,eloRating:c.eloRating||1e3,avatar:c.avatar,status:"offline"})}return i}catch(r){return b.error("Erreur lors de la recherche:",r),[]}}function Xr(s=new Date){const t=s.getFullYear(),r=s.getMonth(),n=new Date(t,r+1,1),a=new Date(n.getTime()-1);let i=new Date(a);for(;i.getDay()!==6;)i.setDate(i.getDate()-1);let o=new Date(i);return o.setDate(o.getDate()+1),{start:i,end:o}}function Ao(){const s=new Date,t=Xr(s);return s>=t.start&&s<=t.end}function Ds(){const s=new Date,t=Xr(s);if(s>=t.start&&s<=t.end)return 0;if(s>t.end){const r=new Date(s.getFullYear(),s.getMonth()+1,15),n=Xr(r);return Math.ceil((n.start.getTime()-s.getTime())/(1e3*60*60*24))}return Math.ceil((t.start.getTime()-s.getTime())/(1e3*60*60*24))}function Mo(s){const t=Zr(s);return Math.round(s*t)}async function rx(s){try{const t=S(k,`users/${s}`),r=await z(t);if(!r.exists())return{bettingGains:0,taxesDue:0,taxesPaid:!1,lastTaxPaymentDate:Date.now(),latePenalty:!1,daysUntilNextTax:Ds()};const n=r.val(),a=n.bettingGains||0,i=n.taxesPaidThisMonth||!1,o=n.lastTaxPaymentDate||0,l=Mo(a);return{bettingGains:a,taxesDue:l,taxesPaid:i,lastTaxPaymentDate:o,latePenalty:!1,daysUntilNextTax:Ds()}}catch(t){return b.error("Erreur rÃ©cupÃ©ration infos fiscales:",t),{bettingGains:0,taxesDue:0,taxesPaid:!1,lastTaxPaymentDate:Date.now(),latePenalty:!1,daysUntilNextTax:Ds()}}}async function ax(s){try{if(!Ao())return{success:!1,message:`Les taxes ne peuvent Ãªtre payÃ©es que le dernier week-end du mois. ${Ds()} jour(s) restant(s).`};const t=S(k,`users/${s}`),r=await z(t);if(!r.exists())return{success:!1,message:"Utilisateur non trouvÃ©"};const n=r.val();if(n.taxesPaidThisMonth)return{success:!1,message:"Vous avez dÃ©jÃ  payÃ© vos taxes ce mois-ci."};const a=n.bettingGains||0,i=n.fortune||0,o=Mo(a);if(i<o)return{success:!1,message:`Fonds insuffisants. Vous avez besoin de ${o}â‚¬ (vous en avez ${i}â‚¬)`};const l=i-o,c={};return c[`users/${s}/fortune`]=l,c[`users/${s}/taxesPaidThisMonth`]=!0,c[`users/${s}/lastTaxPaymentDate`]=Date.now(),c[`users/${s}/totalTaxesPaid`]=(n.totalTaxesPaid||0)+o,await oe(S(k),c),await Ve(s,l,-o,`Paiement de taxes (${taxRate}% sur ${a}â‚¬ de gains)`),{success:!0,message:`${o}â‚¬ de taxes payÃ©es avec succÃ¨s`}}catch(t){return b.error("Erreur paiement taxes:",t),{success:!1,message:t.message||"Erreur lors du paiement des taxes"}}}function nx(s){const t=document.documentElement,n=(a=>{a=a.replace("#","");const i=parseInt(a.substring(0,2),16)/255,o=parseInt(a.substring(2,4),16)/255,l=parseInt(a.substring(4,6),16)/255,c=Math.max(i,o,l),d=Math.min(i,o,l);let u=0,h=0,p=(c+d)/2;if(c!==d){const f=c-d;switch(h=p>.5?f/(2-c-d):f/(c+d),c){case i:u=((o-l)/f+(o<l?6:0))/6;break;case o:u=((l-i)/f+2)/6;break;case l:u=((i-o)/f+4)/6;break}}return{h:Math.round(u*360),s:Math.round(h*100),l:Math.round(p*100)}})(s);t.style.setProperty("--primary",`${n.h} ${n.s}% ${n.l}%`),t.style.setProperty("--primary-foreground",`0 0% ${n.l>50?10:98}%`),t.style.setProperty("--primary-hover",`${n.h} ${n.s}% ${Math.max(n.l-10,0)}%`),t.style.setProperty("--primary-active",`${n.h} ${n.s}% ${Math.max(n.l-20,0)}%`),t.style.setProperty("--secondary",`${(n.h+180)%360} ${n.s}% ${n.l}%`),t.style.setProperty("--accent",`${(n.h+30)%360} ${n.s}% ${n.l}%`)}const ix=({userId:s,fortune:t,bettingGains:r})=>{const[n,a]=m.useState(!1),[i,o]=m.useState(null),l=async()=>{a(!0);try{const j=await rx(s);o(j)}catch(j){b.error("Erreur chargement taxes:",j)}finally{a(!1)}};!i&&!n&&l();const c=Zr(r),d=Math.round(r*c),u=Ds(),h=Ao(),p=i==null?void 0:i.taxesPaid,f=!p&&h&&t>=d,g=(j=>j>=2e3?{next:null,toNext:0,color:"text-red-500",bgColor:"bg-red-500/10",borderColor:"border-red-500/30"}:j>=1e3?{next:2e3,toNext:2e3-j,color:"text-orange-500",bgColor:"bg-orange-500/10",borderColor:"border-orange-500/30"}:j>=100?{next:1e3,toNext:1e3-j,color:"text-yellow-500",bgColor:"bg-yellow-500/10",borderColor:"border-yellow-500/30"}:{next:100,toNext:100-j,color:"text-green-500",bgColor:"bg-green-500/10",borderColor:"border-green-500/30"})(r),y=async()=>{if(f){a(!0);try{const j=await ax(s);j.success?($({title:"Paiement rÃ©ussi! ðŸ’¸",description:j.message}),l()):$({title:"Erreur",description:j.message,variant:"destructive"})}catch(j){$({title:"Erreur",description:j.message,variant:"destructive"})}finally{a(!1)}}};return i?e.jsxs(L,{className:`border-2 ${g.borderColor} bg-gradient-to-br from-secondary/5 to-transparent`,children:[e.jsx(xe,{children:e.jsxs(he,{className:"flex items-center gap-2 text-secondary",children:[e.jsx(ds,{className:"h-5 w-5"}),"SystÃ¨me Fiscal - Dernier Week-end du Mois"]})}),e.jsxs(V,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-surface-alt border border-border",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Statut"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Ce mois-ci"})]}),p?e.jsx(le,{className:"bg-green-500/20 text-green-400 border border-green-500/50",children:"âœ“ PAYÃ‰"}):h?e.jsx(le,{className:"bg-yellow-500/20 text-yellow-400 border border-yellow-500/50 animate-pulse",children:"â° EN COURS"}):e.jsx(le,{className:"bg-muted text-muted-foreground",children:"â³ NON DISPONIBLE"})]}),p&&e.jsx("div",{className:"p-3 rounded-lg bg-green-500/10 border border-green-500/30",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Zt,{className:"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-green-400 mb-1",children:"âœ“ Taxes PayÃ©es"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Vous avez dÃ©jÃ  payÃ© vos taxes ce mois-ci. Prochain paiement possible le mois prochain."})]})]})}),e.jsxs("div",{className:`p-4 rounded-lg ${g.bgColor} border ${g.borderColor}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Taxes Ã  payer"}),e.jsxs("span",{className:`text-3xl font-bold ${g.color}`,children:[p?"0":d,"â‚¬"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:"Taux actuel"}),e.jsxs("span",{className:`font-bold ${g.color}`,children:[Math.round(c*100),"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs mt-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"BasÃ© sur vos gains de paris"}),e.jsxs("span",{className:"font-medium",children:[r,"â‚¬"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs mt-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"Fortune actuelle"}),e.jsxs("span",{className:"font-medium",children:[t,"â‚¬"]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Prochaine pÃ©riode de paiement"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:h?"ðŸ”´ EN COURS":`${u} jour(s)`})]}),h?e.jsxs("div",{className:"p-3 rounded-lg bg-yellow-500/10 border border-yellow-500/30",children:[e.jsx("p",{className:"text-xs font-semibold text-yellow-400",children:"â° Le dernier week-end du mois est ACTIF !"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Vous pouvez payer vos taxes maintenant jusqu'Ã  dimanche minuit."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"relative h-3 bg-gray-700 rounded-full overflow-hidden mb-2",children:e.jsx("div",{className:"absolute inset-y-0 left-0 bg-gradient-to-r from-blue-500 via-cyan-500 to-blue-500 transition-all duration-500 rounded-full",style:{width:`${Math.max(5,(30-u)/30*100)}%`}})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Les taxes peuvent Ãªtre payÃ©es le dernier week-end du mois (samedi-dimanche)."})]})]}),g.next&&e.jsxs("div",{className:"p-3 rounded-lg bg-surface-alt border border-border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Oe,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-medium",children:"Progression vers prochaine tranche"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Encore ",e.jsxs("span",{className:"font-bold text-primary",children:[g.toNext,"â‚¬"]})," de gains pour atteindre la tranche Ã  ",Math.round(Zr(g.next)*100),"%"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(Zt,{className:"h-4 w-4"}),"BarÃ¨me d'imposition"]}),e.jsx("div",{className:"space-y-1.5",children:[{range:"0â‚¬ - 99â‚¬",rate:10,current:r<100},{range:"100â‚¬ - 999â‚¬",rate:15,current:r>=100&&r<1e3},{range:"1000â‚¬ - 1999â‚¬",rate:19,current:r>=1e3&&r<2e3},{range:"2000â‚¬+",rate:23,current:r>=2e3}].map(j=>e.jsxs("div",{className:`flex justify-between p-2.5 rounded-lg text-sm transition-all ${j.current?"bg-secondary/20 border-2 border-secondary/40 font-bold":"bg-surface-alt border border-transparent"}`,children:[e.jsx("span",{className:j.current?"text-foreground":"text-muted-foreground",children:j.range}),e.jsxs("span",{className:j.current?"text-secondary":"text-muted-foreground",children:[j.rate,"%"]})]},j.range))})]}),!h&&e.jsx("div",{className:"p-3 rounded-lg bg-blue-500/10 border border-blue-500/30",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Zt,{className:"h-4 w-4 text-blue-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs font-semibold text-blue-400 mb-1",children:"â„¹ï¸ Paiement indisponible"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Les taxes ne peuvent Ãªtre payÃ©es que le dernier week-end du mois. Revenez dans ",u," jour(s)."]})]})]})}),f?e.jsx(T,{className:"w-full bg-green-600 hover:bg-green-700",onClick:y,disabled:n,children:n?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"h-4 w-4 animate-spin mr-2"}),"Paiement en cours..."]}):e.jsxs(e.Fragment,{children:["ðŸ’¸ Payer ",d,"â‚¬ de taxes"]})}):p?e.jsx(T,{variant:"outline",className:"w-full opacity-50 cursor-not-allowed",disabled:!0,children:"âœ“ DÃ©jÃ  payÃ© ce mois-ci"}):h?t<d?e.jsxs(T,{variant:"outline",className:"w-full opacity-50 cursor-not-allowed",disabled:!0,children:["Fonds insuffisants (",t,"â‚¬ / ",d,"â‚¬)"]}):null:e.jsxs(T,{variant:"outline",className:"w-full opacity-50 cursor-not-allowed",disabled:!0,children:["â³ Disponible le dernier week-end (",u,"j)"]})]})]}):e.jsx(L,{children:e.jsx(V,{className:"flex items-center justify-center p-8",children:e.jsx(ue,{className:"h-6 w-6 animate-spin text-primary"})})})},ox=({equipped:s,inventory:t})=>{const r=d=>{if(!d||!qe||!Array.isArray(qe))return null;const u=qe.find(h=>h&&h.id===d)||null;return b.log("âœ… [EquippedItems] Item trouvÃ©:",(u==null?void 0:u.name)||"null"),u},n=s!=null&&s.avatar&&s.avatar!==""?r(s.avatar):null,a=s!=null&&s.theme&&s.theme!==""?r(s.theme):null,i=s!=null&&s.banner&&s.banner!==""?r(s.banner):null,o=s!=null&&s.title&&s.title!==""?r(s.title):null,l=s!=null&&s.effect&&s.effect!==""?r(s.effect):null;b.log("ðŸŽ­ [EquippedItems] Items Ã©quipÃ©s:",{avatar:(n==null?void 0:n.name)||"none",theme:(a==null?void 0:a.name)||"none",banner:(i==null?void 0:i.name)||"none",title:(o==null?void 0:o.name)||"none",effect:(l==null?void 0:l.name)||"none"});const c=Object.keys(t||{}).reduce((d,u)=>t&&typeof t[u]=="object"?d+Object.keys(t[u]).length:d,0);return e.jsxs(L,{className:"border-2 border-primary/20 bg-gradient-to-br from-primary/5 to-transparent",children:[e.jsx(xe,{children:e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx(Pt,{className:"h-5 w-5 text-primary"}),"Items Ã‰quipÃ©s"]})}),e.jsxs(V,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-surface-alt border border-border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-3xl",children:(n==null?void 0:n.icon)||"ðŸ˜Š"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:(n==null?void 0:n.name)||"Avatar par dÃ©faut"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Avatar"})]})]}),n&&e.jsx(le,{variant:"outline",className:"bg-primary/10 text-primary border-primary/30",children:"Ã‰quipÃ©"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-surface-alt border border-border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[a!=null&&a.preview?e.jsx("div",{className:"w-8 h-8 rounded-lg border-2 border-white/20",style:{backgroundColor:a.preview}}):e.jsx("div",{className:"text-3xl",children:"ðŸŽ¨"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:(a==null?void 0:a.name)||"ThÃ¨me par dÃ©faut"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ThÃ¨me"})]})]}),a&&e.jsx(le,{variant:"outline",className:"bg-primary/10 text-primary border-primary/30",children:"Ã‰quipÃ©"})]}),i&&e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-surface-alt border border-border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[i.preview?e.jsx("div",{className:"w-24 h-12 rounded-lg border-2 border-white/20 relative overflow-hidden",style:{background:i.preview},children:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:i.icon||"ðŸŽª"})})}):e.jsx("div",{className:"text-3xl",children:i.icon||"ðŸŽª"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:i.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"BanniÃ¨re"})]})]}),e.jsx(le,{variant:"outline",className:"bg-primary/10 text-primary border-primary/30",children:"Ã‰quipÃ©"})]}),o&&e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-surface-alt border border-border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-gradient-to-r from-sky-500/30 via-cyan-500/30 to-indigo-500/30 border border-cyan-400/60",children:[e.jsx("span",{className:"text-xl",children:o.icon||"ðŸ‘‘"}),e.jsx("span",{className:"text-[11px] font-semibold tracking-wide uppercase text-cyan-100",children:o.preview||o.name})]}),e.jsx("div",{children:e.jsx("p",{className:"text-xs text-muted-foreground",children:"Titre"})})]}),e.jsx(le,{variant:"outline",className:"bg-primary/10 text-primary border-primary/30",children:"Ã‰quipÃ©"})]}),l&&e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-surface-alt border border-border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-3xl",children:l.icon||"âœ¨"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:l.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Effet"})]})]}),e.jsx(le,{variant:"outline",className:"bg-primary/10 text-primary border-primary/30",children:"Ã‰quipÃ©"})]}),e.jsx("div",{className:"pt-3 border-t border-border",children:e.jsxs("p",{className:"text-xs text-muted-foreground text-center",children:["Collection : ",c," items possÃ©dÃ©s"]})})]})]})},lx=({userId:s})=>{const[t,r]=m.useState([]),[n,a]=m.useState(!0);m.useEffect(()=>{(async()=>{a(!0);try{const c=S(k,"matches"),d=await z(c);if(!d.exists()){r([]);return}const u=[];d.forEach(h=>{const p=h.val();if(!p)return;const f=Array.isArray(p.team1)?p.team1:[],x=Array.isArray(p.team2)?p.team2:[];!f.includes(s)&&!x.includes(s)||u.push({id:h.key||"",team1:f,team2:x,team1Names:p.team1Names,team2Names:p.team2Names,score1:p.score1,score2:p.score2,timestamp:p.timestamp||Date.now()})}),u.sort((h,p)=>p.timestamp-h.timestamp),r(u.slice(0,6))}catch(c){b.error("Erreur chargement matchs rÃ©cents:",c)}finally{a(!1)}})()},[s]);const o=(()=>{let l=0;for(const c of t){const d=c.team1.includes(s),u=c.team2.includes(s);if(!d&&!u)continue;const h=c.score1>c.score2;if(d&&h||u&&!h)l++;else break}return l})();return e.jsxs(L,{children:[e.jsx(xe,{children:e.jsxs(he,{className:"text-sm sm:text-base flex items-center gap-2",children:[e.jsx(Oe,{className:"h-4 w-4 text-primary"}),"Historique des derniers matchs"]})}),e.jsx(V,{className:"space-y-3",children:n?e.jsxs("div",{className:"flex items-center justify-center py-4 text-xs text-muted-foreground",children:[e.jsx(ue,{className:"h-4 w-4 mr-2 animate-spin"}),"Chargement des matchs..."]}):t.length===0?e.jsx("p",{className:"text-xs text-muted-foreground",children:"Aucun match enregistrÃ© pour l'instant."}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["SÃ©rie actuelle :"," ",e.jsxs("span",{className:"font-semibold text-foreground",children:[o," victoire",o>1?"s":""," d'affilÃ©e"]})]}),e.jsx("div",{className:"space-y-2",children:t.map(l=>{const c=l.team1.includes(s),d=l.score1>l.score2,u=c&&d||!c&&!d,h=c?l.team2Names||l.team2:l.team1Names||l.team1,f=new Date(l.timestamp).toLocaleDateString(void 0,{day:"2-digit",month:"2-digit"});return e.jsxs("div",{className:"flex items-center justify-between rounded-md border border-border bg-surface-alt px-2 py-1.5",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:`text-xs font-semibold ${u?"text-green-400":"text-red-400"}`,children:[u?"Victoire":"DÃ©faite"," ",l.score1,"-",l.score2]}),e.jsxs("span",{className:"text-[11px] text-muted-foreground",children:["vs ",Array.isArray(h)?h.join(", "):h]})]}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:f})]},l.id)})})]})})]})},cx=({cards:s})=>{const r=Object.entries(s||{}).sort((n,a)=>a[1]-n[1]).slice(0,3);return e.jsxs(L,{children:[e.jsx(xe,{children:e.jsxs(he,{className:"text-sm sm:text-base flex items-center gap-2",children:[e.jsx(Ns,{className:"h-4 w-4 text-secondary"}),"Cartes BabyDex mises en avant"]})}),e.jsx(V,{className:"space-y-3",children:r.length===0?e.jsx("p",{className:"text-xs text-muted-foreground",children:"Ouvre quelques boosters dans le BabyDex pour commencer ta collection."}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"SÃ©lection automatique de tes cartes les plus prÃ©sentes (par code)."}),e.jsx("div",{className:"space-y-2",children:r.map(([n,a])=>e.jsxs("div",{className:"flex items-center justify-between rounded-md border border-border bg-surface-alt px-2 py-1.5",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs font-medium text-foreground",children:n.replace(/\.(png|jpg|jpeg|gif)$/i,"")}),e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Carte BabyDex"})]}),e.jsxs(le,{variant:"outline",className:"text-[10px] px-2 py-0.5",children:["x",a]})]},n))})]})})]})},dx=({userId:s})=>{const{userProfile:t}=Ae(),[r,n]=m.useState([]),[a,i]=m.useState([]),[o,l]=m.useState(!0),[c,d]=m.useState(null),[u,h]=m.useState(null),[p,f]=m.useState(!1),[x,g]=m.useState("");m.useEffect(()=>{y()},[s]);const y=async()=>{l(!0);try{const[O,N]=await Promise.all([bo(s),vo(s)]);n(O),i(N)}catch(O){b.error("Erreur chargement offres:",O)}finally{l(!1)}},j=async O=>{d(O);try{const N=r.find(R=>R.id===O);await fo(s,O),N&&await jo(N.buyerId,(t==null?void 0:t.username)||"Un vendeur",N.listingId).catch(R=>{b.error("Erreur notification:",R)}),$({title:"Offre acceptÃ©e âœ…",description:"La transaction a Ã©tÃ© effectuÃ©e et l'acheteur a Ã©tÃ© notifiÃ©."}),await y()}catch(N){$({title:"Erreur",description:N.message,variant:"destructive"})}finally{d(null)}},M=async O=>{d(O);try{const N=r.find(R=>R.id===O);await po(s,O),N&&await wo(N.buyerId,(t==null?void 0:t.username)||"Un vendeur",N.listingId).catch(R=>{b.error("Erreur notification:",R)}),$({title:"Offre rejetÃ©e",description:"L'acheteur a Ã©tÃ© notifiÃ©."}),await y()}catch(N){$({title:"Erreur",description:N.message,variant:"destructive"})}finally{d(null)}},P=async()=>{if(!u||!x)return;const O=parseFloat(x);if(isNaN(O)||O<=0){$({title:"Erreur",description:"Montant invalide",variant:"destructive"});return}try{await go(s,u.id,O),await No(u.buyerId,(t==null?void 0:t.username)||"Un vendeur",O,u.listingId).catch(N=>{b.error("Erreur notification:",N)}),$({title:"Contre-offre envoyÃ©e âœ…",description:`Proposition de ${O}â‚¬ envoyÃ©e Ã  l'acheteur`}),f(!1),g(""),await y()}catch(N){$({title:"Erreur",description:N.message,variant:"destructive"})}},w=O=>{const N=O-Date.now();if(N<=0)return"ExpirÃ©e";const R=Math.floor(N/(1e3*60*60));return R<24?`${R}h restantes`:`${Math.floor(R/24)}j restantes`},I=O=>{switch(O){case"pending":return e.jsx(le,{variant:"outline",className:"bg-yellow-500/10 text-yellow-600 border-yellow-500",children:"En attente"});case"accepted":return e.jsx(le,{variant:"outline",className:"bg-green-500/10 text-green-600 border-green-500",children:"AcceptÃ©e"});case"rejected":return e.jsx(le,{variant:"outline",className:"bg-red-500/10 text-red-600 border-red-500",children:"RejetÃ©e"});case"countered":return e.jsx(le,{variant:"outline",className:"bg-blue-500/10 text-blue-600 border-blue-500",children:"Contre-offre"});case"expired":return e.jsx(le,{variant:"outline",className:"bg-gray-500/10 text-gray-600 border-gray-500",children:"ExpirÃ©e"});default:return null}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-4",children:e.jsxs(Ss,{defaultValue:"received",children:[e.jsxs(Xt,{className:"grid w-full grid-cols-2",children:[e.jsxs(He,{value:"received",children:["Offres ReÃ§ues",r.filter(O=>O.status==="pending").length>0&&e.jsx(le,{className:"ml-2 h-5 w-5 p-0 flex items-center justify-center bg-red-500",children:r.filter(O=>O.status==="pending").length})]}),e.jsxs(He,{value:"sent",children:["Offres EnvoyÃ©es",a.filter(O=>O.status==="countered").length>0&&e.jsx(le,{className:"ml-2 h-5 w-5 p-0 flex items-center justify-center bg-blue-500",children:a.filter(O=>O.status==="countered").length})]})]}),e.jsx(Je,{value:"received",className:"mt-4 space-y-3",children:o?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(ue,{className:"h-4 w-4 animate-spin"})}):r.length===0?e.jsx(L,{children:e.jsx(V,{className:"py-8 text-center text-sm text-muted-foreground",children:"Aucune offre reÃ§ue pour le moment."})}):r.map(O=>{const N=Date.now()>O.expiresAt,R=O.status==="pending"&&!N;return e.jsxs(L,{className:R?"border-yellow-500/50":"",children:[e.jsx(xe,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs(he,{className:"text-sm",children:["Listing #",O.listingId.slice(-6)]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["De: ",O.buyerId.slice(0,6),"..."]})]}),I(O.status)]})}),e.jsxs(V,{className:"space-y-3 text-xs",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Montant proposÃ©"}),e.jsxs("span",{className:"font-semibold text-lg",children:[O.amount,"â‚¬"]})]}),O.counterOffer&&e.jsxs("div",{className:"flex items-center justify-between bg-blue-500/10 p-2 rounded",children:[e.jsxs("span",{className:"text-blue-600 flex items-center gap-1",children:[e.jsx(Oe,{className:"h-3 w-3"}),"Contre-offre"]}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[O.counterOffer,"â‚¬"]})]}),O.message&&e.jsx("div",{className:"bg-muted p-2 rounded",children:e.jsxs("p",{className:"text-xs italic",children:['"',O.message,'"']})}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(it,{className:"h-3 w-3"}),w(O.expiresAt)]}),e.jsx("span",{className:"text-muted-foreground",children:new Date(O.createdAt).toLocaleDateString("fr-FR")})]})]}),R&&e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(T,{size:"sm",variant:"outline",className:"flex-1 text-xs",onClick:()=>M(O.id),disabled:c===O.id,children:[e.jsx(Fe,{className:"h-4 w-4 mr-1"}),"Rejeter"]}),e.jsxs(T,{size:"sm",variant:"outline",className:"flex-1 text-xs",onClick:()=>{h(O),g((O.amount*1.1).toFixed(0)),f(!0)},disabled:c===O.id,children:[e.jsx(Oe,{className:"h-4 w-4 mr-1"}),"Contre-offre"]}),e.jsxs(T,{size:"sm",className:"flex-1 text-xs bg-green-600 hover:bg-green-700",onClick:()=>j(O.id),disabled:c===O.id,children:[e.jsx(at,{className:"h-4 w-4 mr-1"}),"Accepter"]})]})]})]},O.id)})}),e.jsx(Je,{value:"sent",className:"mt-4 space-y-3",children:o?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(ue,{className:"h-4 w-4 animate-spin"})}):a.length===0?e.jsx(L,{children:e.jsx(V,{className:"py-8 text-center text-sm text-muted-foreground",children:"Aucune offre envoyÃ©e pour le moment."})}):a.map(O=>e.jsxs(L,{children:[e.jsx(xe,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs(he,{className:"text-sm",children:["Listing #",O.listingId.slice(-6)]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Ã€: ",O.sellerId.slice(0,6),"..."]})]}),I(O.status)]})}),e.jsx(V,{className:"space-y-3 text-xs",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Montant proposÃ©"}),e.jsxs("span",{className:"font-semibold text-lg",children:[O.amount,"â‚¬"]})]}),O.counterOffer&&e.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded p-3 text-center",children:[e.jsx(ds,{className:"h-4 w-4 text-blue-600 mx-auto mb-1"}),e.jsxs("p",{className:"text-blue-600 text-xs",children:["Le vendeur a proposÃ© ",O.counterOffer,"â‚¬"]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(it,{className:"h-3 w-3"}),w(O.expiresAt)]}),e.jsx("span",{className:"text-muted-foreground",children:new Date(O.createdAt).toLocaleDateString("fr-FR")})]})]})})]},O.id))})]})}),e.jsx(Ue,{open:p,onOpenChange:f,children:e.jsxs(Le,{children:[e.jsxs(Ie,{children:[e.jsx(De,{children:"Faire une contre-offre"}),e.jsx(Ye,{children:"Proposez un nouveau prix Ã  l'acheteur"})]}),e.jsxs("div",{className:"space-y-4",children:[u&&e.jsxs("div",{className:"bg-muted p-3 rounded-lg space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Offre initiale:"}),e.jsxs("span",{className:"font-semibold",children:[u.amount,"â‚¬"]})]}),u.message&&e.jsxs("div",{className:"text-xs italic text-muted-foreground pt-2 border-t",children:['"',u.message,'"']})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Votre contre-offre (â‚¬)"}),e.jsx(je,{type:"number",placeholder:"Montant",value:x,onChange:O=>g(O.target.value)}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:"ðŸ’¡ Proposez un prix intermÃ©diaire pour maximiser vos chances"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(T,{variant:"outline",onClick:()=>f(!1),className:"flex-1",children:"Annuler"}),e.jsxs(T,{onClick:P,className:"flex-1",children:[e.jsx(Gs,{className:"h-4 w-4 mr-2"}),"Envoyer"]})]})]})]})})]})},ux=()=>{var h;const[s,t]=m.useState(""),[r,n]=m.useState(null),[a,i]=m.useState(!1),[o,l]=m.useState([]),c=async()=>{const p=s.trim().toLowerCase();if(!p){$({title:"Erreur",description:"Veuillez entrer un nom ou un code.",variant:"destructive"});return}i(!0);try{let f="";const{getCardByCode:x,codeToCardMap:g}=await rt(async()=>{const{getCardByCode:M,codeToCardMap:P}=await Promise.resolve().then(()=>Zs);return{getCardByCode:M,codeToCardMap:P}},void 0),y=x(p.toUpperCase());if(b.log("ðŸ—‚ï¸ [Profile] Carte directe trouvÃ©e:",y),y&&y.found)f=y.code;else{b.log("ðŸ” [Profile] Recherche par nom dans codeToCardMap...");let M=null;for(const P of Object.keys(g)){const w=g[P];if(M=Object.keys(w).find(I=>w[I].nom.toLowerCase().replace(/\.(png|jpg|jpeg|gif)$/i,"").includes(p)||w[I].nom.toLowerCase().includes(p))||null,M){b.log("âœ… [Profile] Code trouvÃ©:",M,"dans la saison:",P);break}}if(!M){b.log("âŒ [Profile] Aucune carte trouvÃ©e pour:",p),$({title:"Non trouvÃ©",description:`Aucune carte ne correspond Ã  "${s}". VÃ©rifiez l'orthographe.`,variant:"destructive"}),i(!1);return}f=M}b.log("ðŸŽ¯ [Profile] Code cible final:",f),b.log("ðŸ“Š [Profile] Appel getMarketStats pour:",f);const j=await wr(f);b.log("ðŸ“ˆ [Profile] Stats rÃ©cupÃ©rÃ©es:",j),b.log("ðŸ’° [Profile] Prix history:",j==null?void 0:j.priceHistory),j?(n(j),l(M=>{const P=M.filter(w=>w.cardCode!==j.cardCode);return[j,...P].slice(0,3)}),$({title:"âœ… Carte trouvÃ©e",description:`Statistiques de ${j.cardCode} chargÃ©es`})):($({title:"Aucune donnÃ©e",description:`La carte "${f}" n'a pas encore Ã©tÃ© vendue sur le marchÃ©.`,variant:"destructive"}),n(null))}catch(f){b.error("âŒ [Profile] Erreur recherche stats:",f),$({title:"Erreur",description:f.message||"Impossible de charger les statistiques.",variant:"destructive"})}finally{i(!1)}},d=p=>{if(!p||!Array.isArray(p)||p.length<2)return null;const f=p[0].price,g=(p[p.length-1].price-f)/f*100;return{percentage:Math.abs(g).toFixed(1),isIncrease:g>0}},u=({history:p})=>{if(!p||!Array.isArray(p)||p.length===0)return e.jsx("div",{className:"h-32 bg-muted/50 rounded-lg p-4 flex items-center justify-center",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun historique disponible"})});const f=p.filter(j=>j&&typeof j=="object"&&typeof j.price=="number"&&typeof j.date=="number"&&j.price>0);if(f.length===0)return e.jsx("div",{className:"h-32 bg-muted/50 rounded-lg p-4 flex items-center justify-center",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"DonnÃ©es invalides"})});const x=Math.max(...f.map(j=>j.price)),g=Math.min(...f.map(j=>j.price)),y=x-g||1;return e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-end gap-1 h-32 bg-muted/50 rounded-lg p-4",children:f.map((j,M)=>{const P=(j.price-g)/y*100,w=M===f.length-1;return e.jsxs("div",{className:"flex-1 flex flex-col items-center gap-1",children:[e.jsx("div",{className:`w-full rounded-t transition-all ${w?"bg-gradient-to-t from-green-600 to-green-400":"bg-gradient-to-t from-purple-600 to-purple-400"}`,style:{height:`${Math.max(P,10)}%`},title:`${j.price}â‚¬`}),e.jsx("span",{className:"text-[8px] text-muted-foreground",children:new Date(j.date).toLocaleDateString("fr-FR",{day:"2-digit",month:"short"})})]},M)})}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Min: ",g,"â‚¬"]}),e.jsxs("span",{children:["Max: ",x,"â‚¬"]}),e.jsxs("span",{children:["Moyenne: ",(f.reduce((j,M)=>j+M.price,0)/f.length).toFixed(2),"â‚¬"]})]})]})};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(L,{children:[e.jsx(xe,{children:e.jsxs(he,{className:"text-sm flex items-center gap-2",children:[e.jsx(Jt,{className:"h-4 w-4 text-purple-400"}),"Rechercher une carte"]})}),e.jsxs(V,{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(je,{placeholder:"Nom du joueur ou code (ex: Lilwenn, N831...)",value:s,onChange:p=>t(p.target.value),onKeyPress:p=>p.key==="Enter"&&c(),className:"flex-1"}),e.jsx(T,{onClick:c,disabled:a,children:a?e.jsx(ue,{className:"h-4 w-4 animate-spin"}):e.jsx(lt,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-start gap-2 p-2 rounded-lg bg-blue-500/10 border border-blue-500/20",children:[e.jsx(Zt,{className:"h-4 w-4 text-blue-500 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400",children:'ðŸ’¡ Recherche intelligente : tapez "Lilwenn" ou "N831", les deux fonctionnent !'})]})]})]}),r&&e.jsxs(L,{className:"overflow-hidden",children:[e.jsx(xe,{className:"bg-gradient-to-r from-purple-500/10 to-blue-500/10 border-b",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs(he,{className:"text-xl flex items-center gap-2",children:[r.cardCode||"Carte inconnue",r.priceHistory&&r.priceHistory.length>0&&d(r.priceHistory)&&e.jsxs(le,{variant:"outline",className:d(r.priceHistory).isIncrease?"bg-green-500/10 text-green-600 border-green-500":"bg-red-500/10 text-red-600 border-red-500",children:[d(r.priceHistory).isIncrease?e.jsx(ii,{className:"h-3 w-3 mr-1"}):e.jsx(oi,{className:"h-3 w-3 mr-1"}),d(r.priceHistory).percentage,"%"]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["DonnÃ©es sur ",((h=r.priceHistory)==null?void 0:h.length)||0," vente(s)"]})]}),e.jsxs(le,{className:"bg-primary",children:[e.jsx($t,{className:"h-3 w-3 mr-1"}),r.totalSales||0," ventes"]})]})}),e.jsxs(V,{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-500/10 to-blue-600/5 rounded-lg p-4 border border-blue-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-600 text-sm mb-2",children:[e.jsx(Wt,{className:"h-4 w-4"}),"Prix Moyen"]}),e.jsxs("div",{className:"text-2xl font-bold text-foreground",children:[r.averagePrice.toFixed(2),"â‚¬"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-500/10 to-green-600/5 rounded-lg p-4 border border-green-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-600 text-sm mb-2",children:[e.jsx(us,{className:"h-4 w-4"}),"Prix Min"]}),e.jsxs("div",{className:"text-2xl font-bold text-foreground",children:[r.lowestPrice,"â‚¬"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-red-500/10 to-red-600/5 rounded-lg p-4 border border-red-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm mb-2",children:[e.jsx(Oe,{className:"h-4 w-4"}),"Prix Max"]}),e.jsxs("div",{className:"text-2xl font-bold text-foreground",children:[r.highestPrice,"â‚¬"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-500/10 to-purple-600/5 rounded-lg p-4 border border-purple-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2 text-purple-600 text-sm mb-2",children:[e.jsx(ws,{className:"h-4 w-4"}),"DerniÃ¨re Vente"]}),e.jsxs("div",{className:"text-2xl font-bold text-foreground",children:[r.lastSalePrice||"N/A","â‚¬"]}),r.lastSaleDate&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:new Date(r.lastSaleDate).toLocaleDateString("fr-FR")})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold mb-3 flex items-center gap-2",children:[e.jsx(Jt,{className:"h-4 w-4"}),"Historique des Prix"]}),r.priceHistory&&r.priceHistory.length>0?e.jsx(u,{history:r.priceHistory}):e.jsx("div",{className:"h-32 bg-muted/50 rounded-lg p-4 flex items-center justify-center",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun historique disponible"})})]}),e.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-blue-600 mb-2 flex items-center gap-2",children:"ðŸ’¡ Recommandation de Prix"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Pour vendre rapidement, fixez votre prix entre"," ",e.jsxs("span",{className:"font-semibold text-foreground",children:[(r.averagePrice*.9).toFixed(2),"â‚¬"]})," ","et"," ",e.jsxs("span",{className:"font-semibold text-foreground",children:[(r.averagePrice*1.1).toFixed(2),"â‚¬"]})]})]})]})]}),o.length>0&&!r&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold mb-3",children:"Recherches rÃ©centes"}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:o.map(p=>e.jsx(L,{className:"cursor-pointer hover:border-primary transition-colors",onClick:()=>{t(p.cardCode),n(p)},children:e.jsxs(V,{className:"p-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:p.cardCode}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[p.totalSales," ventes Â· Moy: ",p.averagePrice.toFixed(2),"â‚¬"]})]}),e.jsx(Ns,{className:"h-4 w-4 text-muted-foreground"})]})},p.cardCode))})]})]})},mx=()=>{const s=ht(),{user:t,userProfile:r,logout:n}=Ae(),[a,i]=m.useState(!1),[o,l]=m.useState(!1),[c,d]=m.useState(!1),[u,h]=m.useState(!1),[p,f]=m.useState(!1),[x,g]=m.useState(""),[y,j]=m.useState([]),[M,P]=m.useState([]),[w,I]=m.useState([]),[O,N]=m.useState(!1),[R,F]=m.useState(null),[A,B]=m.useState(null),[_,J]=m.useState(null),[U,X]=m.useState(!1),[pe,ge]=m.useState("overview"),[ye,ee]=m.useState({fortune:0,bettingGains:0,equipped:{avatar:"",theme:"",banner:"",title:"",effect:""},inventory:{},cards:{}}),[se,H]=m.useState(!1),fe=Dm(x,300);m.useEffect(()=>{if(!t)return;H(!0);const v=S(k,`users/${t.uid}`),Z=et(v,K=>{try{if(K.exists()){const ne=K.val(),Se={avatar:ne.avatar||"",theme:ne.theme||"",banner:ne.banner||"",title:ne.title||"",effect:ne.effect||""};if(ee({fortune:ne.fortune||0,bettingGains:ne.bettingGains||0,equipped:Se,inventory:ne.inventory||{},cards:ne.cards||{}}),Se.theme){const Me=qe.find(Ge=>Ge.id===Se.theme);Me&&Me.preview&&nx(Me.preview)}b.log("âœ… [Profile] DonnÃ©es mises Ã  jour en temps rÃ©el")}}catch(ne){b.error("Erreur chargement donnÃ©es utilisateur:",ne)}finally{H(!1)}});return()=>Z()},[t]),m.useEffect(()=>{if(!t)return;(async()=>{N(!0);try{const[K,ne]=await Promise.all([Ro(t.uid),Or(t.uid)]);P(K),I(ne)}catch(K){b.error("Erreur chargement amis:",K)}finally{N(!1)}})();const Z=ex(t.uid,K=>{P(K)});return()=>Z()},[t]),m.useEffect(()=>{if(!t)return;(async()=>{X(!0);try{const Z=await $o(t.uid);J(Z)}catch(Z){b.error("Erreur chargement paramÃ¨tres:",Z)}finally{X(!1)}})()},[t]),m.useEffect(()=>{if(!t||fe.length<2){j([]);return}(async()=>{const Z=await sx(fe,t.uid);j(Z)})()},[fe,t]);const D=async()=>{try{await n(),$({title:"DÃ©connexion rÃ©ussie",description:"Ã€ bientÃ´t !"}),s("/auth")}catch{$({title:"Erreur",description:"Impossible de se dÃ©connecter.",variant:"destructive"})}},E=async()=>{if(!(!t||!_))try{await tx(t.uid,_),$({title:"ParamÃ¨tres sauvegardÃ©s! âš™ï¸",description:"Vos prÃ©fÃ©rences ont Ã©tÃ© mises Ã  jour."}),i(!1)}catch{$({title:"Erreur",description:"Impossible de sauvegarder les paramÃ¨tres.",variant:"destructive"})}},Q=async(v,Z)=>{if(!(!t||!r)){F(v);try{await Jm(t.uid,r.username,v),$({title:"Demande envoyÃ©e! ðŸ¤",description:`Demande d'ami envoyÃ©e Ã  ${Z}`}),g(""),j([])}catch(K){$({title:"Erreur",description:K.message,variant:"destructive"})}finally{F(null)}}},ae=async(v,Z)=>{try{if(await Ym(v),$({title:"Ami ajoutÃ©! âœ…",description:`${Z} est maintenant votre ami`}),t){const K=await Or(t.uid);I(K)}}catch(K){$({title:"Erreur",description:K.message,variant:"destructive"})}},C=async v=>{try{if(await Km(v),$({title:"Demande refusÃ©e",description:"La demande a Ã©tÃ© refusÃ©e"}),t){const Z=await Or(t.uid);I(Z)}}catch(Z){$({title:"Erreur",description:Z.message,variant:"destructive"})}},q=async(v,Z)=>{if(t)try{await Xm(t.uid,v),$({title:"Ami supprimÃ©",description:`${Z} a Ã©tÃ© retirÃ© de vos amis`}),(A==null?void 0:A.id)===v&&B(null)}catch(K){$({title:"Erreur",description:K.message,variant:"destructive"})}};if(!t||!r)return e.jsx($e,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:e.jsx(ue,{className:"h-8 w-8 animate-spin text-primary"})})});const Y=r||{username:(t==null?void 0:t.displayName)||"Joueur",role:"player",eloRating:1e3,wins:0,losses:0};return e.jsxs($e,{children:[e.jsxs(W.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-6 flex justify-end gap-2",children:[e.jsxs(T,{variant:"ghost",size:"icon",onClick:()=>l(!0),className:"relative",children:[e.jsx(Ts,{className:"h-5 w-5"}),w.length>0&&e.jsx("span",{className:"absolute right-1 top-1 flex h-4 w-4 items-center justify-center rounded-full bg-secondary text-[10px] font-bold animate-pulse",children:w.length})]}),e.jsx(T,{variant:"ghost",size:"icon",onClick:()=>i(!0),children:e.jsx(Ma,{className:"h-5 w-5"})})]}),e.jsx(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mb-4 sm:mb-6",children:e.jsx(Fm,{username:Y.username,role:Y.role,eloRating:Y.eloRating,rank:1,equippedAvatar:ye.equipped.avatar,equippedBanner:ye.equipped.banner,equippedTitle:ye.equipped.title})}),e.jsx(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mb-6",children:e.jsxs(Ss,{value:pe,onValueChange:v=>ge(v),className:"w-full",children:[e.jsxs(Xt,{className:"grid w-full grid-cols-2 sm:grid-cols-3 md:grid-cols-5",children:[e.jsx(He,{value:"overview",children:"RÃ©sumÃ©"}),e.jsx(He,{value:"stats",children:"Stats"}),e.jsx(He,{value:"club",children:"Club"}),e.jsx(He,{value:"offers",children:"Offres"}),e.jsx(He,{value:"market",children:"MarchÃ©"})]}),e.jsxs(Je,{value:"overview",className:"mt-4 space-y-4",children:[e.jsx(zm,{wins:Y.wins,losses:Y.losses,fortune:ye.fortune,totalEarned:ye.bettingGains}),se?e.jsx(L,{children:e.jsxs(V,{className:"flex items-center justify-center p-8",children:[e.jsx(ue,{className:"h-6 w-6 animate-spin text-primary"}),e.jsx("p",{className:"ml-3 text-muted-foreground",children:"Chargement..."})]})}):e.jsx(ox,{equipped:ye.equipped,inventory:ye.inventory}),e.jsxs(L,{children:[e.jsx(xe,{children:e.jsx(he,{className:"text-lg",children:"Actions rapides"})}),e.jsxs(V,{className:"space-y-2",children:[e.jsxs(T,{variant:"outline",className:"w-full justify-start gap-3",onClick:()=>s("/shop"),children:[e.jsx($t,{className:"h-4 w-4 text-primary"}),"Boutique"]}),e.jsxs(T,{variant:"outline",className:"w-full justify-start gap-3",onClick:()=>s("/inventory"),children:[e.jsx(Rs,{className:"h-4 w-4 text-primary"}),"Inventaire"]}),e.jsxs(T,{variant:"outline",className:"w-full justify-start gap-3",onClick:()=>s("/market"),children:[e.jsx(Wt,{className:"h-4 w-4 text-primary"}),"MarchÃ© des Cartes"]}),e.jsxs(T,{variant:"outline",className:"w-full justify-start gap-3",onClick:()=>s("/chat"),children:[e.jsx($s,{className:"h-4 w-4 text-primary"}),"Messages"]}),(r==null?void 0:r.role)==="admin"&&e.jsxs(T,{variant:"outline",className:"w-full justify-start gap-3 border-yellow-500/50 text-yellow-500 hover:bg-yellow-500/10",onClick:()=>s("/admin"),children:[e.jsx(wt,{className:"h-4 w-4"}),"Panneau Admin"]}),e.jsxs(T,{variant:"outline",className:"w-full justify-start gap-3",onClick:()=>d(!0),children:[e.jsx(as,{className:"h-4 w-4 text-primary"}),"GÃ©rer les amis",e.jsx("span",{className:"ml-auto rounded-full bg-primary/20 px-2 py-0.5 text-xs text-primary",children:M.length})]}),e.jsxs(T,{variant:"outline",className:"w-full justify-start gap-3",onClick:()=>f(!0),children:[e.jsx(wt,{className:"h-4 w-4 text-muted-foreground"}),"ConfidentialitÃ©"]}),e.jsxs(T,{variant:"outline",className:"w-full justify-start gap-3 text-secondary hover:text-secondary",onClick:D,children:[e.jsx(oa,{className:"h-4 w-4"}),"DÃ©connexion"]})]})]})]}),e.jsxs(Je,{value:"stats",className:"mt-4 space-y-4",children:[t&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx(lx,{userId:t.uid}),e.jsx(cx,{cards:ye.cards})]}),t&&e.jsx(ix,{userId:t.uid,fortune:ye.fortune,bettingGains:ye.bettingGains}),t&&e.jsx(Bm,{userId:t.uid}),t&&e.jsx(Vm,{userId:t.uid})]}),e.jsx(Je,{value:"club",className:"mt-4 space-y-4",children:t&&e.jsx(Gm,{userId:t.uid})}),e.jsx(Je,{value:"offers",className:"mt-4 space-y-4",children:t&&e.jsx(dx,{userId:t.uid})}),e.jsx(Je,{value:"market",className:"mt-4 space-y-4",children:e.jsx(ux,{})})]})}),e.jsx(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"mt-6",children:e.jsx(L,{children:e.jsx(V,{className:"p-4",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["ConnectÃ© en tant que: ",e.jsx("span",{className:"text-foreground",children:t==null?void 0:t.email})]})})})}),e.jsx(Ue,{open:o,onOpenChange:l,children:e.jsxs(Le,{children:[e.jsx(Ie,{children:e.jsxs(De,{className:"flex items-center gap-2",children:[e.jsx(Ts,{className:"h-5 w-5 text-primary"}),"Demandes d'ami (",w.length,")"]})}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:w.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Aucune demande en attente"}):w.map(v=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-surface-alt",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:v.fromUsername}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Demande d'ami"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(T,{size:"sm",variant:"default",onClick:()=>ae(v.id,v.fromUsername),children:e.jsx(at,{className:"h-4 w-4"})}),e.jsx(T,{size:"sm",variant:"destructive",onClick:()=>C(v.id),children:e.jsx(Fe,{className:"h-4 w-4"})})]})]},v.id))})]})}),e.jsx(Ue,{open:c,onOpenChange:d,children:e.jsxs(Le,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsx(Ie,{children:e.jsxs(De,{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-5 w-5 text-primary"}),"Mes Amis (",M.length,")"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(T,{variant:"outline",className:"w-full",onClick:()=>{d(!1),h(!0)},children:[e.jsx(as,{className:"h-4 w-4 mr-2"}),"Ajouter un ami"]}),O?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(ue,{className:"h-6 w-6 animate-spin text-primary"})}):M.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Ee,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Vous n'avez pas encore d'amis"}),e.jsx("p",{className:"text-sm mt-2",children:"Ajoutez des amis pour jouer ensemble !"})]}):e.jsx("div",{className:"space-y-2",children:M.map(v=>{const Z=v.avatar&&v.avatar!==""?qe.find(ne=>ne&&ne.id===v.avatar):null,K=(Z==null?void 0:Z.icon)||"ðŸ˜Š";return e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-surface-alt hover:bg-surface-alt/80 transition-colors cursor-pointer",onClick:()=>{B({id:v.id,username:v.username}),d(!1)},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-2xl",children:K}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:v.username}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["ELO: ",v.eloRating]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{className:v.status==="online"?"text-green-500 flex items-center gap-1":"text-muted-foreground",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${v.status==="online"?"bg-green-500":"bg-muted-foreground"}`}),v.status==="online"?"En ligne":"Hors ligne"]})]})]})]}),e.jsx(T,{variant:"ghost",size:"icon",onClick:ne=>{ne.stopPropagation(),q(v.id,v.username)},children:e.jsx(Fe,{className:"h-4 w-4"})})]},v.id)})})]})]})}),e.jsx(Ue,{open:u,onOpenChange:h,children:e.jsxs(Le,{children:[e.jsxs(Ie,{children:[e.jsxs(De,{className:"flex items-center gap-2",children:[e.jsx(as,{className:"h-5 w-5 text-primary"}),"Ajouter un ami"]}),e.jsx(Ye,{children:"Recherchez un joueur par son nom d'utilisateur"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(lt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(je,{placeholder:"Rechercher un utilisateur...",value:x,onChange:v=>g(v.target.value),className:"pl-10"})]}),y.length>0&&e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:y.map(v=>{const Z=M.some(Me=>Me.id===v.id),K=R===v.id,ne=v.avatar&&v.avatar!==""?qe.find(Me=>Me&&Me.id===v.avatar):null,Se=(ne==null?void 0:ne.icon)||"ðŸ˜Š";return e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-surface-alt",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-2xl",children:Se}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:v.username}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["ELO: ",v.eloRating]})]})]}),Z?e.jsx(le,{variant:"outline",children:"DÃ©jÃ  ami"}):e.jsx(T,{size:"sm",onClick:()=>Q(v.id,v.username),disabled:K,children:K?e.jsx(ue,{className:"h-4 w-4 animate-spin"}):e.jsx(as,{className:"h-4 w-4"})})]},v.id)})}),x.length>=2&&y.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(lt,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Aucun utilisateur trouvÃ©"})]})]})]})}),e.jsx(Ue,{open:a,onOpenChange:i,children:e.jsxs(Le,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsx(Ie,{children:e.jsxs(De,{className:"flex items-center gap-2",children:[e.jsx(Ma,{className:"h-5 w-5 text-primary"}),"ParamÃ¨tres"]})}),U?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(ue,{className:"h-6 w-6 animate-spin text-primary"})}):_?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Notifications"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(vt,{htmlFor:"notifications",children:"Activer les notifications"}),e.jsx(bt,{id:"notifications",checked:_.notifications.enabled,onCheckedChange:v=>J({..._,notifications:{..._.notifications,enabled:v}})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(vt,{htmlFor:"matchReminders",children:"Rappels de matchs"}),e.jsx(bt,{id:"matchReminders",checked:_.notifications.matchReminders,onCheckedChange:v=>J({..._,notifications:{..._.notifications,matchReminders:v}})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(vt,{htmlFor:"friendRequests",children:"Demandes d'ami"}),e.jsx(bt,{id:"friendRequests",checked:_.notifications.friendRequests,onCheckedChange:v=>J({..._,notifications:{..._.notifications,friendRequests:v}})})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Son"}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(vt,{htmlFor:"sound",children:"Activer le son"}),e.jsx(bt,{id:"sound",checked:_.sound.enabled,onCheckedChange:v=>J({..._,sound:{..._.sound,enabled:v}})})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(T,{variant:"outline",onClick:()=>i(!1),className:"flex-1",children:"Annuler"}),e.jsx(T,{onClick:E,className:"flex-1",children:"Sauvegarder"})]})]}):null]})}),e.jsx(Ue,{open:p,onOpenChange:f,children:e.jsxs(Le,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsx(Ie,{children:e.jsxs(De,{className:"flex items-center gap-2",children:[e.jsx(wt,{className:"h-5 w-5 text-primary"}),"ConfidentialitÃ©"]})}),U?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(ue,{className:"h-6 w-6 animate-spin text-primary"})}):_?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"VisibilitÃ©"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(vt,{htmlFor:"profilePublic",children:"Profil public"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Permettre aux autres joueurs de voir votre profil"})]}),e.jsx(bt,{id:"profilePublic",checked:_.privacy.profilePublic,onCheckedChange:v=>J({..._,privacy:{..._.privacy,profilePublic:v}})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(vt,{htmlFor:"showStats",children:"Afficher les statistiques"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Afficher vos stats sur votre profil public"})]}),e.jsx(bt,{id:"showStats",checked:_.privacy.showStats,onCheckedChange:v=>J({..._,privacy:{..._.privacy,showStats:v}})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(vt,{htmlFor:"allowFriendRequests",children:"Demandes d'ami"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Autoriser les autres Ã  vous envoyer des demandes"})]}),e.jsx(bt,{id:"allowFriendRequests",checked:_.privacy.allowFriendRequests,onCheckedChange:v=>J({..._,privacy:{..._.privacy,allowFriendRequests:v}})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(vt,{htmlFor:"showOnlineStatus",children:"Statut en ligne"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Afficher votre statut en ligne aux autres"})]}),e.jsx(bt,{id:"showOnlineStatus",checked:_.privacy.showOnlineStatus,onCheckedChange:v=>J({..._,privacy:{..._.privacy,showOnlineStatus:v}})})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(T,{variant:"outline",onClick:()=>f(!1),className:"flex-1",children:"Annuler"}),e.jsx(T,{onClick:async()=>{await E(),f(!1)},className:"flex-1",children:"Sauvegarder"})]})]}):null]})}),e.jsx(Wm,{isOpen:!!A,onClose:()=>{B(null),d(!0)},friendId:(A==null?void 0:A.id)||"",friendUsername:(A==null?void 0:A.username)||"",onRemoveFriend:q,canRemove:!0})]})};var _e;(function(s){s.assertEqual=a=>{};function t(a){}s.assertIs=t;function r(a){throw new Error}s.assertNever=r,s.arrayToEnum=a=>{const i={};for(const o of a)i[o]=o;return i},s.getValidEnumValues=a=>{const i=s.objectKeys(a).filter(l=>typeof a[a[l]]!="number"),o={};for(const l of i)o[l]=a[l];return s.objectValues(o)},s.objectValues=a=>s.objectKeys(a).map(function(i){return a[i]}),s.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{const i=[];for(const o in a)Object.prototype.hasOwnProperty.call(a,o)&&i.push(o);return i},s.find=(a,i)=>{for(const o of a)if(i(o))return o},s.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&Number.isFinite(a)&&Math.floor(a)===a;function n(a,i=" | "){return a.map(o=>typeof o=="string"?`'${o}'`:o).join(i)}s.joinValues=n,s.jsonStringifyReplacer=(a,i)=>typeof i=="bigint"?i.toString():i})(_e||(_e={}));var Xa;(function(s){s.mergeShapes=(t,r)=>({...t,...r})})(Xa||(Xa={}));const ie=_e.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Rt=s=>{switch(typeof s){case"undefined":return ie.undefined;case"string":return ie.string;case"number":return Number.isNaN(s)?ie.nan:ie.number;case"boolean":return ie.boolean;case"function":return ie.function;case"bigint":return ie.bigint;case"symbol":return ie.symbol;case"object":return Array.isArray(s)?ie.array:s===null?ie.null:s.then&&typeof s.then=="function"&&s.catch&&typeof s.catch=="function"?ie.promise:typeof Map<"u"&&s instanceof Map?ie.map:typeof Set<"u"&&s instanceof Set?ie.set:typeof Date<"u"&&s instanceof Date?ie.date:ie.object;default:return ie.unknown}},te=_e.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class ut extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=t}format(t){const r=t||function(i){return i.message},n={_errors:[]},a=i=>{for(const o of i.issues)if(o.code==="invalid_union")o.unionErrors.map(a);else if(o.code==="invalid_return_type")a(o.returnTypeError);else if(o.code==="invalid_arguments")a(o.argumentsError);else if(o.path.length===0)n._errors.push(r(o));else{let l=n,c=0;for(;c<o.path.length;){const d=o.path[c];c===o.path.length-1?(l[d]=l[d]||{_errors:[]},l[d]._errors.push(r(o))):l[d]=l[d]||{_errors:[]},l=l[d],c++}}};return a(this),n}static assert(t){if(!(t instanceof ut))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,_e.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=r=>r.message){const r={},n=[];for(const a of this.issues)if(a.path.length>0){const i=a.path[0];r[i]=r[i]||[],r[i].push(t(a))}else n.push(t(a));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}}ut.create=s=>new ut(s);const ea=(s,t)=>{let r;switch(s.code){case te.invalid_type:s.received===ie.undefined?r="Required":r=`Expected ${s.expected}, received ${s.received}`;break;case te.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(s.expected,_e.jsonStringifyReplacer)}`;break;case te.unrecognized_keys:r=`Unrecognized key(s) in object: ${_e.joinValues(s.keys,", ")}`;break;case te.invalid_union:r="Invalid input";break;case te.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${_e.joinValues(s.options)}`;break;case te.invalid_enum_value:r=`Invalid enum value. Expected ${_e.joinValues(s.options)}, received '${s.received}'`;break;case te.invalid_arguments:r="Invalid function arguments";break;case te.invalid_return_type:r="Invalid function return type";break;case te.invalid_date:r="Invalid date";break;case te.invalid_string:typeof s.validation=="object"?"includes"in s.validation?(r=`Invalid input: must include "${s.validation.includes}"`,typeof s.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${s.validation.position}`)):"startsWith"in s.validation?r=`Invalid input: must start with "${s.validation.startsWith}"`:"endsWith"in s.validation?r=`Invalid input: must end with "${s.validation.endsWith}"`:_e.assertNever(s.validation):s.validation!=="regex"?r=`Invalid ${s.validation}`:r="Invalid";break;case te.too_small:s.type==="array"?r=`Array must contain ${s.exact?"exactly":s.inclusive?"at least":"more than"} ${s.minimum} element(s)`:s.type==="string"?r=`String must contain ${s.exact?"exactly":s.inclusive?"at least":"over"} ${s.minimum} character(s)`:s.type==="number"?r=`Number must be ${s.exact?"exactly equal to ":s.inclusive?"greater than or equal to ":"greater than "}${s.minimum}`:s.type==="bigint"?r=`Number must be ${s.exact?"exactly equal to ":s.inclusive?"greater than or equal to ":"greater than "}${s.minimum}`:s.type==="date"?r=`Date must be ${s.exact?"exactly equal to ":s.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(s.minimum))}`:r="Invalid input";break;case te.too_big:s.type==="array"?r=`Array must contain ${s.exact?"exactly":s.inclusive?"at most":"less than"} ${s.maximum} element(s)`:s.type==="string"?r=`String must contain ${s.exact?"exactly":s.inclusive?"at most":"under"} ${s.maximum} character(s)`:s.type==="number"?r=`Number must be ${s.exact?"exactly":s.inclusive?"less than or equal to":"less than"} ${s.maximum}`:s.type==="bigint"?r=`BigInt must be ${s.exact?"exactly":s.inclusive?"less than or equal to":"less than"} ${s.maximum}`:s.type==="date"?r=`Date must be ${s.exact?"exactly":s.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(s.maximum))}`:r="Invalid input";break;case te.custom:r="Invalid input";break;case te.invalid_intersection_types:r="Intersection results could not be merged";break;case te.not_multiple_of:r=`Number must be a multiple of ${s.multipleOf}`;break;case te.not_finite:r="Number must be finite";break;default:r=t.defaultError,_e.assertNever(s)}return{message:r}};let xx=ea;function hx(){return xx}const fx=s=>{const{data:t,path:r,errorMaps:n,issueData:a}=s,i=[...r,...a.path||[]],o={...a,path:i};if(a.message!==void 0)return{...a,path:i,message:a.message};let l="";const c=n.filter(d=>!!d).slice().reverse();for(const d of c)l=d(o,{data:t,defaultError:l}).message;return{...a,path:i,message:l}};function re(s,t){const r=hx(),n=fx({issueData:t,data:s.data,path:s.path,errorMaps:[s.common.contextualErrorMap,s.schemaErrorMap,r,r===ea?void 0:ea].filter(a=>!!a)});s.common.issues.push(n)}class ot{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,r){const n=[];for(const a of r){if(a.status==="aborted")return be;a.status==="dirty"&&t.dirty(),n.push(a.value)}return{status:t.value,value:n}}static async mergeObjectAsync(t,r){const n=[];for(const a of r){const i=await a.key,o=await a.value;n.push({key:i,value:o})}return ot.mergeObjectSync(t,n)}static mergeObjectSync(t,r){const n={};for(const a of r){const{key:i,value:o}=a;if(i.status==="aborted"||o.status==="aborted")return be;i.status==="dirty"&&t.dirty(),o.status==="dirty"&&t.dirty(),i.value!=="__proto__"&&(typeof o.value<"u"||a.alwaysSet)&&(n[i.value]=o.value)}return{status:t.value,value:n}}}const be=Object.freeze({status:"aborted"}),Ms=s=>({status:"dirty",value:s}),ct=s=>({status:"valid",value:s}),en=s=>s.status==="aborted",tn=s=>s.status==="dirty",gs=s=>s.status==="valid",ur=s=>typeof Promise<"u"&&s instanceof Promise;var de;(function(s){s.errToObj=t=>typeof t=="string"?{message:t}:t||{},s.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(de||(de={}));class Dt{constructor(t,r,n,a){this._cachedPath=[],this.parent=t,this.data=r,this._path=n,this._key=a}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const sn=(s,t)=>{if(gs(t))return{success:!0,data:t.value};if(!s.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const r=new ut(s.common.issues);return this._error=r,this._error}}};function Ne(s){if(!s)return{};const{errorMap:t,invalid_type_error:r,required_error:n,description:a}=s;if(t&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:a}:{errorMap:(o,l)=>{const{message:c}=s;return o.code==="invalid_enum_value"?{message:c??l.defaultError}:typeof l.data>"u"?{message:c??n??l.defaultError}:o.code!=="invalid_type"?{message:l.defaultError}:{message:c??r??l.defaultError}},description:a}}class ke{get description(){return this._def.description}_getType(t){return Rt(t.data)}_getOrReturnCtx(t,r){return r||{common:t.parent.common,data:t.data,parsedType:Rt(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new ot,ctx:{common:t.parent.common,data:t.data,parsedType:Rt(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const r=this._parse(t);if(ur(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(t){const r=this._parse(t);return Promise.resolve(r)}parse(t,r){const n=this.safeParse(t,r);if(n.success)return n.data;throw n.error}safeParse(t,r){const n={common:{issues:[],async:(r==null?void 0:r.async)??!1,contextualErrorMap:r==null?void 0:r.errorMap},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Rt(t)},a=this._parseSync({data:t,path:n.path,parent:n});return sn(n,a)}"~validate"(t){var n,a;const r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Rt(t)};if(!this["~standard"].async)try{const i=this._parseSync({data:t,path:[],parent:r});return gs(i)?{value:i.value}:{issues:r.common.issues}}catch(i){(a=(n=i==null?void 0:i.message)==null?void 0:n.toLowerCase())!=null&&a.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:r}).then(i=>gs(i)?{value:i.value}:{issues:r.common.issues})}async parseAsync(t,r){const n=await this.safeParseAsync(t,r);if(n.success)return n.data;throw n.error}async safeParseAsync(t,r){const n={common:{issues:[],contextualErrorMap:r==null?void 0:r.errorMap,async:!0},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Rt(t)},a=this._parse({data:t,path:n.path,parent:n}),i=await(ur(a)?a:Promise.resolve(a));return sn(n,i)}refine(t,r){const n=a=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(a):r;return this._refinement((a,i)=>{const o=t(a),l=()=>i.addIssue({code:te.custom,...n(a)});return typeof Promise<"u"&&o instanceof Promise?o.then(c=>c?!0:(l(),!1)):o?!0:(l(),!1)})}refinement(t,r){return this._refinement((n,a)=>t(n)?!0:(a.addIssue(typeof r=="function"?r(n,a):r),!1))}_refinement(t){return new vs({schema:this,typeName:ve.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return Tt.create(this,this._def)}nullable(){return ys.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return xt.create(this)}promise(){return fr.create(this,this._def)}or(t){return xr.create([this,t],this._def)}and(t){return hr.create(this,t,this._def)}transform(t){return new vs({...Ne(this._def),schema:this,typeName:ve.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const r=typeof t=="function"?t:()=>t;return new sa({...Ne(this._def),innerType:this,defaultValue:r,typeName:ve.ZodDefault})}brand(){return new Dx({typeName:ve.ZodBranded,type:this,...Ne(this._def)})}catch(t){const r=typeof t=="function"?t:()=>t;return new ra({...Ne(this._def),innerType:this,catchValue:r,typeName:ve.ZodCatch})}describe(t){const r=this.constructor;return new r({...this._def,description:t})}pipe(t){return Na.create(this,t)}readonly(){return aa.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const px=/^c[^\s-]{8,}$/i,gx=/^[0-9a-z]+$/,bx=/^[0-9A-HJKMNP-TV-Z]{26}$/i,vx=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,yx=/^[a-z0-9_-]{21}$/i,jx=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,wx=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Nx=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Cx="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Ir;const Sx=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,kx=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,_x=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Ex=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Rx=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,$x=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,To="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Ax=new RegExp(`^${To}$`);function Po(s){let t="[0-5]\\d";s.precision?t=`${t}\\.\\d{${s.precision}}`:s.precision==null&&(t=`${t}(\\.\\d+)?`);const r=s.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${r}`}function Mx(s){return new RegExp(`^${Po(s)}$`)}function Tx(s){let t=`${To}T${Po(s)}`;const r=[];return r.push(s.local?"Z?":"Z"),s.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,new RegExp(`^${t}$`)}function Px(s,t){return!!((t==="v4"||!t)&&Sx.test(s)||(t==="v6"||!t)&&_x.test(s))}function Ox(s,t){if(!jx.test(s))return!1;try{const[r]=s.split(".");if(!r)return!1;const n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),a=JSON.parse(atob(n));return!(typeof a!="object"||a===null||"typ"in a&&(a==null?void 0:a.typ)!=="JWT"||!a.alg||t&&a.alg!==t)}catch{return!1}}function Lx(s,t){return!!((t==="v4"||!t)&&kx.test(s)||(t==="v6"||!t)&&Ex.test(s))}class At extends ke{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==ie.string){const i=this._getOrReturnCtx(t);return re(i,{code:te.invalid_type,expected:ie.string,received:i.parsedType}),be}const n=new ot;let a;for(const i of this._def.checks)if(i.kind==="min")t.data.length<i.value&&(a=this._getOrReturnCtx(t,a),re(a,{code:te.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="max")t.data.length>i.value&&(a=this._getOrReturnCtx(t,a),re(a,{code:te.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="length"){const o=t.data.length>i.value,l=t.data.length<i.value;(o||l)&&(a=this._getOrReturnCtx(t,a),o?re(a,{code:te.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):l&&re(a,{code:te.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),n.dirty())}else if(i.kind==="email")Nx.test(t.data)||(a=this._getOrReturnCtx(t,a),re(a,{validation:"email",code:te.invalid_string,message:i.message}),n.dirty());else if(i.kind==="emoji")Ir||(Ir=new RegExp(Cx,"u")),Ir.test(t.data)||(a=this._getOrReturnCtx(t,a),re(a,{validation:"emoji",code:te.invalid_string,message:i.message}),n.dirty());else if(i.kind==="uuid")vx.test(t.data)||(a=this._getOrReturnCtx(t,a),re(a,{validation:"uuid",code:te.invalid_string,message:i.message}),n.dirty());else if(i.kind==="nanoid")yx.test(t.data)||(a=this._getOrReturnCtx(t,a),re(a,{validation:"nanoid",code:te.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid")px.test(t.data)||(a=this._getOrReturnCtx(t,a),re(a,{validation:"cuid",code:te.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid2")gx.test(t.data)||(a=this._getOrReturnCtx(t,a),re(a,{validation:"cuid2",code:te.invalid_string,message:i.message}),n.dirty());else if(i.kind==="ulid")bx.test(t.data)||(a=this._getOrReturnCtx(t,a),re(a,{validation:"ulid",code:te.invalid_string,message:i.message}),n.dirty());else if(i.kind==="url")try{new URL(t.data)}catch{a=this._getOrReturnCtx(t,a),re(a,{validation:"url",code:te.invalid_string,message:i.message}),n.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(t.data)||(a=this._getOrReturnCtx(t,a),re(a,{validation:"regex",code:te.invalid_string,message:i.message}),n.dirty())):i.kind==="trim"?t.data=t.data.trim():i.kind==="includes"?t.data.includes(i.value,i.position)||(a=this._getOrReturnCtx(t,a),re(a,{code:te.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),n.dirty()):i.kind==="toLowerCase"?t.data=t.data.toLowerCase():i.kind==="toUpperCase"?t.data=t.data.toUpperCase():i.kind==="startsWith"?t.data.startsWith(i.value)||(a=this._getOrReturnCtx(t,a),re(a,{code:te.invalid_string,validation:{startsWith:i.value},message:i.message}),n.dirty()):i.kind==="endsWith"?t.data.endsWith(i.value)||(a=this._getOrReturnCtx(t,a),re(a,{code:te.invalid_string,validation:{endsWith:i.value},message:i.message}),n.dirty()):i.kind==="datetime"?Tx(i).test(t.data)||(a=this._getOrReturnCtx(t,a),re(a,{code:te.invalid_string,validation:"datetime",message:i.message}),n.dirty()):i.kind==="date"?Ax.test(t.data)||(a=this._getOrReturnCtx(t,a),re(a,{code:te.invalid_string,validation:"date",message:i.message}),n.dirty()):i.kind==="time"?Mx(i).test(t.data)||(a=this._getOrReturnCtx(t,a),re(a,{code:te.invalid_string,validation:"time",message:i.message}),n.dirty()):i.kind==="duration"?wx.test(t.data)||(a=this._getOrReturnCtx(t,a),re(a,{validation:"duration",code:te.invalid_string,message:i.message}),n.dirty()):i.kind==="ip"?Px(t.data,i.version)||(a=this._getOrReturnCtx(t,a),re(a,{validation:"ip",code:te.invalid_string,message:i.message}),n.dirty()):i.kind==="jwt"?Ox(t.data,i.alg)||(a=this._getOrReturnCtx(t,a),re(a,{validation:"jwt",code:te.invalid_string,message:i.message}),n.dirty()):i.kind==="cidr"?Lx(t.data,i.version)||(a=this._getOrReturnCtx(t,a),re(a,{validation:"cidr",code:te.invalid_string,message:i.message}),n.dirty()):i.kind==="base64"?Rx.test(t.data)||(a=this._getOrReturnCtx(t,a),re(a,{validation:"base64",code:te.invalid_string,message:i.message}),n.dirty()):i.kind==="base64url"?$x.test(t.data)||(a=this._getOrReturnCtx(t,a),re(a,{validation:"base64url",code:te.invalid_string,message:i.message}),n.dirty()):_e.assertNever(i);return{status:n.value,value:t.data}}_regex(t,r,n){return this.refinement(a=>t.test(a),{validation:r,code:te.invalid_string,...de.errToObj(n)})}_addCheck(t){return new At({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...de.errToObj(t)})}url(t){return this._addCheck({kind:"url",...de.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...de.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...de.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...de.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...de.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...de.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...de.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...de.errToObj(t)})}base64url(t){return this._addCheck({kind:"base64url",...de.errToObj(t)})}jwt(t){return this._addCheck({kind:"jwt",...de.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...de.errToObj(t)})}cidr(t){return this._addCheck({kind:"cidr",...de.errToObj(t)})}datetime(t){return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,offset:(t==null?void 0:t.offset)??!1,local:(t==null?void 0:t.local)??!1,...de.errToObj(t==null?void 0:t.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,...de.errToObj(t==null?void 0:t.message)})}duration(t){return this._addCheck({kind:"duration",...de.errToObj(t)})}regex(t,r){return this._addCheck({kind:"regex",regex:t,...de.errToObj(r)})}includes(t,r){return this._addCheck({kind:"includes",value:t,position:r==null?void 0:r.position,...de.errToObj(r==null?void 0:r.message)})}startsWith(t,r){return this._addCheck({kind:"startsWith",value:t,...de.errToObj(r)})}endsWith(t,r){return this._addCheck({kind:"endsWith",value:t,...de.errToObj(r)})}min(t,r){return this._addCheck({kind:"min",value:t,...de.errToObj(r)})}max(t,r){return this._addCheck({kind:"max",value:t,...de.errToObj(r)})}length(t,r){return this._addCheck({kind:"length",value:t,...de.errToObj(r)})}nonempty(t){return this.min(1,de.errToObj(t))}trim(){return new At({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new At({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new At({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return!!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return!!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxLength(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}}At.create=s=>new At({checks:[],typeName:ve.ZodString,coerce:(s==null?void 0:s.coerce)??!1,...Ne(s)});function Ix(s,t){const r=(s.toString().split(".")[1]||"").length,n=(t.toString().split(".")[1]||"").length,a=r>n?r:n,i=Number.parseInt(s.toFixed(a).replace(".","")),o=Number.parseInt(t.toFixed(a).replace(".",""));return i%o/10**a}class Bs extends ke{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==ie.number){const i=this._getOrReturnCtx(t);return re(i,{code:te.invalid_type,expected:ie.number,received:i.parsedType}),be}let n;const a=new ot;for(const i of this._def.checks)i.kind==="int"?_e.isInteger(t.data)||(n=this._getOrReturnCtx(t,n),re(n,{code:te.invalid_type,expected:"integer",received:"float",message:i.message}),a.dirty()):i.kind==="min"?(i.inclusive?t.data<i.value:t.data<=i.value)&&(n=this._getOrReturnCtx(t,n),re(n,{code:te.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),a.dirty()):i.kind==="max"?(i.inclusive?t.data>i.value:t.data>=i.value)&&(n=this._getOrReturnCtx(t,n),re(n,{code:te.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),a.dirty()):i.kind==="multipleOf"?Ix(t.data,i.value)!==0&&(n=this._getOrReturnCtx(t,n),re(n,{code:te.not_multiple_of,multipleOf:i.value,message:i.message}),a.dirty()):i.kind==="finite"?Number.isFinite(t.data)||(n=this._getOrReturnCtx(t,n),re(n,{code:te.not_finite,message:i.message}),a.dirty()):_e.assertNever(i);return{status:a.value,value:t.data}}gte(t,r){return this.setLimit("min",t,!0,de.toString(r))}gt(t,r){return this.setLimit("min",t,!1,de.toString(r))}lte(t,r){return this.setLimit("max",t,!0,de.toString(r))}lt(t,r){return this.setLimit("max",t,!1,de.toString(r))}setLimit(t,r,n,a){return new Bs({...this._def,checks:[...this._def.checks,{kind:t,value:r,inclusive:n,message:de.toString(a)}]})}_addCheck(t){return new Bs({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:de.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:de.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:de.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:de.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:de.toString(t)})}multipleOf(t,r){return this._addCheck({kind:"multipleOf",value:t,message:de.toString(r)})}finite(t){return this._addCheck({kind:"finite",message:de.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:de.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:de.toString(t)})}get minValue(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxValue(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&_e.isInteger(t.value))}get isFinite(){let t=null,r=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(t===null||n.value<t)&&(t=n.value)}return Number.isFinite(r)&&Number.isFinite(t)}}Bs.create=s=>new Bs({checks:[],typeName:ve.ZodNumber,coerce:(s==null?void 0:s.coerce)||!1,...Ne(s)});class Us extends ke{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch{return this._getInvalidInput(t)}if(this._getType(t)!==ie.bigint)return this._getInvalidInput(t);let n;const a=new ot;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?t.data<i.value:t.data<=i.value)&&(n=this._getOrReturnCtx(t,n),re(n,{code:te.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),a.dirty()):i.kind==="max"?(i.inclusive?t.data>i.value:t.data>=i.value)&&(n=this._getOrReturnCtx(t,n),re(n,{code:te.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),a.dirty()):i.kind==="multipleOf"?t.data%i.value!==BigInt(0)&&(n=this._getOrReturnCtx(t,n),re(n,{code:te.not_multiple_of,multipleOf:i.value,message:i.message}),a.dirty()):_e.assertNever(i);return{status:a.value,value:t.data}}_getInvalidInput(t){const r=this._getOrReturnCtx(t);return re(r,{code:te.invalid_type,expected:ie.bigint,received:r.parsedType}),be}gte(t,r){return this.setLimit("min",t,!0,de.toString(r))}gt(t,r){return this.setLimit("min",t,!1,de.toString(r))}lte(t,r){return this.setLimit("max",t,!0,de.toString(r))}lt(t,r){return this.setLimit("max",t,!1,de.toString(r))}setLimit(t,r,n,a){return new Us({...this._def,checks:[...this._def.checks,{kind:t,value:r,inclusive:n,message:de.toString(a)}]})}_addCheck(t){return new Us({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:de.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:de.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:de.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:de.toString(t)})}multipleOf(t,r){return this._addCheck({kind:"multipleOf",value:t,message:de.toString(r)})}get minValue(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxValue(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}}Us.create=s=>new Us({checks:[],typeName:ve.ZodBigInt,coerce:(s==null?void 0:s.coerce)??!1,...Ne(s)});class rn extends ke{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==ie.boolean){const n=this._getOrReturnCtx(t);return re(n,{code:te.invalid_type,expected:ie.boolean,received:n.parsedType}),be}return ct(t.data)}}rn.create=s=>new rn({typeName:ve.ZodBoolean,coerce:(s==null?void 0:s.coerce)||!1,...Ne(s)});class mr extends ke{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==ie.date){const i=this._getOrReturnCtx(t);return re(i,{code:te.invalid_type,expected:ie.date,received:i.parsedType}),be}if(Number.isNaN(t.data.getTime())){const i=this._getOrReturnCtx(t);return re(i,{code:te.invalid_date}),be}const n=new ot;let a;for(const i of this._def.checks)i.kind==="min"?t.data.getTime()<i.value&&(a=this._getOrReturnCtx(t,a),re(a,{code:te.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),n.dirty()):i.kind==="max"?t.data.getTime()>i.value&&(a=this._getOrReturnCtx(t,a),re(a,{code:te.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),n.dirty()):_e.assertNever(i);return{status:n.value,value:new Date(t.data.getTime())}}_addCheck(t){return new mr({...this._def,checks:[...this._def.checks,t]})}min(t,r){return this._addCheck({kind:"min",value:t.getTime(),message:de.toString(r)})}max(t,r){return this._addCheck({kind:"max",value:t.getTime(),message:de.toString(r)})}get minDate(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t!=null?new Date(t):null}}mr.create=s=>new mr({checks:[],coerce:(s==null?void 0:s.coerce)||!1,typeName:ve.ZodDate,...Ne(s)});class an extends ke{_parse(t){if(this._getType(t)!==ie.symbol){const n=this._getOrReturnCtx(t);return re(n,{code:te.invalid_type,expected:ie.symbol,received:n.parsedType}),be}return ct(t.data)}}an.create=s=>new an({typeName:ve.ZodSymbol,...Ne(s)});class nn extends ke{_parse(t){if(this._getType(t)!==ie.undefined){const n=this._getOrReturnCtx(t);return re(n,{code:te.invalid_type,expected:ie.undefined,received:n.parsedType}),be}return ct(t.data)}}nn.create=s=>new nn({typeName:ve.ZodUndefined,...Ne(s)});class on extends ke{_parse(t){if(this._getType(t)!==ie.null){const n=this._getOrReturnCtx(t);return re(n,{code:te.invalid_type,expected:ie.null,received:n.parsedType}),be}return ct(t.data)}}on.create=s=>new on({typeName:ve.ZodNull,...Ne(s)});class ln extends ke{constructor(){super(...arguments),this._any=!0}_parse(t){return ct(t.data)}}ln.create=s=>new ln({typeName:ve.ZodAny,...Ne(s)});class cn extends ke{constructor(){super(...arguments),this._unknown=!0}_parse(t){return ct(t.data)}}cn.create=s=>new cn({typeName:ve.ZodUnknown,...Ne(s)});class Ft extends ke{_parse(t){const r=this._getOrReturnCtx(t);return re(r,{code:te.invalid_type,expected:ie.never,received:r.parsedType}),be}}Ft.create=s=>new Ft({typeName:ve.ZodNever,...Ne(s)});class dn extends ke{_parse(t){if(this._getType(t)!==ie.undefined){const n=this._getOrReturnCtx(t);return re(n,{code:te.invalid_type,expected:ie.void,received:n.parsedType}),be}return ct(t.data)}}dn.create=s=>new dn({typeName:ve.ZodVoid,...Ne(s)});class xt extends ke{_parse(t){const{ctx:r,status:n}=this._processInputParams(t),a=this._def;if(r.parsedType!==ie.array)return re(r,{code:te.invalid_type,expected:ie.array,received:r.parsedType}),be;if(a.exactLength!==null){const o=r.data.length>a.exactLength.value,l=r.data.length<a.exactLength.value;(o||l)&&(re(r,{code:o?te.too_big:te.too_small,minimum:l?a.exactLength.value:void 0,maximum:o?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),n.dirty())}if(a.minLength!==null&&r.data.length<a.minLength.value&&(re(r,{code:te.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),n.dirty()),a.maxLength!==null&&r.data.length>a.maxLength.value&&(re(r,{code:te.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((o,l)=>a.type._parseAsync(new Dt(r,o,r.path,l)))).then(o=>ot.mergeArray(n,o));const i=[...r.data].map((o,l)=>a.type._parseSync(new Dt(r,o,r.path,l)));return ot.mergeArray(n,i)}get element(){return this._def.type}min(t,r){return new xt({...this._def,minLength:{value:t,message:de.toString(r)}})}max(t,r){return new xt({...this._def,maxLength:{value:t,message:de.toString(r)}})}length(t,r){return new xt({...this._def,exactLength:{value:t,message:de.toString(r)}})}nonempty(t){return this.min(1,t)}}xt.create=(s,t)=>new xt({type:s,minLength:null,maxLength:null,exactLength:null,typeName:ve.ZodArray,...Ne(t)});function rs(s){if(s instanceof Ze){const t={};for(const r in s.shape){const n=s.shape[r];t[r]=Tt.create(rs(n))}return new Ze({...s._def,shape:()=>t})}else return s instanceof xt?new xt({...s._def,type:rs(s.element)}):s instanceof Tt?Tt.create(rs(s.unwrap())):s instanceof ys?ys.create(rs(s.unwrap())):s instanceof Kt?Kt.create(s.items.map(t=>rs(t))):s}class Ze extends ke{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),r=_e.objectKeys(t);return this._cached={shape:t,keys:r},this._cached}_parse(t){if(this._getType(t)!==ie.object){const d=this._getOrReturnCtx(t);return re(d,{code:te.invalid_type,expected:ie.object,received:d.parsedType}),be}const{status:n,ctx:a}=this._processInputParams(t),{shape:i,keys:o}=this._getCached(),l=[];if(!(this._def.catchall instanceof Ft&&this._def.unknownKeys==="strip"))for(const d in a.data)o.includes(d)||l.push(d);const c=[];for(const d of o){const u=i[d],h=a.data[d];c.push({key:{status:"valid",value:d},value:u._parse(new Dt(a,h,a.path,d)),alwaysSet:d in a.data})}if(this._def.catchall instanceof Ft){const d=this._def.unknownKeys;if(d==="passthrough")for(const u of l)c.push({key:{status:"valid",value:u},value:{status:"valid",value:a.data[u]}});else if(d==="strict")l.length>0&&(re(a,{code:te.unrecognized_keys,keys:l}),n.dirty());else if(d!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const d=this._def.catchall;for(const u of l){const h=a.data[u];c.push({key:{status:"valid",value:u},value:d._parse(new Dt(a,h,a.path,u)),alwaysSet:u in a.data})}}return a.common.async?Promise.resolve().then(async()=>{const d=[];for(const u of c){const h=await u.key,p=await u.value;d.push({key:h,value:p,alwaysSet:u.alwaysSet})}return d}).then(d=>ot.mergeObjectSync(n,d)):ot.mergeObjectSync(n,c)}get shape(){return this._def.shape()}strict(t){return de.errToObj,new Ze({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(r,n)=>{var i,o;const a=((o=(i=this._def).errorMap)==null?void 0:o.call(i,r,n).message)??n.defaultError;return r.code==="unrecognized_keys"?{message:de.errToObj(t).message??a}:{message:a}}}:{}})}strip(){return new Ze({...this._def,unknownKeys:"strip"})}passthrough(){return new Ze({...this._def,unknownKeys:"passthrough"})}extend(t){return new Ze({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new Ze({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:ve.ZodObject})}setKey(t,r){return this.augment({[t]:r})}catchall(t){return new Ze({...this._def,catchall:t})}pick(t){const r={};for(const n of _e.objectKeys(t))t[n]&&this.shape[n]&&(r[n]=this.shape[n]);return new Ze({...this._def,shape:()=>r})}omit(t){const r={};for(const n of _e.objectKeys(this.shape))t[n]||(r[n]=this.shape[n]);return new Ze({...this._def,shape:()=>r})}deepPartial(){return rs(this)}partial(t){const r={};for(const n of _e.objectKeys(this.shape)){const a=this.shape[n];t&&!t[n]?r[n]=a:r[n]=a.optional()}return new Ze({...this._def,shape:()=>r})}required(t){const r={};for(const n of _e.objectKeys(this.shape))if(t&&!t[n])r[n]=this.shape[n];else{let i=this.shape[n];for(;i instanceof Tt;)i=i._def.innerType;r[n]=i}return new Ze({...this._def,shape:()=>r})}keyof(){return Oo(_e.objectKeys(this.shape))}}Ze.create=(s,t)=>new Ze({shape:()=>s,unknownKeys:"strip",catchall:Ft.create(),typeName:ve.ZodObject,...Ne(t)});Ze.strictCreate=(s,t)=>new Ze({shape:()=>s,unknownKeys:"strict",catchall:Ft.create(),typeName:ve.ZodObject,...Ne(t)});Ze.lazycreate=(s,t)=>new Ze({shape:s,unknownKeys:"strip",catchall:Ft.create(),typeName:ve.ZodObject,...Ne(t)});class xr extends ke{_parse(t){const{ctx:r}=this._processInputParams(t),n=this._def.options;function a(i){for(const l of i)if(l.result.status==="valid")return l.result;for(const l of i)if(l.result.status==="dirty")return r.common.issues.push(...l.ctx.common.issues),l.result;const o=i.map(l=>new ut(l.ctx.common.issues));return re(r,{code:te.invalid_union,unionErrors:o}),be}if(r.common.async)return Promise.all(n.map(async i=>{const o={...r,common:{...r.common,issues:[]},parent:null};return{result:await i._parseAsync({data:r.data,path:r.path,parent:o}),ctx:o}})).then(a);{let i;const o=[];for(const c of n){const d={...r,common:{...r.common,issues:[]},parent:null},u=c._parseSync({data:r.data,path:r.path,parent:d});if(u.status==="valid")return u;u.status==="dirty"&&!i&&(i={result:u,ctx:d}),d.common.issues.length&&o.push(d.common.issues)}if(i)return r.common.issues.push(...i.ctx.common.issues),i.result;const l=o.map(c=>new ut(c));return re(r,{code:te.invalid_union,unionErrors:l}),be}}get options(){return this._def.options}}xr.create=(s,t)=>new xr({options:s,typeName:ve.ZodUnion,...Ne(t)});function ta(s,t){const r=Rt(s),n=Rt(t);if(s===t)return{valid:!0,data:s};if(r===ie.object&&n===ie.object){const a=_e.objectKeys(t),i=_e.objectKeys(s).filter(l=>a.indexOf(l)!==-1),o={...s,...t};for(const l of i){const c=ta(s[l],t[l]);if(!c.valid)return{valid:!1};o[l]=c.data}return{valid:!0,data:o}}else if(r===ie.array&&n===ie.array){if(s.length!==t.length)return{valid:!1};const a=[];for(let i=0;i<s.length;i++){const o=s[i],l=t[i],c=ta(o,l);if(!c.valid)return{valid:!1};a.push(c.data)}return{valid:!0,data:a}}else return r===ie.date&&n===ie.date&&+s==+t?{valid:!0,data:s}:{valid:!1}}class hr extends ke{_parse(t){const{status:r,ctx:n}=this._processInputParams(t),a=(i,o)=>{if(en(i)||en(o))return be;const l=ta(i.value,o.value);return l.valid?((tn(i)||tn(o))&&r.dirty(),{status:r.value,value:l.data}):(re(n,{code:te.invalid_intersection_types}),be)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([i,o])=>a(i,o)):a(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}hr.create=(s,t,r)=>new hr({left:s,right:t,typeName:ve.ZodIntersection,...Ne(r)});class Kt extends ke{_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==ie.array)return re(n,{code:te.invalid_type,expected:ie.array,received:n.parsedType}),be;if(n.data.length<this._def.items.length)return re(n,{code:te.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),be;!this._def.rest&&n.data.length>this._def.items.length&&(re(n,{code:te.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());const i=[...n.data].map((o,l)=>{const c=this._def.items[l]||this._def.rest;return c?c._parse(new Dt(n,o,n.path,l)):null}).filter(o=>!!o);return n.common.async?Promise.all(i).then(o=>ot.mergeArray(r,o)):ot.mergeArray(r,i)}get items(){return this._def.items}rest(t){return new Kt({...this._def,rest:t})}}Kt.create=(s,t)=>{if(!Array.isArray(s))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Kt({items:s,typeName:ve.ZodTuple,rest:null,...Ne(t)})};class un extends ke{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==ie.map)return re(n,{code:te.invalid_type,expected:ie.map,received:n.parsedType}),be;const a=this._def.keyType,i=this._def.valueType,o=[...n.data.entries()].map(([l,c],d)=>({key:a._parse(new Dt(n,l,n.path,[d,"key"])),value:i._parse(new Dt(n,c,n.path,[d,"value"]))}));if(n.common.async){const l=new Map;return Promise.resolve().then(async()=>{for(const c of o){const d=await c.key,u=await c.value;if(d.status==="aborted"||u.status==="aborted")return be;(d.status==="dirty"||u.status==="dirty")&&r.dirty(),l.set(d.value,u.value)}return{status:r.value,value:l}})}else{const l=new Map;for(const c of o){const d=c.key,u=c.value;if(d.status==="aborted"||u.status==="aborted")return be;(d.status==="dirty"||u.status==="dirty")&&r.dirty(),l.set(d.value,u.value)}return{status:r.value,value:l}}}}un.create=(s,t,r)=>new un({valueType:t,keyType:s,typeName:ve.ZodMap,...Ne(r)});class qs extends ke{_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==ie.set)return re(n,{code:te.invalid_type,expected:ie.set,received:n.parsedType}),be;const a=this._def;a.minSize!==null&&n.data.size<a.minSize.value&&(re(n,{code:te.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),r.dirty()),a.maxSize!==null&&n.data.size>a.maxSize.value&&(re(n,{code:te.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),r.dirty());const i=this._def.valueType;function o(c){const d=new Set;for(const u of c){if(u.status==="aborted")return be;u.status==="dirty"&&r.dirty(),d.add(u.value)}return{status:r.value,value:d}}const l=[...n.data.values()].map((c,d)=>i._parse(new Dt(n,c,n.path,d)));return n.common.async?Promise.all(l).then(c=>o(c)):o(l)}min(t,r){return new qs({...this._def,minSize:{value:t,message:de.toString(r)}})}max(t,r){return new qs({...this._def,maxSize:{value:t,message:de.toString(r)}})}size(t,r){return this.min(t,r).max(t,r)}nonempty(t){return this.min(1,t)}}qs.create=(s,t)=>new qs({valueType:s,minSize:null,maxSize:null,typeName:ve.ZodSet,...Ne(t)});class mn extends ke{get schema(){return this._def.getter()}_parse(t){const{ctx:r}=this._processInputParams(t);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}}mn.create=(s,t)=>new mn({getter:s,typeName:ve.ZodLazy,...Ne(t)});class xn extends ke{_parse(t){if(t.data!==this._def.value){const r=this._getOrReturnCtx(t);return re(r,{received:r.data,code:te.invalid_literal,expected:this._def.value}),be}return{status:"valid",value:t.data}}get value(){return this._def.value}}xn.create=(s,t)=>new xn({value:s,typeName:ve.ZodLiteral,...Ne(t)});function Oo(s,t){return new bs({values:s,typeName:ve.ZodEnum,...Ne(t)})}class bs extends ke{_parse(t){if(typeof t.data!="string"){const r=this._getOrReturnCtx(t),n=this._def.values;return re(r,{expected:_e.joinValues(n),received:r.parsedType,code:te.invalid_type}),be}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(t.data)){const r=this._getOrReturnCtx(t),n=this._def.values;return re(r,{received:r.data,code:te.invalid_enum_value,options:n}),be}return ct(t.data)}get options(){return this._def.values}get enum(){const t={};for(const r of this._def.values)t[r]=r;return t}get Values(){const t={};for(const r of this._def.values)t[r]=r;return t}get Enum(){const t={};for(const r of this._def.values)t[r]=r;return t}extract(t,r=this._def){return bs.create(t,{...this._def,...r})}exclude(t,r=this._def){return bs.create(this.options.filter(n=>!t.includes(n)),{...this._def,...r})}}bs.create=Oo;class hn extends ke{_parse(t){const r=_e.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(t);if(n.parsedType!==ie.string&&n.parsedType!==ie.number){const a=_e.objectValues(r);return re(n,{expected:_e.joinValues(a),received:n.parsedType,code:te.invalid_type}),be}if(this._cache||(this._cache=new Set(_e.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){const a=_e.objectValues(r);return re(n,{received:n.data,code:te.invalid_enum_value,options:a}),be}return ct(t.data)}get enum(){return this._def.values}}hn.create=(s,t)=>new hn({values:s,typeName:ve.ZodNativeEnum,...Ne(t)});class fr extends ke{unwrap(){return this._def.type}_parse(t){const{ctx:r}=this._processInputParams(t);if(r.parsedType!==ie.promise&&r.common.async===!1)return re(r,{code:te.invalid_type,expected:ie.promise,received:r.parsedType}),be;const n=r.parsedType===ie.promise?r.data:Promise.resolve(r.data);return ct(n.then(a=>this._def.type.parseAsync(a,{path:r.path,errorMap:r.common.contextualErrorMap})))}}fr.create=(s,t)=>new fr({type:s,typeName:ve.ZodPromise,...Ne(t)});class vs extends ke{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===ve.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:r,ctx:n}=this._processInputParams(t),a=this._def.effect||null,i={addIssue:o=>{re(n,o),o.fatal?r.abort():r.dirty()},get path(){return n.path}};if(i.addIssue=i.addIssue.bind(i),a.type==="preprocess"){const o=a.transform(n.data,i);if(n.common.async)return Promise.resolve(o).then(async l=>{if(r.value==="aborted")return be;const c=await this._def.schema._parseAsync({data:l,path:n.path,parent:n});return c.status==="aborted"?be:c.status==="dirty"||r.value==="dirty"?Ms(c.value):c});{if(r.value==="aborted")return be;const l=this._def.schema._parseSync({data:o,path:n.path,parent:n});return l.status==="aborted"?be:l.status==="dirty"||r.value==="dirty"?Ms(l.value):l}}if(a.type==="refinement"){const o=l=>{const c=a.refinement(l,i);if(n.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return l};if(n.common.async===!1){const l=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return l.status==="aborted"?be:(l.status==="dirty"&&r.dirty(),o(l.value),{status:r.value,value:l.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(l=>l.status==="aborted"?be:(l.status==="dirty"&&r.dirty(),o(l.value).then(()=>({status:r.value,value:l.value}))))}if(a.type==="transform")if(n.common.async===!1){const o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!gs(o))return be;const l=a.transform(o.value,i);if(l instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:l}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>gs(o)?Promise.resolve(a.transform(o.value,i)).then(l=>({status:r.value,value:l})):be);_e.assertNever(a)}}vs.create=(s,t,r)=>new vs({schema:s,typeName:ve.ZodEffects,effect:t,...Ne(r)});vs.createWithPreprocess=(s,t,r)=>new vs({schema:t,effect:{type:"preprocess",transform:s},typeName:ve.ZodEffects,...Ne(r)});class Tt extends ke{_parse(t){return this._getType(t)===ie.undefined?ct(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}Tt.create=(s,t)=>new Tt({innerType:s,typeName:ve.ZodOptional,...Ne(t)});class ys extends ke{_parse(t){return this._getType(t)===ie.null?ct(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}ys.create=(s,t)=>new ys({innerType:s,typeName:ve.ZodNullable,...Ne(t)});class sa extends ke{_parse(t){const{ctx:r}=this._processInputParams(t);let n=r.data;return r.parsedType===ie.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}}sa.create=(s,t)=>new sa({innerType:s,typeName:ve.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...Ne(t)});class ra extends ke{_parse(t){const{ctx:r}=this._processInputParams(t),n={...r,common:{...r.common,issues:[]}},a=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return ur(a)?a.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new ut(n.common.issues)},input:n.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new ut(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}ra.create=(s,t)=>new ra({innerType:s,typeName:ve.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...Ne(t)});class fn extends ke{_parse(t){if(this._getType(t)!==ie.nan){const n=this._getOrReturnCtx(t);return re(n,{code:te.invalid_type,expected:ie.nan,received:n.parsedType}),be}return{status:"valid",value:t.data}}}fn.create=s=>new fn({typeName:ve.ZodNaN,...Ne(s)});class Dx extends ke{_parse(t){const{ctx:r}=this._processInputParams(t),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}}class Na extends ke{_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?be:i.status==="dirty"?(r.dirty(),Ms(i.value)):this._def.out._parseAsync({data:i.value,path:n.path,parent:n})})();{const a=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?be:a.status==="dirty"?(r.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:n.path,parent:n})}}static create(t,r){return new Na({in:t,out:r,typeName:ve.ZodPipeline})}}class aa extends ke{_parse(t){const r=this._def.innerType._parse(t),n=a=>(gs(a)&&(a.value=Object.freeze(a.value)),a);return ur(r)?r.then(a=>n(a)):n(r)}unwrap(){return this._def.innerType}}aa.create=(s,t)=>new aa({innerType:s,typeName:ve.ZodReadonly,...Ne(t)});var ve;(function(s){s.ZodString="ZodString",s.ZodNumber="ZodNumber",s.ZodNaN="ZodNaN",s.ZodBigInt="ZodBigInt",s.ZodBoolean="ZodBoolean",s.ZodDate="ZodDate",s.ZodSymbol="ZodSymbol",s.ZodUndefined="ZodUndefined",s.ZodNull="ZodNull",s.ZodAny="ZodAny",s.ZodUnknown="ZodUnknown",s.ZodNever="ZodNever",s.ZodVoid="ZodVoid",s.ZodArray="ZodArray",s.ZodObject="ZodObject",s.ZodUnion="ZodUnion",s.ZodDiscriminatedUnion="ZodDiscriminatedUnion",s.ZodIntersection="ZodIntersection",s.ZodTuple="ZodTuple",s.ZodRecord="ZodRecord",s.ZodMap="ZodMap",s.ZodSet="ZodSet",s.ZodFunction="ZodFunction",s.ZodLazy="ZodLazy",s.ZodLiteral="ZodLiteral",s.ZodEnum="ZodEnum",s.ZodEffects="ZodEffects",s.ZodNativeEnum="ZodNativeEnum",s.ZodOptional="ZodOptional",s.ZodNullable="ZodNullable",s.ZodDefault="ZodDefault",s.ZodCatch="ZodCatch",s.ZodPromise="ZodPromise",s.ZodBranded="ZodBranded",s.ZodPipeline="ZodPipeline",s.ZodReadonly="ZodReadonly"})(ve||(ve={}));const yt=At.create;Ft.create;xt.create;const Ca=Ze.create;xr.create;hr.create;Kt.create;bs.create;fr.create;Tt.create;ys.create;const Fx=Ca({email:yt().email("Adresse email invalide"),password:yt().min(6,"Le mot de passe doit contenir au moins 6 caractÃ¨res")}),zx=Ca({username:yt().min(3,"Le pseudo doit contenir au moins 3 caractÃ¨res").max(20,"Le pseudo ne peut pas dÃ©passer 20 caractÃ¨res"),email:yt().email("Adresse email invalide"),password:yt().min(6,"Le mot de passe doit contenir au moins 6 caractÃ¨res"),confirmPassword:yt()}).refine(s=>s.password===s.confirmPassword,{message:"Les mots de passe ne correspondent pas",path:["confirmPassword"]}),Bx=()=>{const[s,t]=m.useState(!0),[r,n]=m.useState(!1),[a,i]=m.useState(!1),[o,l]=m.useState(null),[c,d]=m.useState({}),[u,h]=m.useState(""),[p,f]=m.useState(""),[x,g]=m.useState(""),[y,j]=m.useState(""),[M,P]=m.useState(!1),[w,I]=m.useState(""),[O,N]=m.useState(!1),[R,F]=m.useState(!1),{user:A,login:B,signup:_}=Ae(),J=ht(),U=Hs();m.useEffect(()=>{b.log("  - user:",A==null?void 0:A.uid)},[A,R]),m.useEffect(()=>{var se,H;if(b.log("ðŸ”„ useEffect redirection - user:",A==null?void 0:A.uid,"showTutorial:",R),A&&!R){const fe=((H=(se=U.state)==null?void 0:se.from)==null?void 0:H.pathname)||"/";J(fe,{replace:!0})}},[A,J,U,R]);const X=()=>{h(""),f(""),g(""),j(""),l(null),d({}),P(!1),I(""),N(!1)},pe=async se=>{se.preventDefault(),l(null),d({});try{s?Fx.parse({email:u,password:p}):zx.parse({username:y,email:u,password:p,confirmPassword:x})}catch(H){if(H instanceof ut){const fe={};H.errors.forEach(D=>{D.path[0]&&(fe[D.path[0]]=D.message)}),d(fe);return}}i(!0);try{if(s){b.log("ðŸ”‘ Tentative de connexion...");const H=await B(u,p);H.error?(b.log("âŒ Erreur de connexion:",H.error),l(H.error)):b.log("âœ… Connexion rÃ©ussie")}else{b.log("ðŸ“ Tentative d'inscription...");const H=await _(u,p,y);b.log("ðŸ“Š RÃ©sultat inscription:",H),H.error?(b.log("âŒ Erreur d'inscription:",H.error),l(H.error)):H.userId?(b.log("âœ… Inscription rÃ©ussie! UserId:",H.userId),b.log("ðŸŽ“ Activation du tutoriel..."),F(!0),b.log("ðŸŽ“ Ã‰tat showTutorialAfterSignup:",!0)):b.log("âš ï¸ Inscription rÃ©ussie mais pas de userId retournÃ©")}}catch(H){b.error("ðŸ’¥ Erreur inattendue:",H)}finally{i(!1)}},ge=()=>{t(!s),X()},ye=async se=>{se.preventDefault(),l(null),d({});try{yt().email().parse(w)}catch{d({resetEmail:"Adresse email invalide"});return}i(!0);try{const H=la();await Rc(H,w),N(!0)}catch(H){H.code==="auth/user-not-found"?l("Aucun compte avec cet email"):l("Une erreur est survenue. Veuillez rÃ©essayer.")}finally{i(!1)}},ee=async()=>{if(!(A!=null&&A.uid)){b.error("âŒ Pas d'utilisateur connectÃ©");return}try{b.log("âœ… Marquage du tutoriel comme complÃ©tÃ© pour:",A.uid);const se=S(k,`users/${A.uid}`);await oe(se,{hasSeenTutorial:!0,tutorialCompletedAt:Date.now()}),F(!1),J("/")}catch(se){b.error("âŒ Erreur completion tutoriel:",se),F(!1),J("/")}};return e.jsxs("div",{className:"flex min-h-screen items-center justify-center bg-background p-4",children:[(b.log("ðŸŽ¨ Rendu - user:",A==null?void 0:A.uid),null),R&&A&&e.jsxs(e.Fragment,{children:[b.log("ðŸŽ“ AFFICHAGE DU TUTORIEL CONFIRMÃ‰"),e.jsx(TutorialOverlay,{onComplete:ee})]}),R&&!A&&e.jsx(e.Fragment,{children:b.log("âš ï¸ showTutorialAfterSignup=true MAIS user=null")}),!R&&e.jsx(e.Fragment,{children:b.log("â„¹ï¸ Tutoriel non affichÃ© (showTutorialAfterSignup=false)")}),e.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[e.jsx("div",{className:"absolute left-1/4 top-1/4 h-64 w-64 rounded-full bg-primary/5 blur-3xl"}),e.jsx("div",{className:"absolute bottom-1/4 right-1/4 h-64 w-64 rounded-full bg-secondary/5 blur-3xl"})]}),e.jsxs(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative z-10 w-full max-w-md",children:[e.jsxs(W.div,{initial:{scale:.8},animate:{scale:1},className:"mb-8 text-center",children:[e.jsx(W.span,{animate:{rotate:[0,5,-5,0]},transition:{duration:2,repeat:1/0},className:"mb-4 inline-block text-6xl",children:"âš½"}),e.jsxs("h1",{className:"text-3xl font-bold text-foreground",children:["Baby-Foot ",e.jsx("span",{className:"text-primary text-glow-cyan",children:"App"})]})]}),e.jsxs(L,{className:"border-border/50 bg-card/80 backdrop-blur-xl",children:[e.jsxs(xe,{className:"text-center",children:[e.jsx(he,{className:"text-2xl",children:M?"Mot de passe oubliÃ©":s?"Connexion":"Inscription"}),e.jsx(ba,{children:M?"Entrez votre email pour rÃ©initialiser votre mot de passe":s?"Connectez-vous pour accÃ©der Ã  votre compte":"CrÃ©ez votre compte pour rejoindre la communautÃ©"})]}),e.jsxs(V,{children:[M?e.jsxs("form",{onSubmit:ye,className:"space-y-4",children:[O?e.jsxs(W.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"rounded-lg bg-green-500/10 p-4 text-center",children:[e.jsxs("p",{className:"text-sm text-green-600 dark:text-green-400",children:["âœ“ Un email de rÃ©initialisation a Ã©tÃ© envoyÃ© Ã  ",w]}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:"VÃ©rifiez votre boÃ®te mail (et les spams)"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ta,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(je,{type:"email",placeholder:"Email",value:w,onChange:se=>I(se.target.value),className:"pl-10",disabled:a})]}),c.resetEmail&&e.jsx("p",{className:"text-xs text-destructive",children:c.resetEmail})]}),o&&e.jsxs(W.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"flex items-center gap-2 rounded-lg bg-destructive/10 p-3 text-sm text-destructive",children:[e.jsx(xs,{className:"h-4 w-4 shrink-0"}),o]}),e.jsx(T,{type:"submit",className:"w-full",disabled:a,children:a?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"mr-2 h-4 w-4 animate-spin"}),"Envoi en cours..."]}):"Envoyer le lien de rÃ©initialisation"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{type:"button",onClick:()=>{P(!1),I(""),N(!1),l(null),d({})},className:"text-sm text-muted-foreground hover:text-foreground",disabled:a,children:"â† Retour Ã  la connexion"})})]}):e.jsxs("form",{onSubmit:pe,className:"space-y-4",children:[e.jsx(nt,{mode:"wait",children:!s&&e.jsxs(W.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Vs,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(je,{type:"text",placeholder:"Pseudo",value:y,onChange:se=>j(se.target.value),className:"pl-10",disabled:a})]}),c.username&&e.jsx("p",{className:"text-xs text-destructive",children:c.username})]},"username")}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ta,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(je,{type:"email",placeholder:"Email",value:u,onChange:se=>h(se.target.value),className:"pl-10",disabled:a})]}),c.email&&e.jsx("p",{className:"text-xs text-destructive",children:c.email})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Qt,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(je,{type:r?"text":"password",placeholder:"Mot de passe",value:p,onChange:se=>f(se.target.value),className:"pl-10 pr-10",disabled:a}),e.jsx("button",{type:"button",onClick:()=>n(!r),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:r?e.jsx(li,{className:"h-4 w-4"}):e.jsx(Ns,{className:"h-4 w-4"})})]}),c.password&&e.jsx("p",{className:"text-xs text-destructive",children:c.password})]}),e.jsx(nt,{mode:"wait",children:!s&&e.jsxs(W.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Qt,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(je,{type:r?"text":"password",placeholder:"Confirmer le mot de passe",value:x,onChange:se=>g(se.target.value),className:"pl-10",disabled:a})]}),c.confirmPassword&&e.jsx("p",{className:"text-xs text-destructive",children:c.confirmPassword})]},"confirmPassword")}),e.jsx(nt,{children:o&&e.jsxs(W.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex items-center gap-2 rounded-lg bg-destructive/10 p-3 text-sm text-destructive",children:[e.jsx(xs,{className:"h-4 w-4 shrink-0"}),o]})}),e.jsx(T,{type:"submit",className:"w-full",disabled:a,children:a?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"mr-2 h-4 w-4 animate-spin"}),s?"Connexion...":"Inscription..."]}):e.jsx(e.Fragment,{children:s?"Se connecter":"S'inscrire"})}),s&&e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"button",onClick:()=>P(!0),className:"text-sm text-muted-foreground hover:text-primary hover:underline",disabled:a,children:"Mot de passe oubliÃ© ?"})})]}),!M&&e.jsxs("div",{className:"mt-6 text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s?"Pas encore de compte ?":"DÃ©jÃ  un compte ?"}),e.jsx("button",{type:"button",onClick:ge,className:"mt-1 text-sm font-medium text-primary hover:underline",disabled:a,children:s?"CrÃ©er un compte":"Se connecter"})]})]})]}),e.jsx(W.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},className:"mt-4 text-center",children:e.jsx("button",{onClick:()=>J("/"),className:"text-sm text-muted-foreground hover:text-foreground",children:"â† Retour Ã  l'accueil"})})]})]})},Ux=()=>{const s=Hs();return m.useEffect(()=>{b.error("404 Error: User attempted to access non-existent route:",s.pathname)},[s.pathname]),e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-muted",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"mb-4 text-4xl font-bold",children:"404"}),e.jsx("p",{className:"mb-4 text-xl text-muted-foreground",children:"Oops! Page not found"}),e.jsx("a",{href:"/",className:"text-primary underline hover:text-primary/90",children:"Return to Home"})]})})},qx=Ca({password:yt().min(6,"Le mot de passe doit contenir au moins 6 caractÃ¨res"),confirmPassword:yt()}).refine(s=>s.password===s.confirmPassword,{message:"Les mots de passe ne correspondent pas",path:["confirmPassword"]}),Vx=()=>{const{token:s}=pc(),t=ht(),[r,n]=m.useState(""),[a,i]=m.useState(""),[o,l]=m.useState(!1),[c,d]=m.useState(!1),[u,h]=m.useState(null),[p,f]=m.useState({}),[x,g]=m.useState(!1),y=async j=>{j.preventDefault(),h(null),f({});try{qx.parse({password:r,confirmPassword:a})}catch(M){if(M instanceof ut){const P={};M.errors.forEach(w=>{w.path[0]&&(P[w.path[0]]=w.message)}),f(P);return}}d(!0);try{const M=await fetch(`/api/auth/reset-password/${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:r})}),P=await M.json();if(!M.ok)throw new Error(P.error||"Une erreur est survenue");g(!0),setTimeout(()=>{t("/auth")},3e3)}catch(M){h(M instanceof Error?M.message:"Une erreur est survenue. Veuillez rÃ©essayer.")}finally{d(!1)}};return e.jsxs("div",{className:"flex min-h-screen items-center justify-center bg-background p-4",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[e.jsx("div",{className:"absolute left-1/4 top-1/4 h-64 w-64 rounded-full bg-primary/5 blur-3xl"}),e.jsx("div",{className:"absolute bottom-1/4 right-1/4 h-64 w-64 rounded-full bg-secondary/5 blur-3xl"})]}),e.jsxs(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative z-10 w-full max-w-md",children:[e.jsxs(W.div,{initial:{scale:.8},animate:{scale:1},className:"mb-8 text-center",children:[e.jsx(W.span,{animate:{rotate:[0,5,-5,0]},transition:{duration:2,repeat:1/0},className:"mb-4 inline-block text-6xl",children:"âš½"}),e.jsxs("h1",{className:"text-3xl font-bold text-foreground",children:["Baby-Foot ",e.jsx("span",{className:"text-primary text-glow-cyan",children:"App"})]})]}),e.jsxs(L,{className:"border-border/50 bg-card/80 backdrop-blur-xl",children:[e.jsxs(xe,{className:"text-center",children:[e.jsx(he,{className:"text-2xl",children:x?"Mot de passe modifiÃ© !":"Nouveau mot de passe"}),e.jsx(ba,{children:x?"Vous allez Ãªtre redirigÃ© vers la page de connexion":"Choisissez un nouveau mot de passe pour votre compte"})]}),e.jsx(V,{children:x?e.jsxs(W.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"space-y-4 text-center",children:[e.jsx("div",{className:"mx-auto flex h-16 w-16 items-center justify-center rounded-full bg-green-500/10",children:e.jsx(Gr,{className:"h-8 w-8 text-green-600 dark:text-green-400"})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Votre mot de passe a Ã©tÃ© rÃ©initialisÃ© avec succÃ¨s."}),e.jsx(T,{onClick:()=>t("/auth"),className:"w-full",children:"Se connecter maintenant"})]}):e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Qt,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(je,{type:o?"text":"password",placeholder:"Nouveau mot de passe",value:r,onChange:j=>n(j.target.value),className:"pl-10 pr-10",disabled:c}),e.jsx("button",{type:"button",onClick:()=>l(!o),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:o?e.jsx(li,{className:"h-4 w-4"}):e.jsx(Ns,{className:"h-4 w-4"})})]}),p.password&&e.jsx("p",{className:"text-xs text-destructive",children:p.password})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Qt,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(je,{type:o?"text":"password",placeholder:"Confirmer le mot de passe",value:a,onChange:j=>i(j.target.value),className:"pl-10",disabled:c})]}),p.confirmPassword&&e.jsx("p",{className:"text-xs text-destructive",children:p.confirmPassword})]}),u&&e.jsxs(W.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"flex items-center gap-2 rounded-lg bg-destructive/10 p-3 text-sm text-destructive",children:[e.jsx(xs,{className:"h-4 w-4 shrink-0"}),u]}),e.jsx(T,{type:"submit",className:"w-full",disabled:c,children:c?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"mr-2 h-4 w-4 animate-spin"}),"RÃ©initialisation..."]}):"RÃ©initialiser le mot de passe"})]})})]}),!x&&e.jsx(W.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},className:"mt-4 text-center",children:e.jsx("button",{onClick:()=>t("/auth"),className:"text-sm text-muted-foreground hover:text-foreground",children:"â† Retour Ã  la connexion"})})]})]})};async function pn(s,t={}){const{timeout:r=1e4,errorMessage:n="Une erreur est survenue",retries:a=1}=t;let i=null;for(let l=0;l<a;l++)try{return{data:await Promise.race([s(),new Promise((d,u)=>setTimeout(()=>u(new Error("Timeout")),r))]),error:null}}catch(c){if(i=c,logger.error(`Firebase query attempt ${l+1}/${a} failed:`,c),l<a-1){await new Promise(d=>setTimeout(d,1e3*(l+1)));continue}}let o=n;return i&&(i.message==="Timeout"?o="La requÃªte a pris trop de temps. VÃ©rifiez votre connexion.":i.code==="unavailable"||i.code==="network-request-failed"?o="Pas de connexion internet. VÃ©rifiez votre rÃ©seau.":i.code==="permission-denied"?o="Permission refusÃ©e. Vous n'avez pas accÃ¨s Ã  cette ressource.":i.code==="unauthenticated"?o="Vous devez Ãªtre connectÃ© pour effectuer cette action.":i.message&&(o=i.message)),{data:null,error:o}}const Gx=()=>{const{user:s,userProfile:t}=Ae(),r=ht(),[n,a]=m.useState([]),[i,o]=m.useState([]),[l,c]=m.useState(""),[d,u]=m.useState(!0),[h,p]=m.useState(!1),[f,x]=m.useState(0),[g,y]=m.useState(!1),[j,M]=m.useState([]),[P,w]=m.useState([]),[I,O]=m.useState({}),[N,R]=m.useState({}),[F,A]=m.useState(null),[B,_]=m.useState(0),[J,U]=m.useState(0);m.useEffect(()=>{pe(),X()},[s]);const X=async()=>{if(s)try{const D=S(k,`users/${s.uid}`),E=await z(D);E.exists()&&x(E.val().fortune||0)}catch(D){b.error("Erreur chargement fortune:",D)}},pe=async()=>{u(!0);try{const[D,E]=await Promise.all([pn(()=>bm(),{errorMessage:"Impossible de charger les matchs",retries:2}),pn(()=>mo(),{errorMessage:"Impossible de charger les joueurs",retries:2})]);if(D.error?$({title:"Erreur",description:D.error,variant:"destructive"}):D.data&&a(D.data),E.error)$({title:"Erreur",description:E.error,variant:"destructive"});else if(E.data){const Q=E.data.map(ae=>({id:ae.id,username:ae.username,eloRating:ae.eloGlobal}));o(Q)}}catch(D){$({title:"Erreur",description:D.message||"Impossible de charger les donnÃ©es",variant:"destructive"})}finally{u(!1)}},ge=async()=>{if(!s||j.length===0||P.length===0){$({title:"Erreur",description:"SÃ©lectionnez au moins 1 joueur par Ã©quipe",variant:"destructive"});return}p(!0);try{const D=await mm(j,P,s.uid),E=[...j,...P],Q=E.map(ae=>cr(ae,"âš½ Nouveau match disponible","Un nouveau match est ouvert aux paris. Tentez votre chance !").catch(C=>{b.error(`Erreur notification pour ${ae}:`,C)}));await Promise.allSettled(Q),$({title:"Match crÃ©Ã©! ðŸŽ®",description:`${E.length} joueur(s) notifiÃ©(s)`}),y(!1),M([]),w([]),pe()}catch(D){b.error("Erreur crÃ©ation match:",D),$({title:"Erreur",description:D.message||"Impossible de crÃ©er le match",variant:"destructive"})}finally{p(!1)}},ye=async(D,E)=>{if(!s||!t)return;const Q=I[D];if(!Q||Q<=0||!E){$({title:"Erreur",description:"Montant ou Ã©quipe invalide",variant:"destructive"});return}try{await xm(D,s.uid,t.username,Q,E),$({title:"Pari placÃ©! ðŸ’°",description:`${Q}â‚¬ sur l'Ã©quipe ${E}`}),pe(),X()}catch(ae){$({title:"Erreur",description:ae.message,variant:"destructive"})}},ee=async D=>{try{await hm(D),$({title:"Match dÃ©marrÃ©! âš½",description:"Les paris sont fermÃ©s"}),pe()}catch(E){$({title:"Erreur",description:E.message,variant:"destructive"})}},se=async()=>{if(F){if(B===J){$({title:"Erreur",description:"Match nul interdit",variant:"destructive"});return}try{const D=await pm(F,B,J);if(D.winnings&&Object.keys(D.winnings).length>0){const E=Object.entries(D.winnings).map(([C,q])=>{const Y=Math.abs(q),v=q>0;return _o(C,v,Y).catch(Z=>{b.error(`Erreur notification pour ${C}:`,Z)})});await Promise.allSettled(E);const Q=Object.values(D.winnings).filter(C=>C>0).length,ae=Object.keys(D.winnings).length-Q;$({title:"Match terminÃ©! ðŸ†",description:`${Q} gagnant(s), ${ae} perdant(s) notifiÃ©(s)`})}else $({title:"Match terminÃ©! ðŸ†",description:"Aucun pari n'a Ã©tÃ© placÃ©"});A(null),_(0),U(0),await pe(),await X()}catch(D){b.error("Erreur fin de match:",D),$({title:"Erreur",description:D.message||"Impossible de terminer le match",variant:"destructive"})}}},H=(D,E)=>{const Q=E===1?j:P,ae=E===1?P:j,C=E===1?M:w,q=E===1?w:M;ae.includes(D)&&q(ae.filter(Y=>Y!==D)),Q.includes(D)?C(Q.filter(Y=>Y!==D)):Q.length<2&&C([...Q,D])},fe=D=>{const E=D.totalBetsTeam1+D.totalBetsTeam2;if(E===0)return{odds1:"2.00",odds2:"2.00"};const Q=D.totalBetsTeam1===0?E:E/D.totalBetsTeam1,ae=D.totalBetsTeam2===0?E:E/D.totalBetsTeam2,C=Math.max(Q,1.1),q=Math.max(ae,1.1);return b.log(`ðŸ“Š [COTES] Ã‰quipe 1: brut=${Q.toFixed(2)}, final=${C.toFixed(2)}`),b.log(`ðŸ“Š [COTES] Ã‰quipe 2: brut=${ae.toFixed(2)}, final=${q.toFixed(2)}`),{odds1:C.toFixed(2),odds2:q.toFixed(2)}};return d?e.jsx($e,{children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(ue,{className:"h-8 w-8 animate-spin text-primary"})})}):e.jsxs($e,{children:[e.jsxs(W.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-4 sm:mb-6 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx(T,{variant:"ghost",size:"icon",onClick:()=>r("/match"),className:"rounded-xl",children:e.jsx(pr,{className:"h-4 w-4 sm:h-5 sm:w-5"})}),e.jsx("div",{className:"rounded-xl bg-primary/20 p-2 sm:p-3",children:e.jsx(Gt,{className:"h-5 w-5 sm:h-6 sm:w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg sm:text-2xl font-bold",children:"Paris"}),e.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground",children:[f.toLocaleString(),"â‚¬ disponibles"]})]})]}),e.jsxs(Ue,{open:g,onOpenChange:y,children:[e.jsx(dr,{asChild:!0,children:e.jsxs(T,{variant:"neon",children:[e.jsx(is,{className:"h-4 w-4 mr-2"}),"CrÃ©er Match"]})}),e.jsxs(Le,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Ie,{children:[e.jsx(De,{className:"text-lg sm:text-xl",children:"CrÃ©er un match avec paris"}),e.jsx(Ye,{children:"CrÃ©ez un match et permettez aux autres joueurs de parier sur le rÃ©sultat."})]}),e.jsxs("div",{className:"flex flex-col gap-3 sm:gap-4 mt-4",children:[e.jsx(je,{placeholder:"Rechercher un joueur",value:l,onChange:D=>c(D.target.value)}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"font-semibold text-primary",children:["Ã‰quipe 1 (",j.length,"/2)"]}),e.jsx("div",{className:"space-y-1 max-h-64 overflow-y-auto",children:i.filter(D=>D.username.toLowerCase().includes(l.toLowerCase())).map(D=>e.jsxs("div",{onClick:()=>H(D.id,1),className:`p-2 rounded cursor-pointer transition ${j.includes(D.id)?"bg-primary text-primary-foreground":"bg-surface-alt hover:bg-surface-alt/70"}`,children:[D.username," (",D.eloRating,")"]},D.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"font-semibold text-red-500",children:["Ã‰quipe 2 (",P.length,"/2)"]}),e.jsx("div",{className:"space-y-1 max-h-64 overflow-y-auto",children:i.filter(D=>D.username.toLowerCase().includes(l.toLowerCase())).map(D=>e.jsxs("div",{onClick:()=>H(D.id,2),className:`p-2 rounded cursor-pointer transition ${P.includes(D.id)?"bg-red-500 text-white":"bg-surface-alt hover:bg-surface-alt/70"}`,children:[D.username," (",D.eloRating,")"]},D.id))})]})]})]}),e.jsx(T,{onClick:ge,disabled:h||j.length===0||P.length===0,className:"w-full mt-4",variant:"neon",children:h?e.jsx(ue,{className:"h-4 w-4 animate-spin"}):"CrÃ©er"})]})]})]}),e.jsx("div",{className:"space-y-4",children:n.length===0?e.jsx(L,{children:e.jsx(V,{className:"p-8 text-center text-muted-foreground",children:"Aucun match disponible"})}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"border-primary/30 bg-primary/5",children:e.jsx(V,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"rounded-lg bg-primary/20 p-2",children:e.jsx(Oe,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-sm text-foreground mb-1",children:"ðŸ’¡ SystÃ¨me de cotes"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Distribution proportionnelle: vous rÃ©cupÃ©rez votre mise + votre part des pertes adverses. Plus l'Ã©quipe est favorite (plus de mises), plus la cote est basse. Pariez sur l'outsider pour des gains maximums !"})]})]})})}),n.map((D,E)=>{var C,q,Y;const Q=fe(D),ae=s?(C=D.bets)==null?void 0:C[s.uid]:null;return e.jsx(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:E*.1},children:e.jsxs(L,{children:[e.jsx(xe,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(he,{className:"text-lg flex items-center gap-2",children:[e.jsx(Pe,{className:"h-5 w-5 text-primary"}),((q=D.team1Names)==null?void 0:q.join(" & "))||"Ã‰quipe 1"," vs ",((Y=D.team2Names)==null?void 0:Y.join(" & "))||"Ã‰quipe 2"]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${D.status==="open"?"bg-green-500/20 text-green-500":D.status==="playing"?"bg-yellow-500/20 text-yellow-500":"bg-gray-500/20 text-gray-500"}`,children:D.status==="open"?"Paris ouverts":D.status==="playing"?"En cours":"TerminÃ©"})]})}),e.jsxs(V,{className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-primary/10",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ã‰quipe 1"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:[D.totalBetsTeam1,"â‚¬"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Cote: x",Q.odds1]})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-red-500/10",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ã‰quipe 2"}),e.jsxs("p",{className:"text-2xl font-bold text-red-500",children:[D.totalBetsTeam2,"â‚¬"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Cote: x",Q.odds2]})]})]}),ae&&e.jsx("div",{className:"p-3 rounded-lg bg-accent/10 border border-accent",children:e.jsxs("p",{className:"text-sm",children:["Votre pari: ",e.jsxs("span",{className:"font-bold",children:[ae.amount,"â‚¬"]})," sur"," ",e.jsxs("span",{className:"font-bold",children:["Ã‰quipe ",ae.teamBet]})]})}),D.status==="open"&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx(je,{type:"number",placeholder:"Montant (â‚¬)",value:I[D.id]||"",onChange:v=>O({...I,[D.id]:Number(v.target.value)}),className:"flex-1"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(T,{variant:N[D.id]===1?"default":"outline",onClick:()=>{R({...N,[D.id]:1}),ye(D.id,1)},className:"flex-1",children:"Ã‰quipe 1"}),e.jsx(T,{variant:N[D.id]===2?"destructive":"outline",onClick:()=>{R({...N,[D.id]:2}),ye(D.id,2)},className:"flex-1",children:"Ã‰quipe 2"})]})]}),D.status==="open"&&D.createdBy===(s==null?void 0:s.uid)&&e.jsxs(T,{onClick:()=>ee(D.id),variant:"neon",className:"w-full",children:[e.jsx(ri,{className:"h-4 w-4 mr-2"}),"DÃ©marrer le match"]}),D.status==="playing"&&D.createdBy===(s==null?void 0:s.uid)&&e.jsxs(Ue,{open:F===D.id,onOpenChange:v=>A(v?D.id:null),children:[e.jsx(dr,{asChild:!0,children:e.jsxs(T,{variant:"neon",className:"w-full",children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Terminer le match"]})}),e.jsxs(Le,{children:[e.jsxs(Ie,{children:[e.jsx(De,{children:"Entrer les scores"}),e.jsx(Ye,{children:"Entrez les scores finaux du match pour finaliser les paris."})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-primary",children:"Score Ã‰quipe 1"}),e.jsx(je,{type:"number",value:B,onChange:v=>_(Number(v.target.value)),min:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-red-500",children:"Score Ã‰quipe 2"}),e.jsx(je,{type:"number",value:J,onChange:v=>U(Number(v.target.value)),min:"0"})]})]}),e.jsx(T,{onClick:se,variant:"neon",className:"w-full mt-4",children:"Valider"})]})]})]})]})},D.id)})]})})]})},Nr=m.forwardRef(({className:s,...t},r)=>e.jsx("textarea",{className:me("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:r,...t}));Nr.displayName="Textarea";const Hx=({cardCode:s,cardName:t,className:r})=>{const[n,a]=m.useState(!1),[i,o]=m.useState("season1");m.useEffect(()=>{(async()=>{const{getCardByCode:d}=await rt(async()=>{const{getCardByCode:h}=await Promise.resolve().then(()=>Zs);return{getCardByCode:h}},void 0),u=d(s);u&&o(u.season)})()},[s]);const l=`/images/cards/${i}/${t}`;return n?e.jsx("div",{className:me("flex items-center justify-center bg-muted/50 rounded-lg",r),children:e.jsxs("div",{className:"text-center p-4",children:[e.jsx(oc,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Image indisponible"})]})}):e.jsx("div",{className:me("relative overflow-hidden rounded-lg",r),children:e.jsx("img",{src:l,alt:t,className:"w-full h-full object-cover",onError:()=>{a(!0)},loading:"lazy"})})},Zx=()=>{const{user:s}=Ae(),[t,r]=m.useState([]),[n,a]=m.useState("all"),[i,o]=m.useState(""),[l,c]=m.useState(""),[d,u]=m.useState("recent"),[h,p]=m.useState(!1),[f,x]=m.useState(null),[g,y]=m.useState(""),[j,M]=m.useState(null),[P,w]=m.useState(""),[I,O]=m.useState(""),[N,R]=m.useState(!1),[F,A]=m.useState({}),B=async()=>{p(!0);try{const ee=await Rm();r(ee);const H=[...new Set(ee.map(E=>E.cardCode))].map(async E=>{const Q=await wr(E);return{code:E,stats:Q}}),fe=await Promise.all(H),D={};fe.forEach(({code:E,stats:Q})=>{Q&&(D[E]=Q)}),A(D)}catch(ee){b.error("âŒ Erreur chargement marchÃ©:",ee),$({title:"Erreur",description:"Impossible de charger les annonces du marchÃ©.",variant:"destructive"})}finally{p(!1)}};m.useEffect(()=>{B()},[]);const _=m.useMemo(()=>{let ee=t.filter(se=>{if(n==="mine"&&se.sellerId!==(s==null?void 0:s.uid)||n==="others"&&se.sellerId===(s==null?void 0:s.uid))return!1;const H=i?se.price>=Number(i):!0,fe=l?se.price<=Number(l):!0,D=g?se.cardCode.toLowerCase().includes(g.toLowerCase())||se.cardName.toLowerCase().includes(g.toLowerCase()):!0;return H&&fe&&D});switch(d){case"price-low":ee.sort((se,H)=>se.price-H.price);break;case"price-high":ee.sort((se,H)=>H.price-se.price);break;case"popular":ee.sort((se,H)=>(H.views||0)-(se.views||0));break;case"recent":default:ee.sort((se,H)=>H.createdAt-se.createdAt);break}return ee},[t,n,i,l,g,d,s==null?void 0:s.uid]),J=async ee=>{if(s){x(ee);try{await Mm(s.uid,ee),$({title:"Achat rÃ©ussi âœ…",description:"La carte a Ã©tÃ© ajoutÃ©e Ã  votre collection."}),await B()}catch(se){$({title:"Erreur",description:se.message||"Impossible d'acheter cette carte.",variant:"destructive"})}finally{x(null)}}},U=async ee=>{if(s){x(ee);try{await Am(s.uid,ee),$({title:"Annonce annulÃ©e",description:"La carte a Ã©tÃ© remise dans votre collection."}),await B()}catch(se){$({title:"Erreur",description:se.message||"Impossible d'annuler cette annonce.",variant:"destructive"})}finally{x(null)}}},X=async ee=>{M(ee),R(!0),await $m(ee.id);const se=await Pm(ee.cardCode);w(se.toString())},pe=async()=>{if(!s||!j)return;const ee=Number(P);if(isNaN(ee)||ee<=0){$({title:"Erreur",description:"Montant invalide",variant:"destructive"});return}try{await Tm(s.uid,j.id,ee,I),$({title:"Offre envoyÃ©e âœ…",description:"Le vendeur a Ã©tÃ© notifiÃ© de votre offre."}),R(!1),w(""),O(""),await B()}catch(se){$({title:"Erreur",description:se.message||"Impossible d'envoyer l'offre.",variant:"destructive"})}},ge=(ee,se)=>{const H=F[se];if(!H)return null;const fe=H.averagePrice,D=(ee-fe)/fe*100;return{percentage:Math.abs(D).toFixed(1),isHigher:D>0,isGoodDeal:D<-10}},ye=ee=>{const se=Math.floor((Date.now()-ee)/1e3);if(se<60)return`${se}s`;const H=Math.floor(se/60);if(H<60)return`${H}min`;const fe=Math.floor(H/60);return fe<24?`${fe}h`:`${Math.floor(fe/24)}j`};return e.jsxs($e,{children:[e.jsxs("div",{className:"container mx-auto max-w-6xl p-4",children:[e.jsxs("div",{className:"mb-6 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(Gt,{className:"h-7 w-7 text-yellow-400"}),"MarchÃ© des Cartes"]}),e.jsx("p",{className:"mt-1 text-muted-foreground text-sm",children:"Achetez et vendez vos cartes BabyDex entre joueurs."})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(T,{variant:"outline",size:"icon",onClick:B,disabled:h,children:e.jsx(ci,{className:`h-4 w-4 ${h?"animate-spin":""}`})})})]}),e.jsxs(L,{className:"mb-6",children:[e.jsx(xe,{children:e.jsxs(he,{className:"flex items-center gap-2 text-sm",children:[e.jsx(gr,{className:"h-4 w-4"}),"Filtres et Tri"]})}),e.jsxs(V,{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(lt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(je,{placeholder:"Rechercher par nom ou code (ex: Lilwenn, N831)",value:g,onChange:ee=>y(ee.target.value),className:"pl-10"})]}),g&&e.jsx(T,{variant:"ghost",size:"icon",onClick:()=>y(""),className:"shrink-0",children:e.jsx(ir,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(T,{size:"sm",variant:n==="all"?"default":"outline",onClick:()=>a("all"),children:"Tout"}),e.jsx(T,{size:"sm",variant:n==="mine"?"default":"outline",onClick:()=>a("mine"),children:"Mes annonces"}),e.jsx(T,{size:"sm",variant:n==="others"?"default":"outline",onClick:()=>a("others"),children:"Annonces des autres"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(je,{placeholder:"Prix min (â‚¬)",type:"number",value:i,onChange:ee=>o(ee.target.value),className:"w-32 text-xs"}),e.jsx(je,{placeholder:"Prix max (â‚¬)",type:"number",value:l,onChange:ee=>c(ee.target.value),className:"w-32 text-xs"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground self-center",children:"Trier par:"}),e.jsx(T,{size:"sm",variant:d==="recent"?"default":"outline",onClick:()=>u("recent"),children:"RÃ©cents"}),e.jsx(T,{size:"sm",variant:d==="price-low"?"default":"outline",onClick:()=>u("price-low"),children:"Prix â†‘"}),e.jsx(T,{size:"sm",variant:d==="price-high"?"default":"outline",onClick:()=>u("price-high"),children:"Prix â†“"}),e.jsx(T,{size:"sm",variant:d==="popular"?"default":"outline",onClick:()=>u("popular"),children:"Populaires"})]})]})]}),h?e.jsxs("div",{className:"flex justify-center py-12 text-muted-foreground text-sm",children:[e.jsx(ue,{className:"h-6 w-6 animate-spin mr-2"}),"Chargement des annonces..."]}):_.length===0?e.jsx(L,{children:e.jsx(V,{className:"py-12 text-center text-muted-foreground text-sm",children:"Aucune annonce disponible pour le moment."})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:_.map(ee=>{const se=ee.sellerId===(s==null?void 0:s.uid),H=ge(ee.price,ee.cardCode);return e.jsx(W.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:e.jsxs(L,{className:"h-full flex flex-col relative overflow-hidden",children:[(H==null?void 0:H.isGoodDeal)&&e.jsxs(le,{className:"absolute top-2 right-2 bg-green-500 text-white gap-1 z-10",children:[e.jsx(er,{className:"h-3 w-3"}),"Bon Deal"]}),e.jsx("div",{className:"relative h-48 bg-muted",children:e.jsx(Hx,{cardCode:ee.cardCode,cardName:ee.cardName,className:"h-full w-full"})}),e.jsx(xe,{className:"pb-2",children:e.jsxs(he,{className:"text-sm flex items-center justify-between gap-2",children:[e.jsx("span",{className:"truncate",children:ee.cardName.replace(/\.(png|jpg|gif)$/i,"")}),e.jsx(le,{variant:"outline",className:"text-xs uppercase shrink-0",children:ee.rarity})]})}),e.jsxs(V,{className:"flex-1 flex flex-col justify-between space-y-3 text-xs",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Code"}),e.jsx("span",{className:"font-mono text-primary",children:ee.cardCode})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Prix"}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsxs("span",{className:"font-semibold text-foreground text-base",children:[ee.price,"â‚¬"]}),H&&e.jsxs("span",{className:`text-[10px] flex items-center gap-1 ${H.isHigher?"text-red-500":"text-green-500"}`,children:[H.isHigher?e.jsx(Oe,{className:"h-3 w-3"}):e.jsx(us,{className:"h-3 w-3"}),H.isHigher?"+":"-",H.percentage,"% vs moy."]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Vendeur"}),e.jsx("span",{className:"text-[11px] text-muted-foreground",children:se?"Vous":ee.sellerId.slice(0,8)+"..."})]}),e.jsxs("div",{className:"flex items-center justify-between pt-1 border-t",children:[e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(Ns,{className:"h-3 w-3"}),e.jsx("span",{children:ee.views||0})]}),e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(Fs,{className:"h-3 w-3"}),e.jsx("span",{children:ee.offersCount||0})]}),e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(it,{className:"h-3 w-3"}),e.jsx("span",{children:ye(ee.createdAt)})]})]})]}),e.jsx("div",{className:"flex gap-2 pt-2",children:se?e.jsxs(T,{size:"sm",variant:"outline",className:"flex-1 text-xs",onClick:()=>U(ee.id),disabled:f===ee.id,children:[e.jsx(ir,{className:"h-4 w-4 mr-1"}),f===ee.id?"Annulation...":"Annuler"]}):e.jsxs(e.Fragment,{children:[e.jsxs(T,{size:"sm",className:"flex-1 text-xs",onClick:()=>J(ee.id),disabled:f===ee.id,children:[e.jsx(ic,{className:"h-4 w-4 mr-1"}),f===ee.id?"Achat...":"Acheter"]}),e.jsx(T,{size:"sm",variant:"outline",className:"text-xs",onClick:()=>X(ee),children:e.jsx(Fs,{className:"h-4 w-4"})})]})})]})]})},ee.id)})})]}),e.jsx(Ue,{open:N,onOpenChange:R,children:e.jsxs(Le,{children:[e.jsxs(Ie,{children:[e.jsx(De,{children:"Faire une offre"}),e.jsxs(Ye,{children:["Proposez un prix pour ",j==null?void 0:j.cardName]})]}),e.jsxs("div",{className:"space-y-4",children:[j&&F[j.cardCode]&&e.jsxs("div",{className:"bg-muted p-3 rounded-lg space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(Zt,{className:"h-4 w-4"}),e.jsx("span",{className:"font-semibold",children:"Statistiques de marchÃ©"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Prix demandÃ©:"}),e.jsxs("span",{className:"font-semibold",children:[j.price,"â‚¬"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Prix moyen:"}),e.jsxs("span",{className:"font-semibold",children:[F[j.cardCode].averagePrice.toFixed(2),"â‚¬"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"DerniÃ¨re vente:"}),e.jsxs("span",{className:"font-semibold",children:[F[j.cardCode].lastSalePrice||"N/A","â‚¬"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Votre offre (â‚¬)"}),e.jsx(je,{type:"number",placeholder:"Montant",value:P,onChange:ee=>w(ee.target.value)}),P&&j&&e.jsxs("p",{className:"mt-2 text-xs",children:[Number(P)<j.price*.7&&e.jsx("span",{className:"text-destructive",children:"âš ï¸ Offre trÃ¨s basse, risque de rejet"}),Number(P)>=j.price*.7&&Number(P)<j.price*.9&&e.jsx("span",{className:"text-yellow-600",children:"ðŸ’¡ Offre raisonnable"}),Number(P)>=j.price*.9&&e.jsx("span",{className:"text-green-600",children:"âœ“ Offre trÃ¨s compÃ©titive"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Message (optionnel)"}),e.jsx(Nr,{placeholder:"Ajoutez un message au vendeur...",value:I,onChange:ee=>O(ee.target.value),rows:3})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(T,{variant:"outline",onClick:()=>R(!1),className:"flex-1",children:"Annuler"}),e.jsx(T,{onClick:pe,className:"flex-1",children:"Envoyer l'offre"})]})]})]})})]})},Wx={common:{label:"Commun",color:"bg-gray-500",textColor:"text-gray-400",borderColor:"border-gray-500/50",bgGlow:"bg-gray-500/10"},rare:{label:"Rare",color:"bg-blue-500",textColor:"text-blue-400",borderColor:"border-blue-500/50",bgGlow:"bg-blue-500/10"},epic:{label:"Ã‰pique",color:"bg-purple-500",textColor:"text-purple-400",borderColor:"border-purple-500/50",bgGlow:"bg-purple-500/10"},legendary:{label:"LÃ©gendaire",color:"bg-orange-500",textColor:"text-orange-400",borderColor:"border-orange-500/50",bgGlow:"bg-orange-500/10"},mythic:{label:"Mythique",color:"bg-gradient-to-r from-pink-500 via-purple-500 to-cyan-500",textColor:"text-transparent bg-clip-text bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400",borderColor:"border-pink-500/50",bgGlow:"bg-gradient-to-br from-pink-500/10 via-purple-500/10 to-cyan-500/10"}},Dr={all:{label:"Tout",icon:$t},avatar:{label:"Avatars",icon:ms},theme:{label:"ThÃ¨mes",icon:Pt},banner:{label:"BanniÃ¨res",icon:Oe},title:{label:"Titres",icon:Ht},effect:{label:"Effets",icon:jt},lootbox:{label:"Lootboxes",icon:dt}},Qx=()=>{const{user:s}=Ae(),[t,r]=m.useState(0),[n,a]=m.useState({}),[i,o]=m.useState({avatar:"",theme:"",banner:"",title:"",effect:""}),[l,c]=m.useState(!1),[d,u]=m.useState("all"),[h,p]=m.useState(""),[f,x]=m.useState("price-asc"),[g,y]=m.useState(!1);m.useEffect(()=>{window.scrollTo({top:0,behavior:"auto"})},[]),m.useEffect(()=>{if(!s)return;const N=S(k,`users/${s.uid}`),R=et(N,F=>{try{if(F.exists()){const A=F.val();r(A.fortune||0),a(A.inventory||{}),o({avatar:A.avatar||A.equippedAvatar||"",theme:A.theme||A.equippedTheme||"",banner:A.banner||A.equippedBanner||"",title:A.title||A.equippedTitle||"",effect:A.effect||A.equippedEffect||""}),b.log("âœ… [Shop] Fortune mise Ã  jour en temps rÃ©el:",A.fortune||0)}}catch(A){b.error("Erreur chargement donnÃ©es:",A)}});return()=>R()},[s]);const j=qe.filter(N=>{const R=d==="all"||N.type===d,F=h===""||N.name.toLowerCase().includes(h.toLowerCase())||N.description.toLowerCase().includes(h.toLowerCase());return R&&F}).sort((N,R)=>{if(f==="price-asc")return N.price-R.price;if(f==="price-desc")return R.price-N.price;if(f==="rarity"){const F={common:0,rare:1,epic:2,legendary:3,mythic:4};return F[R.rarity||"common"]-F[N.rarity||"common"]}return 0}),M=async N=>{if(s){if(t<N.price){$({title:"Fonds insuffisants ðŸ’¸",description:`Il vous faut ${N.price}â‚¬ (vous avez ${t}â‚¬)`,variant:"destructive"});return}if(N.type==="lootbox"){c(!0);try{await ro(s.uid,N.id,N.price);const R=S(k,`users/${s.uid}`),F=await z(R);if(F.exists()){const A=F.val();r(A.fortune||0),a(A.inventory||{})}$({title:"ðŸŽ Lootbox achetÃ©e!",description:`${N.name} a Ã©tÃ© ajoutÃ©e Ã  votre inventaire`})}catch(R){$({title:"Erreur",description:R.message,variant:"destructive"})}finally{c(!1)}return}if(w(N)){$({title:"DÃ©jÃ  possÃ©dÃ©",description:"Vous possÃ©dez dÃ©jÃ  cet item",variant:"destructive"});return}c(!0);try{await no(s.uid,N.id,N.type,N.price);const R=S(k,`users/${s.uid}`),F=await z(R);if(F.exists()){const A=F.val();r(A.fortune||0),a(A.inventory||{}),o({avatar:A.avatar||"",theme:A.theme||"",banner:A.banner||"",title:A.title||"",effect:A.effect||""})}$({title:"Achat rÃ©ussi! ðŸŽ‰",description:`${N.name} a Ã©tÃ© ajoutÃ© Ã  votre inventaire`}),N.type==="theme"&&Object.keys(n.theme||{}).length===0&&setTimeout(()=>window.location.reload(),1500)}catch(R){$({title:"Erreur",description:R.message,variant:"destructive"})}finally{c(!1)}}},P=async N=>{if(s){if(!w(N)){$({title:"Item non possÃ©dÃ©",description:"Vous devez d'abord acheter cet item",variant:"destructive"});return}c(!0);try{await ja(s.uid,N.id,N.type),o(R=>({...R,[N.type]:N.id})),$({title:"Ã‰quipÃ©! âœ…",description:`${N.name} est maintenant actif`}),N.type==="theme"&&setTimeout(()=>{window.location.reload()},1e3)}catch(R){$({title:"Erreur",description:R.message,variant:"destructive"})}finally{c(!1)}}},w=N=>N.type==="lootbox"?!1:n[N.type]&&typeof n[N.type]=="object"?!!n[N.type][N.id]:!!n[N.id],I=N=>n.lootbox&&n.lootbox[N]?n.lootbox[N]:n[N]?n[N]:0,O={total:qe.filter(N=>N.type!=="lootbox").length,owned:qe.filter(N=>N.type!=="lootbox"&&w(N)).length,affordable:j.filter(N=>t>=N.price).length};return e.jsx($e,{children:e.jsxs(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-foreground flex items-center gap-2",children:[e.jsx($t,{className:"h-8 w-8 text-primary"}),"Boutique Premium"]}),e.jsx("p",{className:"mt-1 text-muted-foreground",children:"Personnalisez votre expÃ©rience de jeu"})]}),e.jsxs(L,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Votre fortune"}),e.jsxs("p",{className:"text-3xl font-bold text-primary",children:[t,"â‚¬"]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[O.affordable," item(s) disponible(s)"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx(L,{className:"bg-gradient-to-br from-primary/10 to-transparent border-primary/20",children:e.jsxs(V,{className:"p-4 flex items-center gap-3",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-primary/20 flex items-center justify-center",children:e.jsx($t,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold",children:[O.owned,"/",O.total]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Items possÃ©dÃ©s"})]})]})}),e.jsx(L,{className:"bg-gradient-to-br from-green-500/10 to-transparent border-green-500/20",children:e.jsxs(V,{className:"p-4 flex items-center gap-3",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-green-500/20 flex items-center justify-center",children:e.jsx(at,{className:"h-6 w-6 text-green-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:O.affordable}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ã€ votre portÃ©e"})]})]})}),e.jsx(L,{className:"bg-gradient-to-br from-orange-500/10 to-transparent border-orange-500/20",children:e.jsxs(V,{className:"p-4 flex items-center gap-3",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-orange-500/20 flex items-center justify-center",children:e.jsx(ms,{className:"h-6 w-6 text-orange-500"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold",children:[Math.round(O.owned/O.total*100),"%"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Collection"})]})]})})]}),e.jsx(L,{className:"mb-6",children:e.jsxs(V,{className:"p-4",children:[e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(lt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(je,{placeholder:"Rechercher un item...",value:h,onChange:N=>p(N.target.value),className:"pl-10"}),h&&e.jsx(T,{variant:"ghost",size:"sm",className:"absolute right-1 top-1/2 transform -translate-y-1/2 h-7 w-7 p-0",onClick:()=>p(""),children:e.jsx(Fe,{className:"h-4 w-4"})})]}),e.jsx(T,{variant:"outline",size:"icon",onClick:()=>y(!g),children:e.jsx(gr,{className:"h-4 w-4"})})]}),e.jsx(nt,{children:g&&e.jsx(W.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsxs("div",{className:"pt-4 border-t space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"CatÃ©gories"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.keys(Dr).map(N=>{const R=Dr[N].icon;return e.jsxs(T,{variant:d===N?"default":"outline",size:"sm",onClick:()=>u(N),children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),Dr[N].label]},N)})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Trier par"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(T,{variant:f==="price-asc"?"default":"outline",size:"sm",onClick:()=>x("price-asc"),children:"Prix â†‘"}),e.jsx(T,{variant:f==="price-desc"?"default":"outline",size:"sm",onClick:()=>x("price-desc"),children:"Prix â†“"}),e.jsx(T,{variant:f==="rarity"?"default":"outline",size:"sm",onClick:()=>x("rarity"),children:"RaretÃ©"})]})]})]})})})]})}),j.length===0?e.jsx(L,{children:e.jsxs(V,{className:"p-12 text-center",children:[e.jsx($t,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium text-muted-foreground",children:"Aucun item trouvÃ©"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Essayez de modifier vos filtres ou votre recherche"})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:j.map((N,R)=>{const F=w(N),A=i[N.type]===N.id,B=t>=N.price,_=Wx[N.rarity||"common"],J=N.type==="lootbox"?I(N.id):0;return e.jsx(W.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:R*.05},whileHover:{scale:1.03,y:-5},children:e.jsxs(L,{className:`relative overflow-hidden h-full transition-all ${A?`border-2 ${_.borderColor} shadow-lg`:"border-border hover:border-primary/50"} ${_.bgGlow}`,children:[e.jsx("div",{className:`absolute top-2 right-2 px-2 py-1 rounded-full text-xs font-bold text-white ${_.color} shadow-lg z-10`,children:_.label}),A&&e.jsxs("div",{className:"absolute top-2 left-2 px-2 py-1 rounded-full text-xs font-bold bg-primary text-primary-foreground shadow-lg z-10 flex items-center gap-1",children:[e.jsx(at,{className:"h-3 w-3"}),"Ã‰quipÃ©"]}),J>0&&e.jsx("div",{className:"absolute top-2 left-2 bg-orange-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold text-sm z-10 shadow-lg",children:J}),e.jsxs(xe,{className:"pb-3",children:[e.jsx("div",{className:"flex items-center justify-center h-24 text-6xl mb-2",children:N.type==="theme"&&N.preview?e.jsx("div",{className:"w-20 h-20 rounded-lg shadow-xl border-2 border-white/20",style:{backgroundColor:N.preview}}):N.type==="banner"&&N.preview?e.jsx("div",{className:"w-full h-16 rounded-lg shadow-xl border-2 border-white/20 relative overflow-hidden",style:{background:N.preview},children:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:N.icon})})}):N.type==="title"&&N.preview?e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("span",{className:"text-4xl",children:N.icon}),e.jsx("span",{className:"text-xs font-bold text-primary",children:N.preview})]}):e.jsx("span",{children:N.icon||"ðŸŽ"})}),e.jsx(he,{className:"text-center text-lg",children:N.name}),e.jsx("p",{className:"text-sm text-muted-foreground text-center line-clamp-2",children:N.description})]}),e.jsxs(V,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("span",{className:`text-2xl font-bold ${_.textColor}`,children:[N.price,"â‚¬"]}),N.type!=="lootbox"&&e.jsx(le,{variant:F?"default":"outline",children:F?"PossÃ©dÃ©":"Non possÃ©dÃ©"})]}),N.type==="lootbox"?e.jsx(T,{className:"w-full",onClick:()=>M(N),disabled:!B||l,variant:B?"default":"secondary",children:B?e.jsxs(e.Fragment,{children:[e.jsx(dt,{className:"h-4 w-4 mr-2"}),"Acheter"]}):e.jsxs(e.Fragment,{children:[e.jsx(Qt,{className:"h-4 w-4 mr-2"}),"Fonds insuffisants"]})}):F?A?e.jsxs(T,{className:"w-full",variant:"outline",disabled:!0,children:[e.jsx(at,{className:"h-4 w-4 mr-2"}),"Ã‰quipÃ©"]}):e.jsxs(T,{className:"w-full",onClick:()=>P(N),disabled:l,children:[e.jsx(Pt,{className:"h-4 w-4 mr-2"}),"Ã‰quiper"]}):e.jsx(T,{className:"w-full",onClick:()=>M(N),disabled:!B||l,variant:B?"default":"secondary",children:B?e.jsxs(e.Fragment,{children:[e.jsx($t,{className:"h-4 w-4 mr-2"}),"Acheter"]}):e.jsxs(e.Fragment,{children:[e.jsx(Qt,{className:"h-4 w-4 mr-2"}),"Fonds insuffisants"]})})]})]})},N.id)})})]})})},Jx=Ll,Yx=Ol,Lo=m.forwardRef(({className:s,...t},r)=>e.jsx(Bn,{className:me("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...t,ref:r}));Lo.displayName=Bn.displayName;const Io=m.forwardRef(({className:s,...t},r)=>e.jsxs(Yx,{children:[e.jsx(Lo,{}),e.jsx(Un,{ref:r,className:me("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...t})]}));Io.displayName=Un.displayName;const Do=({className:s,...t})=>e.jsx("div",{className:me("flex flex-col space-y-2 text-center sm:text-left",s),...t});Do.displayName="AlertDialogHeader";const Fo=({className:s,...t})=>e.jsx("div",{className:me("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t});Fo.displayName="AlertDialogFooter";const zo=m.forwardRef(({className:s,...t},r)=>e.jsx(qn,{ref:r,className:me("text-lg font-semibold",s),...t}));zo.displayName=qn.displayName;const Bo=m.forwardRef(({className:s,...t},r)=>e.jsx(Vn,{ref:r,className:me("text-sm text-muted-foreground",s),...t}));Bo.displayName=Vn.displayName;const Uo=m.forwardRef(({className:s,...t},r)=>e.jsx(Gn,{ref:r,className:me(ga(),s),...t}));Uo.displayName=Gn.displayName;const qo=m.forwardRef(({className:s,...t},r)=>e.jsx(Hn,{ref:r,className:me(ga({variant:"outline"}),"mt-2 sm:mt-0",s),...t}));qo.displayName=Hn.displayName;function Kx({open:s,onOpenChange:t,title:r,description:n,confirmText:a="Confirmer",cancelText:i="Annuler",onConfirm:o,variant:l="default"}){const c=()=>{o(),t(!1)};return e.jsx(Jx,{open:s,onOpenChange:t,children:e.jsxs(Io,{children:[e.jsxs(Do,{children:[e.jsx(zo,{children:r}),e.jsx(Bo,{children:n})]}),e.jsxs(Fo,{children:[e.jsx(qo,{children:i}),e.jsx(Uo,{onClick:c,className:l==="destructive"?"bg-destructive text-destructive-foreground hover:bg-destructive/90":"",children:a})]})]})})}const Fr=["âš½","ðŸ†","ðŸ”¥","âš¡","ðŸŽ¯","ðŸŒŸ","ðŸ’Ž","ðŸ‘‘"],zr=["#3b82f6","#8b5cf6","#ec4899","#f59e0b","#10b981","#06b6d4"],gn=[{id:"xpBoost",name:"Boost XP",description:"+20% d'ELO gagnÃ©",cost:500,icon:"ðŸ“ˆ"},{id:"fortuneBoost",name:"Boost Fortune",description:"+15% de gains",cost:750,icon:"ðŸ’°"},{id:"premiumCards",name:"Cartes Premium",description:"Double chance de cartes rares",cost:1e3,icon:"ðŸŽ´"}],Xx=()=>{const{user:s,userProfile:t}=Ae(),[r,n]=m.useState(!1),[a,i]=m.useState(!1),[o,l]=m.useState(!1),[c,d]=m.useState(!1),[u,h]=m.useState(null),[p,f]=m.useState([]),[x,g]=m.useState(0),[y,j]=m.useState([]),[M,P]=m.useState(""),[w,I]=m.useState(!1),[O,N]=m.useState(!0),[R,F]=m.useState(""),[A,B]=m.useState(Fr[0]),[_,J]=m.useState(zr[0]),[U,X]=m.useState("");m.useEffect(()=>{if(!s){N(!1);return}let E=null;const Q=S(k,`users/${s.uid}`),ae=et(Q,C=>{if(!C.exists()){N(!1);return}const q=C.val();g(q.fortune||0),E&&(E(),E=null),q.clubId?E=Xi(q.clubId,Y=>{if(Y){h(Y);const v=Y.members&&typeof Y.members=="object"?Object.values(Y.members):[];f(v)}else h(null),f([]);N(!1)}):(h(null),f([]),N(!1))},C=>{b.error("Erreur chargement donnÃ©es utilisateur:",C),N(!1)});return()=>{ae(),E&&E()}},[s]);const pe=async()=>{I(!0);try{const E=S(k,"clubs"),Q=await z(E);if(!Q.exists()){j([]),I(!1);return}const ae=Q.val(),C=Object.entries(ae).map(([Y,v])=>({id:Y,name:v.name||"Club sans nom",logo:v.logo||"ðŸ†",color:v.color||"#3b82f6",founderId:v.founderId||"",treasury:v.treasury||0,totalEarnings:v.totalEarnings||0,members:v.members||{},bonuses:v.bonuses||{},createdAt:v.createdAt||Date.now()}));let q=C;M.trim()&&(q=C.filter(Y=>Y.name.toLowerCase().includes(M.toLowerCase()))),j(q)}catch(E){b.error("Erreur chargement clubs:",E),$({title:"Erreur",description:"Impossible de charger les clubs",variant:"destructive"})}finally{I(!1)}};m.useEffect(()=>{a&&pe()},[a,M]);const ge=async()=>{if(!(!s||!t)){if(!R.trim()){$({title:"Erreur",description:"Veuillez entrer un nom de club",variant:"destructive"});return}try{const E=await Wi(s.uid,t.username,R,A,_);await cr(s.uid,"ðŸ† Club crÃ©Ã© avec succÃ¨s",`Votre club "${R}" est maintenant actif. Invitez des membres !`).catch(Q=>{b.error("Erreur notification crÃ©ation:",Q)}),$({title:"Club crÃ©Ã©! ðŸŽ‰",description:`${R} a Ã©tÃ© crÃ©Ã© avec succÃ¨s`}),n(!1),F(""),B(Fr[0]),J(zr[0])}catch(E){b.error("Erreur crÃ©ation club:",E),$({title:"Erreur",description:E.message||"Impossible de crÃ©er le club",variant:"destructive"})}}},ye=async(E,Q)=>{if(!s||!t){$({title:"Erreur",description:"Vous devez Ãªtre connectÃ©",variant:"destructive"});return}try{const ae=S(k,`clubs/${E}`);if(!(await z(ae)).exists()){$({title:"Erreur",description:"Ce club n'existe plus",variant:"destructive"}),await pe();return}const q=S(k,`users/${s.uid}`),Y=await z(q);if(Y.exists()&&Y.val().clubId){$({title:"Erreur",description:"Vous Ãªtes dÃ©jÃ  dans un club. Quittez-le d'abord.",variant:"destructive"});return}await Qi(E,s.uid,t.username),$({title:"Club rejoint! ðŸŽ‰",description:`Vous avez rejoint ${Q}`}),i(!1),P("")}catch(ae){b.error("Erreur rejoindre club:",ae),$({title:"Erreur",description:ae.message||"Impossible de rejoindre le club",variant:"destructive"})}},ee=async()=>{if(!(!s||!u)){if(u.founderId===s.uid){$({title:"Action impossible",description:"Le fondateur ne peut pas quitter le club",variant:"destructive"});return}d(!0)}},se=async()=>{if(!(!s||!u))try{await Ki(u.id,s.uid),$({title:"Club quittÃ©",description:"Vous avez quittÃ© le club avec succÃ¨s"})}catch(E){b.error("Erreur quitter club:",E),$({title:"Erreur",description:E.message||"Impossible de quitter le club",variant:"destructive"})}},H=async()=>{if(!s||!u)return;const E=parseInt(U);if(isNaN(E)||E<=0){$({title:"Erreur",description:"Montant invalide",variant:"destructive"});return}if(E>x){$({title:"Erreur",description:"Fonds insuffisants",variant:"destructive"});return}try{await Ji(s.uid,u.id,E),$({title:"Contribution ajoutÃ©e! ðŸ’°",description:`${E}â‚¬ ajoutÃ©s Ã  la trÃ©sorerie`}),l(!1),X("")}catch(Q){b.error("Erreur contribution:",Q),$({title:"Erreur",description:Q.message||"Impossible de contribuer",variant:"destructive"})}},fe=async(E,Q)=>{var ae;if(!(!u||!s)){if((u.treasury||0)<Q){$({title:"Fonds insuffisants",description:"La trÃ©sorerie du club est insuffisante",variant:"destructive"});return}try{if(await Yi(u.id,E,Q),u.members){const C=((ae=gn.find(v=>v.id===E))==null?void 0:ae.name)||"Bonus",q=Object.keys(u.members),Y=q.map(v=>cr(v,"ðŸŽ Nouveau bonus de club",`Le bonus "${C}" est maintenant actif pour tous les membres !`).catch(Z=>{b.error(`Erreur notification pour ${v}:`,Z)}));await Promise.allSettled(Y),$({title:"Bonus achetÃ©! ðŸŽ‰",description:`${q.length} membre(s) notifiÃ©(s)`})}else $({title:"Bonus achetÃ©! ðŸŽ‰",description:"Le bonus est maintenant actif"})}catch(C){b.error("Erreur achat bonus:",C),$({title:"Erreur",description:C.message||"Impossible d'acheter le bonus",variant:"destructive"})}}},D=E=>!E||!E.members?0:Object.keys(E.members).length;return O?e.jsx($e,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ue,{className:"h-8 w-8 animate-spin text-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Chargement..."})]})})}):u?e.jsxs($e,{children:[e.jsxs(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsx(L,{className:"mb-6",style:{borderColor:u.color},children:e.jsx(xe,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"text-6xl w-20 h-20 flex items-center justify-center rounded-lg",style:{backgroundColor:u.color+"20"},children:u.logo}),e.jsxs("div",{children:[e.jsx(he,{className:"text-2xl",children:u.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[D(u)," membre",D(u)>1?"s":""]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"TrÃ©sorerie"}),e.jsxs("p",{className:"text-3xl font-bold text-primary",children:[u.treasury||0,"â‚¬"]})]}),u.founderId!==(s==null?void 0:s.uid)&&e.jsxs(T,{variant:"destructive",size:"sm",onClick:ee,children:[e.jsx(oa,{className:"h-4 w-4 mr-2"}),"Quitter"]})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs(L,{children:[e.jsx(xe,{children:e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"h-5 w-5 text-primary"}),"Contribuer"]})}),e.jsxs(V,{className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Votre fortune: ",e.jsxs("span",{className:"font-bold text-foreground",children:[x,"â‚¬"]})]}),e.jsxs(T,{onClick:()=>l(!0),className:"w-full",children:[e.jsx(dt,{className:"h-4 w-4 mr-2"}),"Faire un don"]})]})]}),e.jsxs(L,{children:[e.jsx(xe,{children:e.jsx(he,{children:"Statistiques"})}),e.jsxs(V,{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total gagnÃ©"}),e.jsxs("span",{className:"font-bold",children:[u.totalEarnings||0,"â‚¬"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Membres actifs"}),e.jsx("span",{className:"font-bold",children:D(u)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Bonus actifs"}),e.jsx("span",{className:"font-bold",children:u.bonuses?Object.values(u.bonuses).filter(Boolean).length:0})]})]})]})]}),e.jsxs(L,{className:"mb-6",children:[e.jsx(xe,{children:e.jsx(he,{children:"Bonus du club"})}),e.jsx(V,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:gn.map(E=>{const Q=u.bonuses&&u.bonuses[E.id],ae=(u.treasury||0)>=E.cost;return e.jsx(L,{className:Q?"border-primary":"",children:e.jsxs(V,{className:"p-4",children:[e.jsx("div",{className:"text-4xl mb-2 text-center",children:E.icon}),e.jsx("h3",{className:"font-bold text-center mb-1",children:E.name}),e.jsx("p",{className:"text-xs text-muted-foreground text-center mb-3",children:E.description}),Q?e.jsx(T,{size:"sm",className:"w-full",variant:"outline",disabled:!0,children:"Actif âœ“"}):e.jsxs(T,{size:"sm",className:"w-full",onClick:()=>fe(E.id,E.cost),disabled:!ae,variant:ae?"default":"secondary",children:[E.cost,"â‚¬"]})]})},E.id)})})})]}),e.jsxs(L,{children:[e.jsx(xe,{children:e.jsxs(he,{children:["Membres (",p.length,")"]})}),e.jsx(V,{children:p.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Aucun membre"}):e.jsx("div",{className:"space-y-2",children:p.sort((E,Q)=>Q.contributions-E.contributions).map(E=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-surface-alt",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[E.role==="founder"&&e.jsx(Mt,{className:"h-5 w-5 text-gold"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:E.username}),e.jsx("p",{className:"text-xs text-muted-foreground",children:E.role==="founder"?"Fondateur":"Membre"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-bold text-primary",children:[E.contributions,"â‚¬"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Contributions"})]})]},E.userId))})})]}),e.jsx(Ue,{open:o,onOpenChange:l,children:e.jsxs(Le,{children:[e.jsxs("button",{onClick:()=>l(!1),className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none z-50",children:[e.jsx(Fe,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Fermer"})]}),e.jsxs(Ie,{children:[e.jsx(De,{children:"Contribuer Ã  la trÃ©sorerie"}),e.jsx(Ye,{children:"Ajoutez de la fortune Ã  la trÃ©sorerie de votre club."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Votre fortune: ",e.jsxs("span",{className:"font-bold text-foreground",children:[x,"â‚¬"]})]}),e.jsx(je,{type:"number",value:U,onChange:E=>X(E.target.value),placeholder:"Montant",min:"1",max:x}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(T,{onClick:()=>l(!1),variant:"outline",className:"flex-1",children:"Annuler"}),e.jsx(T,{onClick:H,className:"flex-1",children:"Contribuer"})]})]})]})})]}),e.jsx(Kx,{open:c,onOpenChange:d,title:"Quitter le club",description:"ÃŠtes-vous sÃ»r de vouloir quitter ce club ? Vos contributions resteront dans la trÃ©sorerie.",confirmText:"Quitter",cancelText:"Annuler",onConfirm:se,variant:"destructive"})]}):e.jsx($e,{children:e.jsxs(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"max-w-2xl mx-auto",children:[e.jsxs(L,{className:"text-center p-8 sm:p-12",children:[e.jsx(Ee,{className:"h-16 w-16 mx-auto mb-4 text-muted-foreground"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Vous n'avez pas de club"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"CrÃ©ez ou rejoignez un club pour profiter des bonus collectifs"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsxs(T,{onClick:()=>n(!0),size:"lg",className:"w-full sm:w-auto",children:[e.jsx(is,{className:"h-5 w-5 mr-2"}),"CrÃ©er un club"]}),e.jsxs(T,{onClick:()=>i(!0),size:"lg",variant:"outline",className:"w-full sm:w-auto",children:[e.jsx(lt,{className:"h-5 w-5 mr-2"}),"Rejoindre un club"]})]})]}),e.jsx(Ue,{open:r,onOpenChange:n,children:e.jsxs(Le,{children:[e.jsxs("button",{onClick:()=>n(!1),className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none z-50",children:[e.jsx(Fe,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Fermer"})]}),e.jsxs(Ie,{children:[e.jsx(De,{children:"CrÃ©er un club"}),e.jsx(Ye,{children:"CrÃ©ez votre propre club et invitez d'autres joueurs Ã  vous rejoindre."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Nom du club"}),e.jsx(je,{value:R,onChange:E=>F(E.target.value),placeholder:"Les Champions",maxLength:20})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Logo"}),e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-2",children:Fr.map(E=>e.jsx("button",{onClick:()=>B(E),className:`text-4xl p-4 rounded-lg border-2 transition-all ${A===E?"border-primary bg-primary/10":"border-border hover:border-primary/50"}`,children:E},E))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Couleur"}),e.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-6 gap-2",children:zr.map(E=>e.jsx("button",{onClick:()=>J(E),className:`h-12 rounded-lg border-2 transition-all ${_===E?"border-white scale-110":"border-transparent"}`,style:{backgroundColor:E}},E))})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(T,{onClick:()=>n(!1),variant:"outline",className:"flex-1",children:"Annuler"}),e.jsx(T,{onClick:ge,className:"flex-1",children:"CrÃ©er le club"})]})]})]})}),e.jsx(Ue,{open:a,onOpenChange:i,children:e.jsxs(Le,{className:"max-w-2xl max-h-[80vh]",children:[e.jsxs("button",{onClick:()=>i(!1),className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none z-50",children:[e.jsx(Fe,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Fermer"})]}),e.jsxs(Ie,{children:[e.jsx(De,{children:"Rejoindre un club"}),e.jsx(Ye,{children:"Recherchez et rejoignez un club existant."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(lt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(je,{placeholder:"Rechercher un club...",value:M,onChange:E=>P(E.target.value),className:"pl-10"})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto space-y-2",children:w?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(ue,{className:"h-6 w-6 animate-spin text-primary"})}):y.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ee,{className:"h-12 w-12 mx-auto mb-3 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:M?"Aucun club trouvÃ©":"Aucun club disponible"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Soyez le premier Ã  crÃ©er un club !"})]}):y.map(E=>e.jsx(L,{className:"hover:border-primary/50 transition-colors",children:e.jsx(V,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"text-4xl w-14 h-14 flex items-center justify-center rounded-lg",style:{backgroundColor:E.color+"20"},children:E.logo}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:E.name}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[e.jsxs("span",{children:[D(E)," membre",D(E)>1?"s":""]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:[E.treasury||0,"â‚¬ de trÃ©sorerie"]})]})]})]}),e.jsx(T,{onClick:()=>ye(E.id,E.name),size:"sm",children:"Rejoindre"})]})})},E.id))}),e.jsx(T,{onClick:()=>{i(!1),P("")},variant:"outline",className:"w-full mt-4",children:"Fermer"})]})]})})]})})},Br={common:{label:"Commun",color:"bg-gray-500",textColor:"text-gray-400",borderColor:"border-gray-500/50",glowColor:"shadow-gray-500/50"},rare:{label:"Rare",color:"bg-blue-500",textColor:"text-blue-400",borderColor:"border-blue-500/50",glowColor:"shadow-blue-500/50"},epic:{label:"Ã‰pique",color:"bg-purple-500",textColor:"text-purple-400",borderColor:"border-purple-500/50",glowColor:"shadow-purple-500/50"},legendary:{label:"LÃ©gendaire",color:"bg-orange-500",textColor:"text-orange-400",borderColor:"border-orange-500/50",glowColor:"shadow-orange-500/50"},mythic:{label:"Mythique",color:"bg-gradient-to-r from-pink-500 via-purple-500 to-cyan-500",textColor:"text-transparent bg-clip-text bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400",borderColor:"border-pink-500/50",glowColor:"shadow-pink-500/50"}},eh=()=>{const{user:s}=Ae(),[t,r]=m.useState({}),[n,a]=m.useState({avatar:"",theme:"",banner:"",title:"",effect:""}),[i,o]=m.useState(!0),[l,c]=m.useState(!1),[d,u]=m.useState("items"),[h,p]=m.useState(!1),[f,x]=m.useState(null),[g,y]=m.useState(!1);m.useEffect(()=>{if(!s)return;o(!0);const A=S(k,`users/${s.uid}`),B=et(A,_=>{try{if(_.exists()){const J=_.val();r(J.inventory||{}),a({avatar:J.avatar||"",theme:J.theme||"",banner:J.banner||"",title:J.title||"",effect:J.effect||""}),b.log("âœ… [Inventory] Inventaire mis Ã  jour en temps rÃ©el")}}catch(J){b.error("Erreur chargement inventaire:",J),$({title:"Erreur",description:"Impossible de charger l'inventaire",variant:"destructive"})}finally{o(!1)}});return()=>B()},[s]);const j=async()=>{},M=async(A,B)=>{if(s){c(!0);try{await ja(s.uid,A,B),a(J=>({...J,[B]:A}));const _=qe.find(J=>J.id===A);$({title:"Ã‰quipÃ©! âœ…",description:`${(_==null?void 0:_.name)||A} est maintenant actif`}),B==="theme"&&setTimeout(()=>window.location.reload(),1e3)}catch(_){$({title:"Erreur",description:_.message,variant:"destructive"})}finally{c(!1)}}},P=async A=>{if(s){p(!0);try{const B=await so(s.uid,A);x(B),y(!0),await j(),$({title:"ðŸŽ‰ Lootbox ouverte!",description:`Vous avez reÃ§u ${B.rewards.length} items et ${B.fortuneBonus}â‚¬!`})}catch(B){$({title:"Erreur",description:B.message,variant:"destructive"})}finally{p(!1)}}},w=()=>{const A=[];return qe.forEach(B=>{t[B.type]&&typeof t[B.type]=="object"?t[B.type][B.id]&&A.push(B):t[B.id]&&A.push(B)}),A},I=()=>{const A=[];return qe.forEach(B=>{if(B.type==="lootbox"){let _=0;t.lootbox&&t.lootbox[B.id]?_=t.lootbox[B.id]:t[B.id]&&(_=t[B.id]),_>0&&A.push({...B,count:_})}}),A},O=w().filter(A=>A.type!=="lootbox"),N=I(),R={avatar:O.filter(A=>A.type==="avatar"),theme:O.filter(A=>A.type==="theme"),banner:O.filter(A=>A.type==="banner"),title:O.filter(A=>A.type==="title"),effect:O.filter(A=>A.type==="effect")},F={total:O.length,avatars:R.avatar.length,themes:R.theme.length,banners:R.banner.length,titles:R.title.length,effects:R.effect.length,lootboxes:N.reduce((A,B)=>A+B.count,0)};return i?e.jsx($e,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ue,{className:"h-8 w-8 animate-spin text-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Chargement de l'inventaire..."})]})})}):e.jsx($e,{children:e.jsxs(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(Rs,{className:"h-8 w-8 text-primary"}),"Mon Inventaire"]}),e.jsx("p",{className:"mt-1 text-muted-foreground",children:"GÃ©rez vos items et Ã©quipements"})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-6",children:[e.jsx(L,{children:e.jsxs(V,{className:"p-4 text-center",children:[e.jsx(Rs,{className:"h-6 w-6 mx-auto mb-2 text-primary"}),e.jsx("p",{className:"text-2xl font-bold",children:F.total}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Items"})]})}),e.jsx(L,{children:e.jsxs(V,{className:"p-4 text-center",children:[e.jsx(ms,{className:"h-6 w-6 mx-auto mb-2 text-blue-500"}),e.jsx("p",{className:"text-2xl font-bold",children:F.avatars}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Avatars"})]})}),e.jsx(L,{children:e.jsxs(V,{className:"p-4 text-center",children:[e.jsx(Pt,{className:"h-6 w-6 mx-auto mb-2 text-purple-500"}),e.jsx("p",{className:"text-2xl font-bold",children:F.themes}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ThÃ¨mes"})]})}),e.jsx(L,{children:e.jsxs(V,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl mx-auto mb-2",children:"ðŸŽ¯"}),e.jsx("p",{className:"text-2xl font-bold",children:F.banners}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"BanniÃ¨res"})]})}),e.jsx(L,{children:e.jsxs(V,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl mx-auto mb-2",children:"ðŸ·ï¸"}),e.jsx("p",{className:"text-2xl font-bold",children:F.titles}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Titres"})]})}),e.jsx(L,{children:e.jsxs(V,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl mx-auto mb-2",children:"âš¡"}),e.jsx("p",{className:"text-2xl font-bold",children:F.effects}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Effets"})]})}),e.jsx(L,{children:e.jsxs(V,{className:"p-4 text-center",children:[e.jsx(dt,{className:"h-6 w-6 mx-auto mb-2 text-orange-500"}),e.jsx("p",{className:"text-2xl font-bold",children:F.lootboxes}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Lootboxes"})]})})]}),e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsxs(T,{variant:d==="items"?"default":"outline",onClick:()=>u("items"),children:[e.jsx(Rs,{className:"h-4 w-4 mr-2"}),"Items (",F.total,")"]}),e.jsxs(T,{variant:d==="lootboxes"?"default":"outline",onClick:()=>u("lootboxes"),children:[e.jsx(dt,{className:"h-4 w-4 mr-2"}),"Lootboxes (",F.lootboxes,")"]})]}),e.jsx(nt,{mode:"wait",children:d==="items"?e.jsx(W.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},children:O.length===0?e.jsx(L,{children:e.jsxs(V,{className:"p-12 text-center",children:[e.jsx(Rs,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium text-muted-foreground mb-2",children:"Inventaire vide"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Achetez des items dans la boutique pour les voir ici"})]})}):e.jsx("div",{className:"space-y-6",children:Object.entries(R).map(([A,B])=>B.length>0&&e.jsxs(L,{children:[e.jsx(xe,{children:e.jsxs(he,{className:"flex items-center gap-2 capitalize",children:[A==="avatar"&&e.jsx(ms,{className:"h-5 w-5 text-primary"}),A==="theme"&&e.jsx(Pt,{className:"h-5 w-5 text-primary"}),A==="banner"&&e.jsx("div",{className:"text-xl",children:"ðŸŽ¯"}),A==="title"&&e.jsx("div",{className:"text-xl",children:"ðŸ·ï¸"}),A==="effect"&&e.jsx("div",{className:"text-xl",children:"âš¡"}),A,"s (",B.length,")"]})}),e.jsx(V,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3",children:B.map(_=>{const J=n[A]===_.id,U=Br[_.rarity||"common"];return e.jsxs(W.div,{whileHover:{scale:1.05},className:`p-3 rounded-lg border-2 transition-all text-center ${J?`${U.borderColor} bg-primary/5`:"border-border hover:border-primary/50"}`,children:[_.type==="theme"&&_.preview?e.jsx("div",{className:"w-16 h-16 rounded-lg mx-auto mb-2 border-2 border-white/20",style:{backgroundColor:_.preview}}):_.type==="banner"&&_.preview?e.jsx("div",{className:"w-full h-16 rounded-lg mx-auto mb-2 border-2 border-white/20 relative overflow-hidden",style:{background:_.preview},children:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:_.icon})})}):_.type==="title"&&_.preview?e.jsx("div",{className:"flex flex-col items-center gap-1 mb-1",children:e.jsxs("div",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-gradient-to-r from-sky-500/20 via-cyan-500/20 to-indigo-500/20 border border-cyan-400/50",children:[e.jsx("span",{className:"text-base",children:_.icon}),e.jsx("span",{className:"text-[9px] font-semibold tracking-wide uppercase text-cyan-100 line-clamp-1",children:_.preview})]})}):e.jsx("div",{className:"text-4xl mb-2",children:_.icon||_.preview}),e.jsx("p",{className:"text-xs font-medium mb-1 line-clamp-1",children:_.name}),J?e.jsx(le,{variant:"default",className:"w-full text-xs",children:"Ã‰quipÃ© âœ“"}):e.jsx(T,{size:"sm",variant:"outline",className:"w-full text-xs",onClick:()=>M(_.id,_.type),disabled:l,children:"Ã‰quiper"})]},_.id)})})})]},A))})},"items"):e.jsx(W.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},children:N.length===0?e.jsx(L,{children:e.jsxs(V,{className:"p-12 text-center",children:[e.jsx(dt,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium text-muted-foreground mb-2",children:"Aucune lootbox"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Achetez des lootboxes dans la boutique"})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:N.map(A=>{const B=Br[A.rarity||"common"];return e.jsx(W.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},whileHover:{scale:1.03},children:e.jsxs(L,{className:`border-2 ${B.borderColor} relative overflow-hidden`,children:[A.count>1&&e.jsx("div",{className:"absolute top-2 right-2 bg-primary text-primary-foreground rounded-full w-8 h-8 flex items-center justify-center font-bold text-sm z-10",children:A.count}),e.jsxs(xe,{children:[e.jsx(W.div,{className:"text-6xl text-center mb-2",animate:{rotate:[0,-10,10,-10,0]},transition:{duration:2,repeat:1/0,repeatDelay:1},children:A.icon||"ðŸŽ"}),e.jsx(he,{className:"text-center",children:A.name}),e.jsx(le,{className:`${B.color} text-white mx-auto`,children:B.label})]}),e.jsxs(V,{children:[e.jsx("p",{className:"text-sm text-muted-foreground text-center mb-4",children:A.description}),e.jsx(T,{className:"w-full",onClick:()=>P(A.id),disabled:h,children:h?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"h-4 w-4 mr-2 animate-spin"}),"Ouverture..."]}):e.jsxs(e.Fragment,{children:[e.jsx(dt,{className:"h-4 w-4 mr-2"}),"Ouvrir"]})})]})]})},A.id)})})},"lootboxes")}),e.jsx(nt,{children:g&&f&&e.jsx(W.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4",onClick:()=>y(!1),children:e.jsx(W.div,{initial:{scale:.8,y:50},animate:{scale:1,y:0},exit:{scale:.8,y:50},className:"max-w-2xl w-full",onClick:A=>A.stopPropagation(),children:e.jsxs(L,{className:"border-2 border-primary shadow-2xl",children:[e.jsxs(xe,{className:"text-center pb-4",children:[e.jsx(W.div,{animate:{rotate:[0,360]},transition:{duration:1,ease:"easeInOut"},className:"text-6xl mb-4",children:"ðŸŽ‰"}),e.jsx(he,{className:"text-3xl",children:"RÃ©compenses obtenues!"}),e.jsxs("p",{className:"text-muted-foreground mt-2",children:["Bonus de fortune: ",e.jsxs("span",{className:"text-primary font-bold",children:[f.fortuneBonus,"â‚¬"]})]})]}),e.jsxs(V,{children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 mb-6",children:f.rewards.map((A,B)=>{const _=qe.find(U=>U.id===A.itemId),J=Br[A.rarity];return e.jsxs(W.div,{initial:{opacity:0,scale:0,rotateY:180},animate:{opacity:1,scale:1,rotateY:0},transition:{delay:B*.2,duration:.5},className:`p-4 rounded-lg border-2 ${J.borderColor} ${J.color} bg-opacity-10 text-center`,children:[e.jsx("div",{className:"text-5xl mb-2",children:(_==null?void 0:_.icon)||(_==null?void 0:_.preview)||"ðŸŽ"}),e.jsx("p",{className:"text-sm font-medium mb-1",children:_==null?void 0:_.name}),e.jsx(le,{className:`${J.color} text-white text-xs`,children:J.label})]},B)})}),e.jsxs(T,{className:"w-full",size:"lg",onClick:()=>y(!1),children:[e.jsx(lc,{className:"h-4 w-4 mr-2"}),"GÃ©nial!"]})]})]})})})})]})})};function th(s,t){return{id:`match_round${t}_bye_${s.userId}`,round:t,team1:{playerIds:[s.userId],playerNames:[s.username],partnerId:s.partnerId||null,partnerName:s.partnerUsername||null},team2:{playerIds:[],playerNames:["BYE"],partnerId:null,partnerName:null},status:"completed",startTime:Date.now(),score1:10,score2:0,winnerId:s.userId,isBye:!0}}function sh(s){const t=[...s];for(let r=t.length-1;r>0;r--){const n=Math.floor(Math.random()*(r+1));[t[r],t[n]]=[t[n],t[r]]}return t}async function rh(s="active",t){var n,a;const r=S(k,`tournaments/${s}`);try{const i=await mi(r,c=>{var j;if(!c)return c;const d=Date.now();if((j=c.roundLock)!=null&&j.isLocked&&d-c.roundLock.lockedAt<3e4&&c.roundLock.lockedBy!==t)throw new Error("Un autre organisateur crÃ©e le round");const u=c.currentRound||1,h=c.matches||{},p=Object.values(h).filter(M=>M.round===u);if(!p.every(M=>M.status==="completed"))throw new Error("Tous les matchs du round actuel doivent Ãªtre terminÃ©s");let x=p.map(M=>{var I;const P=M.score1>M.score2?M.team1.playerIds[0]:M.team2.playerIds[0],w=M.score1>M.score2?M.team1:M.team2;return{userId:P,username:w.playerNames[0],eloRating:((I=c.players.find(O=>O.userId===P))==null?void 0:I.eloRating)||1e3,partnerId:w.partnerId,partnerUsername:w.partnerName}});if(x.length===1)return c.status="completed",c.winners=[x[0].userId],c.roundLock={isLocked:!1,lockedBy:"",lockedAt:0},c;c.roundLock={isLocked:!0,lockedBy:t,lockedAt:d},x=sh(x);const g=u+1;let y=null;if(x.length%2!==0){y=x.pop();const M=th(y,g);h[M.id]=M}for(let M=0;M<x.length-1;M+=2){const P=x[M],w=x[M+1];if(P&&w){const I=`match_round${g}_${M}`;h[I]={id:I,round:g,team1:{playerIds:[P.userId],playerNames:[P.username],partnerId:P.partnerId||null,partnerName:P.partnerUsername||null},team2:{playerIds:[w.userId],playerNames:[w.username],partnerId:w.partnerId||null,partnerName:w.partnerUsername||null},status:"pending",startTime:d,score1:0,score2:0}}}return c.matches=h,c.currentRound=g,c.roundLock={isLocked:!1,lockedBy:"",lockedAt:0},c});if(!i.committed)return{success:!1,message:"Transaction annulÃ©e - rÃ©essayez"};const o=(n=i.snapshot.val())==null?void 0:n.currentRound,l=(a=i.snapshot.val())!=null&&a.matches?Object.values(i.snapshot.val().matches).filter(c=>c.round===o&&c.isBye).length:0;return{success:!0,message:`Round ${o} crÃ©Ã© avec succÃ¨s${l>0?` (${l} bye)`:""}`,newRound:o}}catch(i){return b.error("Erreur crÃ©ation round:",i),{success:!1,message:i.message||"Erreur lors de la crÃ©ation du round"}}}async function ah(s,t,r="active"){const n=S(k,`tournaments/${r}/matches/${s}`);try{return(await mi(n,i=>{if(!i)throw new Error("Match introuvable");if(i.status==="completed")throw new Error("Match dÃ©jÃ  terminÃ©");if(i.score1===i.score2)throw new Error("Le score ne peut pas Ãªtre une Ã©galitÃ©");const o=i.score1>i.score2?i.team1.playerIds[0]:i.team2.playerIds[0];return i.status="completed",i.winnerId=o,i})).committed?{success:!0,message:"Match terminÃ© avec succÃ¨s"}:{success:!1,message:"Transaction annulÃ©e"}}catch(a){return{success:!1,message:a.message||"Erreur lors de la fin du match"}}}async function nh(s="active"){try{const t=S(k,`tournaments/${s}`),r=await z(t);if(!r.exists())return{isComplete:!1,winnersCount:0};const n=r.val(),a=n.currentRound||1,o=Object.values(n.matches||{}).filter(d=>d.round===a),l=o.every(d=>d.status==="completed"),c=o.length;return{isComplete:l,winnersCount:c}}catch(t){return b.error("Erreur vÃ©rification round:",t),{isComplete:!1,winnersCount:0}}}async function ih(s="active"){const t=S(k,`tournaments/${s}`);try{const r=await z(t);if(!r.exists())return{success:!1,message:"Tournoi introuvable"};const n=r.val();if(n.status!=="completed")return{success:!1,message:"Le tournoi n'est pas terminÃ©"};if(n.winners.length===0)return{success:!1,message:"Aucun gagnant trouvÃ©"};const a=Object.values(n.matches||{}),i=Math.max(...a.map(w=>w.round)),o=a.filter(w=>w.round===i&&w.status==="completed");if(o.length===0)return{success:!1,message:"Aucun match final trouvÃ©"};const l=n.winners[0],c=o[0],d=c.winnerId===c.team1.playerIds[0]?c.team2.playerIds[0]:c.team1.playerIds[0],u=i-1,p=a.filter(w=>w.round===u&&w.status==="completed").map(w=>w.winnerId===w.team1.playerIds[0]?w.team2.playerIds[0]:w.team1.playerIds[0]),f=Math.floor(n.prizePool*.5),x=Math.floor(n.prizePool*.3),g=Math.floor(n.prizePool*.2),y={},j=S(k,`users/${l}`),M=await z(j);if(M.exists()){const I=(M.val().fortune||0)+f;y[`users/${l}/fortune`]=I,await Ve(l,I,f,"ðŸ† 1Ã¨re place - Tournoi Quotidien")}if(d){const w=S(k,`users/${d}`),I=await z(w);if(I.exists()){const N=(I.val().fortune||0)+x;y[`users/${d}/fortune`]=N,await Ve(d,N,x,"ðŸ¥ˆ 2Ã¨me place - Tournoi Quotidien")}}const P=Math.floor(g/Math.max(p.length,1));for(const w of p){const I=S(k,`users/${w}`),O=await z(I);if(O.exists()){const R=(O.val().fortune||0)+P;y[`users/${w}/fortune`]=R,await Ve(w,R,P,"ðŸ¥‰ 3Ã¨me place - Tournoi Quotidien")}}return y[`tournaments/${s}/prizesDistributed`]=!0,y[`tournaments/${s}/prizesDistributedAt`]=Date.now(),await oe(S(k),y),{success:!0,message:`Prix distribuÃ©s: 1er (${f}â‚¬), 2Ã¨me (${x}â‚¬), 3Ã¨me (${P}â‚¬)`}}catch(r){return b.error("Erreur distribution prix:",r),{success:!1,message:r.message||"Erreur distribution des prix"}}}const Ur=13,bn=14.25,qr=50,gt=25,oh=()=>{var ae;const{user:s,userProfile:t}=Ae(),[r,n]=m.useState("overview"),[a,i]=m.useState(1),[o,l]=m.useState(null),[c,d]=m.useState(!1),[u,h]=m.useState("solo"),[p,f]=m.useState(""),[x,g]=m.useState([]),[y,j]=m.useState(!1),[M,P]=m.useState(!1),[w,I]=m.useState(!1),[O,N]=m.useState({hours:0,minutes:0,seconds:0}),[R,F]=m.useState(!1),[A,B]=m.useState(0);m.useEffect(()=>{if(!s)return;_();const C=setInterval(_,5e3);return()=>clearInterval(C)},[s]),m.useEffect(()=>{const C=setInterval(J,1e3);return()=>clearInterval(C)},[]),m.useEffect(()=>{o!=null&&o.currentRound&&i(o.currentRound)},[o==null?void 0:o.currentRound]),m.useEffect(()=>{const q=setTimeout(async()=>{if(p.length<2){g([]);return}j(!0);try{const v=(await to(p)).filter(Z=>Z.id!==(s==null?void 0:s.uid));g(v)}catch(Y){b.error("Erreur recherche partenaires:",Y),g([])}finally{j(!1)}},300);return()=>clearTimeout(q)},[p,s]);const _=async()=>{var C;if(s)try{const q=S(k,`users/${s.uid}`),Y=await z(q);Y.exists()&&B(Y.val().fortune||0);const v=S(k,"tournaments/active"),Z=await z(v);if(Z.exists()){const K=Z.val();(!K.players||!Array.isArray(K.players))&&(K.players=[]),(!K.matches||typeof K.matches!="object")&&(K.matches={}),l(K);const ne=K.players.some(Se=>Se.userId===s.uid);d(ne),K.status==="completed"&&!K.prizesDistributed&&((C=K.winners)==null?void 0:C.length)>0&&(b.log("ðŸ† Tournoi terminÃ© dÃ©tectÃ©, distribution des prix..."),setTimeout(async()=>{const Se=await ih("active");Se.success&&($({title:"ðŸ† Prix distribuÃ©s!",description:Se.message}),_())},1e3))}else l(null),d(!1)}catch(q){b.error("Erreur chargement tournoi:",q)}},J=()=>{const C=new Date,q=C.getHours()+C.getMinutes()/60;if(q>=Ur&&q<bn){const Y=bn-q,v=Math.floor(Y),Z=Math.floor((Y-v)*60),K=Math.floor(((Y-v)*60-Z)*60);N({hours:v,minutes:Z,seconds:K})}else if(q<Ur){const Y=Ur-q,v=Math.floor(Y),Z=Math.floor((Y-v)*60),K=Math.floor(((Y-v)*60-Z)*60);N({hours:v,minutes:Z,seconds:K})}else N({hours:0,minutes:0,seconds:0})},U=async()=>{if(!s||!t)return;const C=u==="duo"?gt:qr;if(A<C){$({title:"Fonds insuffisants",description:`Il vous faut ${C}â‚¬ pour participer (vous avez ${A}â‚¬)`,variant:"destructive"});return}if(u==="duo"&&!p.trim()){$({title:"Partenaire requis",description:"Entrez le nom de votre partenaire",variant:"destructive"});return}F(!0);try{let q=null,Y=null,v=0;if(u==="duo"){const Xe=S(k,"users"),Ct=await z(Xe);if(Ct.exists()){const es=Ct.val(),ft=Object.entries(es).find(([ks,We])=>{var ts;return((ts=We.username)==null?void 0:ts.toLowerCase())===p.toLowerCase()});if(!ft){$({title:"Partenaire introuvable",description:"Aucun joueur avec ce nom",variant:"destructive"}),F(!1);return}if(q=ft[0],Y=ft[1].username,v=ft[1].fortune||0,v<gt){$({title:"Partenaire sans fonds",description:`${Y} n'a pas assez de fortune (${v}â‚¬ / ${gt}â‚¬)`,variant:"destructive"}),F(!1);return}}}const Z=S(k,"tournaments/active"),K=await z(Z);if(!K.exists()){$({title:"Aucun tournoi actif",description:"Un admin doit d'abord crÃ©er le tournoi.",variant:"destructive"}),F(!1);return}const ne=K.val();if((!ne.players||!Array.isArray(ne.players))&&(ne.players=[]),ne.players.some(Xe=>Xe.userId===s.uid)){$({title:"DÃ©jÃ  inscrit",description:"Vous Ãªtes dÃ©jÃ  inscrit Ã  ce tournoi",variant:"destructive"}),F(!1);return}if(q&&ne.players.some(Xe=>Xe.userId===q)){$({title:"Partenaire dÃ©jÃ  inscrit",description:`${Y} est dÃ©jÃ  inscrit au tournoi`,variant:"destructive"}),F(!1);return}const Me={userId:s.uid,username:t.username,eloRating:t.eloRating||1e3,partnerId:q||null,partnerUsername:Y||null};ne.players.push(Me);let Ge=C;u==="duo"&&q&&(Ge+=gt),ne.prizePool+=Ge;const tt=`reg_${s.uid}_${Date.now()}`;u==="duo"&&q&&await Re(S(k,`tournamentRegistrations/${tt}`),{userId:s.uid,partnerId:q,timestamp:Date.now()});const st={};st[`users/${s.uid}/fortune`]=A-C,u==="duo"&&q&&(st[`users/${q}/fortune`]=v-gt),st["tournaments/active/players"]=ne.players,st["tournaments/active/prizePool"]=ne.prizePool,await oe(S(k),st),u==="duo"&&await Re(S(k,`tournamentRegistrations/${tt}`),null),await Ve(s.uid,-C,"tournament_entry",`Inscription tournoi ${u==="solo"?"solo":"duo"}`,{tournamentId:"active",mode:u,entryFee:C,...u==="duo"&&q&&{partnerId:q,partnerName:Y}}),u==="duo"&&q&&Y&&await Ve(q,-gt,"tournament_entry","Inscription tournoi duo",{tournamentId:"active",mode:"duo",entryFee:gt,partnerId:s.uid,partnerName:t.username}),$({title:"Inscription rÃ©ussie! ðŸŽ‰",description:`Vous Ãªtes inscrit ${u==="duo"?`en duo (${Ge}â‚¬ total)`:`en solo (${C}â‚¬)`}`}),await ko(s.uid,"Tournoi Quotidien","dans quelques instants"),P(!1),f(""),h("solo"),_()}catch(q){b.error("Erreur inscription:",q),$({title:"Erreur",description:q.message||"Impossible de s'inscrire au tournoi",variant:"destructive"})}finally{F(!1)}},X=async(C,q,Y)=>{if(o)try{const v={},Z=q==="team1"?"score1":"score2";v[`tournaments/active/matches/${C}/${Z}`]=Y,await oe(S(k),v),await _(),$({title:"Score mis Ã  jour",description:`${q==="team1"?"Ã‰quipe 1":"Ã‰quipe 2"}: ${Y} points`})}catch(v){b.error("Erreur mise Ã  jour score:",v),$({title:"Erreur",description:v.message,variant:"destructive"})}},pe=async C=>{if(!o||!t)return;const q=o.matches[C];if(q){if(q.score1===q.score2){$({title:"Score invalide",description:"Le match ne peut pas se terminer par une Ã©galitÃ©",variant:"destructive"});return}if(confirm(`âœ… Terminer le match ${q.team1.playerNames[0]} vs ${q.team2.playerNames[0]} ?`))try{F(!0);const Y=await ah(C,s.uid);if(Y.success){$({title:"Match terminÃ©! ðŸ",description:`Score final: ${q.score1} - ${q.score2}`}),await _();const v=await nh();v.isComplete&&v.winnersCount>1?setTimeout(()=>{confirm(`ðŸŽŠ Round terminÃ©! ${v.winnersCount} gagnants. CrÃ©er le prochain round ?`)&&ge()},1e3):v.winnersCount===1&&$({title:"ðŸ† TOURNOI TERMINÃ‰!",description:"Le vainqueur a Ã©tÃ© dÃ©terminÃ©!"})}else $({title:"Erreur",description:Y.message,variant:"destructive"})}catch(Y){b.error("Erreur fin de match:",Y),$({title:"Erreur",description:Y.message,variant:"destructive"})}finally{F(!1)}}},ge=async()=>{if(!(!s||!o))try{F(!0);const C=await rh("active",s.uid);C.success?($({title:`ðŸŽ® Round ${C.newRound} crÃ©Ã©!`,description:C.message}),await _()):$({title:"Erreur",description:C.message,variant:"destructive"})}catch(C){b.error("Erreur crÃ©ation round:",C),$({title:"Erreur",description:C.message,variant:"destructive"})}finally{F(!1)}},ye=async()=>{if(!o||!s){$({title:"Erreur",description:"Aucun tournoi actif",variant:"destructive"});return}if(o.players.length<2){$({title:"Erreur",description:"Il faut au moins 2 joueurs",variant:"destructive"});return}if(confirm(`âš ï¸ Lancer le tournoi avec ${o.players.length} joueurs ?`)){F(!0);try{const C=[...o.players],q=[];for(let Z=C.length-1;Z>0;Z--){const K=Math.floor(Math.random()*(Z+1));[C[Z],C[K]]=[C[K],C[Z]]}for(let Z=0;Z<C.length-1;Z+=2){const K=C[Z],ne=C[Z+1];K&&ne&&q.push({id:`match_round1_${Z}`,round:1,team1:{playerIds:[K.userId],playerNames:[K.username],partnerId:K.partnerId??null,partnerName:K.partnerUsername??null},team2:{playerIds:[ne.userId],playerNames:[ne.username],partnerId:ne.partnerId??null,partnerName:ne.partnerUsername??null},status:"pending",startTime:Date.now(),score1:0,score2:0})}const Y={};q.forEach(Z=>{Y[Z.id]=Z});const v={};v["tournaments/active/matches"]=Y,v["tournaments/active/status"]="in_progress",v["tournaments/active/currentRound"]=1,await oe(S(k),v),$({title:"ðŸŽ® Tournoi lancÃ©!",description:`${q.length} matchs crÃ©Ã©s pour le Round 1`}),await _()}catch(C){b.error("Erreur lancement tournoi:",C),$({title:"Erreur",description:C.message,variant:"destructive"})}finally{F(!1)}}},ee=()=>{if(!(o!=null&&o.matches))return{};const C={};return Object.values(o.matches).forEach(q=>{C[q.round]||(C[q.round]=[]),C[q.round].push(q)}),C},se=()=>{if(!o)return[];if(!o.players||!Array.isArray(o.players))return[];const C={};return o.players.forEach(Y=>{C[Y.userId]={name:Y.username+(Y.partnerUsername?` & ${Y.partnerUsername}`:""),wins:0,elo:Y.eloRating}}),o.matches&&typeof o.matches=="object"&&Object.values(o.matches).forEach(Y=>{Y.status==="completed"&&Y.winnerId&&C[Y.winnerId]&&C[Y.winnerId].wins++}),Object.entries(C).map(([Y,v])=>({...v,id:Y})).sort((Y,v)=>v.wins!==Y.wins?v.wins-Y.wins:v.elo-Y.elo).slice(0,10).map((Y,v)=>({...Y,rank:v+1,prize:v===0?Math.floor(o.prizePool*.5):v===1?Math.floor(o.prizePool*.3):v===2?Math.floor(o.prizePool*.2):0}))},H=C=>{switch(C){case"completed":return"bg-green-500/10 text-green-500 border-green-500/30";case"in_progress":return"bg-blue-500/10 text-blue-500 border-blue-500/30";case"pending":return"bg-gray-500/10 text-gray-400 border-gray-500/30";default:return"bg-gray-500/10 text-gray-400 border-gray-500/30"}},fe=({match:C,matchKey:q})=>{const Y=t&&(t.role==="admin"||t.role==="agent");return e.jsxs(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-gradient-to-br from-slate-900 to-slate-800 rounded-xl p-4 border border-slate-700 hover:border-blue-500/50 transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold border ${H(C.status)}`,children:C.status==="completed"?"âœ… TerminÃ©":C.status==="in_progress"?"ðŸŽ® En cours":"â³ Ã€ venir"}),e.jsxs("span",{className:"text-xs text-slate-400",children:["Round ",C.round]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg ${C.winnerId===C.team1.playerIds[0]?"bg-blue-500/20 border border-blue-500/50":"bg-slate-800/50"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:`w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-lg font-bold ${C.winnerId===C.team1.playerIds[0]?"ring-2 ring-blue-500":""}`,children:C.team1.playerNames[0][0]}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("p",{className:"font-semibold text-white truncate",children:[C.team1.playerNames[0],C.team1.partnerName&&` & ${C.team1.partnerName}`]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[Y&&C.status!=="completed"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>X(q,"team1",Math.max(0,C.score1-1)),disabled:C.score1<=0||R,className:"w-8 h-8 bg-slate-700 hover:bg-slate-600 rounded-lg font-bold disabled:opacity-50 disabled:cursor-not-allowed",children:"-"}),e.jsx("span",{className:"text-2xl font-bold w-12 text-center",children:C.score1}),e.jsx("button",{onClick:()=>X(q,"team1",C.score1+1),disabled:R,className:"w-8 h-8 bg-slate-700 hover:bg-slate-600 rounded-lg font-bold",children:"+"})]}),C.status==="completed"&&e.jsx("span",{className:`text-3xl font-bold ${C.winnerId===C.team1.playerIds[0]?"text-blue-400":"text-slate-600"}`,children:C.score1})]})]}),e.jsx("div",{className:"text-center text-slate-500 font-bold text-sm",children:"VS"}),e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg ${C.winnerId===C.team2.playerIds[0]?"bg-blue-500/20 border border-blue-500/50":"bg-slate-800/50"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:`w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-lg font-bold ${C.winnerId===C.team2.playerIds[0]?"ring-2 ring-blue-500":""}`,children:C.team2.playerNames[0][0]}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("p",{className:"font-semibold text-white truncate",children:[C.team2.playerNames[0],C.team2.partnerName&&` & ${C.team2.partnerName}`]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[Y&&C.status!=="completed"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>X(q,"team2",Math.max(0,C.score2-1)),disabled:C.score2<=0||R,className:"w-8 h-8 bg-slate-700 hover:bg-slate-600 rounded-lg font-bold disabled:opacity-50 disabled:cursor-not-allowed",children:"-"}),e.jsx("span",{className:"text-2xl font-bold w-12 text-center",children:C.score2}),e.jsx("button",{onClick:()=>X(q,"team2",C.score2+1),disabled:R,className:"w-8 h-8 bg-slate-700 hover:bg-slate-600 rounded-lg font-bold",children:"+"})]}),C.status==="completed"&&e.jsx("span",{className:`text-3xl font-bold ${C.winnerId===C.team2.playerIds[0]?"text-blue-400":"text-slate-600"}`,children:C.score2})]})]})]}),Y&&C.status!=="completed"&&e.jsx("button",{onClick:()=>pe(q),disabled:R,className:"w-full mt-3 px-4 py-2 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 rounded-lg font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:R?e.jsx(ue,{className:"h-4 w-4 animate-spin mx-auto"}):"ðŸ Terminer le match"}),C.status==="completed"&&C.winnerId&&e.jsx("div",{className:"mt-3 text-center p-2 bg-gradient-to-r from-blue-500/20 to-purple-500/20 rounded-lg",children:e.jsxs("p",{className:"text-sm font-semibold text-blue-400 flex items-center justify-center gap-2",children:[e.jsx(Pe,{className:"h-4 w-4"}),C.winnerId===C.team1.playerIds[0]?C.team1.playerNames[0]:C.team2.playerNames[0]," remporte le match !"]})})]})},D=se(),E=ee(),Q=Object.keys(E).length;return e.jsx($e,{children:e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 text-white p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs(W.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"text-center mb-8",children:[e.jsx(W.div,{animate:{scale:[1,1.1,1],rotate:[0,5,-5,0]},transition:{duration:3,repeat:1/0},className:"text-8xl mb-4",children:"ðŸ†"}),e.jsx("h1",{className:"text-5xl font-bold mb-2 bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent",children:"Tournoi Quotidien"}),e.jsx("p",{className:"text-slate-400 text-lg",children:new Date().toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),(o==null?void 0:o.status)&&e.jsx("div",{className:"mt-3",children:e.jsx("span",{className:`px-4 py-2 rounded-full text-sm font-semibold border ${o.status==="completed"?"bg-green-500/10 text-green-500 border-green-500/30":o.status==="in_progress"?"bg-blue-500/10 text-blue-500 border-blue-500/30":"bg-gray-500/10 text-gray-400 border-gray-500/30"}`,children:o.status==="in_progress"?"ðŸŽ® En cours":o.status==="completed"?"âœ… TerminÃ©":"â³ En attente"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[e.jsxs(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-gradient-to-br from-blue-500/10 to-blue-600/10 rounded-xl p-6 border border-blue-500/20",children:[e.jsx(it,{className:"h-8 w-8 text-blue-400 mb-3"}),e.jsxs("p",{className:"text-3xl font-bold text-white mb-1",children:[String(O.hours).padStart(2,"0"),":",String(O.minutes).padStart(2,"0"),":",String(O.seconds).padStart(2,"0")]}),e.jsx("p",{className:"text-sm text-slate-400",children:"Temps restant"})]}),e.jsxs(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-gradient-to-br from-purple-500/10 to-purple-600/10 rounded-xl p-6 border border-purple-500/20",children:[e.jsx(Ee,{className:"h-8 w-8 text-purple-400 mb-3"}),e.jsx("p",{className:"text-3xl font-bold text-white mb-1",children:(o==null?void 0:o.players.length)||0}),e.jsx("p",{className:"text-sm text-slate-400",children:"Participants"})]}),e.jsxs(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-gradient-to-br from-yellow-500/10 to-yellow-600/10 rounded-xl p-6 border border-yellow-500/20",children:[e.jsx(Pe,{className:"h-8 w-8 text-yellow-400 mb-3"}),e.jsxs("p",{className:"text-3xl font-bold text-white mb-1",children:[(o==null?void 0:o.prizePool)||0,"â‚¬"]}),e.jsx("p",{className:"text-sm text-slate-400",children:"Cagnotte totale"})]}),e.jsxs(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-gradient-to-br from-pink-500/10 to-pink-600/10 rounded-xl p-6 border border-pink-500/20",children:[e.jsx(Oe,{className:"h-8 w-8 text-pink-400 mb-3"}),e.jsxs("p",{className:"text-3xl font-bold text-white mb-1",children:["Round ",(o==null?void 0:o.currentRound)||0,"/",Q||0]}),e.jsx("p",{className:"text-sm text-slate-400",children:"Progression"})]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2 mb-6 bg-slate-900/50 p-2 rounded-xl border border-slate-800",children:[{view:"overview",icon:"ðŸ“Š",label:"Vue"},{view:"matches",icon:"ðŸŽ®",label:"Matchs"},{view:"leaderboard",icon:"ðŸ…",label:"Classement"}].map(({view:C,icon:q,label:Y})=>e.jsxs("button",{onClick:()=>n(C),className:`py-3 px-2 rounded-lg font-semibold transition-all ${r===C?"bg-blue-500 text-white shadow-lg shadow-blue-500/50":"bg-transparent text-slate-400 hover:text-white hover:bg-slate-800"}`,children:[e.jsxs("span",{className:"hidden sm:inline",children:[q," ",Y]}),e.jsx("span",{className:"sm:hidden text-xl",children:q})]},C))}),e.jsxs(nt,{mode:"wait",children:[r==="overview"&&e.jsxs(W.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"space-y-6",children:[!c&&(o==null?void 0:o.status)!=="in_progress"&&(o==null?void 0:o.status)!=="completed"&&o&&e.jsxs(W.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 rounded-2xl p-6 sm:p-8 border border-white/10 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PHBhdHRlcm4gaWQ9ImdyaWQiIHdpZHRoPSI2MCIgaGVpZ2h0PSI2MCIgcGF0dGVyblVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+PHBhdGggZD0iTSAxMCAwIEwgMCAwIDAgMTAiIGZpbGw9Im5vbmUiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS1vcGFjaXR5PSIwLjA1IiBzdHJva2Utd2lkdGg9IjEiLz48L3BhdHRlcm4+PC9kZWZzPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9InVybCgjZ3JpZCkiLz48L3N2Zz4=')] opacity-30"}),e.jsxs("div",{className:"relative",children:[e.jsx(Pt,{className:"h-10 w-10 sm:h-12 sm:w-12 text-white mb-3 sm:mb-4"}),e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-white mb-2",children:"Rejoignez le tournoi !"}),e.jsxs("p",{className:"text-white/90 mb-4 sm:mb-6 text-base sm:text-lg",children:["Participez seul ou en duo et tentez de remporter la cagnotte de ",(o==null?void 0:o.prizePool)||0,"â‚¬"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("button",{onClick:()=>P(!0),disabled:R,className:"w-full sm:w-auto px-6 sm:px-8 py-3 sm:py-4 bg-white text-purple-600 rounded-xl font-bold hover:scale-105 transition-transform shadow-xl disabled:opacity-50 disabled:cursor-not-allowed",children:R?"Chargement...":"S'inscrire maintenant"}),e.jsx("button",{onClick:()=>I(!0),className:"w-full sm:w-auto px-6 sm:px-8 py-3 sm:py-4 bg-white/10 backdrop-blur-sm text-white rounded-xl font-bold hover:bg-white/20 transition-all border border-white/20",children:"Voir les rÃ¨gles"})]})]})]}),!o&&e.jsxs(W.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-gradient-to-r from-orange-600 via-red-600 to-orange-600 rounded-2xl p-8 border border-orange-500/30 text-center",children:[e.jsx(xs,{className:"h-16 w-16 mx-auto mb-4 text-white"}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Aucun tournoi actif"}),e.jsx("p",{className:"text-white/90 mb-4",children:"Un administrateur doit crÃ©er le tournoi du jour depuis le panneau admin."}),t&&(t.role==="admin"||t.role==="agent")&&e.jsx("button",{onClick:async()=>{if(s)try{F(!0);const C={id:"active",startTime:Date.now(),endTime:0,isActive:!0,players:[],matches:{},winners:[],prizePool:0,status:"waiting",currentRound:0,organizerId:s.uid};await Re(S(k,"tournaments/active"),C),$({title:"Tournoi crÃ©Ã© ! ðŸŽ®",description:"Les joueurs peuvent maintenant s'inscrire"}),await _()}catch(C){$({title:"Erreur",description:C.message,variant:"destructive"})}finally{F(!1)}},disabled:R,className:"px-8 py-4 bg-white text-orange-600 rounded-xl font-bold hover:scale-105 transition-transform disabled:opacity-50",children:R?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx(ue,{className:"h-5 w-5 animate-spin"}),"CrÃ©ation..."]}):"CrÃ©er le tournoi"})]}),c&&e.jsx(W.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-gradient-to-r from-green-600 via-green-700 to-green-600 rounded-2xl p-8 border border-green-500/30",children:e.jsxs("div",{className:"text-center",children:[e.jsx(kr,{className:"h-16 w-16 mx-auto mb-4 text-white"}),e.jsx("h2",{className:"text-3xl font-bold text-white mb-2",children:"Vous Ãªtes inscrit ! âœ…"}),e.jsx("p",{className:"text-white/90 text-lg",children:"Bonne chance pour le tournoi"})]})}),t&&(t.role==="admin"||t.role==="agent")&&o&&o.status==="waiting"&&e.jsxs(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-orange-600 via-red-600 to-orange-600 rounded-2xl p-6 border border-orange-500/30",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"ðŸŽ® Panel Organisateur"}),e.jsx("button",{onClick:ye,disabled:R||((o==null?void 0:o.players.length)||0)<2,className:"w-full px-6 py-3 bg-white text-orange-600 rounded-xl font-bold hover:scale-105 transition-transform disabled:opacity-50 disabled:cursor-not-allowed",children:R?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx(ue,{className:"h-5 w-5 animate-spin"}),"Lancement..."]}):`Lancer le tournoi (${(o==null?void 0:o.players.length)||0} joueurs)`})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-slate-900 to-slate-800 rounded-xl p-6 border border-slate-700",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(ws,{className:"h-5 w-5 text-blue-400"}),"Informations"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-slate-800/50 rounded-lg",children:[e.jsx("span",{className:"text-slate-400",children:"Horaires"}),e.jsx("span",{className:"font-semibold",children:"13h00 - 14h15"})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-slate-800/50 rounded-lg",children:[e.jsx("span",{className:"text-slate-400",children:"DurÃ©e des matchs"}),e.jsx("span",{className:"font-semibold",children:"5 minutes"})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-slate-800/50 rounded-lg",children:[e.jsx("span",{className:"text-slate-400",children:"Format"}),e.jsx("span",{className:"font-semibold",children:"Ã‰limination directe"})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-slate-800/50 rounded-lg",children:[e.jsx("span",{className:"text-slate-400",children:"Inscription"}),e.jsx("span",{className:"font-semibold text-blue-400",children:"50â‚¬ solo / 25â‚¬ duo"})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-slate-900 to-slate-800 rounded-xl p-6 border border-slate-700",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(Mt,{className:"h-5 w-5 text-yellow-400"}),"RÃ©compenses"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gradient-to-r from-yellow-500/20 to-yellow-600/20 rounded-lg border border-yellow-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qt,{className:"h-5 w-5 text-yellow-400"}),e.jsx("span",{className:"font-semibold",children:"1er place"})]}),e.jsxs("span",{className:"font-bold text-yellow-400",children:[o?Math.floor(o.prizePool*.5):0,"â‚¬"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gradient-to-r from-slate-500/20 to-slate-600/20 rounded-lg border border-slate-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qt,{className:"h-5 w-5 text-slate-400"}),e.jsx("span",{className:"font-semibold",children:"2Ã¨me place"})]}),e.jsxs("span",{className:"font-bold text-slate-400",children:[o?Math.floor(o.prizePool*.3):0,"â‚¬"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gradient-to-r from-orange-500/20 to-orange-600/20 rounded-lg border border-orange-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qt,{className:"h-5 w-5 text-orange-400"}),e.jsx("span",{className:"font-semibold",children:"3Ã¨me place"})]}),e.jsxs("span",{className:"font-bold text-orange-400",children:[o?Math.floor(o.prizePool*.2):0,"â‚¬"]})]})]})]})]}),o&&Q>0&&e.jsxs("div",{className:"bg-gradient-to-br from-slate-900 to-slate-800 rounded-xl p-6 border border-slate-700",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Progression du tournoi"}),e.jsx("div",{className:"flex items-center gap-4",children:Array.from({length:Q},(C,q)=>q+1).map(C=>e.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[e.jsx("div",{className:`w-full h-3 rounded-full ${C<(o.currentRound||1)?"bg-green-500":C===(o.currentRound||1)?"bg-blue-500 animate-pulse":"bg-slate-700"}`}),C<Q&&e.jsx(si,{className:"h-5 w-5 text-slate-600 flex-shrink-0"})]},C))}),e.jsx("div",{className:"flex justify-between mt-2",children:Array.from({length:Q},(C,q)=>q+1).map(C=>e.jsxs("p",{className:"text-xs text-slate-400 flex-1 text-center",children:["Round ",C]},C))})]}),o&&o.players.length>0&&e.jsxs("div",{className:"bg-gradient-to-br from-slate-900 to-slate-800 rounded-xl p-6 border border-slate-700",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Participants (",o.players.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:o.players.map((C,q)=>e.jsx(W.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:q*.05},className:`p-4 rounded-lg ${C.userId===(s==null?void 0:s.uid)?"bg-gradient-to-r from-blue-500/20 to-purple-500/20 border border-blue-500/50":"bg-slate-800/50"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center font-bold",children:C.username[0]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold truncate",children:C.username}),C.partnerUsername&&e.jsxs("p",{className:"text-xs text-slate-400 flex items-center gap-1",children:[e.jsx(Ee,{className:"h-3 w-3"}),"avec ",C.partnerUsername]}),e.jsxs("p",{className:"text-xs text-slate-400 flex items-center gap-1 mt-1",children:[e.jsx(jt,{className:"h-3 w-3"}),C.eloRating," ELO"]})]})]})},C.userId))})]})]},"overview"),r==="matches"&&e.jsx(W.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},children:Object.keys(E).length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6 flex gap-2 overflow-x-auto pb-2",children:Object.keys(E).sort((C,q)=>Number(q)-Number(C)).map(C=>e.jsxs("button",{onClick:()=>i(Number(C)),className:`px-6 py-3 rounded-xl font-semibold whitespace-nowrap transition-all ${a===Number(C)?"bg-blue-500 text-white shadow-lg shadow-blue-500/50":"bg-slate-800 text-slate-400 hover:text-white hover:bg-slate-700"}`,children:["Round ",C,Number(C)===(o==null?void 0:o.currentRound)&&e.jsx("span",{className:"ml-2 inline-block w-2 h-2 bg-green-500 rounded-full animate-pulse"})]},C))}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:(ae=E[a])==null?void 0:ae.map(C=>{const q=Object.keys((o==null?void 0:o.matches)||{}).find(Y=>(o==null?void 0:o.matches[Y].id)===C.id);return q?e.jsx(fe,{match:C,matchKey:q},C.id):null})})]}):e.jsxs("div",{className:"text-center py-12 bg-slate-900/50 rounded-xl border border-slate-800",children:[e.jsx(Pe,{className:"h-16 w-16 mx-auto mb-4 text-slate-600"}),e.jsx("p",{className:"text-xl text-slate-400",children:"Aucun match pour le moment"}),e.jsx("p",{className:"text-sm text-slate-500 mt-2",children:"Les matchs apparaÃ®tront une fois le tournoi lancÃ©"})]})},"matches"),r==="leaderboard"&&e.jsxs(W.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"bg-gradient-to-br from-slate-900 to-slate-800 rounded-xl p-6 border border-slate-700",children:[e.jsxs("h3",{className:"text-2xl font-bold mb-6 flex items-center gap-2",children:[e.jsx(Pe,{className:"h-6 w-6 text-yellow-400"}),"Classement"]}),D.length>0?e.jsx("div",{className:"space-y-3",children:D.map((C,q)=>e.jsxs(W.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:q*.1},className:`flex items-center justify-between p-4 rounded-xl ${C.rank===1?"bg-gradient-to-r from-yellow-500/20 to-yellow-600/20 border border-yellow-500/30":C.rank===2?"bg-gradient-to-r from-slate-500/20 to-slate-600/20 border border-slate-500/30":C.rank===3?"bg-gradient-to-r from-orange-500/20 to-orange-600/20 border border-orange-500/30":"bg-slate-800/50"}`,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:`w-12 h-12 rounded-full flex items-center justify-center font-bold text-lg ${C.rank===1?"bg-gradient-to-br from-yellow-400 to-yellow-600 text-white":C.rank===2?"bg-gradient-to-br from-slate-400 to-slate-600 text-white":C.rank===3?"bg-gradient-to-br from-orange-400 to-orange-600 text-white":"bg-slate-700 text-slate-300"}`,children:["#",C.rank]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-lg",children:C.name}),e.jsxs("p",{className:"text-sm text-slate-400 flex items-center gap-2",children:[e.jsx(kr,{className:"h-4 w-4 text-green-500"}),C.wins," victoire",C.wins>1?"s":"",e.jsxs("span",{className:"ml-2 flex items-center gap-1",children:[e.jsx(jt,{className:"h-4 w-4"}),C.elo]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-2xl font-bold text-yellow-400",children:[C.prize,"â‚¬"]}),e.jsx("p",{className:"text-xs text-slate-400",children:"Gains potentiels"})]})]},C.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(qt,{className:"h-16 w-16 mx-auto mb-4 text-slate-600"}),e.jsx("p",{className:"text-xl text-slate-400",children:"Aucun classement disponible"}),e.jsx("p",{className:"text-sm text-slate-500 mt-2",children:"Le classement apparaÃ®tra une fois les matchs commencÃ©s"})]})]},"leaderboard")]}),e.jsx(nt,{children:M&&e.jsx(W.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50",onClick:()=>P(!1),children:e.jsxs(W.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},onClick:C=>C.stopPropagation(),className:"bg-gradient-to-br from-slate-900 to-slate-800 rounded-2xl p-8 border border-slate-700 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Inscription au Tournoi"}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("p",{className:"text-slate-400 mb-2",children:["Votre fortune : ",e.jsxs("span",{className:"font-bold text-white",children:[A,"â‚¬"]})]}),e.jsx("p",{className:"text-slate-400 mb-4",children:"Choisissez votre mode de jeu :"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:()=>h("solo"),className:`p-6 rounded-xl border-2 transition-all ${u==="solo"?"border-blue-500 bg-blue-500/20":"border-slate-700 hover:border-slate-600"}`,children:[e.jsx(Pe,{className:"h-8 w-8 mx-auto mb-2 text-blue-400"}),e.jsx("p",{className:"font-bold mb-1",children:"Solo"}),e.jsx("p",{className:"text-sm text-slate-400",children:"50â‚¬"})]}),e.jsxs("button",{onClick:()=>h("duo"),className:`p-6 rounded-xl border-2 transition-all ${u==="duo"?"border-purple-500 bg-purple-500/20":"border-slate-700 hover:border-slate-600"}`,children:[e.jsx(Ee,{className:"h-8 w-8 mx-auto mb-2 text-purple-400"}),e.jsx("p",{className:"font-bold mb-1",children:"Duo"}),e.jsx("p",{className:"text-sm text-slate-400",children:"25â‚¬ / joueur"})]})]})]}),u==="duo"&&e.jsxs(W.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Rechercher un partenaire"}),e.jsxs("div",{className:"relative",children:[e.jsx(lt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-slate-400 z-10"}),y&&e.jsx(ue,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-5 w-5 animate-spin text-slate-400 z-10"}),e.jsx("input",{type:"text",value:p,onChange:C=>f(C.target.value),placeholder:"Nom du joueur...",className:"w-full pl-10 pr-10 py-3 bg-slate-800 border border-slate-700 rounded-xl focus:outline-none focus:border-blue-500 transition-colors text-white"})]}),p.length>=2&&x.length>0&&e.jsx(W.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mt-3 space-y-2 max-h-48 overflow-y-auto",children:x.map(C=>e.jsx("button",{onClick:()=>f(C.username),className:"w-full p-3 bg-slate-800 hover:bg-slate-700 rounded-lg border border-slate-700 hover:border-blue-500/50 transition-all text-left",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:C.username}),e.jsxs("p",{className:"text-xs text-slate-400 flex items-center gap-2 mt-1",children:[e.jsx(jt,{className:"h-3 w-3"}),C.eloRating," ELO",e.jsxs("span",{className:"ml-2",children:["ðŸ’° ",C.fortune,"â‚¬"]})]})]}),e.jsx(kr,{className:"h-5 w-5 text-green-500"})]})},C.id))}),p.length>0&&p.length<2&&e.jsx("p",{className:"text-xs text-slate-400 mt-2",children:"Tapez au moins 2 lettres pour rechercher"})]}),e.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-slate-400",children:"Frais d'inscription"}),e.jsx("span",{className:"font-bold text-blue-400",children:u==="solo"?"50â‚¬":"25â‚¬"})]}),A<(u==="solo"?qr:gt)&&e.jsx("p",{className:"text-xs text-red-400 mt-2",children:"âš ï¸ Vous n'avez pas assez de fortune pour participer"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>P(!1),className:"flex-1 px-6 py-3 bg-slate-800 hover:bg-slate-700 rounded-xl font-semibold transition-colors",children:"Annuler"}),e.jsx("button",{onClick:U,disabled:R||A<(u==="solo"?qr:gt)||u==="duo"&&!p.trim(),className:"flex-1 px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 rounded-xl font-semibold transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100",children:R?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4 animate-spin"}),"Inscription..."]}):"Confirmer"})]})]})})}),e.jsx(nt,{children:w&&e.jsx(W.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50",onClick:()=>I(!1),children:e.jsxs(W.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},onClick:C=>C.stopPropagation(),className:"bg-gradient-to-br from-slate-900 to-slate-800 rounded-2xl p-8 border border-slate-700 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(xs,{className:"h-6 w-6 text-blue-400"}),e.jsx("h2",{className:"text-2xl font-bold",children:"RÃ¨gles du Tournoi"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg mb-2 flex items-center gap-2",children:[e.jsx(it,{className:"h-5 w-5 text-blue-400"}),"Horaires"]}),e.jsxs("p",{className:"text-slate-300",children:["Le tournoi se dÃ©roule tous les jours de ",e.jsx("strong",{className:"text-white",children:"13h00 Ã  14h15"})," (1h15 de compÃ©tition)"]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg mb-2 flex items-center gap-2",children:[e.jsx(Ee,{className:"h-5 w-5 text-purple-400"}),"Modes de jeu"]}),e.jsxs("ul",{className:"space-y-2 text-slate-300",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-400 mt-1",children:"â€¢"}),e.jsxs("span",{children:[e.jsx("strong",{className:"text-white",children:"Solo :"})," Affrontez les autres joueurs individuellement (50â‚¬)"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-purple-400 mt-1",children:"â€¢"}),e.jsxs("span",{children:[e.jsx("strong",{className:"text-white",children:"Duo :"})," Formez une Ã©quipe avec un partenaire (25â‚¬ par personne)"]})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg mb-2 flex items-center gap-2",children:[e.jsx(Pe,{className:"h-5 w-5 text-yellow-400"}),"DÃ©roulement"]}),e.jsxs("ul",{className:"space-y-2 text-slate-300",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-green-400 mt-1",children:"â€¢"}),e.jsxs("span",{children:["Chaque match dure exactement ",e.jsx("strong",{className:"text-white",children:"5 minutes"})]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-green-400 mt-1",children:"â€¢"}),e.jsxs("span",{children:["Les matchs sont organisÃ©s en ",e.jsx("strong",{className:"text-white",children:"Ã©limination directe"})]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-green-400 mt-1",children:"â€¢"}),e.jsx("span",{children:"Le gagnant de chaque match passe au round suivant"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-green-400 mt-1",children:"â€¢"}),e.jsx("span",{children:"Le tournoi continue jusqu'Ã  ce qu'il ne reste qu'un seul vainqueur"})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg mb-2 flex items-center gap-2",children:[e.jsx(Mt,{className:"h-5 w-5 text-yellow-400"}),"RÃ©compenses"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-yellow-500/10 rounded-lg border border-yellow-500/30",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(qt,{className:"h-4 w-4 text-yellow-400"}),e.jsx("span",{className:"font-semibold text-yellow-400",children:"1er place"})]}),e.jsx("span",{className:"font-bold text-yellow-400",children:"50% de la cagnotte"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-500/10 rounded-lg border border-slate-500/30",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(qt,{className:"h-4 w-4 text-slate-400"}),e.jsx("span",{className:"font-semibold text-slate-400",children:"2Ã¨me place"})]}),e.jsx("span",{className:"font-bold text-slate-400",children:"30% de la cagnotte"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-orange-500/10 rounded-lg border border-orange-500/30",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(qt,{className:"h-4 w-4 text-orange-400"}),e.jsx("span",{className:"font-semibold text-orange-400",children:"3Ã¨me place"})]}),e.jsx("span",{className:"font-bold text-orange-400",children:"20% de la cagnotte"})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg mb-2 flex items-center gap-2",children:[e.jsx(Pt,{className:"h-5 w-5 text-pink-400"}),"Bonus"]}),e.jsx("p",{className:"text-slate-300",children:"Les bonus de club sont actifs pendant le tournoi !"})]})]}),e.jsx("button",{onClick:()=>I(!1),className:"w-full mt-6 px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 rounded-xl font-semibold transition-all",children:"J'ai compris"})]})})}),(o==null?void 0:o.status)==="completed"&&o.winners.length>0&&e.jsx(W.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsxs(W.div,{initial:{y:50},animate:{y:0},className:"bg-gradient-to-br from-yellow-600 via-yellow-500 to-yellow-600 rounded-2xl p-12 border border-yellow-400/50 text-center max-w-lg",children:[e.jsx(W.div,{animate:{rotate:[0,10,-10,0],scale:[1,1.2,1]},transition:{duration:2,repeat:1/0},className:"text-9xl mb-6",children:"ðŸ†"}),e.jsx("h2",{className:"text-4xl font-bold text-white mb-4",children:"Tournoi terminÃ© !"}),e.jsx("p",{className:"text-xl text-white/90 mb-6",children:"FÃ©licitations au vainqueur ! ðŸŽ‰"}),e.jsxs("div",{className:"bg-white/20 backdrop-blur-sm rounded-xl p-6 mb-6",children:[e.jsxs("p",{className:"text-5xl font-bold text-white mb-2",children:[Math.floor(o.prizePool*.5),"â‚¬"]}),e.jsx("p",{className:"text-white/80",children:"Gain du vainqueur"})]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-8 py-4 bg-white text-yellow-600 rounded-xl font-bold hover:scale-105 transition-transform",children:"Retour Ã  l'accueil"})]})})]})})})},Vo=async()=>{try{const s=S(k,"suspicious_activities"),t=await z(s);if(!t.exists())return[];const r=t.val();return Object.entries(r).map(([a,i])=>({id:a,...i})).sort((a,i)=>i.timestamp-a.timestamp)}catch(s){throw b.error("Erreur rÃ©cupÃ©ration activitÃ©s suspectes:",s),new Error("Impossible de rÃ©cupÃ©rer les activitÃ©s suspectes")}},lh=async()=>{try{const s=await Vo(),t={total:s.length,unresolved:s.filter(r=>!r.resolved).length,bySeverity:{low:s.filter(r=>r.severity==="low").length,medium:s.filter(r=>r.severity==="medium").length,high:s.filter(r=>r.severity==="high").length},byType:{}};return s.forEach(r=>{t.byType[r.type]||(t.byType[r.type]=0),t.byType[r.type]++}),t}catch(s){throw b.error("Erreur rÃ©cupÃ©ration stats anti-cheat:",s),new Error("Impossible de rÃ©cupÃ©rer les statistiques")}},ch=async(s,t)=>{try{const r=S(k,`suspicious_activities/${s}`);if(!(await z(r)).exists())throw new Error("ActivitÃ© introuvable");await oe(r,{resolved:!0,resolvedAt:Date.now(),resolvedBy:t||"admin"})}catch(r){throw b.error("Erreur rÃ©solution activitÃ©:",r),new Error("Impossible de rÃ©soudre l'activitÃ©")}},dh=async s=>{try{const t=S(k,`suspicious_activities/${s}`);await os(t)}catch(t){throw b.error("Erreur suppression activitÃ©:",t),new Error("Impossible de supprimer l'activitÃ©")}},uh=()=>{var P;const[s,t]=m.useState([]),[r,n]=m.useState(null),[a,i]=m.useState(!0),[o,l]=m.useState("unresolved"),[c,d]=m.useState("all"),[u,h]=m.useState(null);m.useEffect(()=>{p()},[]);const p=async()=>{i(!0);try{const[w,I]=await Promise.all([Vo(),lh()]);t(w),n(I)}catch(w){b.error("Erreur chargement anti-cheat:",w),$({title:"Erreur",description:"Impossible de charger les donnÃ©es anti-cheat",variant:"destructive"})}finally{i(!1)}},f=async w=>{h(w);try{await ch(w),$({title:"âœ… ActivitÃ© rÃ©solue",description:"L'activitÃ© a Ã©tÃ© marquÃ©e comme rÃ©solue"}),await p()}catch(I){$({title:"Erreur",description:I.message,variant:"destructive"})}finally{h(null)}},x=async w=>{if(confirm("âš ï¸ Supprimer dÃ©finitivement cette activitÃ© ?")){h(w);try{await dh(w),$({title:"ðŸ—‘ï¸ ActivitÃ© supprimÃ©e",description:"L'activitÃ© a Ã©tÃ© supprimÃ©e"}),await p()}catch(I){$({title:"Erreur",description:I.message,variant:"destructive"})}finally{h(null)}}},g=w=>{switch(w){case"high":return{label:"Critique",color:"text-red-500",bg:"bg-red-500/10",border:"border-red-500"};case"medium":return{label:"Moyen",color:"text-yellow-500",bg:"bg-yellow-500/10",border:"border-yellow-500"};case"low":return{label:"Faible",color:"text-blue-500",bg:"bg-blue-500/10",border:"border-blue-500"};default:return{label:"Inconnu",color:"text-gray-500",bg:"bg-gray-500/10",border:"border-gray-500"}}},y=w=>{switch(w){case"fortune_spike":return e.jsx(Wt,{className:"h-4 w-4"});case"elo_spike":return e.jsx(Oe,{className:"h-4 w-4"});case"rapid_actions":return e.jsx(jt,{className:"h-4 w-4"});case"negative_value":return e.jsx(ir,{className:"h-4 w-4"});default:return e.jsx(ds,{className:"h-4 w-4"})}},j=w=>{switch(w){case"fortune_spike":return"Pic de fortune";case"elo_spike":return"Pic d'ELO";case"rapid_actions":return"Actions rapides";case"negative_value":return"Valeur nÃ©gative";default:return w}},M=s.filter(w=>!(o==="resolved"&&!w.resolved||o==="unresolved"&&w.resolved||c!=="all"&&w.type!==c));return a?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ue,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsx(L,{children:e.jsxs(V,{className:"p-4 text-center",children:[e.jsx(ds,{className:"mx-auto mb-2 h-6 w-6 text-yellow-500"}),e.jsx("p",{className:"text-2xl font-bold",children:(r==null?void 0:r.total)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total"})]})}),e.jsx(L,{className:"border-red-500/30 bg-red-500/5",children:e.jsxs(V,{className:"p-4 text-center",children:[e.jsx(ir,{className:"mx-auto mb-2 h-6 w-6 text-red-500"}),e.jsx("p",{className:"text-2xl font-bold text-red-500",children:(r==null?void 0:r.unresolved)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Non rÃ©solues"})]})}),e.jsx(L,{className:"border-green-500/30 bg-green-500/5",children:e.jsxs(V,{className:"p-4 text-center",children:[e.jsx(Gr,{className:"mx-auto mb-2 h-6 w-6 text-green-500"}),e.jsx("p",{className:"text-2xl font-bold text-green-500",children:((r==null?void 0:r.total)||0)-((r==null?void 0:r.unresolved)||0)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"RÃ©solues"})]})}),e.jsx(L,{children:e.jsxs(V,{className:"p-4 text-center",children:[e.jsx(Jt,{className:"mx-auto mb-2 h-6 w-6 text-primary"}),e.jsx("p",{className:"text-2xl font-bold",children:((P=r==null?void 0:r.bySeverity)==null?void 0:P.high)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Critiques"})]})})]}),(r==null?void 0:r.byType)&&Object.keys(r.byType).length>0&&e.jsxs(L,{children:[e.jsx(xe,{children:e.jsx(he,{className:"text-sm",children:"Distribution par type"})}),e.jsx(V,{children:e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(r.byType).map(([w,I])=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded bg-muted",children:[e.jsxs("span",{className:"text-xs flex items-center gap-2",children:[y(w),j(w)]}),e.jsx(le,{variant:"outline",children:I})]},w))})})]}),e.jsx(L,{children:e.jsxs(V,{className:"p-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[e.jsxs("span",{className:"text-sm font-medium self-center flex items-center gap-1",children:[e.jsx(gr,{className:"h-3 w-3"}),"Statut:"]}),e.jsx(T,{size:"sm",variant:o==="all"?"default":"outline",onClick:()=>l("all"),children:"Tout"}),e.jsx(T,{size:"sm",variant:o==="unresolved"?"default":"outline",onClick:()=>l("unresolved"),children:"Non rÃ©solues"}),e.jsx(T,{size:"sm",variant:o==="resolved"?"default":"outline",onClick:()=>l("resolved"),children:"RÃ©solues"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("span",{className:"text-sm font-medium self-center",children:"Type:"}),e.jsx(T,{size:"sm",variant:c==="all"?"default":"outline",onClick:()=>d("all"),children:"Tout"}),e.jsx(T,{size:"sm",variant:c==="fortune_spike"?"default":"outline",onClick:()=>d("fortune_spike"),children:"Fortune"}),e.jsx(T,{size:"sm",variant:c==="elo_spike"?"default":"outline",onClick:()=>d("elo_spike"),children:"ELO"}),e.jsx(T,{size:"sm",variant:c==="rapid_actions"?"default":"outline",onClick:()=>d("rapid_actions"),children:"Actions rapides"})]})]})}),e.jsx("div",{className:"space-y-2",children:M.length===0?e.jsx(L,{children:e.jsxs(V,{className:"p-12 text-center",children:[e.jsx(wt,{className:"h-16 w-16 text-green-500 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:o==="unresolved"?"âœ… Aucune activitÃ© suspecte non rÃ©solue":"Aucune activitÃ© trouvÃ©e"})]})}):M.map((w,I)=>{const O=g(w.severity);return e.jsx(W.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:I*.05},children:e.jsx(L,{className:`${w.resolved?"opacity-60":""} ${O.bg} border ${O.border}`,children:e.jsx(V,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`rounded-lg ${O.bg} p-2 ${O.color}`,children:y(w.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-start justify-between gap-2 mb-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1 flex-wrap",children:[e.jsx(le,{variant:"outline",className:`${O.color} ${O.border}`,children:O.label}),e.jsx(le,{variant:"outline",children:j(w.type)}),w.resolved&&e.jsx(le,{variant:"default",className:"bg-green-500",children:"âœ“ RÃ©solu"})]}),e.jsxs("p",{className:"font-medium text-sm mb-1",children:[e.jsx(Vs,{className:"inline h-3 w-3 mr-1"}),w.username]}),e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:w.description}),(w.oldValue!==void 0||w.newValue!==void 0)&&e.jsxs("div",{className:"flex items-center gap-3 text-xs",children:[w.oldValue!==void 0&&e.jsxs("span",{className:"text-muted-foreground",children:["Ancien: ",e.jsx("span",{className:"font-mono font-bold",children:w.oldValue})]}),w.oldValue!==void 0&&w.newValue!==void 0&&e.jsx("span",{children:"â†’"}),w.newValue!==void 0&&e.jsxs("span",{className:O.color,children:["Nouveau: ",e.jsx("span",{className:"font-mono font-bold",children:w.newValue})]})]})]})}),e.jsxs("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-border",children:[e.jsxs("span",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(it,{className:"h-3 w-3"}),new Date(w.timestamp).toLocaleString("fr-FR")]}),e.jsxs("div",{className:"flex gap-1",children:[!w.resolved&&e.jsx(T,{size:"sm",variant:"default",onClick:()=>f(w.id),disabled:u===w.id,className:"h-7 text-xs",children:u===w.id?e.jsx(ue,{className:"h-3 w-3 animate-spin"}):e.jsx(Gr,{className:"h-3 w-3"})}),e.jsx(T,{size:"sm",variant:"destructive",onClick:()=>x(w.id),disabled:u===w.id,className:"h-7 text-xs",children:u===w.id?e.jsx(ue,{className:"h-3 w-3 animate-spin"}):e.jsx(ns,{className:"h-3 w-3"})})]})]})]})]})})})},w.id)})})]})},mh=Ul,xh=ql,Go=m.forwardRef(({className:s,children:t,...r},n)=>e.jsxs(Zn,{ref:n,className:me("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...r,children:[t,e.jsx(Il,{asChild:!0,children:e.jsx(di,{className:"h-4 w-4 opacity-50"})})]}));Go.displayName=Zn.displayName;const Ho=m.forwardRef(({className:s,...t},r)=>e.jsx(Wn,{ref:r,className:me("flex cursor-default items-center justify-center py-1",s),...t,children:e.jsx(cc,{className:"h-4 w-4"})}));Ho.displayName=Wn.displayName;const Zo=m.forwardRef(({className:s,...t},r)=>e.jsx(Qn,{ref:r,className:me("flex cursor-default items-center justify-center py-1",s),...t,children:e.jsx(di,{className:"h-4 w-4"})}));Zo.displayName=Qn.displayName;const Wo=m.forwardRef(({className:s,children:t,position:r="popper",...n},a)=>e.jsx(Dl,{children:e.jsxs(Jn,{ref:a,className:me("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:r,...n,children:[e.jsx(Ho,{}),e.jsx(Fl,{className:me("p-1",r==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),e.jsx(Zo,{})]})}));Wo.displayName=Jn.displayName;const hh=m.forwardRef(({className:s,...t},r)=>e.jsx(Yn,{ref:r,className:me("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...t}));hh.displayName=Yn.displayName;const na=m.forwardRef(({className:s,children:t,...r},n)=>e.jsxs(Kn,{ref:n,className:me("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",s),...r,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(zl,{children:e.jsx(at,{className:"h-4 w-4"})})}),e.jsx(Bl,{children:t})]}));na.displayName=Kn.displayName;const fh=m.forwardRef(({className:s,...t},r)=>e.jsx(Xn,{ref:r,className:me("-mx-1 my-1 h-px bg-muted",s),...t}));fh.displayName=Xn.displayName;function ph(s){return{id:s.id,userId:s.ui,username:s.un,text:s.tx,timestamp:s.ts}}function gh(s,t){return[s,t].sort().join("_")}async function bh(s){try{const t=S(k,"chats/admin_chat");if((await z(t)).exists())return;const n={id:"admin_chat",t:"group",n:"ðŸ’¬ Chat Administrateur",m:[s],mn:{},ca:Date.now(),cb:s,ac:!0};await Re(t,n),await Re(S(k,`userChats/${s}/admin_chat`),!0),b.log("âœ… Chat admin crÃ©Ã©")}catch(t){throw b.error("Erreur crÃ©ation chat admin:",t),t}}async function Qo(s){try{const t=S(k,"chats/admin_info");if((await z(t)).exists()){b.log("âœ… Canal info admin existe dÃ©jÃ ");return}const n={id:"admin_info",t:"admin_info",n:"ðŸ“¢ Informations Admin",m:[],mn:{},ca:Date.now(),cb:s,ac:!0};await Re(t,n),b.log("âœ… Canal info admin crÃ©Ã©")}catch(t){throw b.error("Erreur crÃ©ation canal info:",t),t}}async function vh(s,t,r,n){try{const a=gh(s,t),i=S(k,`chats/${a}`);if((await z(i)).exists())return a;const l={id:a,t:"private",m:[s,t],mn:{[s]:r,[t]:n},ca:Date.now(),cb:s};return await Re(i,l),await Promise.all([Re(S(k,`userChats/${s}/${a}`),!0),Re(S(k,`userChats/${t}/${a}`),!0)]),a}catch(a){throw b.error("Erreur crÃ©ation chat privÃ©:",a),a}}async function yh(s,t,r,n,a){try{if(!r||r.trim().length===0)throw new Error("Le nom du groupe est requis");if(n.length<1)throw new Error("Un groupe doit contenir au moins 1 autre membre");const i=[...new Set([s,...n])],o={[s]:t,...a},l=mt(S(k,"chats")),c=l.key,d={id:c,t:"group",n:r.trim(),m:i,mn:o,ca:Date.now(),cb:s,ac:!1};return await Re(l,d),await Promise.all(i.map(u=>Re(S(k,`userChats/${u}/${c}`),!0))),c}catch(i){throw b.error("Erreur crÃ©ation groupe:",i),i}}async function Jo(s,t,r,n){try{if(!n||n.trim().length===0)throw new Error("Le message ne peut pas Ãªtre vide");const a=S(k,`chats/${s}`),i=await z(a);if(!i.exists())throw new Error("Chat introuvable");const o=i.val(),l=Array.isArray(o.m)?o.m:[];if(o.ac&&!l.includes(t)){const p={};p[`chats/${s}/m`]=[...l,t],p[`chats/${s}/mn/${t}`]=r,p[`userChats/${t}/${s}`]=!0,await oe(S(k),p)}else if(!o.ac&&!l.includes(t))throw new Error("Vous n'Ãªtes pas membre de ce chat");const c=S(k,`chats/${s}/messages`),u={id:mt(c).key,ui:t,un:r,tx:n.trim(),ts:Date.now()},h={};h[`chats/${s}/messages/${u.id}`]=u,h[`chats/${s}/lm`]={tx:u.tx,ts:u.ts,ui:u.ui,un:u.un},await oe(S(k),h)}catch(a){throw b.error("Erreur envoi message:",a),a}}async function jh(s,t,r,n){try{if(n!=="admin")throw new Error("Seuls les administrateurs peuvent envoyer des infos");await Qo(s),await Jo("admin_info",s,`ðŸ“¢ ${t}`,r)}catch(a){throw b.error("Erreur envoi info admin:",a),a}}async function Vr(s,t){try{const r=S(k,`userChats/${s}`),n=await z(r),a=n.exists()?Object.keys(n.val()):[];a.includes("admin_info")||(a.push("admin_info"),await Re(S(k,`userChats/${s}/admin_info`),!0));const i=[],o=a.map(async c=>{const d=S(k,`chats/${c}`),u=await z(d);if(u.exists()){const h=u.val();return Array.isArray(h.m)||(h.m=[]),{id:c,...h}}return null}),l=await Promise.all(o);return i.push(...l.filter(c=>c!==null)),i.sort((c,d)=>{var p,f;if(c.id==="admin_info")return-1;if(d.id==="admin_info")return 1;if(c.id==="admin_chat")return-1;if(d.id==="admin_chat")return 1;const u=((p=c.lm)==null?void 0:p.ts)||c.ca;return(((f=d.lm)==null?void 0:f.ts)||d.ca)-u})}catch(r){return b.error("Erreur rÃ©cupÃ©ration chats:",r),[]}}async function wh(s,t=50){try{const r=S(k,`chats/${s}/messages`);let n;try{n=or(r,xi("ts"),lr(t))}catch(o){b.warn("Index non configurÃ©, utilisation de orderByKey",o),n=or(r,lr(t))}const a=await z(n);return a.exists()?Object.values(a.val()).sort((o,l)=>o.ts-l.ts):[]}catch(r){return b.error("Erreur rÃ©cupÃ©ration messages:",r),[]}}function Nh(s,t,r=50){const n=S(k,`chats/${s}/messages`);let a;try{a=or(n,xi("ts"),lr(r))}catch{a=or(n,lr(r))}const i=et(a,o=>{if(!o.exists()){t([]);return}const l=Object.values(o.val());t(l.sort((c,d)=>c.ts-d.ts))},o=>{b.error("Erreur Ã©coute messages:",o),t([])});return()=>ca(a,"value",i)}function Ch(s,t){const r=S(k,`userChats/${s}`),n=et(r,async a=>{const i=a.exists()?Object.keys(a.val()):[];i.includes("admin_info")||(i.push("admin_info"),await Re(S(k,`userChats/${s}/admin_info`),!0));const o=i.map(async d=>{const u=S(k,`chats/${d}`),h=await z(u);if(h.exists()){const p=h.val();return Array.isArray(p.m)||(p.m=[]),{id:d,...p}}return null}),c=(await Promise.all(o)).filter(d=>d!==null);c.sort((d,u)=>{var f,x;if(d.id==="admin_info")return-1;if(u.id==="admin_info")return 1;if(d.id==="admin_chat")return-1;if(u.id==="admin_chat")return 1;const h=((f=d.lm)==null?void 0:f.ts)||d.ca;return(((x=u.lm)==null?void 0:x.ts)||u.ca)-h}),t(c)},a=>{b.error("Erreur Ã©coute chats:",a),t([])});return()=>ca(r,"value",n)}async function Sh(s,t,r,n){try{const a=S(k,`chats/${s}`),i=await z(a);if(!i.exists())throw new Error("Chat introuvable");const o=i.val(),l=Array.isArray(o.m)?o.m:[];if(o.ac)throw new Error("Impossible de modifier les chats systÃ¨me");if(o.t!=="group")throw new Error("Ce n'est pas un groupe");if(!l.includes(n))throw new Error("Vous n'Ãªtes pas membre de ce groupe");if(l.includes(t))throw new Error("L'utilisateur est dÃ©jÃ  membre");const c={};c[`chats/${s}/m`]=[...l,t],c[`chats/${s}/mn/${t}`]=r,c[`userChats/${t}/${s}`]=!0,await oe(S(k),c)}catch(a){throw b.error("Erreur ajout membre:",a),a}}async function kh(s,t,r){try{const n=S(k,`chats/${s}`),a=await z(n);if(!a.exists())throw new Error("Chat introuvable");const i=a.val(),o=Array.isArray(i.m)?i.m:[];if(i.ac)throw new Error("Impossible de modifier les chats systÃ¨me");if(i.t!=="group")throw new Error("Ce n'est pas un groupe");if(o.length<=2)throw new Error("Un groupe doit contenir au moins 2 membres");const l={};l[`chats/${s}/m`]=o.filter(c=>c!==t),l[`chats/${s}/mn/${t}`]=null,l[`userChats/${t}/${s}`]=null,await oe(S(k),l)}catch(n){throw b.error("Erreur retrait membre:",n),n}}async function _h(s,t,r){try{const n=S(k,`chats/${s}`),a=await z(n);if(!a.exists())throw new Error("Chat introuvable");const i=a.val(),o=Array.isArray(i.m)?i.m:[];if(i.ac)throw new Error("Les chats systÃ¨me ne peuvent pas Ãªtre supprimÃ©s");if(i.t!=="group")throw new Error("Seuls les groupes peuvent Ãªtre supprimÃ©s");if(i.cb!==t&&r!=="admin")throw new Error("Permission refusÃ©e");const l={};o.forEach(c=>{l[`userChats/${c}/${s}`]=null}),l[`chats/${s}`]=null,await oe(S(k),l)}catch(n){throw b.error("Erreur suppression groupe:",n),n}}async function Eh(s,t){try{const r=S(k,"users"),n=await z(r);if(!n.exists())return[];const a=n.val(),i=[],o=s.toLowerCase().trim();return Object.entries(a).forEach(([l,c])=>{if(l===t)return;const d=c.username||"";d.toLowerCase().includes(o)&&i.push({id:l,username:d})}),i.slice(0,20)}catch(r){return b.error("Erreur recherche utilisateurs:",r),[]}}const Rh=()=>{var ka,_a;const{user:s,userProfile:t}=Ae(),r=ht(),[n,a]=m.useState(!1),[i,o]=m.useState(!1),[l,c]=m.useState([]),[d,u]=m.useState([]),[h,p]=m.useState([]),[f,x]=m.useState([]),[g,y]=m.useState(""),[j,M]=m.useState({totalUsers:0,totalMatches:0,totalTournaments:0,totalBets:0,totalFortune:0,activeUsers:0}),[P,w]=m.useState(!1),[I,O]=m.useState(!1),[N,R]=m.useState(!1),[F,A]=m.useState(!1),[B,_]=m.useState(!1),[J,U]=m.useState(!1),[X,pe]=m.useState(null),[ge,ye]=m.useState(null),[ee,se]=m.useState(""),[H,fe]=m.useState(""),[D,E]=m.useState(""),[Q,ae]=m.useState("1000"),[C,q]=m.useState(""),[Y,v]=m.useState(""),[Z,K]=m.useState(""),[ne,Se]=m.useState(""),[Me,Ge]=m.useState("add"),[tt,st]=m.useState(""),[Xe,Ct]=m.useState(""),[es,ft]=m.useState(!1),ks=[{id:"founder",name:"Fondateur",icon:"ðŸ‘‘",color:"gold"},{id:"veteran",name:"VÃ©tÃ©ran",icon:"âš”ï¸",color:"silver"},{id:"champion",name:"Champion",icon:"ðŸ†",color:"gold"},{id:"collector",name:"Collectionneur",icon:"ðŸŽ´",color:"purple"},{id:"millionaire",name:"Millionnaire",icon:"ðŸ’°",color:"green"}];m.useEffect(()=>{s&&t&&(a(t.role==="admin"),t.role==="admin"&&We())},[s,t]);const We=async()=>{o(!0);try{const G=S(k,"users"),ce=await z(G);if(ce.exists()){const Ce=ce.val(),Ke=Object.entries(Ce).map(([Bt,Ut])=>({id:Bt,...Ut}));c(Ke);const zt=Ke.reduce((Bt,Ut)=>Bt+(Ut.fortune||0),0),ul=Ke.filter(Bt=>{const Ut=Bt.lastActive||0;return Date.now()-Ut<24*60*60*1e3}).length,ml=S(k,"matches"),Ea=await z(ml);let Ra=0,Cr=[];if(Ea.exists()){const Bt=Ea.val();Cr=Object.entries(Bt).map(([Ut,hl])=>({id:Ut,...hl})),Ra=Cr.length}u(Cr);const xl=S(k,"tournaments"),$a=await z(xl);let Aa=0;$a.exists()&&(Aa=Object.keys($a.val()).length),M({totalUsers:Ke.length,totalMatches:Ra,totalTournaments:Aa,totalBets:0,totalFortune:zt,activeUsers:ul})}o(!1)}catch(G){b.error("Erreur chargement donnÃ©es admin:",G),$({title:"Erreur",description:"Impossible de charger les donnÃ©es",variant:"destructive"}),o(!1)}},ts=async()=>{if(!s||!t||!Xe.trim()){$({title:"Erreur",description:"Le message ne peut pas Ãªtre vide",variant:"destructive"});return}if(t.role!=="admin"){$({title:"AccÃ¨s refusÃ©",description:"Seuls les administrateurs peuvent envoyer des messages d'info",variant:"destructive"});return}ft(!0);try{await jh(s.uid,t.username,Xe,t.role),$({title:"ðŸ“¢ Message envoyÃ©",description:"Le message d'information a Ã©tÃ© diffusÃ© Ã  tous les joueurs"}),Ct(""),U(!1)}catch(G){b.error("Erreur envoi message info:",G),$({title:"Erreur",description:G.message||"Impossible d'envoyer le message",variant:"destructive"})}finally{ft(!1)}},el=async()=>{if(!ee||!H||!D){$({title:"Erreur",description:"Remplissez tous les champs",variant:"destructive"});return}o(!0);try{const G=la(),Ce=(await ui(G,ee,H)).user.uid,Ke=S(k,`users/${Ce}`);await Re(Ke,{username:D,email:ee,eloRating:parseInt(Q),fortune:100,wins:0,losses:0,role:"player",banned:!1,createdAt:new Date().toISOString()}),$({title:"âœ… Utilisateur crÃ©Ã©",description:`${D} a Ã©tÃ© ajoutÃ©`}),w(!1),se(""),fe(""),E(""),ae("1000"),We()}catch(G){b.error("Erreur crÃ©ation utilisateur:",G),$({title:"Erreur",description:G.message,variant:"destructive"})}finally{o(!1)}},tl=async()=>{if(X){o(!0);try{const G=S(k,`users/${X.id}`),ce={};if(C&&(ce.eloRating=parseInt(C)),Y&&(ce.fortune=parseInt(Y)),Z&&(ce.role=Z),await oe(G,ce),Y){const Ce=X.fortune||0,Ke=parseInt(Y),zt=Ke-Ce;await Ve(X.id,Ke,zt,`Ajustement admin par ${(t==null?void 0:t.username)||"Admin"}`)}$({title:"âœ… Utilisateur modifiÃ©",description:"Les modifications ont Ã©tÃ© sauvegardÃ©es"}),O(!1),pe(null),q(""),v(""),K(""),We()}catch(G){b.error("Erreur modification utilisateur:",G),$({title:"Erreur",description:G.message,variant:"destructive"})}finally{o(!1)}}},sl=async(G,ce)=>{if(confirm(`âš ï¸ Supprimer dÃ©finitivement ${ce} ?

Cette action est irrÃ©versible.`)){o(!0);try{const Ce=S(k,`users/${G}`);await os(Ce),$({title:"ðŸ—‘ï¸ Utilisateur supprimÃ©",description:`${ce} a Ã©tÃ© retirÃ© de la base de donnÃ©es`}),We()}catch(Ce){b.error("Erreur suppression utilisateur:",Ce),$({title:"Erreur",description:Ce.message,variant:"destructive"})}finally{o(!1)}}},rl=async()=>{if(!X||!ne)return;const G=parseInt(ne);if(isNaN(G)||G<=0){$({title:"Erreur",description:"Montant invalide",variant:"destructive"});return}o(!0);try{const ce=S(k,`users/${X.id}`),Ce=await z(ce);if(Ce.exists()){const Ke=Ce.val().fortune||0,zt=Me==="add"?Ke+G:Math.max(0,Ke-G);await oe(ce,{fortune:zt}),$({title:"ðŸ’° Fortune mise Ã  jour",description:`${Me==="add"?"+":"-"}${G}â‚¬`}),R(!1),Se(""),We()}}catch(ce){b.error("Erreur gestion fortune:",ce),$({title:"Erreur",description:ce.message,variant:"destructive"})}finally{o(!1)}},al=async()=>{var G;if(!(!X||!tt)){o(!0);try{const ce=S(k,`users/${X.id}`),Ce=await z(ce);if(Ce.exists()){const Ke=Ce.val().badges||[];Ke.includes(tt)?$({title:"Badge dÃ©jÃ  possÃ©dÃ©",description:"L'utilisateur a dÃ©jÃ  ce badge",variant:"destructive"}):(await oe(ce,{badges:[...Ke,tt]}),$({title:"ðŸ… Badge attribuÃ©",description:`Badge "${(G=ks.find(zt=>zt.id===tt))==null?void 0:G.name}" donnÃ© Ã  ${X.username}`})),A(!1),st(""),We()}}catch(ce){b.error("Erreur attribution badge:",ce),$({title:"Erreur",description:ce.message,variant:"destructive"})}finally{o(!1)}}},nl=async(G,ce)=>{if(confirm(`âš ï¸ Bannir ${ce} ?

L'utilisateur ne pourra plus se connecter.`)){o(!0);try{const Ce=S(k,`users/${G}`);if(!(await z(Ce)).exists()){$({title:"Erreur",description:"Utilisateur introuvable",variant:"destructive"});return}await oe(Ce,{banned:!0,bannedAt:new Date().toISOString(),bannedBy:(s==null?void 0:s.uid)||"admin"}),$({title:"ðŸš« Utilisateur banni",description:`${ce} a Ã©tÃ© banni et ne peut plus se connecter`}),await We()}catch(Ce){b.error("Erreur bannissement:",Ce),$({title:"Erreur",description:Ce.message||"Impossible de bannir l'utilisateur",variant:"destructive"})}finally{o(!1)}}},il=async(G,ce)=>{if(confirm(`âœ… DÃ©bannir ${ce} ?

L'utilisateur pourra Ã  nouveau se connecter.`)){o(!0);try{const Ce=S(k,`users/${G}`);if(!(await z(Ce)).exists()){$({title:"Erreur",description:"Utilisateur introuvable",variant:"destructive"});return}await oe(Ce,{banned:!1,unbannedAt:new Date().toISOString(),unbannedBy:(s==null?void 0:s.uid)||"admin"}),$({title:"âœ… Utilisateur dÃ©banni",description:`${ce} peut maintenant se reconnecter`}),await We()}catch(Ce){b.error("Erreur dÃ©bannissement:",Ce),$({title:"Erreur",description:Ce.message||"Impossible de dÃ©bannir l'utilisateur",variant:"destructive"})}finally{o(!1)}}},ol=async G=>{if(confirm(`âš ï¸ Supprimer ce match ?

Cette action est irrÃ©versible.`)){o(!0);try{const ce=S(k,`matches/${G}`);await os(ce),$({title:"ðŸ—‘ï¸ Match supprimÃ©",description:"Le match a Ã©tÃ© supprimÃ©"}),We()}catch(ce){b.error("Erreur suppression match:",ce),$({title:"Erreur",description:ce.message,variant:"destructive"})}finally{o(!1)}}},ll=async()=>{if(confirm(`âš ï¸ ATTENTION : Remettre tous les ELO Ã  1000 ?

Cette action est irrÃ©versible.`)){o(!0);try{const G={};l.forEach(ce=>{G[`users/${ce.id}/eloRating`]=1e3}),await oe(S(k),G),$({title:"ðŸ”„ ELO reset",description:"Tous les joueurs sont Ã  1000 ELO"}),We()}catch(G){b.error("Erreur reset ELO:",G),$({title:"Erreur",description:G.message,variant:"destructive"})}finally{o(!1)}}},cl=async()=>{if(confirm("ðŸ’° Ajouter 500â‚¬ Ã  tous les joueurs ?")){o(!0);try{const G={};l.forEach(ce=>{G[`users/${ce.id}/fortune`]=(ce.fortune||0)+500}),await oe(S(k),G),$({title:"ðŸ’° Fortune distribuÃ©e",description:"500â‚¬ ajoutÃ©s Ã  tous les joueurs"}),We()}catch(G){b.error("Erreur ajout fortune:",G),$({title:"Erreur",description:G.message,variant:"destructive"})}finally{o(!1)}}},Sa=async()=>{if(confirm(`âš ï¸ DANGER : Supprimer TOUS les matchs ?

Cette action est IRRÃ‰VERSIBLE.`)){o(!0);try{const G=S(k,"matches");await os(G),$({title:"ðŸ—‘ï¸ Matchs supprimÃ©s",description:"Tous les matchs ont Ã©tÃ© effacÃ©s"}),We()}catch(G){b.error("Erreur suppression matchs:",G),$({title:"Erreur",description:G.message,variant:"destructive"})}finally{o(!1)}}},dl=l.filter(G=>{var ce,Ce;return((ce=G.username)==null?void 0:ce.toLowerCase().includes(g.toLowerCase()))||((Ce=G.email)==null?void 0:Ce.toLowerCase().includes(g.toLowerCase()))});return t?n?i&&l.length===0?e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-background",children:e.jsx(ue,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"container mx-auto p-3 sm:p-4 max-w-7xl",children:[e.jsx(W.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-4 sm:mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"rounded-xl bg-primary/20 p-2 sm:p-3",children:e.jsx(wt,{className:"h-6 w-6 sm:h-8 sm:w-8 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl font-bold",children:"Admin Panel"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Gestion complÃ¨te"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(T,{variant:"default",onClick:()=>U(!0),size:"sm",className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(Pa,{className:"mr-1 sm:mr-2 h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"text-xs sm:text-sm",children:"Message Info"})]}),e.jsxs(T,{variant:"outline",onClick:()=>r("/"),size:"sm",children:[e.jsx(Fe,{className:"mr-1 sm:mr-2 h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"text-xs sm:text-sm",children:"Retour"})]})]})]})}),e.jsxs(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"mb-4 sm:mb-6 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-2 sm:gap-3",children:[e.jsx(L,{children:e.jsxs(V,{className:"p-2 sm:p-3 text-center",children:[e.jsx(Ee,{className:"mx-auto mb-1 h-4 w-4 sm:h-5 sm:w-5 text-primary"}),e.jsx("p",{className:"text-base sm:text-lg md:text-xl font-bold",children:j.totalUsers}),e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground",children:"Users"})]})}),e.jsx(L,{children:e.jsxs(V,{className:"p-2 sm:p-3 text-center",children:[e.jsx(dc,{className:"mx-auto mb-1 h-4 w-4 sm:h-5 sm:w-5 text-green-500"}),e.jsx("p",{className:"text-base sm:text-lg md:text-xl font-bold",children:j.activeUsers}),e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground",children:"Actifs"})]})}),e.jsx(L,{children:e.jsxs(V,{className:"p-2 sm:p-3 text-center",children:[e.jsx(Pe,{className:"mx-auto mb-1 h-4 w-4 sm:h-5 sm:w-5 text-yellow-500"}),e.jsx("p",{className:"text-base sm:text-lg md:text-xl font-bold",children:j.totalMatches}),e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground",children:"Matchs"})]})}),e.jsx(L,{children:e.jsxs(V,{className:"p-2 sm:p-3 text-center",children:[e.jsx(Ht,{className:"mx-auto mb-1 h-4 w-4 sm:h-5 sm:w-5 text-purple-500"}),e.jsx("p",{className:"text-base sm:text-lg md:text-xl font-bold",children:j.totalTournaments}),e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground",children:"Tournois"})]})}),e.jsx(L,{children:e.jsxs(V,{className:"p-2 sm:p-3 text-center",children:[e.jsx(js,{className:"mx-auto mb-1 h-4 w-4 sm:h-5 sm:w-5 text-blue-500"}),e.jsx("p",{className:"text-base sm:text-lg md:text-xl font-bold",children:j.totalBets}),e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground",children:"Paris"})]})}),e.jsx(L,{children:e.jsxs(V,{className:"p-2 sm:p-3 text-center",children:[e.jsx(Gt,{className:"mx-auto mb-1 h-4 w-4 sm:h-5 sm:w-5 text-green-500"}),e.jsxs("p",{className:"text-base sm:text-lg md:text-xl font-bold",children:[j.totalFortune,"â‚¬"]}),e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground",children:"Total"})]})})]}),e.jsx(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:e.jsxs(Ss,{defaultValue:"users",className:"space-y-3 sm:space-y-4",children:[e.jsxs(Xt,{className:"grid w-full grid-cols-3 lg:grid-cols-5 gap-1 h-auto p-1",children:[e.jsxs(He,{value:"users",className:"text-xs sm:text-sm px-2 py-1.5",children:[e.jsx(Ee,{className:"h-3 w-3 sm:h-4 sm:w-4 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Users"})]}),e.jsxs(He,{value:"anticheat",className:"text-xs sm:text-sm px-2 py-1.5",children:[e.jsx(wt,{className:"h-3 w-3 sm:h-4 sm:w-4 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Anti-Cheat"})]}),e.jsxs(He,{value:"matches",className:"text-xs sm:text-sm px-2 py-1.5",children:[e.jsx(Pe,{className:"h-3 w-3 sm:h-4 sm:w-4 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Matchs"})]}),e.jsxs(He,{value:"stats",className:"text-xs sm:text-sm px-2 py-1.5",children:[e.jsx(Jt,{className:"h-3 w-3 sm:h-4 sm:w-4 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Stats"})]}),e.jsxs(He,{value:"actions",className:"text-xs sm:text-sm px-2 py-1.5 hidden lg:flex",children:[e.jsx(jt,{className:"h-3 w-3 sm:h-4 sm:w-4 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Actions"})]}),e.jsxs(He,{value:"logs",className:"text-xs sm:text-sm px-2 py-1.5 hidden lg:flex",children:[e.jsx(it,{className:"h-3 w-3 sm:h-4 sm:w-4 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Logs"})]})]}),e.jsxs(Je,{value:"users",className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 items-stretch sm:items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(lt,{className:"absolute left-2 sm:left-3 top-1/2 -translate-y-1/2 h-3 w-3 sm:h-4 sm:w-4 text-muted-foreground"}),e.jsx(je,{placeholder:"Rechercher...",value:g,onChange:G=>y(G.target.value),className:"pl-8 sm:pl-10 text-xs sm:text-sm h-8 sm:h-10"})]}),e.jsxs(T,{onClick:()=>w(!0),size:"sm",className:"text-xs sm:text-sm h-8 sm:h-10 shrink-0",children:[e.jsx(is,{className:"mr-1 h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"hidden xs:inline",children:"Ajouter"})]})]}),e.jsx("div",{className:"space-y-2",children:dl.map(G=>e.jsx(L,{className:G.banned?"opacity-50 border-destructive border-2":"",children:e.jsx(V,{className:"p-2 sm:p-3",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-start gap-2 sm:gap-3",children:[e.jsx("div",{className:"rounded-full bg-primary/20 p-1.5 sm:p-2 shrink-0",children:e.jsx(Ee,{className:"h-3 w-3 sm:h-4 sm:w-4 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 flex-wrap",children:[e.jsx("p",{className:"font-bold text-xs sm:text-sm truncate",children:G.username}),G.role==="admin"&&e.jsx(le,{variant:"default",className:"text-[10px] px-1 py-0",children:"Admin"}),G.banned&&e.jsx(le,{variant:"destructive",className:"text-[10px] px-1 py-0",children:"Banni"})]}),e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground truncate",children:G.email}),e.jsxs("div",{className:"flex gap-2 text-[10px] sm:text-xs text-muted-foreground flex-wrap",children:[e.jsxs("span",{children:["âš¡",G.eloRating||1e3]}),e.jsxs("span",{children:["ðŸ’°",G.fortune||0,"â‚¬"]}),e.jsxs("span",{children:["ðŸ†",G.wins||0,"W-",G.losses||0,"L"]})]})]})]}),e.jsxs("div",{className:"flex gap-1 flex-wrap",children:[e.jsx(T,{size:"sm",variant:"outline",onClick:()=>{pe(G),R(!0)},className:"h-7 w-7 p-0",title:"Fortune",children:e.jsx(Gt,{className:"h-3 w-3"})}),e.jsx(T,{size:"sm",variant:"outline",onClick:()=>{pe(G),A(!0)},className:"h-7 w-7 p-0",title:"Badge",children:e.jsx(Ht,{className:"h-3 w-3"})}),e.jsx(T,{size:"sm",variant:"outline",onClick:()=>{var ce,Ce;pe(G),q(((ce=G.eloRating)==null?void 0:ce.toString())||"1000"),v(((Ce=G.fortune)==null?void 0:Ce.toString())||"0"),K(G.role||"player"),O(!0)},className:"h-7 w-7 p-0",title:"Modifier",children:e.jsx(ai,{className:"h-3 w-3"})}),G.banned?e.jsx(T,{size:"sm",variant:"default",onClick:()=>il(G.id,G.username),disabled:G.role==="admin",className:"bg-green-600 hover:bg-green-700 h-7 w-7 p-0",title:"DÃ©bannir",children:e.jsx(at,{className:"h-3 w-3"})}):e.jsx(T,{size:"sm",variant:"destructive",onClick:()=>nl(G.id,G.username),disabled:G.role==="admin",className:"h-7 w-7 p-0",title:"Bannir",children:e.jsx(uc,{className:"h-3 w-3"})}),e.jsx(T,{size:"sm",variant:"destructive",onClick:()=>sl(G.id,G.username),disabled:G.role==="admin",className:"h-7 w-7 p-0",title:"Supprimer",children:e.jsx(ns,{className:"h-3 w-3"})})]})]})})},G.id))})]}),e.jsxs(Je,{value:"matches",className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2",children:[e.jsxs("h2",{className:"text-sm sm:text-base font-bold",children:["Matchs (",d.length,")"]}),e.jsxs(T,{variant:"destructive",onClick:Sa,disabled:i||d.length===0,size:"sm",className:"text-xs",children:[e.jsx(ns,{className:"mr-1 h-3 w-3"}),"Supprimer"]})]}),e.jsx("div",{className:"space-y-2",children:d.length===0?e.jsx(L,{children:e.jsx(V,{className:"p-6 text-center text-xs sm:text-sm text-muted-foreground",children:"Aucun match"})}):d.slice(0,50).map(G=>{var ce,Ce;return e.jsx(L,{children:e.jsx(V,{className:"p-2 sm:p-3",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 text-xs sm:text-sm",children:[e.jsxs("div",{className:"text-center flex-1",children:[e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Ã‰quipe 1"}),e.jsx("p",{className:"font-bold text-xs truncate",children:((ce=G.team1Names)==null?void 0:ce.join(" & "))||"?"}),e.jsx("p",{className:"text-lg sm:text-xl font-bold text-primary",children:G.score1||0})]}),e.jsx("div",{className:"text-muted-foreground text-xs",children:"VS"}),e.jsxs("div",{className:"text-center flex-1",children:[e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Ã‰quipe 2"}),e.jsx("p",{className:"font-bold text-xs truncate",children:((Ce=G.team2Names)==null?void 0:Ce.join(" & "))||"?"}),e.jsx("p",{className:"text-lg sm:text-xl font-bold text-primary",children:G.score2||0})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground",children:new Date(G.date||G.timestamp).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(T,{size:"sm",variant:"outline",onClick:()=>{ye(G),_(!0)},className:"h-7 w-7 p-0",children:e.jsx(Ns,{className:"h-3 w-3"})}),e.jsx(T,{size:"sm",variant:"destructive",onClick:()=>ol(G.id),className:"h-7 w-7 p-0",children:e.jsx(ns,{className:"h-3 w-3"})})]})]})]})})},G.id)})})]}),e.jsx(Je,{value:"anticheat",className:"space-y-3",children:e.jsx(uh,{})}),e.jsxs(Je,{value:"stats",className:"space-y-3",children:[e.jsx("h2",{className:"text-sm sm:text-base font-bold",children:"Statistiques"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs(L,{children:[e.jsx(xe,{className:"pb-2",children:e.jsxs(he,{className:"text-sm sm:text-base flex items-center gap-2",children:[e.jsx(Jt,{className:"h-4 w-4 text-primary"}),"Top 5 ELO"]})}),e.jsx(V,{className:"space-y-1.5",children:l.sort((G,ce)=>(ce.eloRating||1e3)-(G.eloRating||1e3)).slice(0,5).map((G,ce)=>e.jsxs("div",{className:"flex items-center justify-between p-1.5 rounded bg-muted text-xs sm:text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(le,{variant:"outline",className:"text-[10px] px-1",children:["#",ce+1]}),e.jsx("span",{className:"font-medium truncate",children:G.username})]}),e.jsx("span",{className:"font-bold text-primary",children:G.eloRating||1e3})]},G.id))})]}),e.jsxs(L,{children:[e.jsx(xe,{className:"pb-2",children:e.jsxs(he,{className:"text-sm sm:text-base flex items-center gap-2",children:[e.jsx(Gt,{className:"h-4 w-4 text-green-500"}),"Top 5 Fortune"]})}),e.jsx(V,{className:"space-y-1.5",children:l.sort((G,ce)=>(ce.fortune||0)-(G.fortune||0)).slice(0,5).map((G,ce)=>e.jsxs("div",{className:"flex items-center justify-between p-1.5 rounded bg-muted text-xs sm:text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(le,{variant:"outline",className:"text-[10px] px-1",children:["#",ce+1]}),e.jsx("span",{className:"font-medium truncate",children:G.username})]}),e.jsxs("span",{className:"font-bold text-green-500",children:[G.fortune||0,"â‚¬"]})]},G.id))})]})]})]}),e.jsxs(Je,{value:"actions",className:"space-y-3",children:[e.jsx("h2",{className:"text-sm sm:text-base font-bold",children:"Actions"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs(L,{children:[e.jsx(xe,{className:"pb-2",children:e.jsxs(he,{className:"text-sm flex items-center gap-2",children:[e.jsx(ds,{className:"h-4 w-4 text-yellow-500"}),"Dangereuses"]})}),e.jsxs(V,{className:"space-y-2",children:[e.jsxs(T,{variant:"destructive",className:"w-full text-xs h-8",onClick:ll,children:[e.jsx(Oe,{className:"mr-2 h-3 w-3"}),"Reset ELO"]}),e.jsxs(T,{variant:"destructive",className:"w-full text-xs h-8",onClick:Sa,children:[e.jsx(ns,{className:"mr-2 h-3 w-3"}),"Supprimer matchs"]})]})]}),e.jsxs(L,{children:[e.jsx(xe,{className:"pb-2",children:e.jsxs(he,{className:"text-sm flex items-center gap-2",children:[e.jsx(at,{className:"h-4 w-4 text-green-500"}),"SÃ©curisÃ©es"]})}),e.jsxs(V,{className:"space-y-2",children:[e.jsxs(T,{variant:"outline",className:"w-full text-xs h-8",onClick:cl,children:[e.jsx(Wt,{className:"mr-2 h-3 w-3"}),"+500â‚¬ Ã  tous"]}),e.jsxs(T,{variant:"outline",className:"w-full text-xs h-8",onClick:We,children:[e.jsx(Ht,{className:"mr-2 h-3 w-3"}),"Recharger"]})]})]})]})]}),e.jsx(Je,{value:"logs",className:"space-y-3",children:e.jsx(L,{children:e.jsxs(V,{className:"p-6 text-center",children:[e.jsx(it,{className:"h-12 w-12 mx-auto mb-3 text-muted-foreground"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Logs en dÃ©veloppement"})]})})})]})}),e.jsx(Ue,{open:J,onOpenChange:U,children:e.jsxs(Le,{className:"max-w-[95vw] sm:max-w-lg",children:[e.jsxs(Ie,{children:[e.jsxs(De,{className:"text-sm sm:text-base flex items-center gap-2",children:[e.jsx(Pa,{className:"h-5 w-5 text-blue-500"}),"Envoyer un message d'information"]}),e.jsx(Ye,{children:'Ce message sera diffusÃ© Ã  tous les joueurs dans le canal "ðŸ“¢ Informations Admin"'})]}),e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsx("div",{className:"p-3 rounded-lg bg-blue-500/10 border border-blue-500/20",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Fs,{className:"h-4 w-4 text-blue-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-xs text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"Conseils d'utilisation :"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Utilisez pour les annonces importantes"}),e.jsx("li",{children:"Maintenances, Ã©vÃ©nements, mises Ã  jour"}),e.jsx("li",{children:"Tous les joueurs recevront la notification"})]})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Message"}),e.jsx(Nr,{placeholder:`Ã‰crivez votre message d'information ici...

Exemple :
ðŸŽ‰ Nouveau tournoi ce week-end !
Inscriptions ouvertes dÃ¨s maintenant.`,value:Xe,onChange:G=>Ct(G.target.value),className:"min-h-[150px] text-sm",maxLength:500}),e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Maximum 500 caractÃ¨res"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[Xe.length,"/500"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(T,{variant:"outline",onClick:()=>{U(!1),Ct("")},className:"flex-1",disabled:es,children:"Annuler"}),e.jsx(T,{onClick:ts,disabled:es||!Xe.trim(),className:"flex-1 bg-blue-600 hover:bg-blue-700",children:es?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"mr-2 h-4 w-4 animate-spin"}),"Envoi..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Gs,{className:"mr-2 h-4 w-4"}),"Envoyer"]})})]})]})]})}),e.jsx(Ue,{open:P,onOpenChange:w,children:e.jsxs(Le,{className:"max-w-[95vw] sm:max-w-md",children:[e.jsxs(Ie,{children:[e.jsx(De,{className:"text-sm sm:text-base",children:"Ajouter utilisateur"}),e.jsx(Ye,{children:"CrÃ©ez un nouveau compte utilisateur."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(je,{type:"text",placeholder:"Nom d'utilisateur",value:D,onChange:G=>E(G.target.value),className:"text-xs sm:text-sm h-8 sm:h-10"}),e.jsx(je,{type:"email",placeholder:"Email",value:ee,onChange:G=>se(G.target.value),className:"text-xs sm:text-sm h-8 sm:h-10"}),e.jsx(je,{type:"password",placeholder:"Mot de passe",value:H,onChange:G=>fe(G.target.value),className:"text-xs sm:text-sm h-8 sm:h-10"}),e.jsx(je,{type:"number",placeholder:"ELO (1000)",value:Q,onChange:G=>ae(G.target.value),className:"text-xs sm:text-sm h-8 sm:h-10"}),e.jsxs(T,{className:"w-full text-xs sm:text-sm h-8 sm:h-10",onClick:el,disabled:i,children:[i?e.jsx(ue,{className:"mr-2 h-3 w-3 sm:h-4 sm:w-4 animate-spin"}):e.jsx(is,{className:"mr-2 h-3 w-3 sm:h-4 sm:w-4"}),"CrÃ©er"]})]})]})}),e.jsx(Ue,{open:I,onOpenChange:O,children:e.jsxs(Le,{className:"max-w-[95vw] sm:max-w-md",children:[e.jsxs(Ie,{children:[e.jsxs(De,{className:"text-sm sm:text-base",children:["Modifier ",X==null?void 0:X.username]}),e.jsx(Ye,{children:"Modifiez les informations de cet utilisateur."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium mb-1 block",children:"ELO"}),e.jsx(je,{type:"number",value:C,onChange:G=>q(G.target.value),className:"text-xs sm:text-sm h-8 sm:h-10"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium mb-1 block",children:"Fortune"}),e.jsx(je,{type:"number",value:Y,onChange:G=>v(G.target.value),className:"text-xs sm:text-sm h-8 sm:h-10"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium mb-1 block",children:"RÃ´le"}),e.jsxs(mh,{value:Z,onValueChange:K,children:[e.jsx(Go,{className:"text-xs sm:text-sm h-8 sm:h-10",children:e.jsx(xh,{})}),e.jsxs(Wo,{children:[e.jsx(na,{value:"player",className:"text-xs sm:text-sm",children:"Joueur"}),e.jsx(na,{value:"admin",className:"text-xs sm:text-sm",children:"Admin"})]})]})]}),e.jsxs(T,{className:"w-full text-xs sm:text-sm h-8 sm:h-10",onClick:tl,disabled:i,children:[i?e.jsx(ue,{className:"mr-2 h-3 w-3 animate-spin"}):e.jsx(at,{className:"mr-2 h-3 w-3"}),"Sauvegarder"]})]})]})}),e.jsx(Ue,{open:N,onOpenChange:R,children:e.jsxs(Le,{className:"max-w-[95vw] sm:max-w-md",children:[e.jsxs(Ie,{children:[e.jsxs(De,{className:"text-sm sm:text-base",children:["Fortune - ",X==null?void 0:X.username]}),e.jsx(Ye,{children:"GÃ©rez la fortune de cet utilisateur."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground",children:["Actuelle: ",e.jsxs("span",{className:"font-bold text-foreground",children:[(X==null?void 0:X.fortune)||0,"â‚¬"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(T,{variant:Me==="add"?"default":"outline",onClick:()=>Ge("add"),size:"sm",className:"text-xs h-8",children:[e.jsx(is,{className:"mr-1 h-3 w-3"}),"Ajouter"]}),e.jsxs(T,{variant:Me==="remove"?"default":"outline",onClick:()=>Ge("remove"),size:"sm",className:"text-xs h-8",children:[e.jsx(Fe,{className:"mr-1 h-3 w-3"}),"Retirer"]})]}),e.jsx(je,{type:"number",placeholder:"Montant",value:ne,onChange:G=>Se(G.target.value),className:"text-xs sm:text-sm h-8 sm:h-10"}),e.jsxs(T,{className:"w-full text-xs sm:text-sm h-8 sm:h-10",onClick:rl,disabled:i,children:[i?e.jsx(ue,{className:"mr-2 h-3 w-3 animate-spin"}):e.jsx(Wt,{className:"mr-2 h-3 w-3"}),"Confirmer"]})]})]})}),e.jsx(Ue,{open:F,onOpenChange:A,children:e.jsxs(Le,{className:"max-w-[95vw] sm:max-w-md",children:[e.jsxs(Ie,{children:[e.jsxs(De,{className:"text-sm sm:text-base",children:["Badge - ",X==null?void 0:X.username]}),e.jsx(Ye,{children:"Ajoutez ou retirez des badges Ã  cet utilisateur."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"grid grid-cols-1 gap-2",children:ks.map(G=>e.jsxs(T,{variant:tt===G.id?"default":"outline",onClick:()=>st(G.id),className:"justify-start text-xs sm:text-sm h-auto py-2",children:[e.jsx("span",{className:"text-xl mr-2",children:G.icon}),e.jsx("span",{className:"font-bold",children:G.name})]},G.id))}),e.jsxs(T,{className:"w-full text-xs sm:text-sm h-8 sm:h-10",onClick:al,disabled:i||!tt,children:[i?e.jsx(ue,{className:"mr-2 h-3 w-3 animate-spin"}):e.jsx(dt,{className:"mr-2 h-3 w-3"}),"Donner"]})]})]})}),e.jsx(Ue,{open:B,onOpenChange:_,children:e.jsxs(Le,{className:"max-w-[95vw] sm:max-w-md",children:[e.jsxs(Ie,{children:[e.jsx(De,{className:"text-sm sm:text-base",children:"DÃ©tails du match"}),e.jsx(Ye,{children:"Consultez les dÃ©tails complets de ce match."})]}),ge&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-3",children:[e.jsxs("div",{className:"text-center p-2 sm:p-3 rounded-lg bg-primary/10",children:[e.jsx("p",{className:"text-[10px] text-muted-foreground mb-1",children:"Ã‰quipe 1"}),e.jsx("p",{className:"font-bold text-xs mb-1 truncate",children:((ka=ge.team1Names)==null?void 0:ka.join(" & "))||"?"}),e.jsx("p",{className:"text-2xl font-bold text-primary",children:ge.score1||0})]}),e.jsxs("div",{className:"text-center p-2 sm:p-3 rounded-lg bg-secondary/10",children:[e.jsx("p",{className:"text-[10px] text-muted-foreground mb-1",children:"Ã‰quipe 2"}),e.jsx("p",{className:"font-bold text-xs mb-1 truncate",children:((_a=ge.team2Names)==null?void 0:_a.join(" & "))||"?"}),e.jsx("p",{className:"text-2xl font-bold text-secondary",children:ge.score2||0})]})]}),e.jsxs("div",{className:"p-2 sm:p-3 rounded-lg bg-muted",children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground",children:"Date"}),e.jsx("p",{className:"font-medium text-xs sm:text-sm",children:new Date(ge.date||ge.timestamp).toLocaleString("fr-FR")})]}),ge.eloChanges&&e.jsxs("div",{className:"p-2 sm:p-3 rounded-lg bg-muted",children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground mb-2",children:"Changements ELO"}),e.jsx("div",{className:"space-y-1 text-xs",children:Object.entries(ge.eloChanges).map(([G,ce])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"truncate",children:G}),e.jsxs("span",{className:ce>0?"text-green-500":"text-red-500",children:[ce>0?"+":"",ce]})]},G))})]})]})]})})]})}):e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-background px-4",children:e.jsxs(W.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-destructive/20",children:e.jsx(wt,{className:"h-8 w-8 text-destructive"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"AccÃ¨s refusÃ©"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Vous n'avez pas les permissions d'administrateur"}),e.jsx(T,{onClick:()=>r("/"),children:"Retour Ã  l'accueil"})]})}):e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-background",children:e.jsx(ue,{className:"h-8 w-8 animate-spin text-primary"})})},$h=()=>{const{user:s}=Ae(),t=ht(),[r,n]=m.useState([]),[a,i]=m.useState([]),[o,l]=m.useState([]),[c,d]=m.useState(0),[u,h]=m.useState(0),[p,f]=m.useState(!1),[x,g]=m.useState(!0),[y,j]=m.useState([]),[M,P]=m.useState(!1);m.useEffect(()=>{(async()=>{g(!0);try{const A=(await mo()).map(B=>({id:B.id,username:B.username,eloRating:B.elo2v2}));n(A)}catch{$({title:"Erreur",description:"Impossible de charger la liste des joueurs.",variant:"destructive"})}finally{g(!1)}})()},[]);const w=async R=>{if(R.preventDefault(),!s){$({title:"Erreur",description:"Vous devez Ãªtre connectÃ©.",variant:"destructive"});return}if(a.length===0||o.length===0){$({title:"Erreur",description:"Veuillez sÃ©lectionner les joueurs des deux Ã©quipes.",variant:"destructive"});return}if(c===u){$({title:"Erreur",description:"Le score final ne peut pas Ãªtre une Ã©galitÃ©.",variant:"destructive"});return}if(c<0||u<0||!Number.isInteger(c)||!Number.isInteger(u)){$({title:"Erreur",description:"Les scores doivent Ãªtre des nombres entiers positifs.",variant:"destructive"});return}if(a.filter(A=>o.includes(A)).length>0){$({title:"Erreur",description:"Un joueur ne peut pas Ãªtre dans les deux Ã©quipes.",variant:"destructive"});return}f(!0),P(!1);try{const A=await gm(a,o,c,u,s.uid),B=c>u?"Ã‰quipe 1":"Ã‰quipe 2",_=[...a,...o];for(const J of A.eloUpdates){const U=c>u&&a.includes(J.userId)||u>c&&o.includes(J.userId);await So(J.userId,`${B} a gagnÃ© ${c}-${u}`,J.eloChange)}j(A.eloUpdates),P(!0),$({title:"Match enregistrÃ© avec succÃ¨s! ðŸ†",description:`${B} a gagnÃ©. Les ELO ont Ã©tÃ© mis Ã  jour.`,duration:5e3}),i([]),l([]),d(0),h(0)}catch(A){b.error("Erreur lors de l'enregistrement du match:",A),$({title:"Erreur d'enregistrement",description:A.message||"Une erreur est survenue.",variant:"destructive"})}finally{f(!1)}},I=(R,F)=>{F===1&&o.includes(R)&&l(o.filter(_=>_!==R)),F===2&&a.includes(R)&&i(a.filter(_=>_!==R));const A=F===1?a:o,B=F===1?i:l;A.includes(R)?B(A.filter(_=>_!==R)):A.length<2?B([...A,R]):$({title:"Limite atteinte",description:"Maximum 2 joueurs par Ã©quipe.",variant:"default"})},O=R=>{var F;return((F=r.find(A=>A.id===R))==null?void 0:F.username)||"Inconnu"},N=R=>{if(R.length===0)return 0;const F=R.reduce((A,B)=>{const _=r.find(J=>J.id===B);return A+((_==null?void 0:_.eloRating)||0)},0);return Math.round(F/R.length)};return x?e.jsx($e,{children:e.jsxs("div",{className:"flex justify-center items-center h-96",children:[e.jsx(ue,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"ml-2 text-muted-foreground",children:"Chargement des joueurs..."})]})}):e.jsxs($e,{children:[e.jsx(W.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-4 sm:mb-6 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx(T,{variant:"ghost",size:"icon",onClick:()=>t("/match"),className:"rounded-xl",children:e.jsx(pr,{className:"h-4 w-4 sm:h-5 sm:w-5"})}),e.jsx("div",{className:"rounded-xl bg-primary/20 p-2 sm:p-3",children:e.jsx(jt,{className:"h-5 w-5 sm:h-6 sm:w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg sm:text-2xl font-bold text-foreground",children:"Enregistrer un Match"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Match 2v2"})]})]})}),e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[(a.length>0||o.length>0)&&e.jsx(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsx(L,{className:"border-primary/30",children:e.jsx(V,{className:"p-3 sm:p-4",children:e.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-4 items-center",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Ã‰quipe 1"}),e.jsx("div",{className:"space-y-1",children:a.length>0?e.jsxs(e.Fragment,{children:[a.map(R=>e.jsx("div",{className:"text-sm font-medium",children:O(R)},R)),e.jsxs("p",{className:"text-xs text-primary mt-2",children:["ELO moyen: ",N(a)]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun joueur"})})]}),e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-lg sm:text-2xl font-bold text-primary",children:"VS"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Ã‰quipe 2"}),e.jsx("div",{className:"space-y-1",children:o.length>0?e.jsxs(e.Fragment,{children:[o.map(R=>e.jsx("div",{className:"text-sm font-medium",children:O(R)},R)),e.jsxs("p",{className:"text-xs text-red-500 mt-2",children:["ELO moyen: ",N(o)]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun joueur"})})]})]})})})}),e.jsx(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsxs(L,{children:[e.jsx(xe,{children:e.jsxs(he,{className:"text-xl flex items-center gap-2",children:[e.jsx(Ee,{className:"h-5 w-5 text-primary"}),"SÃ©lection des Ã©quipes"]})}),e.jsx(V,{children:e.jsxs("form",{onSubmit:w,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"space-y-2 sm:space-y-3 p-2 sm:p-3 rounded-lg border border-primary/20 bg-primary/5",children:[e.jsxs("label",{className:"font-semibold text-lg flex items-center justify-between text-primary",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(Ee,{className:"h-4 w-4 mr-1"})," Ã‰quipe 1"]}),e.jsxs("span",{className:"text-sm",children:["(",a.length,"/2)"]})]}),e.jsx("div",{className:"space-y-1 max-h-64 overflow-y-auto pr-2",children:r.map(R=>{const F=a.includes(R.id),A=o.includes(R.id);return e.jsxs("div",{onClick:()=>I(R.id,1),className:`flex justify-between items-center p-2 rounded-md cursor-pointer transition-colors ${F?"bg-primary text-primary-foreground font-bold shadow-md":A?"bg-red-500/20 opacity-50 cursor-not-allowed":"bg-surface-alt hover:bg-surface-alt/70"}`,children:[e.jsx("span",{className:"truncate",children:R.username}),e.jsx("span",{className:`text-sm ml-2 ${F?"text-primary-foreground/80":"text-muted-foreground"}`,children:R.eloRating})]},R.id)})})]}),e.jsxs("div",{className:"space-y-2 sm:space-y-3 p-2 sm:p-3 rounded-lg border border-red-500/20 bg-red-500/5",children:[e.jsxs("label",{className:"font-semibold text-lg flex items-center justify-between text-red-500",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(Ee,{className:"h-4 w-4 mr-1"})," Ã‰quipe 2"]}),e.jsxs("span",{className:"text-sm",children:["(",o.length,"/2)"]})]}),e.jsx("div",{className:"space-y-1 max-h-64 overflow-y-auto pr-2",children:r.map(R=>{const F=o.includes(R.id),A=a.includes(R.id);return e.jsxs("div",{onClick:()=>I(R.id,2),className:`flex justify-between items-center p-2 rounded-md cursor-pointer transition-colors ${F?"bg-red-500 text-primary-foreground font-bold shadow-md":A?"bg-primary/20 opacity-50 cursor-not-allowed":"bg-surface-alt hover:bg-surface-alt/70"}`,children:[e.jsx("span",{className:"truncate",children:R.username}),e.jsx("span",{className:`text-sm ml-2 ${F?"text-primary-foreground/80":"text-muted-foreground"}`,children:R.eloRating})]},R.id)})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t border-border",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"score1",className:"block text-sm font-medium text-primary",children:"Score Ã‰quipe 1"}),e.jsx(je,{id:"score1",type:"number",value:c,onChange:R=>d(Number(R.target.value)),min:"0",required:!0,className:"text-lg font-bold"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"score2",className:"block text-sm font-medium text-red-500",children:"Score Ã‰quipe 2"}),e.jsx(je,{id:"score2",type:"number",value:u,onChange:R=>h(Number(R.target.value)),min:"0",required:!0,className:"text-lg font-bold"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(T,{type:"button",variant:"outline",className:"flex-1",onClick:()=>{i([]),l([]),d(0),h(0)},disabled:p,children:[e.jsx(Fe,{className:"mr-2 h-4 w-4"}),"RÃ©initialiser"]}),e.jsx(T,{type:"submit",className:"flex-1",variant:"neon",disabled:p||a.length===0||o.length===0,children:p?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"mr-2 h-4 w-4 animate-spin"}),"Enregistrement..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Pe,{className:"mr-2 h-4 w-4"}),"Enregistrer le Match"]})})]})]})})]})}),M&&y.length>0&&e.jsx(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:e.jsxs(L,{className:"border-primary/30 bg-primary/5",children:[e.jsx(xe,{children:e.jsxs(he,{className:"text-lg flex items-center gap-2",children:[e.jsx(Pe,{className:"h-5 w-5 text-primary"}),"Mises Ã  jour ELO"]})}),e.jsx(V,{className:"space-y-2",children:y.map(R=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-surface-alt",children:[e.jsx("span",{className:"font-medium",children:R.username}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-muted-foreground",children:R.oldElo}),e.jsx("span",{className:"text-muted-foreground",children:"â†’"}),e.jsx("span",{className:"font-bold text-primary",children:R.newElo}),e.jsx("span",{className:`flex items-center gap-1 font-semibold min-w-[80px] justify-end ${R.eloChange>0?"text-green-500":"text-red-500"}`,children:R.eloChange>0?e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"h-4 w-4"}),"+",R.eloChange]}):e.jsxs(e.Fragment,{children:[e.jsx(us,{className:"h-4 w-4"}),R.eloChange]})})]})]},R.userId))})]})})]})]})},Ah=()=>{const{user:s,userProfile:t}=Ae(),[r,n]=m.useState([]),[a,i]=m.useState(null),[o,l]=m.useState([]),[c,d]=m.useState(""),[u,h]=m.useState(!0),[p,f]=m.useState(!1),[x,g]=m.useState(!1),[y,j]=m.useState(""),[M,P]=m.useState(""),[w,I]=m.useState([]),[O,N]=m.useState([]),[R,F]=m.useState(!1),[A,B]=m.useState(!1),_=m.useRef(null);m.useEffect(()=>{if(!s)return;(t==null?void 0:t.role)==="admin"&&(bh(s.uid).catch(console.error),Qo(s.uid).catch(console.error)),U();const v=Ch(s.uid,Z=>{n(Z)});return()=>v()},[s,t]),m.useEffect(()=>{if(!a||!s)return;X();const v=Nh(a.id,Z=>{l(Z),J()});return()=>v()},[a,s]),m.useEffect(()=>{J()},[o]);const J=()=>{var v;(v=_.current)==null||v.scrollIntoView({behavior:"smooth"})},U=async()=>{if(s){h(!0);try{const v=await Vr(s.uid,t==null?void 0:t.role);n(v),v.length>0&&!a&&i(v[0])}catch(v){b.error("Erreur chargement chats:",v)}finally{h(!1)}}},X=async()=>{if(a)try{const v=await wh(a.id);l(v)}catch(v){b.error("Erreur chargement messages:",v)}},pe=async()=>{if(!(!a||!s||!t||!c.trim())){if(a.id==="admin_info"&&t.role!=="admin"){$({title:"AccÃ¨s refusÃ©",description:"Seuls les administrateurs peuvent envoyer des messages ici",variant:"destructive"});return}f(!0);try{await Jo(a.id,s.uid,t.username,c);const Z=(Array.isArray(a.m)?a.m:[]).filter(K=>K!==s.uid).map(K=>Co(K,t.username,c.substring(0,50)+(c.length>50?"...":""),a.id).catch(ne=>{b.error(`âŒ Erreur notification pour ${K}:`,ne)}));await Promise.allSettled(Z),d(""),b.log(`âœ… Message envoyÃ© avec ${Z.length} notification(s)`)}catch(v){b.error("âŒ Erreur envoi message:",v),$({title:"Erreur",description:v.message||"Impossible d'envoyer le message",variant:"destructive"})}finally{f(!1)}}},ge=async v=>{if(!s||v.length<2){I([]);return}try{const Z=await Eh(v,s.uid);I(Z)}catch(Z){b.error("Erreur recherche:",Z)}},ye=async(v,Z)=>{if(!(!s||!t))try{const K=await vh(s.uid,v,t.username,Z);await U();const ne=r.find(Se=>Se.id===K)||await Vr(s.uid).then(Se=>Se.find(Me=>Me.id===K));ne&&(i(ne),B(!0)),P(""),I([]),$({title:"Chat crÃ©Ã©",description:`Chat avec ${Z} crÃ©Ã©`})}catch(K){$({title:"Erreur",description:K.message||"Impossible de crÃ©er le chat",variant:"destructive"})}},ee=async()=>{if(!s||!t||!y.trim()||O.length===0){$({title:"Erreur",description:"Nom du groupe et au moins un membre requis",variant:"destructive"});return}try{const v=O.map(Se=>Se.id),Z=O.reduce((Se,Me)=>(Se[Me.id]=Me.username,Se),{}),K=await yh(s.uid,t.username,y,v,Z);await U();const ne=r.find(Se=>Se.id===K)||await Vr(s.uid).then(Se=>Se.find(Me=>Me.id===K));ne&&(i(ne),B(!0)),g(!1),j(""),N([]),$({title:"Groupe crÃ©Ã©",description:`Groupe "${y}" crÃ©Ã©`})}catch(v){$({title:"Erreur",description:v.message||"Impossible de crÃ©er le groupe",variant:"destructive"})}},se=async(v,Z)=>{if(!(!a||!s))try{await Sh(a.id,v,Z,s.uid),await U(),F(!1),P(""),I([]),$({title:"Membre ajoutÃ©",description:`${Z} a Ã©tÃ© ajoutÃ© au groupe`})}catch(K){$({title:"Erreur",description:K.message||"Impossible d'ajouter le membre",variant:"destructive"})}},H=async v=>{if(!(!a||!s))try{await kh(a.id,v,s.uid),await U(),$({title:"Membre retirÃ©",description:"Le membre a Ã©tÃ© retirÃ© du groupe"})}catch(Z){$({title:"Erreur",description:Z.message||"Impossible de retirer le membre",variant:"destructive"})}},fe=async()=>{if(!a||!s||!t)return;const v=D(a);if(confirm(`âš ï¸ Supprimer le groupe "${v}" ?`))try{await _h(a.id,s.uid,t.role),await U(),i(null),B(!1),$({title:"Groupe supprimÃ©",description:"Le groupe a Ã©tÃ© supprimÃ©"})}catch(Z){$({title:"Erreur",description:Z.message||"Impossible de supprimer le groupe",variant:"destructive"})}},D=v=>{if(v.t==="admin_info")return"ðŸ“¢ Infos Admin";if(v.t==="group")return v.n||"Groupe sans nom";if(v.mn&&s){const K=(Array.isArray(v.m)?v.m:[]).find(ne=>ne!==s.uid);return K?v.mn[K]||"Utilisateur":"Chat privÃ©"}return"Chat privÃ©"},E=v=>v.id==="admin_info"?e.jsx(Zt,{className:"h-3 w-3 md:h-4 md:w-4 text-blue-500 flex-shrink-0"}):v.t==="group"?e.jsx(Ee,{className:"h-3 w-3 md:h-4 md:w-4 text-primary flex-shrink-0"}):e.jsx($s,{className:"h-3 w-3 md:h-4 md:w-4 text-muted-foreground flex-shrink-0"}),Q=v=>{const Z=new Date(v),ne=new Date().getTime()-Z.getTime(),Se=Math.floor(ne/(1e3*60*60*24));return Se===0?Z.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}):Se===1?"Hier":Se<7?Z.toLocaleDateString("fr-FR",{weekday:"short"}):Z.toLocaleDateString("fr-FR",{day:"numeric",month:"short"})},ae=v=>{i(v),B(!0)},C=()=>{B(!1)},q=(a==null?void 0:a.id)==="admin_info",Y=q&&(t==null?void 0:t.role)!=="admin";return u?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(ue,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"flex flex-col md:flex-row h-[calc(100vh-8rem)] gap-2 md:gap-4",children:[e.jsxs(L,{className:`${A?"hidden md:flex":"flex"} w-full md:w-80 flex-shrink-0 flex-col`,children:[e.jsx(xe,{className:"border-b p-3 md:p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(he,{className:"flex items-center gap-2 text-base md:text-lg",children:[e.jsx($s,{className:"h-4 w-4 md:h-5 md:w-5 text-primary"}),"Messages"]}),e.jsxs(Ue,{open:x,onOpenChange:g,children:[e.jsx(dr,{asChild:!0,children:e.jsx(T,{size:"sm",variant:"outline",title:"CrÃ©er un groupe",children:e.jsx(Ee,{className:"h-4 w-4"})})}),e.jsxs(Le,{className:"max-w-[90vw] md:max-w-md",children:[e.jsxs(Ie,{children:[e.jsx(De,{children:"CrÃ©er un groupe"}),e.jsx(Ye,{children:"CrÃ©ez un nouveau groupe de discussion."})]}),e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsx(je,{placeholder:"Nom du groupe",value:y,onChange:v=>j(v.target.value)}),e.jsxs("div",{children:[e.jsx(je,{placeholder:"Rechercher des membres...",value:M,onChange:v=>{P(v.target.value),ge(v.target.value)}}),w.length>0&&e.jsx("div",{className:"mt-2 space-y-1 max-h-40 overflow-y-auto",children:w.map(v=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded hover:bg-surface-alt cursor-pointer",onClick:()=>{O.find(Z=>Z.id===v.id)||N([...O,v])},children:[e.jsx("span",{className:"text-sm",children:v.username}),O.find(Z=>Z.id===v.id)&&e.jsx("span",{className:"text-xs text-primary",children:"âœ“"})]},v.id))})]}),O.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Membres sÃ©lectionnÃ©s:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:O.map(v=>e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded bg-primary/10 text-xs",children:[v.username,e.jsx("button",{onClick:()=>N(O.filter(Z=>Z.id!==v.id)),className:"ml-1",children:e.jsx(Fe,{className:"h-3 w-3"})})]},v.id))})]}),e.jsx(T,{onClick:ee,className:"w-full",disabled:!y.trim()||O.length===0,children:"CrÃ©er le groupe"})]})]})]})]})}),e.jsxs(V,{className:"flex-1 overflow-y-auto p-0",children:[e.jsxs("div",{className:"p-2 border-b",children:[e.jsxs("div",{className:"relative",children:[e.jsx(lt,{className:"absolute left-2 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(je,{placeholder:"Rechercher...",value:M,onChange:v=>{P(v.target.value),ge(v.target.value)},className:"pl-8 text-sm"})]}),w.length>0&&e.jsx("div",{className:"mt-2 space-y-1 max-h-32 md:max-h-40 overflow-y-auto",children:w.map(v=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded hover:bg-surface-alt cursor-pointer",onClick:()=>ye(v.id,v.username),children:[e.jsx("span",{className:"text-xs md:text-sm",children:v.username}),e.jsx($s,{className:"h-3 w-3 md:h-4 md:w-4 text-primary"})]},v.id))})]}),e.jsx("div",{className:"space-y-1",children:r.length===0?e.jsx("div",{className:"p-4 text-center text-muted-foreground text-xs md:text-sm",children:"Aucun chat. Recherchez un utilisateur ou crÃ©ez un groupe !"}):r.map(v=>e.jsx("div",{onClick:()=>ae(v),className:`p-2 md:p-3 cursor-pointer hover:bg-surface-alt transition ${(a==null?void 0:a.id)===v.id?"bg-primary/10 border-l-2 border-primary":""} ${v.id==="admin_info"?"bg-blue-500/5":""}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[E(v),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-xs md:text-sm truncate",children:D(v)}),v.lm&&e.jsxs("p",{className:"text-xs text-muted-foreground truncate",children:[v.lm.un,": ",v.lm.tx]})]})]}),v.lm&&e.jsx("span",{className:"text-xs text-muted-foreground flex-shrink-0 ml-2",children:Q(v.lm.ts)})]})},v.id))})]})]}),a?e.jsxs(L,{className:`${A?"flex":"hidden md:flex"} flex-1 flex-col`,children:[e.jsxs(xe,{className:"border-b p-3 md:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx(T,{variant:"ghost",size:"sm",className:"md:hidden -ml-2",onClick:C,children:e.jsx(pr,{className:"h-4 w-4"})}),e.jsxs(he,{className:"flex items-center gap-2 text-base md:text-lg min-w-0",children:[E(a),e.jsx("span",{className:"truncate",children:D(a)}),a.t==="group"&&a.m&&e.jsxs("span",{className:"text-xs md:text-sm text-muted-foreground font-normal flex-shrink-0",children:["(",a.m.length,")"]})]})]}),a.t==="group"&&!a.ac&&e.jsxs("div",{className:"flex gap-1 md:gap-2",children:[e.jsxs(Ue,{open:R,onOpenChange:F,children:[e.jsx(dr,{asChild:!0,children:e.jsx(T,{size:"sm",variant:"outline",children:e.jsx(as,{className:"h-3 w-3 md:h-4 md:w-4"})})}),e.jsxs(Le,{className:"max-w-[90vw] md:max-w-md",children:[e.jsxs(Ie,{children:[e.jsx(De,{children:"Ajouter un membre"}),e.jsx(Ye,{children:"Recherchez et ajoutez un joueur au groupe."})]}),e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsx(je,{placeholder:"Rechercher un utilisateur...",value:M,onChange:v=>{P(v.target.value),ge(v.target.value)}}),w.length>0&&e.jsx("div",{className:"space-y-1 max-h-60 overflow-y-auto",children:w.filter(v=>!a.m.includes(v.id)).map(v=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded hover:bg-surface-alt cursor-pointer",onClick:()=>se(v.id,v.username),children:[e.jsx("span",{className:"text-sm",children:v.username}),e.jsx(T,{size:"sm",variant:"ghost",children:e.jsx(as,{className:"h-4 w-4"})})]},v.id))})]})]})]}),a.cb===(s==null?void 0:s.uid)&&e.jsx(T,{size:"sm",variant:"destructive",onClick:fe,children:e.jsx(ns,{className:"h-3 w-3 md:h-4 md:w-4"})})]})]}),q&&e.jsxs("div",{className:"mt-2 p-2 rounded-lg bg-blue-500/10 text-xs text-blue-700 dark:text-blue-300",children:["ðŸ“¢ Canal d'informations officiel - ",(t==null?void 0:t.role)==="admin"?"Vous pouvez envoyer des messages":"Lecture seule"]}),a.t==="group"&&a.mn&&!q&&e.jsxs("div",{className:"flex flex-wrap gap-1 md:gap-2 mt-2",children:[a.m.slice(0,5).map(v=>{var K;const Z=((K=a.mn)==null?void 0:K[v])||"Utilisateur";return e.jsxs("div",{className:"flex items-center gap-1 px-2 py-0.5 rounded bg-surface-alt text-xs",children:[Z,!a.ac&&v!==(s==null?void 0:s.uid)&&a.cb===(s==null?void 0:s.uid)&&e.jsx("button",{onClick:()=>H(v),className:"ml-1 text-destructive",children:e.jsx(Fe,{className:"h-3 w-3"})})]},v)}),a.m.length>5&&e.jsxs("div",{className:"px-2 py-0.5 rounded bg-surface-alt text-xs",children:["+",a.m.length-5]})]})]}),e.jsxs(V,{className:"flex-1 flex flex-col p-0",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-2 md:p-4 space-y-2 md:space-y-3",children:[o.length===0?e.jsx("div",{className:"text-center text-muted-foreground py-8 text-sm",children:q?"Aucune annonce pour le moment":"Aucun message. Commencez la conversation !"}):o.map(v=>{const Z=ph(v);return e.jsx(W.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex ${Z.userId===(s==null?void 0:s.uid)?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[85%] md:max-w-[70%] rounded-lg p-2 md:p-3 ${Z.userId===(s==null?void 0:s.uid)?"bg-primary text-primary-foreground":q?"bg-blue-500/10 border border-blue-500/20":"bg-surface-alt"}`,children:[Z.userId!==(s==null?void 0:s.uid)&&e.jsx("p",{className:"text-xs font-medium mb-1 opacity-70",children:Z.username}),e.jsx("p",{className:"text-xs md:text-sm break-words whitespace-pre-wrap",children:Z.text}),e.jsx("p",{className:`text-xs mt-1 ${Z.userId===(s==null?void 0:s.uid)?"opacity-70":"text-muted-foreground"}`,children:Q(Z.timestamp)})]})},v.id)}),e.jsx("div",{ref:_})]}),!Y&&e.jsx("div",{className:"border-t p-2 md:p-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(je,{placeholder:q?"Message d'information...":"Tapez un message...",value:c,onChange:v=>d(v.target.value),onKeyPress:v=>{v.key==="Enter"&&!v.shiftKey&&(v.preventDefault(),pe())},disabled:p,className:"text-sm"}),e.jsx(T,{onClick:pe,disabled:p||!c.trim(),size:"sm",children:p?e.jsx(ue,{className:"h-3 w-3 md:h-4 md:w-4 animate-spin"}):e.jsx(Gs,{className:"h-3 w-3 md:h-4 md:w-4"})})]})})]})]}):e.jsx(L,{className:"hidden md:flex flex-1 items-center justify-center",children:e.jsxs(V,{className:"text-center",children:[e.jsx($s,{className:"h-16 w-16 mx-auto mb-4 text-muted-foreground opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:"SÃ©lectionnez un chat ou crÃ©ez-en un nouveau"})]})})]})},Mh=()=>{const{user:s}=Ae(),[t,r]=m.useState([]),[n,a]=m.useState([]),[i,o]=m.useState(!1),[l,c]=m.useState(null),[d,u]=m.useState(!1),[h,p]=m.useState(null),[f,x]=m.useState(""),g=async()=>{if(s){o(!0);try{const[N,R]=await Promise.all([bo(s.uid),vo(s.uid)]);r(N),a(R)}catch(N){b.error("Erreur chargement offres:",N),$({title:"Erreur",description:"Impossible de charger les offres.",variant:"destructive"})}finally{o(!1)}}};m.useEffect(()=>{g()},[s]);const y=async N=>{if(s){c(N);try{await fo(s.uid,N),$({title:"Offre acceptÃ©e âœ…",description:"La transaction a Ã©tÃ© effectuÃ©e avec succÃ¨s."}),await g()}catch(R){$({title:"Erreur",description:R.message||"Impossible d'accepter l'offre.",variant:"destructive"})}finally{c(null)}}},j=async N=>{if(s){c(N);try{await po(s.uid,N),$({title:"Offre rejetÃ©e",description:"L'acheteur a Ã©tÃ© notifiÃ©."}),await g()}catch(R){$({title:"Erreur",description:R.message||"Impossible de rejeter l'offre.",variant:"destructive"})}finally{c(null)}}},M=N=>{p(N),x((N.amount*1.1).toFixed(0)),u(!0)},P=async()=>{if(!s||!h)return;const N=Number(f);if(isNaN(N)||N<=0){$({title:"Erreur",description:"Montant invalide",variant:"destructive"});return}try{await go(s.uid,h.id,N),$({title:"Contre-offre envoyÃ©e âœ…",description:"L'acheteur a Ã©tÃ© notifiÃ©."}),u(!1),await g()}catch(R){$({title:"Erreur",description:R.message||"Impossible d'envoyer la contre-offre.",variant:"destructive"})}},w=N=>{const R=N-Date.now();if(R<=0)return"ExpirÃ©e";const F=Math.floor(R/(1e3*60*60));return F<24?`${F}h restantes`:`${Math.floor(F/24)}j restantes`},I=N=>{switch(N){case"pending":return e.jsx(le,{variant:"outline",className:"bg-yellow-500/10 text-yellow-600 border-yellow-500",children:"En attente"});case"accepted":return e.jsx(le,{variant:"outline",className:"bg-green-500/10 text-green-600 border-green-500",children:"AcceptÃ©e"});case"rejected":return e.jsx(le,{variant:"outline",className:"bg-red-500/10 text-red-600 border-red-500",children:"RejetÃ©e"});case"countered":return e.jsx(le,{variant:"outline",className:"bg-blue-500/10 text-blue-600 border-blue-500",children:"Contre-offre"});case"expired":return e.jsx(le,{variant:"outline",className:"bg-gray-500/10 text-gray-600 border-gray-500",children:"ExpirÃ©e"});default:return null}},O=({offer:N,isReceived:R})=>{const F=Date.now()>N.expiresAt,A=N.status==="pending"&&!F;return e.jsx(W.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:e.jsxs(L,{className:A&&R?"border-yellow-500/50":"",children:[e.jsx(xe,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs(he,{className:"text-sm",children:["Listing #",N.listingId.slice(-6)]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:R?e.jsxs(e.Fragment,{children:["De: ",N.buyerId.slice(0,6),"..."]}):e.jsxs(e.Fragment,{children:["Ã€: ",N.sellerId.slice(0,6),"..."]})})]}),I(N.status)]})}),e.jsxs(V,{className:"space-y-3 text-xs",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Montant proposÃ©"}),e.jsxs("span",{className:"font-semibold text-lg",children:[N.amount,"â‚¬"]})]}),N.counterOffer&&e.jsxs("div",{className:"flex items-center justify-between bg-blue-500/10 p-2 rounded",children:[e.jsxs("span",{className:"text-blue-600 flex items-center gap-1",children:[e.jsx(Oe,{className:"h-3 w-3"}),"Contre-offre"]}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[N.counterOffer,"â‚¬"]})]}),N.message&&e.jsx("div",{className:"bg-muted p-2 rounded",children:e.jsxs("p",{className:"text-xs italic",children:['"',N.message,'"']})}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(it,{className:"h-3 w-3"}),w(N.expiresAt)]}),e.jsx("span",{className:"text-muted-foreground",children:new Date(N.createdAt).toLocaleDateString("fr-FR")})]})]}),A&&R&&e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(T,{size:"sm",variant:"outline",className:"flex-1 text-xs",onClick:()=>j(N.id),disabled:l===N.id,children:[e.jsx(Fe,{className:"h-4 w-4 mr-1"}),"Rejeter"]}),e.jsxs(T,{size:"sm",variant:"outline",className:"flex-1 text-xs",onClick:()=>M(N),disabled:l===N.id,children:[e.jsx(Oe,{className:"h-4 w-4 mr-1"}),"Contre-offre"]}),e.jsxs(T,{size:"sm",className:"flex-1 text-xs bg-green-600 hover:bg-green-700",onClick:()=>y(N.id),disabled:l===N.id,children:[e.jsx(at,{className:"h-4 w-4 mr-1"}),"Accepter"]})]}),N.status==="countered"&&!R&&e.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded p-3 text-center",children:[e.jsx(xs,{className:"h-4 w-4 text-blue-600 mx-auto mb-1"}),e.jsxs("p",{className:"text-blue-600 text-xs",children:["Le vendeur a proposÃ© ",N.counterOffer,"â‚¬"]})]})]})]})})};return e.jsxs($e,{children:[e.jsxs("div",{className:"container mx-auto max-w-6xl p-4",children:[e.jsxs("div",{className:"mb-6 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(Fs,{className:"h-7 w-7 text-blue-400"}),"Mes Offres"]}),e.jsx("p",{className:"mt-1 text-muted-foreground text-sm",children:"GÃ©rez vos offres d'achat et de vente."})]}),e.jsx(T,{variant:"outline",size:"icon",onClick:g,disabled:i,children:e.jsx(ci,{className:`h-4 w-4 ${i?"animate-spin":""}`})})]}),e.jsxs(Ss,{defaultValue:"received",className:"w-full",children:[e.jsxs(Xt,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsxs(He,{value:"received",className:"relative",children:["Offres ReÃ§ues",t.filter(N=>N.status==="pending").length>0&&e.jsx(le,{className:"ml-2 h-5 w-5 p-0 flex items-center justify-center bg-red-500",children:t.filter(N=>N.status==="pending").length})]}),e.jsxs(He,{value:"sent",children:["Offres EnvoyÃ©es",n.filter(N=>N.status==="countered").length>0&&e.jsx(le,{className:"ml-2 h-5 w-5 p-0 flex items-center justify-center bg-blue-500",children:n.filter(N=>N.status==="countered").length})]})]}),e.jsx(Je,{value:"received",className:"space-y-4",children:i?e.jsx("div",{className:"flex justify-center py-12 text-muted-foreground text-sm",children:"Chargement..."}):t.length===0?e.jsx(L,{children:e.jsx(V,{className:"py-12 text-center text-muted-foreground text-sm",children:"Aucune offre reÃ§ue pour le moment."})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(N=>e.jsx(O,{offer:N,isReceived:!0},N.id))})}),e.jsx(Je,{value:"sent",className:"space-y-4",children:i?e.jsx("div",{className:"flex justify-center py-12 text-muted-foreground text-sm",children:"Chargement..."}):n.length===0?e.jsx(L,{children:e.jsx(V,{className:"py-12 text-center text-muted-foreground text-sm",children:"Aucune offre envoyÃ©e pour le moment."})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:n.map(N=>e.jsx(O,{offer:N,isReceived:!1},N.id))})})]})]}),e.jsx(Ue,{open:d,onOpenChange:u,children:e.jsxs(Le,{children:[e.jsxs(Ie,{children:[e.jsx(De,{children:"Faire une contre-offre"}),e.jsx(Ye,{children:"Proposez un nouveau prix Ã  l'acheteur"})]}),e.jsxs("div",{className:"space-y-4",children:[h&&e.jsxs("div",{className:"bg-muted p-3 rounded-lg space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Offre initiale:"}),e.jsxs("span",{className:"font-semibold",children:[h.amount,"â‚¬"]})]}),h.message&&e.jsxs("div",{className:"text-xs italic text-muted-foreground pt-2 border-t",children:['"',h.message,'"']})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Votre contre-offre (â‚¬)"}),e.jsx(je,{type:"number",placeholder:"Montant",value:f,onChange:N=>x(N.target.value)}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:"ðŸ’¡ Proposez un prix intermÃ©diaire pour maximiser vos chances"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(T,{variant:"outline",onClick:()=>u(!1),className:"flex-1",children:"Annuler"}),e.jsxs(T,{onClick:P,className:"flex-1",children:[e.jsx(Gs,{className:"h-4 w-4 mr-2"}),"Envoyer"]})]})]})]})})]})},Th=()=>{const{user:s}=Ae(),[t,r]=m.useState(""),[n,a]=m.useState(null),[i,o]=m.useState(!1),[l,c]=m.useState([]),d=async()=>{const f=t.trim().toLowerCase();if(!f){$({title:"Erreur",description:"Veuillez entrer un nom ou un code."});return}o(!0);try{let x="";const g=Hi(f.toUpperCase());if(b.log("ðŸ“‡ Carte directe trouvÃ©e:",g),g.found)x=g.code;else{b.log("ðŸ”Ž Recherche par nom dans codeToCardMap...");for(const j of Object.keys(ps)){const M=ps[j],P=Object.keys(M).find(w=>M[w].nom.toLowerCase().replace(".png","").includes(f)||M[w].nom.toLowerCase().includes(f));if(P){x=P,b.log("âœ… Code trouvÃ©:",P,"dans la saison:",j);break}}}if(b.log("ðŸŽ¯ Code cible final:",x),!x){$({title:"Non trouvÃ©",description:"Aucune carte ne correspond Ã  ce nom ou code."});return}b.log("ðŸ“Š Appel getMarketStats pour:",x);const y=await wr(x);b.log("ðŸ“ˆ Stats rÃ©cupÃ©rÃ©es:",y),b.log("ðŸ’° Prix history:",y==null?void 0:y.priceHistory),y?(a(y),l.find(j=>j.cardCode===y.cardCode)||c(j=>[y,...j].slice(0,5))):(b.log("âŒ Aucune stats retournÃ©e"),$({title:"Aucune donnÃ©e",description:"Cette carte n'a pas encore de transactions enregistrÃ©es."}))}catch(x){b.error("âŒ Erreur lors de la recherche:",x),$({title:"Erreur",description:"Erreur lors de la recherche."})}finally{o(!1)}},u=f=>{if(f.length<2)return null;const x=f[0].price,g=f[f.length-1].price,y=(g-x)/x*100;return{percentage:Math.abs(y).toFixed(1),isIncrease:y>0,value:g-x}},h=({history:f})=>{if(!f||f.length===0)return e.jsx("div",{className:"h-48 bg-muted/50 rounded-lg p-4 flex items-center justify-center",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun historique disponible"})});const x=f.filter(P=>P&&typeof P.price=="number"&&P.price>0);if(x.length===0)return e.jsx("div",{className:"h-48 bg-muted/50 rounded-lg p-4 flex items-center justify-center",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"DonnÃ©es invalides"})});const g=Math.max(...x.map(P=>P.price)),y=Math.min(...x.map(P=>P.price)),j=g-y||1,M=x.reduce((P,w)=>P+w.price,0)/x.length;return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative h-48 bg-gradient-to-b from-muted/30 to-muted/50 rounded-lg p-4 overflow-hidden",children:[e.jsxs("svg",{className:"w-full h-full",viewBox:"0 0 100 100",preserveAspectRatio:"none",children:[e.jsxs("defs",{children:[e.jsx("pattern",{id:"grid",width:"20",height:"20",patternUnits:"userSpaceOnUse",children:e.jsx("path",{d:"M 20 0 L 0 0 0 20",fill:"none",stroke:"currentColor",strokeOpacity:"0.1",strokeWidth:"0.5"})}),e.jsxs("linearGradient",{id:"areaGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"rgb(168, 85, 247)",stopOpacity:"0.4"}),e.jsx("stop",{offset:"100%",stopColor:"rgb(168, 85, 247)",stopOpacity:"0.05"})]})]}),e.jsx("rect",{width:"100",height:"100",fill:"url(#grid)"}),x.map((P,w)=>{const I=x.length>1?w/(x.length-1)*100:50,O=100-(P.price-y)/j*100,N=w===x.length-1;return e.jsxs("g",{children:[w>0&&e.jsx("line",{x1:(w-1)/(x.length-1)*100,y1:100-(x[w-1].price-y)/j*100,x2:I,y2:O,stroke:"rgb(168, 85, 247)",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("circle",{cx:I,cy:O,r:N?"3":"2",fill:N?"rgb(34, 197, 94)":"rgb(168, 85, 247)",className:"drop-shadow-md"}),N&&e.jsxs("circle",{cx:I,cy:O,r:"3",fill:"none",stroke:"rgb(34, 197, 94)",strokeWidth:"1",opacity:"0.5",children:[e.jsx("animate",{attributeName:"r",from:"3",to:"8",dur:"1.5s",repeatCount:"indefinite"}),e.jsx("animate",{attributeName:"opacity",from:"0.5",to:"0",dur:"1.5s",repeatCount:"indefinite"})]})]},w)})]}),e.jsx("div",{className:"absolute bottom-2 left-4 right-4 flex justify-between text-[10px] text-muted-foreground",children:x.map((P,w)=>w===0||w===x.length-1?e.jsx("span",{children:new Date(P.date).toLocaleDateString("fr-FR",{day:"2-digit",month:"short"})},w):null)})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-green-500/10 rounded-lg p-2 text-center border border-green-500/20",children:[e.jsx("p",{className:"text-muted-foreground mb-1",children:"Min"}),e.jsxs("p",{className:"font-bold text-green-600",children:[y,"â‚¬"]})]}),e.jsxs("div",{className:"bg-purple-500/10 rounded-lg p-2 text-center border border-purple-500/20",children:[e.jsx("p",{className:"text-muted-foreground mb-1",children:"Moyenne"}),e.jsxs("p",{className:"font-bold text-purple-600",children:[M.toFixed(2),"â‚¬"]})]}),e.jsxs("div",{className:"bg-red-500/10 rounded-lg p-2 text-center border border-red-500/20",children:[e.jsx("p",{className:"text-muted-foreground mb-1",children:"Max"}),e.jsxs("p",{className:"font-bold text-red-600",children:[g,"â‚¬"]})]})]})]})},p=({stats:f})=>{const x=u(f.priceHistory);return e.jsx(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsxs(L,{className:"overflow-hidden",children:[e.jsx(xe,{className:"bg-gradient-to-r from-purple-500/10 to-blue-500/10 border-b",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs(he,{className:"text-xl flex items-center gap-2",children:[f.cardCode,x&&e.jsxs(le,{variant:"outline",className:x.isIncrease?"bg-green-500/10 text-green-600 border-green-500":"bg-red-500/10 text-red-600 border-red-500",children:[x.isIncrease?e.jsx(ii,{className:"h-3 w-3 mr-1"}):e.jsx(oi,{className:"h-3 w-3 mr-1"}),x.percentage,"%"]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["DonnÃ©es sur ",f.priceHistory.length," vente(s)"]})]}),e.jsxs(le,{className:"bg-primary",children:[e.jsx($t,{className:"h-3 w-3 mr-1"}),f.totalSales," ventes"]})]})}),e.jsxs(V,{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-500/10 to-blue-600/5 rounded-lg p-4 border border-blue-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-600 text-sm mb-2",children:[e.jsx(Wt,{className:"h-4 w-4"}),"Prix Moyen"]}),e.jsxs("div",{className:"text-2xl font-bold text-foreground",children:[f.averagePrice.toFixed(2),"â‚¬"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-500/10 to-green-600/5 rounded-lg p-4 border border-green-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-600 text-sm mb-2",children:[e.jsx(us,{className:"h-4 w-4"}),"Prix Min"]}),e.jsxs("div",{className:"text-2xl font-bold text-foreground",children:[f.lowestPrice,"â‚¬"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-red-500/10 to-red-600/5 rounded-lg p-4 border border-red-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm mb-2",children:[e.jsx(Oe,{className:"h-4 w-4"}),"Prix Max"]}),e.jsxs("div",{className:"text-2xl font-bold text-foreground",children:[f.highestPrice,"â‚¬"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-500/10 to-purple-600/5 rounded-lg p-4 border border-purple-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2 text-purple-600 text-sm mb-2",children:[e.jsx(ws,{className:"h-4 w-4"}),"DerniÃ¨re Vente"]}),e.jsxs("div",{className:"text-2xl font-bold text-foreground",children:[f.lastSalePrice||"N/A","â‚¬"]}),f.lastSaleDate&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:new Date(f.lastSaleDate).toLocaleDateString("fr-FR")})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold mb-3 flex items-center gap-2",children:[e.jsx(Jt,{className:"h-4 w-4"}),"Historique des Prix (30 derniers jours)"]}),e.jsx(h,{history:f.priceHistory})]}),x&&e.jsxs("div",{className:`rounded-lg p-4 ${x.isIncrease?"bg-green-500/10 border border-green-500/20":"bg-red-500/10 border border-red-500/20"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[x.isIncrease?e.jsx(Oe,{className:"h-5 w-5 text-green-600"}):e.jsx(us,{className:"h-5 w-5 text-red-600"}),e.jsxs("span",{className:`font-semibold ${x.isIncrease?"text-green-600":"text-red-600"}`,children:["Tendance ",x.isIncrease?"HaussiÃ¨re":"BaissiÃ¨re"]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Le prix a ",x.isIncrease?"augmentÃ©":"diminuÃ©"," de"," ",e.jsxs("span",{className:"font-semibold",children:[x.percentage,"%"]})," (",x.isIncrease?"+":"",x.value.toFixed(2),"â‚¬) sur la pÃ©riode."]})]}),e.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-blue-600 mb-2 flex items-center gap-2",children:"ðŸ’¡ Recommandation de Prix"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Pour vendre rapidement, fixez votre prix entre"," ",e.jsxs("span",{className:"font-semibold text-foreground",children:[(f.averagePrice*.9).toFixed(2),"â‚¬"]})," ","et"," ",e.jsxs("span",{className:"font-semibold text-foreground",children:[(f.averagePrice*1.1).toFixed(2),"â‚¬"]})]})]})]})]})})};return e.jsx($e,{children:e.jsxs("div",{className:"container mx-auto max-w-6xl p-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(Jt,{className:"h-7 w-7 text-purple-400"}),"Statistiques de MarchÃ©"]}),e.jsx("p",{className:"mt-1 text-muted-foreground text-sm",children:"Analysez les tendances et l'historique des prix des cartes."})]}),e.jsx(L,{className:"mb-6",children:e.jsx(V,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(je,{placeholder:"Nom du joueur ou code (ex: Lilwenn, N831...)",value:t,onChange:f=>r(f.target.value),onKeyPress:f=>f.key==="Enter"&&d(),className:"flex-1"}),e.jsx(T,{onClick:d,disabled:i,children:i?e.jsx(ue,{className:"h-4 w-4 animate-spin"}):e.jsx(lt,{className:"h-4 w-4"})})]})})}),n&&e.jsx(p,{stats:n}),l.length>0&&!n&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Recherches RÃ©centes"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:l.map(f=>{const x=u(f.priceHistory);return e.jsxs(L,{className:"cursor-pointer hover:border-primary transition-colors",onClick:()=>{r(f.cardCode),a(f)},children:[e.jsx(xe,{className:"pb-3",children:e.jsxs(he,{className:"text-sm flex items-center justify-between",children:[e.jsx("span",{children:f.cardCode}),x&&e.jsxs(le,{variant:"outline",className:x.isIncrease?"bg-green-500/10 text-green-600 border-green-500":"bg-red-500/10 text-red-600 border-red-500",children:[x.isIncrease?"+":"-",x.percentage,"%"]})]})}),e.jsxs(V,{className:"space-y-2 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Prix Moyen"}),e.jsxs("span",{className:"font-semibold",children:[f.averagePrice.toFixed(2),"â‚¬"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Ventes Totales"}),e.jsx("span",{className:"font-semibold",children:f.totalSales})]})]})]},f.cardCode)})})]}),!n&&l.length===0&&e.jsx(L,{children:e.jsxs(V,{className:"py-12 text-center",children:[e.jsx(lt,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:"Recherchez une carte pour voir ses statistiques de marchÃ©"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Exemple: Lilwenn, N831, Romane, etc."})]})})]})})},vn=({quest:s,onClaim:t,isClaiming:r})=>{const n=Math.round(s.progress/s.target*100),a=s.completed,i=!!s.claimedAt,o=()=>{switch(s.category){case"match":return e.jsx(Pe,{className:"h-4 w-4"});case"social":return e.jsx(js,{className:"h-4 w-4"});case"collection":return e.jsx(dt,{className:"h-4 w-4"});case"progression":return e.jsx(ws,{className:"h-4 w-4"})}},l=()=>{switch(s.category){case"match":return"text-rarity-gold";case"social":return"text-primary";case"collection":return"text-rarity-epic";case"progression":return"text-rarity-legendary"}};return e.jsx(W.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"group",children:e.jsxs(L,{className:`relative overflow-hidden transition-all ${a&&!i?"border-primary/50 bg-gradient-to-br from-primary/5 to-transparent":""}`,children:[a&&!i&&e.jsx("div",{className:"absolute top-0 right-0 w-20 h-20 bg-primary/10 rounded-bl-full"}),e.jsx(V,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg bg-surface ${l()}`,children:o()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-start justify-between gap-2 mb-1",children:e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-sm text-foreground flex items-center gap-2",children:[s.title,a&&e.jsxs(le,{variant:"outline",className:"text-xs",children:[e.jsx(at,{className:"h-3 w-3 mr-1"}),i?"RÃ©clamÃ©":"TerminÃ©"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.description})]})}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs mb-1",children:[e.jsxs("span",{className:"text-muted-foreground",children:[s.progress," / ",s.target]}),e.jsxs("span",{className:"font-medium text-foreground",children:[n,"%"]})]}),e.jsx(It,{value:n,className:"h-1.5"})]}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[s.reward.fortune&&e.jsxs(le,{variant:"secondary",className:"font-medium",children:["ðŸ’° ",s.reward.fortune]}),s.reward.packs&&e.jsxs(le,{variant:"secondary",className:"font-medium",children:["ðŸ“¦ ",s.reward.packs]}),s.reward.badge&&e.jsx(le,{variant:"secondary",className:"font-medium",children:"ðŸ… Badge"})]}),a&&!i&&e.jsxs(T,{size:"sm",onClick:t,disabled:r,className:"text-xs h-7",children:[e.jsx(dt,{className:"h-3 w-3 mr-1"}),"RÃ©clamer"]})]})]})]})})]})})},Ph=()=>{const{user:s}=Ae(),{quests:t,isLoading:r,isClaiming:n,claimReward:a,stats:i}=va(s==null?void 0:s.uid);return r?e.jsx(L,{children:e.jsx(V,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})}):t?e.jsxs("div",{className:"space-y-4",children:[e.jsx(W.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},children:e.jsxs(L,{children:[e.jsx(xe,{children:e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx(js,{className:"h-5 w-5 text-primary"}),"QuÃªtes"]})}),e.jsx(V,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Quotidiennes"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(It,{value:(i==null?void 0:i.dailyProgress)||0,className:"flex-1"}),e.jsxs("span",{className:"text-sm font-medium",children:[i==null?void 0:i.dailyCompleted,"/",i==null?void 0:i.dailyTotal]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Hebdomadaires"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(It,{value:(i==null?void 0:i.weeklyProgress)||0,className:"flex-1"}),e.jsxs("span",{className:"text-sm font-medium",children:[i==null?void 0:i.weeklyCompleted,"/",i==null?void 0:i.weeklyTotal]})]})]})]})})]})}),e.jsxs(Ss,{defaultValue:"daily",className:"w-full",children:[e.jsxs(Xt,{className:"grid w-full grid-cols-2",children:[e.jsxs(He,{value:"daily",className:"gap-2",children:[e.jsx(it,{className:"h-4 w-4"}),"Quotidiennes",((i==null?void 0:i.dailyCompleted)||0)>0&&e.jsx(le,{variant:"secondary",className:"ml-1 h-5 text-xs",children:i==null?void 0:i.dailyCompleted})]}),e.jsxs(He,{value:"weekly",className:"gap-2",children:[e.jsx(ws,{className:"h-4 w-4"}),"Hebdomadaires",((i==null?void 0:i.weeklyCompleted)||0)>0&&e.jsx(le,{variant:"secondary",className:"ml-1 h-5 text-xs",children:i==null?void 0:i.weeklyCompleted})]})]}),e.jsx(Je,{value:"daily",className:"space-y-3 mt-4",children:t.daily.length===0?e.jsx(L,{children:e.jsx(V,{className:"p-6 text-center text-muted-foreground",children:"Aucune quÃªte quotidienne disponible"})}):t.daily.map(o=>e.jsx(vn,{quest:o,onClaim:()=>a("daily",o.id),isClaiming:n},o.id))}),e.jsx(Je,{value:"weekly",className:"space-y-3 mt-4",children:t.weekly.length===0?e.jsx(L,{children:e.jsx(V,{className:"p-6 text-center text-muted-foreground",children:"Aucune quÃªte hebdomadaire disponible"})}):t.weekly.map(o=>e.jsx(vn,{quest:o,onClaim:()=>a("weekly",o.id),isClaiming:n},o.id))})]})]}):null},Oh=()=>e.jsxs($e,{children:[e.jsx(W.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"rounded-xl bg-primary/20 p-3",children:e.jsx(js,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"QuÃªtes"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"ComplÃ¨te des quÃªtes pour gagner des rÃ©compenses"})]})]})}),e.jsx(Ph,{})]}),Lh=24*60*60*1e3;async function Ih(s,t,r,n,a,i,o){try{if(s===r)throw new Error("Vous ne pouvez pas vous dÃ©fier vous-mÃªme");if((await Uh(s,r)).length>0)throw new Error("Un dÃ©fi est dÃ©jÃ  en cours avec ce joueur");const c=S(k,"challenges"),d=mt(c),u=d.key,h={id:u,challengerId:s,challengerUsername:t,challengedId:r,challengedUsername:n,type:a,message:i||"",stake:o||0,status:"pending",createdAt:Date.now(),expiresAt:Date.now()+Lh};await oe(d,h);const{default:p}=await rt(async()=>{const{default:f}=await Promise.resolve().then(()=>wa);return{default:f}},void 0);return await p(r,"challenge_received","Nouveau dÃ©fi!",`${t} vous dÃ©fie en ${a}${o?` pour ${o}â‚¬`:""}`,u),b.log(`âœ… DÃ©fi crÃ©Ã©: ${u}`),u}catch(l){throw b.error("âŒ Erreur crÃ©ation dÃ©fi:",l),l}}async function Dh(s,t){try{const r=S(k,`challenges/${s}`),n=await z(r);if(!n.exists())throw new Error("DÃ©fi introuvable");const a=n.val();if(a.challengedId!==t)throw new Error("Vous n'Ãªtes pas autorisÃ© Ã  accepter ce dÃ©fi");if(a.status!=="pending")throw new Error("Ce dÃ©fi n'est plus disponible");if(Date.now()>a.expiresAt)throw await oe(r,{status:"expired"}),new Error("Ce dÃ©fi a expirÃ©");await oe(r,{status:"accepted",acceptedAt:Date.now()});const{default:i}=await rt(async()=>{const{default:o}=await Promise.resolve().then(()=>wa);return{default:o}},void 0);await i(a.challengerId,"challenge_accepted","DÃ©fi acceptÃ©!",`${a.challengedUsername} a acceptÃ© votre dÃ©fi!`,s),b.log(`âœ… DÃ©fi acceptÃ©: ${s}`)}catch(r){throw b.error("âŒ Erreur acceptation dÃ©fi:",r),r}}async function Fh(s,t){try{const r=S(k,`challenges/${s}`),n=await z(r);if(!n.exists())throw new Error("DÃ©fi introuvable");const a=n.val();if(a.challengedId!==t)throw new Error("Vous n'Ãªtes pas autorisÃ© Ã  refuser ce dÃ©fi");if(a.status!=="pending")throw new Error("Ce dÃ©fi n'est plus disponible");await oe(r,{status:"declined"});const{default:i}=await rt(async()=>{const{default:o}=await Promise.resolve().then(()=>wa);return{default:o}},void 0);await i(a.challengerId,"challenge_declined","DÃ©fi refusÃ©",`${a.challengedUsername} a refusÃ© votre dÃ©fi`,s),b.log(`âœ… DÃ©fi refusÃ©: ${s}`)}catch(r){throw b.error("âŒ Erreur refus dÃ©fi:",r),r}}async function zh(s,t){try{const r=S(k,`challenges/${s}`),n=await z(r);if(!n.exists())throw new Error("DÃ©fi introuvable");const a=n.val();if(a.challengerId!==t)throw new Error("Seul l'initiateur peut annuler ce dÃ©fi");if(a.status!=="pending")throw new Error("Ce dÃ©fi ne peut plus Ãªtre annulÃ©");await os(r),b.log(`âœ… DÃ©fi annulÃ©: ${s}`)}catch(r){throw b.error("âŒ Erreur annulation dÃ©fi:",r),r}}async function Bh(s){try{const t=S(k,"challenges"),r=await z(t);if(!r.exists())return[];const n=r.val(),a=[];return Object.values(n).forEach(i=>{(i.challengerId===s||i.challengedId===s)&&a.push(i)}),a.sort((i,o)=>o.createdAt-i.createdAt)}catch(t){return b.error("âŒ Erreur rÃ©cupÃ©ration dÃ©fis:",t),[]}}async function Uh(s,t){try{const r=S(k,"challenges"),n=await z(r);if(!n.exists())return[];const a=n.val(),i=[];return Object.values(a).forEach(o=>{o.status==="pending"&&(o.challengerId===s&&o.challengedId===t||o.challengerId===t&&o.challengedId===s)&&i.push(o)}),i}catch(r){return b.error("âŒ Erreur rÃ©cupÃ©ration dÃ©fis actifs:",r),[]}}function qh(){const{user:s}=Ae(),{toast:t}=hi(),[r,n]=m.useState([]),[a,i]=m.useState([]),[o,l]=m.useState(!0),[c,d]=m.useState(!1),[u,h]=m.useState(""),[p,f]=m.useState("1v1"),[x,g]=m.useState(""),[y,j]=m.useState(0),[M,P]=m.useState(!1);m.useEffect(()=>{w()},[s]);const w=async()=>{if(s)try{l(!0);const[U,X]=await Promise.all([Bh(s.uid),Ro(s.uid)]);n(U),i(X)}catch(U){b.error("Erreur chargement dÃ©fis:",U),t({title:"Erreur",description:"Impossible de charger les dÃ©fis",variant:"destructive"})}finally{l(!1)}},I=async()=>{if(!(!s||!u))try{P(!0);const U=a.find(X=>X.id===u);if(!U)return;await Ih(s.uid,s.displayName||"Joueur",u,U.username,p,x,y),t({title:"DÃ©fi envoyÃ©!",description:`Votre dÃ©fi Ã  ${U.username} a Ã©tÃ© envoyÃ©`}),d(!1),h(""),g(""),j(0),w()}catch(U){b.error("Erreur crÃ©ation dÃ©fi:",U),t({title:"Erreur",description:U.message||"Impossible de crÃ©er le dÃ©fi",variant:"destructive"})}finally{P(!1)}},O=async U=>{if(s)try{await Dh(U,s.uid),t({title:"DÃ©fi acceptÃ©!",description:"Rendez-vous au baby-foot!"}),w()}catch(X){b.error("Erreur acceptation dÃ©fi:",X),t({title:"Erreur",description:X.message,variant:"destructive"})}},N=async U=>{if(s)try{await Fh(U,s.uid),t({title:"DÃ©fi refusÃ©",description:"Le dÃ©fi a Ã©tÃ© refusÃ©"}),w()}catch(X){b.error("Erreur refus dÃ©fi:",X),t({title:"Erreur",description:X.message,variant:"destructive"})}},R=async U=>{if(s)try{await zh(U,s.uid),t({title:"DÃ©fi annulÃ©",description:"Le dÃ©fi a Ã©tÃ© annulÃ©"}),w()}catch(X){b.error("Erreur annulation dÃ©fi:",X),t({title:"Erreur",description:X.message,variant:"destructive"})}},F=U=>{const X=Date.now(),pe=U-X;if(pe<=0)return"ExpirÃ©";const ge=Math.floor(pe/(1e3*60*60)),ye=Math.floor(pe%(1e3*60*60)/(1e3*60));return ge>0?`${ge}h ${ye}m`:`${ye}m`},A=U=>{const X={pending:{variant:"secondary",text:"En attente"},accepted:{variant:"default",text:"AcceptÃ©"},declined:{variant:"destructive",text:"RefusÃ©"},expired:{variant:"outline",text:"ExpirÃ©"},completed:{variant:"default",text:"TerminÃ©"}},{variant:pe,text:ge}=X[U];return e.jsx(le,{variant:pe,children:ge})},B=r.filter(U=>U.status==="pending"),_=r.filter(U=>U.status==="accepted"),J=r.filter(U=>["declined","expired","completed"].includes(U.status));return o?e.jsx($e,{children:e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(ue,{className:"w-8 h-8 animate-spin text-primary"})})}):e.jsx($e,{children:e.jsxs("div",{className:"container mx-auto px-4 py-8 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ps,{className:"w-8 h-8 text-primary"}),e.jsx("h1",{className:"text-3xl font-bold",children:"DÃ©fis"})]}),e.jsxs(T,{onClick:()=>d(!0),children:[e.jsx(Gs,{className:"w-4 h-4 mr-2"}),"Nouveau dÃ©fi"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(L,{children:e.jsxs(V,{className:"pt-6 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-500",children:B.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"En attente"})]})}),e.jsx(L,{children:e.jsxs(V,{className:"pt-6 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-500",children:_.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Actifs"})]})}),e.jsx(L,{children:e.jsxs(V,{className:"pt-6 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-500",children:J.filter(U=>U.status==="completed").length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"TerminÃ©s"})]})})]}),B.length>0&&e.jsxs(L,{children:[e.jsx(xe,{children:e.jsx(he,{children:"DÃ©fis en attente"})}),e.jsx(V,{className:"space-y-4",children:B.map(U=>{const X=U.challengedId===(s==null?void 0:s.uid);return e.jsxs(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"p-4 border rounded-lg space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ps,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:X?`${U.challengerUsername} vous dÃ©fie!`:`DÃ©fi envoyÃ© Ã  ${U.challengedUsername}`}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[U.type==="1v1"?"1v1":"2v2",U.stake&&U.stake>0?` â€¢ ${U.stake}â‚¬ en jeu`:""]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(it,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:F(U.expiresAt)})]})]}),U.message&&e.jsxs("div",{className:"text-sm italic text-muted-foreground pl-8",children:['"',U.message,'"']}),e.jsx("div",{className:"flex gap-2 pl-8",children:X?e.jsxs(e.Fragment,{children:[e.jsxs(T,{size:"sm",onClick:()=>O(U.id),children:[e.jsx(at,{className:"w-4 h-4 mr-1"}),"Accepter"]}),e.jsxs(T,{size:"sm",variant:"outline",onClick:()=>N(U.id),children:[e.jsx(Fe,{className:"w-4 h-4 mr-1"}),"Refuser"]})]}):e.jsxs(T,{size:"sm",variant:"outline",onClick:()=>R(U.id),children:[e.jsx(Fe,{className:"w-4 h-4 mr-1"}),"Annuler"]})})]},U.id)})})]}),_.length>0&&e.jsxs(L,{children:[e.jsx(xe,{children:e.jsx(he,{children:"DÃ©fis actifs"})}),e.jsx(V,{className:"space-y-4",children:_.map(U=>e.jsxs(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"p-4 border rounded-lg border-green-500/50 bg-green-500/5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Pe,{className:"w-5 h-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:U.challengerId===(s==null?void 0:s.uid)?`DÃ©fi contre ${U.challengedUsername}`:`DÃ©fi contre ${U.challengerUsername}`}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[U.type==="1v1"?"1v1":"2v2",U.stake&&U.stake>0?` â€¢ ${U.stake}â‚¬ en jeu`:""]})]})]}),A(U.status)]}),e.jsx("div",{className:"text-sm text-muted-foreground mt-2 pl-8",children:"Rendez-vous au baby-foot pour jouer ce match!"})]},U.id))})]}),J.length>0&&e.jsxs(L,{children:[e.jsx(xe,{children:e.jsx(he,{children:"Historique"})}),e.jsx(V,{className:"space-y-4",children:J.slice(0,5).map(U=>e.jsx("div",{className:"p-4 border rounded-lg opacity-60",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:U.challengerId===(s==null?void 0:s.uid)?`${U.challengedUsername}`:`${U.challengerUsername}`}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[U.type==="1v1"?"1v1":"2v2",U.winnerId===(s==null?void 0:s.uid)&&" â€¢ Victoire ðŸ†",U.winnerId&&U.winnerId!==(s==null?void 0:s.uid)&&" â€¢ DÃ©faite"]})]})}),A(U.status)]})},U.id))})]}),r.length===0&&e.jsx(L,{children:e.jsxs(V,{className:"py-12 text-center",children:[e.jsx(Ps,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Aucun dÃ©fi pour le moment"}),e.jsx(T,{onClick:()=>d(!0),children:"CrÃ©er votre premier dÃ©fi"})]})}),c&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs(W.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"bg-background rounded-lg p-6 max-w-md w-full space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Nouveau dÃ©fi"}),e.jsx(T,{variant:"ghost",size:"icon",onClick:()=>d(!1),children:e.jsx(Fe,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"DÃ©fier"}),e.jsxs("select",{className:"w-full p-2 border rounded-lg bg-background",value:u,onChange:U=>h(U.target.value),children:[e.jsx("option",{value:"",children:"SÃ©lectionner un ami"}),a.map(U=>e.jsx("option",{value:U.id,children:U.username},U.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Type"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(T,{variant:p==="1v1"?"default":"outline",onClick:()=>f("1v1"),className:"flex-1",children:"1v1"}),e.jsx(T,{variant:p==="2v2"?"default":"outline",onClick:()=>f("2v2"),className:"flex-1",children:"2v2"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Message (optionnel)"}),e.jsx(Nr,{placeholder:"Ajouter un message...",value:x,onChange:U=>g(U.target.value),maxLength:200})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Mise (optionnel)"}),e.jsx(je,{type:"number",placeholder:"0",value:y||"",onChange:U=>j(Number(U.target.value)),min:0})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(T,{className:"flex-1",onClick:I,disabled:!u||M,children:M?e.jsx(ue,{className:"w-4 h-4 animate-spin"}):"Envoyer le dÃ©fi"}),e.jsx(T,{variant:"outline",onClick:()=>d(!1),children:"Annuler"})]})]})]})})]})})}function Vh(s){return s>=20?"legendary":s>=10?"heated":"casual"}async function Gh(s,t,r,n,a){try{const[i,o]=[s,t].sort(),l=`${i}_${o}`,c=S(k,`rivalries/${l}`),d=await z(c);if(d.exists()){const u=d.val(),h=s===i,p=a&&h||!a&&!h?1:0,f=!a&&h||a&&!h?1:0,x={player1Wins:u.player1Wins+p,player2Wins:u.player2Wins+f,totalMatches:u.totalMatches+1,lastMatchDate:Date.now(),intensity:Vh(u.totalMatches+1)};await oe(c,x),b.log(`âœ… RivalitÃ© mise Ã  jour: ${l}`)}else{const u=s===i,h={id:l,player1Id:i,player2Id:o,player1Username:u?r:n,player2Username:u?n:r,player1Wins:u&&a||!u&&!a?1:0,player2Wins:u&&!a||!u&&a?1:0,totalMatches:1,lastMatchDate:Date.now(),createdAt:Date.now(),intensity:"casual"};await Re(c,h),b.log(`âœ… Nouvelle rivalitÃ© crÃ©Ã©e: ${l}`)}}catch(i){b.error("âŒ Erreur mise Ã  jour rivalitÃ©:",i)}}async function Yo(s){try{const t=S(k,"rivalries"),r=await z(t);if(!r.exists())return[];const n=r.val(),a=[];return Object.values(n).forEach(i=>{(i.player1Id===s||i.player2Id===s)&&a.push(i)}),a.sort((i,o)=>{const l={legendary:3,heated:2,casual:1},c=l[o.intensity]-l[i.intensity];return c!==0?c:o.totalMatches-i.totalMatches})}catch(t){return b.error("âŒ Erreur rÃ©cupÃ©ration rivalitÃ©s:",t),[]}}async function Hh(s,t){try{const[r,n]=[s,t].sort(),a=`${r}_${n}`,i=S(k,`rivalries/${a}`),o=await z(i);return o.exists()?o.val():null}catch(r){return b.error("âŒ Erreur rÃ©cupÃ©ration rivalitÃ©:",r),null}}async function Ko(s=10){try{const t=S(k,"rivalries"),r=await z(t);return r.exists()?Object.values(r.val()).sort((a,i)=>{const o={legendary:3,heated:2,casual:1},l=o[i.intensity]-o[a.intensity];return l!==0?l:i.totalMatches-a.totalMatches}).slice(0,s):[]}catch(t){return b.error("âŒ Erreur rÃ©cupÃ©ration top rivalitÃ©s:",t),[]}}const yn=Object.freeze(Object.defineProperty({__proto__:null,getRivalryBetween:Hh,getTopRivalries:Ko,getUserRivalries:Yo,updateRivalry:Gh},Symbol.toStringTag,{value:"Module"}));function Zh(){const{user:s}=Ae(),[t,r]=m.useState([]),[n,a]=m.useState([]),[i,o]=m.useState(!0),[l,c]=m.useState("mine");m.useEffect(()=>{d()},[s]);const d=async()=>{if(s)try{o(!0);const[x,g]=await Promise.all([Yo(s.uid),Ko(10)]);r(x),a(g)}catch(x){b.error("Erreur chargement rivalitÃ©s:",x)}finally{o(!1)}},u=x=>{const g={casual:{variant:"secondary",text:"Casual",icon:"ðŸŸ¢"},heated:{variant:"default",text:"Intense",icon:"ðŸŸ¡"},legendary:{variant:"destructive",text:"LÃ©gendaire",icon:"ðŸ”¥"}},{variant:y,text:j,icon:M}=g[x];return e.jsxs(le,{variant:y,children:[M," ",j]})},h=(x,g)=>{if(!g)return 50;const j=x.player1Id===g?x.player1Wins:x.player2Wins,M=x.totalMatches;return M>0?Math.round(j/M*100):0},p=(x,g)=>{if(!g)return{text:"Ã‰quilibrÃ©",color:"text-yellow-500"};const y=h(x,g);return y>=70?{text:"Dominant",color:"text-green-500"}:y>=55?{text:"Favori",color:"text-blue-500"}:y>=45?{text:"Ã‰quilibrÃ©",color:"text-yellow-500"}:y>=30?{text:"ChallengÃ©",color:"text-orange-500"}:{text:"En difficultÃ©",color:"text-red-500"}},f=({rivalry:x,showUserPerspective:g=!1})=>{const y=g&&x.player1Id===(s==null?void 0:s.uid),j=y?x.player1Wins:x.player2Wins,M=y?x.player2Wins:x.player1Wins;y?x.player1Username:x.player2Username;const P=y?x.player2Username:x.player1Username,w=h(x,s==null?void 0:s.uid),I=p(x,s==null?void 0:s.uid);return e.jsxs(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"p-6 border rounded-lg space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(er,{className:`w-6 h-6 ${x.intensity==="legendary"?"text-red-500":x.intensity==="heated"?"text-orange-500":"text-yellow-500"}`}),e.jsx("div",{children:g?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold text-lg",children:["vs ",P]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[x.totalMatches," matchs â€¢"," ",e.jsx("span",{className:I.color,children:I.text})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold text-lg",children:[x.player1Username," vs ",x.player2Username]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[x.totalMatches," matchs jouÃ©s"]})]})})]}),u(x.intensity)]}),g?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Votre taux de victoire"}),e.jsxs("span",{className:"font-semibold",children:[w,"%"]})]}),e.jsx(It,{value:w,className:"h-2"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center pt-2 border-t",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-green-500",children:j}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Victoires"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-red-500",children:M}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"DÃ©faites"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-500",children:x.totalMatches}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Total"})]})]})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2 border-t",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold text-lg",children:x.player1Username}),e.jsx("div",{className:"text-3xl font-bold text-primary mt-2",children:x.player1Wins}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"victoires"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold text-lg",children:x.player2Username}),e.jsx("div",{className:"text-3xl font-bold text-primary mt-2",children:x.player2Wins}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"victoires"})]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground text-center pt-2 border-t",children:["Dernier match:"," ",new Date(x.lastMatchDate).toLocaleDateString("fr-FR")]})]})};return i?e.jsx($e,{children:e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(ue,{className:"w-8 h-8 animate-spin text-primary"})})}):e.jsx($e,{children:e.jsxs("div",{className:"container mx-auto px-4 py-8 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(er,{className:"w-8 h-8 text-red-500"}),e.jsx("h1",{className:"text-3xl font-bold",children:"RivalitÃ©s"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(T,{variant:l==="mine"?"default":"outline",onClick:()=>c("mine"),className:"flex-1",children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Mes rivalitÃ©s"]}),e.jsxs(T,{variant:l==="global"?"default":"outline",onClick:()=>c("global"),className:"flex-1",children:[e.jsx(Oe,{className:"w-4 h-4 mr-2"}),"Top rivalitÃ©s"]})]}),l==="mine"&&t.length>0&&e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(L,{children:e.jsxs(V,{className:"pt-6 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:t.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"RivalitÃ©s"})]})}),e.jsx(L,{children:e.jsxs(V,{className:"pt-6 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-500",children:t.filter(x=>x.intensity==="heated"||x.intensity==="legendary").length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Intenses"})]})}),e.jsx(L,{children:e.jsxs(V,{className:"pt-6 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-500",children:t.filter(x=>x.intensity==="legendary").length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"LÃ©gendaires"})]})})]}),l==="mine"&&e.jsx(e.Fragment,{children:t.length>0?e.jsx("div",{className:"space-y-4",children:t.map(x=>e.jsx(f,{rivalry:x,showUserPerspective:!0},x.id))}):e.jsx(L,{children:e.jsxs(V,{className:"py-12 text-center",children:[e.jsx(Ee,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground mb-2",children:"Aucune rivalitÃ© pour le moment"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Jouez des matchs en 1v1 pour crÃ©er des rivalitÃ©s!"})]})})}),l==="global"&&e.jsx(e.Fragment,{children:n.length>0?e.jsxs(L,{children:[e.jsx(xe,{children:e.jsx(he,{children:"Les rivalitÃ©s les plus intenses"})}),e.jsx(V,{className:"space-y-4",children:n.map((x,g)=>e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -left-4 top-6 w-8 h-8 rounded-full bg-primary flex items-center justify-center font-bold text-sm",children:g+1}),e.jsx(f,{rivalry:x})]},x.id))})]}):e.jsx(L,{children:e.jsxs(V,{className:"py-12 text-center",children:[e.jsx(er,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:"Aucune rivalitÃ© enregistrÃ©e pour le moment"})]})})})]})})}const Wh=new mc,Qh=()=>{Su();const s=Hs();return e.jsxs(e.Fragment,{children:[e.jsx(nt,{mode:"wait",children:e.jsxs(bc,{location:s,children:[e.jsx(ze,{path:"/auth",element:e.jsx(Be,{children:e.jsx(Bx,{})})}),e.jsx(ze,{path:"/reset-password/:token",element:e.jsx(Be,{children:e.jsx(Vx,{})})}),e.jsx(ze,{path:"/",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(Qu,{})})})}),e.jsx(ze,{path:"/inventory",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(eh,{})})})}),e.jsx(ze,{path:"/admin",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(Rh,{})})})}),e.jsx(ze,{path:"/leaderboard",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(Sm,{})})})}),e.jsx(ze,{path:"/match",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(_m,{})})})}),e.jsx(ze,{path:"/record-match",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx($h,{})})})}),e.jsx(ze,{path:"/babydex",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(Im,{})})})}),e.jsx(ze,{path:"/market",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(Zx,{})})})}),e.jsx(ze,{path:"/my-offers",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(Mh,{})})})}),e.jsx(ze,{path:"/card-statistics",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(Th,{})})})}),e.jsx(ze,{path:"/betting",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(Gx,{})})})}),e.jsx(ze,{path:"/profile",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(mx,{})})})}),e.jsx(ze,{path:"/shop",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(Qx,{})})})}),e.jsx(ze,{path:"/clubs",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(Xx,{})})})}),e.jsx(ze,{path:"/tournament",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(oh,{})})})}),e.jsx(ze,{path:"/chat",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(Ah,{})})})}),e.jsx(ze,{path:"/quests",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(Oh,{})})})}),e.jsx(ze,{path:"/challenges",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(qh,{})})})}),e.jsx(ze,{path:"/rivalries",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(Zh,{})})})}),e.jsx(ze,{path:"*",element:e.jsx(Be,{children:e.jsx(Ux,{})})})]},s.pathname)}),e.jsx(Ii,{})]})},Jh=()=>e.jsx(yu,{children:e.jsx(xc,{client:Wh,children:e.jsxs(jd,{children:[e.jsx(gc,{children:e.jsx(pu,{children:e.jsx(bu,{children:e.jsx(Qh,{})})})}),e.jsx(fd,{}),e.jsx(yd,{})]})})});ru();const Xo=document.getElementById("root");if(!Xo)throw new Error("Root element not found");document.body.classList.add("loaded");bl(Xo).render(e.jsx(m.StrictMode,{children:e.jsx(Jh,{})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/",updateViaCache:"none"}).then(s=>{b.log("âœ… [FCM] Service Worker enregistrÃ© !",s.scope),setInterval(()=>{s.update()},60*60*1e3),s.addEventListener("updatefound",()=>{const r=s.installing;r==null||r.addEventListener("statechange",()=>{r.state==="installed"&&navigator.serviceWorker.controller&&confirm("Une nouvelle version est disponible ! Voulez-vous recharger ?")&&(r.postMessage({type:"SKIP_WAITING"}),window.location.reload())})});let t=!1;navigator.serviceWorker.addEventListener("controllerchange",()=>{t||(t=!0,window.location.reload())})}).catch(s=>{b.error("âŒ [FCM] Erreur d'enregistrement du Service Worker:",s)}),window.addEventListener("online",()=>{}),window.addEventListener("offline",()=>{})});
