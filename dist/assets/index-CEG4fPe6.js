var tl=Object.defineProperty;var sl=(s,t,r)=>t in s?tl(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r;var vr=(s,t,r)=>sl(s,typeof t!="symbol"?t+"":t,r);import{r as u,j as e,R as rl,e as al}from"./vendor-react-BxsbldMV.js";import{V as gn,R as bn,A as yn,C as vn,T as jn,D as wn,P as nl,a as Nn,b as il,S as ol,c as ll,d as Cn,e as cl,f as dl,g as Sn,h as ul,i as ml,j as kn,k as xl,l as _n,I as hl,L as En,m as Rn,n as $n,o as fl,O as An,p as pl,q as Mn,r as gl,s as Tn,t as Pn,u as bl,v as yl,w as On,x as vl,y as Ln,z as In,B as jl,E as Dn,F as Fn,G as zn,H as Bn,J as Un,K as wl,M as qn,N as Nl,Q as Vn,U as Gn,W as Cl,X as Hn,Y as Sl,Z as Zn,_ as Wn,$ as kl,a0 as _l,a1 as Qn,a2 as El,a3 as Rl}from"./vendor-radix-DZuMzuN9.js";import{c as Jn,X as Ze,$ as $l,L as ue,T as ls,R as Al,H as ra,B as As,D as Zt,C as nt,M as Is,a as Te,U as Re,b as ys,d as Yn,e as Us,A as ur,f as aa,g as Kn,Z as vt,h as Ie,G as Ml,S as Xn,i as it,P as ei,j as ti,k as ns,l as Tl,m as Pl,n as ct,F as mr,o as Ol,p as Ll,q as $t,r as jt,s as si,t as Vt,u as Gt,v as Mt,w as Wt,I as Ht,x as vs,y as cs,z as Il,E as Dl,J as Fl,K as zl,Y as Bl,N as Ul,O as ql,Q as Vl,V as Gl,W as ds,_ as Ra,a0 as Et,a1 as _s,a2 as Es,a3 as rs,a4 as ot,a5 as js,a6 as xr,a7 as Qt,a8 as ri,a9 as ai,aa as $a,ab as us,ac as ni,ad as zr,ae as ii,af as sr,ag as Hl,ah as Zl,ai as Wl,aj as Ql,ak as jr,al as Ut,am as as,an as oi,ao as Jl,ap as Aa,aq as Yl,ar as Kl,as as Xl,at as ec}from"./vendor-ui-CUyU4sRp.js";import{u as qs,N as tc,a as sc,b as mt,L as Rs,c as rc,B as ac,R as nc,d as Ve}from"./vendor-router-o6rgvikh.js";import{i as ic,g as oc,c as na,d as lc,e as cc,o as dc,s as wr,f as li,u as uc,h as $e,r as k,j as mc,k as q,l as et,m as ia,n as ce,p as xc,q as hc,t as xt,v as Ms,w as fc,x as pc,y as ci,z as rr,A as di,B as ar}from"./vendor-firebase-CWnkKim8.js";import{A as rt,m as W}from"./vendor-framer-IsYYbCxk.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function r(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=r(a);fetch(a.href,i)}})();const gc=1,bc=1e6;let Nr=0;function yc(){return Nr=(Nr+1)%Number.MAX_SAFE_INTEGER,Nr.toString()}const Cr=new Map,Ma=s=>{if(Cr.has(s))return;const t=setTimeout(()=>{Cr.delete(s),Ts({type:"REMOVE_TOAST",toastId:s})},bc);Cr.set(s,t)},vc=(s,t)=>{switch(t.type){case"ADD_TOAST":return{...s,toasts:[t.toast,...s.toasts].slice(0,gc)};case"UPDATE_TOAST":return{...s,toasts:s.toasts.map(r=>r.id===t.toast.id?{...r,...t.toast}:r)};case"DISMISS_TOAST":{const{toastId:r}=t;return r?Ma(r):s.toasts.forEach(n=>{Ma(n.id)}),{...s,toasts:s.toasts.map(n=>n.id===r||r===void 0?{...n,open:!1}:n)}}case"REMOVE_TOAST":return t.toastId===void 0?{...s,toasts:[]}:{...s,toasts:s.toasts.filter(r=>r.id!==t.toastId)}}},Ys=[];let Ks={toasts:[]};function Ts(s){Ks=vc(Ks,s),Ys.forEach(t=>{t(Ks)})}function $({...s}){const t=yc(),r=a=>Ts({type:"UPDATE_TOAST",toast:{...a,id:t}}),n=()=>Ts({type:"DISMISS_TOAST",toastId:t});return Ts({type:"ADD_TOAST",toast:{...s,id:t,open:!0,onOpenChange:a=>{a||n()}}}),{id:t,dismiss:n,update:r}}function jc(){const[s,t]=u.useState(Ks);return u.useEffect(()=>(Ys.push(t),()=>{const r=Ys.indexOf(t);r>-1&&Ys.splice(r,1)}),[s]),{...s,toast:$,dismiss:r=>Ts({type:"DISMISS_TOAST",toastId:r})}}const Ta=s=>typeof s=="boolean"?`${s}`:s===0?"0":s,Pa=Jn,hr=(s,t)=>r=>{var n;if((t==null?void 0:t.variants)==null)return Pa(s,r==null?void 0:r.class,r==null?void 0:r.className);const{variants:a,defaultVariants:i}=t,o=Object.keys(a).map(d=>{const m=r==null?void 0:r[d],x=i==null?void 0:i[d];if(m===null)return null;const p=Ta(m)||Ta(x);return a[d][p]}),l=r&&Object.entries(r).reduce((d,m)=>{let[x,p]=m;return p===void 0||(d[x]=p),d},{}),c=t==null||(n=t.compoundVariants)===null||n===void 0?void 0:n.reduce((d,m)=>{let{class:x,className:p,...f}=m;return Object.entries(f).every(h=>{let[g,v]=h;return Array.isArray(v)?v.includes({...i,...l}[g]):{...i,...l}[g]===v})?[...d,x,p]:d},[]);return Pa(s,o,c,r==null?void 0:r.class,r==null?void 0:r.className)},oa="-",wc=s=>{const t=Cc(s),{conflictingClassGroups:r,conflictingClassGroupModifiers:n}=s;return{getClassGroupId:o=>{const l=o.split(oa);return l[0]===""&&l.length!==1&&l.shift(),ui(l,t)||Nc(o)},getConflictingClassGroupIds:(o,l)=>{const c=r[o]||[];return l&&n[o]?[...c,...n[o]]:c}}},ui=(s,t)=>{var o;if(s.length===0)return t.classGroupId;const r=s[0],n=t.nextPart.get(r),a=n?ui(s.slice(1),n):void 0;if(a)return a;if(t.validators.length===0)return;const i=s.join(oa);return(o=t.validators.find(({validator:l})=>l(i)))==null?void 0:o.classGroupId},Oa=/^\[(.+)\]$/,Nc=s=>{if(Oa.test(s)){const t=Oa.exec(s)[1],r=t==null?void 0:t.substring(0,t.indexOf(":"));if(r)return"arbitrary.."+r}},Cc=s=>{const{theme:t,prefix:r}=s,n={nextPart:new Map,validators:[]};return kc(Object.entries(s.classGroups),r).forEach(([i,o])=>{Br(o,n,i,t)}),n},Br=(s,t,r,n)=>{s.forEach(a=>{if(typeof a=="string"){const i=a===""?t:La(t,a);i.classGroupId=r;return}if(typeof a=="function"){if(Sc(a)){Br(a(n),t,r,n);return}t.validators.push({validator:a,classGroupId:r});return}Object.entries(a).forEach(([i,o])=>{Br(o,La(t,i),r,n)})})},La=(s,t)=>{let r=s;return t.split(oa).forEach(n=>{r.nextPart.has(n)||r.nextPart.set(n,{nextPart:new Map,validators:[]}),r=r.nextPart.get(n)}),r},Sc=s=>s.isThemeGetter,kc=(s,t)=>t?s.map(([r,n])=>{const a=n.map(i=>typeof i=="string"?t+i:typeof i=="object"?Object.fromEntries(Object.entries(i).map(([o,l])=>[t+o,l])):i);return[r,a]}):s,_c=s=>{if(s<1)return{get:()=>{},set:()=>{}};let t=0,r=new Map,n=new Map;const a=(i,o)=>{r.set(i,o),t++,t>s&&(t=0,n=r,r=new Map)};return{get(i){let o=r.get(i);if(o!==void 0)return o;if((o=n.get(i))!==void 0)return a(i,o),o},set(i,o){r.has(i)?r.set(i,o):a(i,o)}}},mi="!",Ec=s=>{const{separator:t,experimentalParseClassName:r}=s,n=t.length===1,a=t[0],i=t.length,o=l=>{const c=[];let d=0,m=0,x;for(let v=0;v<l.length;v++){let j=l[v];if(d===0){if(j===a&&(n||l.slice(v,v+i)===t)){c.push(l.slice(m,v)),m=v+i;continue}if(j==="/"){x=v;continue}}j==="["?d++:j==="]"&&d--}const p=c.length===0?l:l.substring(m),f=p.startsWith(mi),h=f?p.substring(1):p,g=x&&x>m?x-m:void 0;return{modifiers:c,hasImportantModifier:f,baseClassName:h,maybePostfixModifierPosition:g}};return r?l=>r({className:l,parseClassName:o}):o},Rc=s=>{if(s.length<=1)return s;const t=[];let r=[];return s.forEach(n=>{n[0]==="["?(t.push(...r.sort(),n),r=[]):r.push(n)}),t.push(...r.sort()),t},$c=s=>({cache:_c(s.cacheSize),parseClassName:Ec(s),...wc(s)}),Ac=/\s+/,Mc=(s,t)=>{const{parseClassName:r,getClassGroupId:n,getConflictingClassGroupIds:a}=t,i=[],o=s.trim().split(Ac);let l="";for(let c=o.length-1;c>=0;c-=1){const d=o[c],{modifiers:m,hasImportantModifier:x,baseClassName:p,maybePostfixModifierPosition:f}=r(d);let h=!!f,g=n(h?p.substring(0,f):p);if(!g){if(!h){l=d+(l.length>0?" "+l:l);continue}if(g=n(p),!g){l=d+(l.length>0?" "+l:l);continue}h=!1}const v=Rc(m).join(":"),j=x?v+mi:v,M=j+g;if(i.includes(M))continue;i.push(M);const P=a(g,h);for(let C=0;C<P.length;++C){const I=P[C];i.push(j+I)}l=d+(l.length>0?" "+l:l)}return l};function Tc(){let s=0,t,r,n="";for(;s<arguments.length;)(t=arguments[s++])&&(r=xi(t))&&(n&&(n+=" "),n+=r);return n}const xi=s=>{if(typeof s=="string")return s;let t,r="";for(let n=0;n<s.length;n++)s[n]&&(t=xi(s[n]))&&(r&&(r+=" "),r+=t);return r};function Pc(s,...t){let r,n,a,i=o;function o(c){const d=t.reduce((m,x)=>x(m),s());return r=$c(d),n=r.cache.get,a=r.cache.set,i=l,l(c)}function l(c){const d=n(c);if(d)return d;const m=Mc(c,r);return a(c,m),m}return function(){return i(Tc.apply(null,arguments))}}const Ae=s=>{const t=r=>r[s]||[];return t.isThemeGetter=!0,t},hi=/^\[(?:([a-z-]+):)?(.+)\]$/i,Oc=/^\d+\/\d+$/,Lc=new Set(["px","full","screen"]),Ic=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Dc=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Fc=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,zc=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Bc=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,ft=s=>is(s)||Lc.has(s)||Oc.test(s),Nt=s=>ws(s,"length",Qc),is=s=>!!s&&!Number.isNaN(Number(s)),Sr=s=>ws(s,"number",is),Ss=s=>!!s&&Number.isInteger(Number(s)),Uc=s=>s.endsWith("%")&&is(s.slice(0,-1)),be=s=>hi.test(s),Ct=s=>Ic.test(s),qc=new Set(["length","size","percentage"]),Vc=s=>ws(s,qc,fi),Gc=s=>ws(s,"position",fi),Hc=new Set(["image","url"]),Zc=s=>ws(s,Hc,Yc),Wc=s=>ws(s,"",Jc),ks=()=>!0,ws=(s,t,r)=>{const n=hi.exec(s);return n?n[1]?typeof t=="string"?n[1]===t:t.has(n[1]):r(n[2]):!1},Qc=s=>Dc.test(s)&&!Fc.test(s),fi=()=>!1,Jc=s=>zc.test(s),Yc=s=>Bc.test(s),Kc=()=>{const s=Ae("colors"),t=Ae("spacing"),r=Ae("blur"),n=Ae("brightness"),a=Ae("borderColor"),i=Ae("borderRadius"),o=Ae("borderSpacing"),l=Ae("borderWidth"),c=Ae("contrast"),d=Ae("grayscale"),m=Ae("hueRotate"),x=Ae("invert"),p=Ae("gap"),f=Ae("gradientColorStops"),h=Ae("gradientColorStopPositions"),g=Ae("inset"),v=Ae("margin"),j=Ae("opacity"),M=Ae("padding"),P=Ae("saturate"),C=Ae("scale"),I=Ae("sepia"),O=Ae("skew"),w=Ae("space"),E=Ae("translate"),V=()=>["auto","contain","none"],A=()=>["auto","hidden","clip","visible","scroll"],B=()=>["auto",be,t],S=()=>[be,t],J=()=>["",ft,Nt],me=()=>["auto",is,be],re=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],Se=()=>["solid","dashed","dotted","double","none"],ve=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],je=()=>["start","end","center","between","around","evenly","stretch"],K=()=>["","0",be],ee=()=>["auto","avoid","all","avoid-page","page","left","right","column"],z=()=>[is,be];return{cacheSize:500,separator:":",theme:{colors:[ks],spacing:[ft,Nt],blur:["none","",Ct,be],brightness:z(),borderColor:[s],borderRadius:["none","","full",Ct,be],borderSpacing:S(),borderWidth:J(),contrast:z(),grayscale:K(),hueRotate:z(),invert:K(),gap:S(),gradientColorStops:[s],gradientColorStopPositions:[Uc,Nt],inset:B(),margin:B(),opacity:z(),padding:S(),saturate:z(),scale:z(),sepia:K(),skew:z(),space:S(),translate:S()},classGroups:{aspect:[{aspect:["auto","square","video",be]}],container:["container"],columns:[{columns:[Ct]}],"break-after":[{"break-after":ee()}],"break-before":[{"break-before":ee()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...re(),be]}],overflow:[{overflow:A()}],"overflow-x":[{"overflow-x":A()}],"overflow-y":[{"overflow-y":A()}],overscroll:[{overscroll:V()}],"overscroll-x":[{"overscroll-x":V()}],"overscroll-y":[{"overscroll-y":V()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[g]}],"inset-x":[{"inset-x":[g]}],"inset-y":[{"inset-y":[g]}],start:[{start:[g]}],end:[{end:[g]}],top:[{top:[g]}],right:[{right:[g]}],bottom:[{bottom:[g]}],left:[{left:[g]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Ss,be]}],basis:[{basis:B()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",be]}],grow:[{grow:K()}],shrink:[{shrink:K()}],order:[{order:["first","last","none",Ss,be]}],"grid-cols":[{"grid-cols":[ks]}],"col-start-end":[{col:["auto",{span:["full",Ss,be]},be]}],"col-start":[{"col-start":me()}],"col-end":[{"col-end":me()}],"grid-rows":[{"grid-rows":[ks]}],"row-start-end":[{row:["auto",{span:[Ss,be]},be]}],"row-start":[{"row-start":me()}],"row-end":[{"row-end":me()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",be]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",be]}],gap:[{gap:[p]}],"gap-x":[{"gap-x":[p]}],"gap-y":[{"gap-y":[p]}],"justify-content":[{justify:["normal",...je()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...je(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...je(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[M]}],px:[{px:[M]}],py:[{py:[M]}],ps:[{ps:[M]}],pe:[{pe:[M]}],pt:[{pt:[M]}],pr:[{pr:[M]}],pb:[{pb:[M]}],pl:[{pl:[M]}],m:[{m:[v]}],mx:[{mx:[v]}],my:[{my:[v]}],ms:[{ms:[v]}],me:[{me:[v]}],mt:[{mt:[v]}],mr:[{mr:[v]}],mb:[{mb:[v]}],ml:[{ml:[v]}],"space-x":[{"space-x":[w]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[w]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",be,t]}],"min-w":[{"min-w":[be,t,"min","max","fit"]}],"max-w":[{"max-w":[be,t,"none","full","min","max","fit","prose",{screen:[Ct]},Ct]}],h:[{h:[be,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[be,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[be,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[be,t,"auto","min","max","fit"]}],"font-size":[{text:["base",Ct,Nt]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Sr]}],"font-family":[{font:[ks]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",be]}],"line-clamp":[{"line-clamp":["none",is,Sr]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",ft,be]}],"list-image":[{"list-image":["none",be]}],"list-style-type":[{list:["none","disc","decimal",be]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[s]}],"placeholder-opacity":[{"placeholder-opacity":[j]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[s]}],"text-opacity":[{"text-opacity":[j]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Se(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",ft,Nt]}],"underline-offset":[{"underline-offset":["auto",ft,be]}],"text-decoration-color":[{decoration:[s]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:S()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",be]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",be]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[j]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...re(),Gc]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Vc]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},Zc]}],"bg-color":[{bg:[s]}],"gradient-from-pos":[{from:[h]}],"gradient-via-pos":[{via:[h]}],"gradient-to-pos":[{to:[h]}],"gradient-from":[{from:[f]}],"gradient-via":[{via:[f]}],"gradient-to":[{to:[f]}],rounded:[{rounded:[i]}],"rounded-s":[{"rounded-s":[i]}],"rounded-e":[{"rounded-e":[i]}],"rounded-t":[{"rounded-t":[i]}],"rounded-r":[{"rounded-r":[i]}],"rounded-b":[{"rounded-b":[i]}],"rounded-l":[{"rounded-l":[i]}],"rounded-ss":[{"rounded-ss":[i]}],"rounded-se":[{"rounded-se":[i]}],"rounded-ee":[{"rounded-ee":[i]}],"rounded-es":[{"rounded-es":[i]}],"rounded-tl":[{"rounded-tl":[i]}],"rounded-tr":[{"rounded-tr":[i]}],"rounded-br":[{"rounded-br":[i]}],"rounded-bl":[{"rounded-bl":[i]}],"border-w":[{border:[l]}],"border-w-x":[{"border-x":[l]}],"border-w-y":[{"border-y":[l]}],"border-w-s":[{"border-s":[l]}],"border-w-e":[{"border-e":[l]}],"border-w-t":[{"border-t":[l]}],"border-w-r":[{"border-r":[l]}],"border-w-b":[{"border-b":[l]}],"border-w-l":[{"border-l":[l]}],"border-opacity":[{"border-opacity":[j]}],"border-style":[{border:[...Se(),"hidden"]}],"divide-x":[{"divide-x":[l]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[l]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[j]}],"divide-style":[{divide:Se()}],"border-color":[{border:[a]}],"border-color-x":[{"border-x":[a]}],"border-color-y":[{"border-y":[a]}],"border-color-s":[{"border-s":[a]}],"border-color-e":[{"border-e":[a]}],"border-color-t":[{"border-t":[a]}],"border-color-r":[{"border-r":[a]}],"border-color-b":[{"border-b":[a]}],"border-color-l":[{"border-l":[a]}],"divide-color":[{divide:[a]}],"outline-style":[{outline:["",...Se()]}],"outline-offset":[{"outline-offset":[ft,be]}],"outline-w":[{outline:[ft,Nt]}],"outline-color":[{outline:[s]}],"ring-w":[{ring:J()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[s]}],"ring-opacity":[{"ring-opacity":[j]}],"ring-offset-w":[{"ring-offset":[ft,Nt]}],"ring-offset-color":[{"ring-offset":[s]}],shadow:[{shadow:["","inner","none",Ct,Wc]}],"shadow-color":[{shadow:[ks]}],opacity:[{opacity:[j]}],"mix-blend":[{"mix-blend":[...ve(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":ve()}],filter:[{filter:["","none"]}],blur:[{blur:[r]}],brightness:[{brightness:[n]}],contrast:[{contrast:[c]}],"drop-shadow":[{"drop-shadow":["","none",Ct,be]}],grayscale:[{grayscale:[d]}],"hue-rotate":[{"hue-rotate":[m]}],invert:[{invert:[x]}],saturate:[{saturate:[P]}],sepia:[{sepia:[I]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[r]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[c]}],"backdrop-grayscale":[{"backdrop-grayscale":[d]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[m]}],"backdrop-invert":[{"backdrop-invert":[x]}],"backdrop-opacity":[{"backdrop-opacity":[j]}],"backdrop-saturate":[{"backdrop-saturate":[P]}],"backdrop-sepia":[{"backdrop-sepia":[I]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[o]}],"border-spacing-x":[{"border-spacing-x":[o]}],"border-spacing-y":[{"border-spacing-y":[o]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",be]}],duration:[{duration:z()}],ease:[{ease:["linear","in","out","in-out",be]}],delay:[{delay:z()}],animate:[{animate:["none","spin","ping","pulse","bounce",be]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[C]}],"scale-x":[{"scale-x":[C]}],"scale-y":[{"scale-y":[C]}],rotate:[{rotate:[Ss,be]}],"translate-x":[{"translate-x":[E]}],"translate-y":[{"translate-y":[E]}],"skew-x":[{"skew-x":[O]}],"skew-y":[{"skew-y":[O]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",be]}],accent:[{accent:["auto",s]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",be]}],"caret-color":[{caret:[s]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":S()}],"scroll-mx":[{"scroll-mx":S()}],"scroll-my":[{"scroll-my":S()}],"scroll-ms":[{"scroll-ms":S()}],"scroll-me":[{"scroll-me":S()}],"scroll-mt":[{"scroll-mt":S()}],"scroll-mr":[{"scroll-mr":S()}],"scroll-mb":[{"scroll-mb":S()}],"scroll-ml":[{"scroll-ml":S()}],"scroll-p":[{"scroll-p":S()}],"scroll-px":[{"scroll-px":S()}],"scroll-py":[{"scroll-py":S()}],"scroll-ps":[{"scroll-ps":S()}],"scroll-pe":[{"scroll-pe":S()}],"scroll-pt":[{"scroll-pt":S()}],"scroll-pr":[{"scroll-pr":S()}],"scroll-pb":[{"scroll-pb":S()}],"scroll-pl":[{"scroll-pl":S()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",be]}],fill:[{fill:[s,"none"]}],"stroke-w":[{stroke:[ft,Nt,Sr]}],stroke:[{stroke:[s,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},Xc=Pc(Kc);function de(...s){return Xc(Jn(s))}const Ia=[{threshold:0,rate:.1},{threshold:100,rate:.15},{threshold:1e3,rate:.19},{threshold:2e3,rate:.23}];function Ur(s){let t=Ia[0].rate;for(const r of Ia)if(s>=r.threshold)t=r.rate;else break;return t}const ed=nl,pi=u.forwardRef(({className:s,...t},r)=>e.jsx(gn,{ref:r,className:de("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",s),...t}));pi.displayName=gn.displayName;const td=hr("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),gi=u.forwardRef(({className:s,variant:t,...r},n)=>e.jsx(bn,{ref:n,className:de(td({variant:t}),s),...r}));gi.displayName=bn.displayName;const sd=u.forwardRef(({className:s,...t},r)=>e.jsx(yn,{ref:r,className:de("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",s),...t}));sd.displayName=yn.displayName;const bi=u.forwardRef(({className:s,...t},r)=>e.jsx(vn,{ref:r,className:de("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",s),"toast-close":"",...t,children:e.jsx(Ze,{className:"h-4 w-4"})}));bi.displayName=vn.displayName;const yi=u.forwardRef(({className:s,...t},r)=>e.jsx(jn,{ref:r,className:de("text-sm font-semibold",s),...t}));yi.displayName=jn.displayName;const vi=u.forwardRef(({className:s,...t},r)=>e.jsx(wn,{ref:r,className:de("text-sm opacity-90",s),...t}));vi.displayName=wn.displayName;function rd(){const{toasts:s}=jc();return e.jsxs(ed,{children:[s.map(function({id:t,title:r,description:n,action:a,...i}){return e.jsxs(gi,{...i,children:[e.jsxs("div",{className:"grid gap-1",children:[r&&e.jsx(yi,{children:r}),n&&e.jsx(vi,{children:n})]}),a,e.jsx(bi,{})]},t)}),e.jsx(pi,{})]})}var Da=["light","dark"],ad="(prefers-color-scheme: dark)",nd=u.createContext(void 0),id={setTheme:s=>{},themes:[]},od=()=>{var s;return(s=u.useContext(nd))!=null?s:id};u.memo(({forcedTheme:s,storageKey:t,attribute:r,enableSystem:n,enableColorScheme:a,defaultTheme:i,value:o,attrs:l,nonce:c})=>{let d=i==="system",m=r==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${l.map(h=>`'${h}'`).join(",")})`};`:`var d=document.documentElement,n='${r}',s='setAttribute';`,x=a?Da.includes(i)&&i?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${i}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",p=(h,g=!1,v=!0)=>{let j=o?o[h]:h,M=g?h+"|| ''":`'${j}'`,P="";return a&&v&&!g&&Da.includes(h)&&(P+=`d.style.colorScheme = '${h}';`),r==="class"?g||j?P+=`c.add(${M})`:P+="null":j&&(P+=`d[s](n,${M})`),P},f=s?`!function(){${m}${p(s)}}()`:n?`!function(){try{${m}var e=localStorage.getItem('${t}');if('system'===e||(!e&&${d})){var t='${ad}',m=window.matchMedia(t);if(m.media!==t||m.matches){${p("dark")}}else{${p("light")}}}else if(e){${o?`var x=${JSON.stringify(o)};`:""}${p(o?"x[e]":"e",!0)}}${d?"":"else{"+p(i,!1,!1)+"}"}${x}}catch(e){}}()`:`!function(){try{${m}var e=localStorage.getItem('${t}');if(e){${o?`var x=${JSON.stringify(o)};`:""}${p(o?"x[e]":"e",!0)}}else{${p(i,!1,!1)};}${x}}catch(t){}}();`;return u.createElement("script",{nonce:c,dangerouslySetInnerHTML:{__html:f}})});const ld=({...s})=>{const{theme:t="system"}=od();return e.jsx($l,{theme:t,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...s})},cd=il,dd=u.forwardRef(({className:s,sideOffset:t=4,...r},n)=>e.jsx(Nn,{ref:n,sideOffset:t,className:de("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...r}));dd.displayName=Nn.displayName;const os=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,Tt=globalThis,Ps="10.32.1";function la(){return ca(Tt),Tt}function ca(s){const t=s.__SENTRY__=s.__SENTRY__||{};return t.version=t.version||Ps,t[Ps]=t[Ps]||{}}function da(s,t,r=Tt){const n=r.__SENTRY__=r.__SENTRY__||{},a=n[Ps]=n[Ps]||{};return a[s]||(a[s]=t())}const ud="Sentry Logger ",Fa={};function md(s){if(!("console"in Tt))return s();const t=Tt.console,r={},n=Object.keys(Fa);n.forEach(a=>{const i=Fa[a];r[a]=t[a],t[a]=i});try{return s()}finally{n.forEach(a=>{t[a]=r[a]})}}function xd(){ma().enabled=!0}function hd(){ma().enabled=!1}function ji(){return ma().enabled}function fd(...s){ua("log",...s)}function pd(...s){ua("warn",...s)}function gd(...s){ua("error",...s)}function ua(s,...t){os&&ji()&&md(()=>{Tt.console[s](`${ud}[${s}]:`,...t)})}function ma(){return os?da("loggerSettings",()=>({enabled:!1})):{enabled:!1}}const Xs={enable:xd,disable:hd,isEnabled:ji,log:fd,warn:pd,error:gd},bd=Object.prototype.toString;function yd(s,t){return bd.call(s)===`[object ${t}]`}function vd(s){return yd(s,"Object")}function jd(s){return!!(s!=null&&s.then&&typeof s.then=="function")}function wd(s,t,r){try{Object.defineProperty(s,t,{value:r,writable:!0,configurable:!0})}catch{os&&Xs.log(`Failed to add non-enumerable property "${t}" to object`,s)}}function Nd(s,t=0){return typeof s!="string"||t===0||s.length<=t?s:`${s.slice(0,t)}...`}function Cd(){const s=Tt;return s.crypto||s.msCrypto}let kr;function Sd(){return Math.random()*16}function Os(s=Cd()){try{if(s!=null&&s.randomUUID)return s.randomUUID().replace(/-/g,"")}catch{}return kr||(kr="10000000100040008000"+1e11),kr.replace(/[018]/g,t=>(t^(Sd()&15)>>t/4).toString(16))}const wi=1e3;function Ni(){return Date.now()/wi}function kd(){const{performance:s}=Tt;if(!(s!=null&&s.now)||!s.timeOrigin)return Ni;const t=s.timeOrigin;return()=>(t+s.now())/wi}let za;function _d(){return(za??(za=kd()))()}function Ed(s,t={}){if(t.user&&(!s.ipAddress&&t.user.ip_address&&(s.ipAddress=t.user.ip_address),!s.did&&!t.did&&(s.did=t.user.id||t.user.email||t.user.username)),s.timestamp=t.timestamp||_d(),t.abnormal_mechanism&&(s.abnormal_mechanism=t.abnormal_mechanism),t.ignoreDuration&&(s.ignoreDuration=t.ignoreDuration),t.sid&&(s.sid=t.sid.length===32?t.sid:Os()),t.init!==void 0&&(s.init=t.init),!s.did&&t.did&&(s.did=`${t.did}`),typeof t.started=="number"&&(s.started=t.started),s.ignoreDuration)s.duration=void 0;else if(typeof t.duration=="number")s.duration=t.duration;else{const r=s.timestamp-s.started;s.duration=r>=0?r:0}t.release&&(s.release=t.release),t.environment&&(s.environment=t.environment),!s.ipAddress&&t.ipAddress&&(s.ipAddress=t.ipAddress),!s.userAgent&&t.userAgent&&(s.userAgent=t.userAgent),typeof t.errors=="number"&&(s.errors=t.errors),t.status&&(s.status=t.status)}function Ci(s,t,r=2){if(!t||typeof t!="object"||r<=0)return t;if(s&&Object.keys(t).length===0)return s;const n={...s};for(const a in t)Object.prototype.hasOwnProperty.call(t,a)&&(n[a]=Ci(n[a],t[a],r-1));return n}function Ba(){return Os()}const qr="_sentrySpan";function Ua(s,t){t?wd(s,qr,t):delete s[qr]}function qa(s){return s[qr]}const Rd=100;class Pt{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._attributes={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext={traceId:Ba(),sampleRand:Math.random()}}clone(){const t=new Pt;return t._breadcrumbs=[...this._breadcrumbs],t._tags={...this._tags},t._attributes={...this._attributes},t._extra={...this._extra},t._contexts={...this._contexts},this._contexts.flags&&(t._contexts.flags={values:[...this._contexts.flags.values]}),t._user=this._user,t._level=this._level,t._session=this._session,t._transactionName=this._transactionName,t._fingerprint=this._fingerprint,t._eventProcessors=[...this._eventProcessors],t._attachments=[...this._attachments],t._sdkProcessingMetadata={...this._sdkProcessingMetadata},t._propagationContext={...this._propagationContext},t._client=this._client,t._lastEventId=this._lastEventId,Ua(t,qa(this)),t}setClient(t){this._client=t}setLastEventId(t){this._lastEventId=t}getClient(){return this._client}lastEventId(){return this._lastEventId}addScopeListener(t){this._scopeListeners.push(t)}addEventProcessor(t){return this._eventProcessors.push(t),this}setUser(t){return this._user=t||{email:void 0,id:void 0,ip_address:void 0,username:void 0},this._session&&Ed(this._session,{user:t}),this._notifyScopeListeners(),this}getUser(){return this._user}setTags(t){return this._tags={...this._tags,...t},this._notifyScopeListeners(),this}setTag(t,r){return this.setTags({[t]:r})}setAttributes(t){return this._attributes={...this._attributes,...t},this._notifyScopeListeners(),this}setAttribute(t,r){return this.setAttributes({[t]:r})}removeAttribute(t){return t in this._attributes&&(delete this._attributes[t],this._notifyScopeListeners()),this}setExtras(t){return this._extra={...this._extra,...t},this._notifyScopeListeners(),this}setExtra(t,r){return this._extra={...this._extra,[t]:r},this._notifyScopeListeners(),this}setFingerprint(t){return this._fingerprint=t,this._notifyScopeListeners(),this}setLevel(t){return this._level=t,this._notifyScopeListeners(),this}setTransactionName(t){return this._transactionName=t,this._notifyScopeListeners(),this}setContext(t,r){return r===null?delete this._contexts[t]:this._contexts[t]=r,this._notifyScopeListeners(),this}setSession(t){return t?this._session=t:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(t){if(!t)return this;const r=typeof t=="function"?t(this):t,n=r instanceof Pt?r.getScopeData():vd(r)?t:void 0,{tags:a,attributes:i,extra:o,user:l,contexts:c,level:d,fingerprint:m=[],propagationContext:x}=n||{};return this._tags={...this._tags,...a},this._attributes={...this._attributes,...i},this._extra={...this._extra,...o},this._contexts={...this._contexts,...c},l&&Object.keys(l).length&&(this._user=l),d&&(this._level=d),m.length&&(this._fingerprint=m),x&&(this._propagationContext=x),this}clear(){return this._breadcrumbs=[],this._tags={},this._attributes={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._session=void 0,Ua(this,void 0),this._attachments=[],this.setPropagationContext({traceId:Ba(),sampleRand:Math.random()}),this._notifyScopeListeners(),this}addBreadcrumb(t,r){var i;const n=typeof r=="number"?r:Rd;if(n<=0)return this;const a={timestamp:Ni(),...t,message:t.message?Nd(t.message,2048):t.message};return this._breadcrumbs.push(a),this._breadcrumbs.length>n&&(this._breadcrumbs=this._breadcrumbs.slice(-n),(i=this._client)==null||i.recordDroppedEvent("buffer_overflow","log_item")),this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(t){return this._attachments.push(t),this}clearAttachments(){return this._attachments=[],this}getScopeData(){return{breadcrumbs:this._breadcrumbs,attachments:this._attachments,contexts:this._contexts,tags:this._tags,attributes:this._attributes,extra:this._extra,user:this._user,level:this._level,fingerprint:this._fingerprint||[],eventProcessors:this._eventProcessors,propagationContext:this._propagationContext,sdkProcessingMetadata:this._sdkProcessingMetadata,transactionName:this._transactionName,span:qa(this)}}setSDKProcessingMetadata(t){return this._sdkProcessingMetadata=Ci(this._sdkProcessingMetadata,t,2),this}setPropagationContext(t){return this._propagationContext=t,this}getPropagationContext(){return this._propagationContext}captureException(t,r){const n=(r==null?void 0:r.event_id)||Os();if(!this._client)return os&&Xs.warn("No client configured on scope - will not capture exception!"),n;const a=new Error("Sentry syntheticException");return this._client.captureException(t,{originalException:t,syntheticException:a,...r,event_id:n},this),n}captureMessage(t,r,n){const a=(n==null?void 0:n.event_id)||Os();if(!this._client)return os&&Xs.warn("No client configured on scope - will not capture message!"),a;const i=(n==null?void 0:n.syntheticException)??new Error(t);return this._client.captureMessage(t,r,{originalException:t,syntheticException:i,...n,event_id:a},this),a}captureEvent(t,r){const n=(r==null?void 0:r.event_id)||Os();return this._client?(this._client.captureEvent(t,{...r,event_id:n},this),n):(os&&Xs.warn("No client configured on scope - will not capture event!"),n)}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach(t=>{t(this)}),this._notifyingListeners=!1)}}function $d(){return da("defaultCurrentScope",()=>new Pt)}function Ad(){return da("defaultIsolationScope",()=>new Pt)}class Md{constructor(t,r){let n;t?n=t:n=new Pt;let a;r?a=r:a=new Pt,this._stack=[{scope:n}],this._isolationScope=a}withScope(t){const r=this._pushScope();let n;try{n=t(r)}catch(a){throw this._popScope(),a}return jd(n)?n.then(a=>(this._popScope(),a),a=>{throw this._popScope(),a}):(this._popScope(),n)}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getIsolationScope(){return this._isolationScope}getStackTop(){return this._stack[this._stack.length-1]}_pushScope(){const t=this.getScope().clone();return this._stack.push({client:this.getClient(),scope:t}),t}_popScope(){return this._stack.length<=1?!1:!!this._stack.pop()}}function ms(){const s=la(),t=ca(s);return t.stack=t.stack||new Md($d(),Ad())}function Td(s){return ms().withScope(s)}function Pd(s,t){const r=ms();return r.withScope(()=>(r.getStackTop().scope=s,t(s)))}function Va(s){return ms().withScope(()=>s(ms().getIsolationScope()))}function Od(){return{withIsolationScope:Va,withScope:Td,withSetScope:Pd,withSetIsolationScope:(s,t)=>Va(t),getCurrentScope:()=>ms().getScope(),getIsolationScope:()=>ms().getIsolationScope()}}function Si(s){const t=ca(s);return t.acs?t.acs:Od()}function ki(){const s=la();return Si(s).getCurrentScope()}function Ld(){const s=la();return Si(s).getIsolationScope()}function Id(s){if(s)return Dd(s)?{captureContext:s}:zd(s)?{captureContext:s}:s}function Dd(s){return s instanceof Pt||typeof s=="function"}const Fd=["user","level","extra","contexts","tags","fingerprint","propagationContext"];function zd(s){return Object.keys(s).some(t=>Fd.includes(t))}function Bd(s,t){return ki().captureException(s,Id(t))}function Ud(s,t){const r=typeof t=="string"?t:void 0,n=typeof t!="string"?{captureContext:t}:void 0;return ki().captureMessage(s,r,n)}function _i(s){Ld().setUser(s)}const b={log:(...s)=>{},warn:(...s)=>{},error:(...s)=>{console.error(...s),s[0]instanceof Error?Bd(s[0],{extra:{additionalData:s.slice(1)}}):typeof s[0]=="string"&&Ud(s[0],{level:"error",extra:{additionalData:s.slice(1)}})},info:(...s)=>{},debug:(...s)=>{}},qd={apiKey:"AIzaSyCbAU10zAKrvv9WJtapj1uBTQhKAlZrhXg",authDomain:"baby-footv2.firebaseapp.com",databaseURL:"https://baby-footv2-default-rtdb.firebaseio.com",projectId:"baby-footv2",storageBucket:"baby-footv2.firebasestorage.app",messagingSenderId:"630738367010",appId:"1:630738367010:web:8070effcead46645d7507b",measurementId:"G-PCFZ8HZ8C4"},fr=ic(qd);typeof window<"u"&&oc(fr);const qt=na(fr),Vd="BAJ02eLWbYkPyz_w3S304RHeltRnL-5l7T9to_ruWiLDjJor9rmc7YEZ_xvGj27TCkIwtxDecQ8JopCIVAmrGvw",_=lc(fr);let xa=null;if(typeof window<"u")try{xa=cc(fr)}catch{}const Gd=()=>{{console.warn("Sentry DSN not found. Error monitoring is disabled. Add VITE_SENTRY_DSN to your .env.local to enable Sentry.");return}},Hd=(s,t,r)=>{_i({id:s,username:t,email:r})},_r=()=>{_i(null)},Zd={username:"un",email:"em",avatar:"av",createdAt:"ca",elo1v1:"e1",elo2v2:"e2",eloGlobal:"eg",wins1v1:"w1",losses1v1:"l1",wins2v2:"w2",losses2v2:"l2",winsMixed:"wm",lossesMixed:"lm",winStreak:"ws",thursdayWins:"tw",betWins:"bw",fortune:"f",totalEarned:"te",bettingGains:"bg",role:"r",banned:"b",bannedAt:"ba",bannedBy:"bb",theme:"t",banner:"bn",title:"ti",effect:"ef",lastActive:"la",clubId:"ci",team1:"t1",team2:"t2",matchType:"mt",score1:"s1",score2:"s2",timestamp:"ts",recordedBy:"rb",suspicious:"su",fromBetting:"fb",status:"st",createdBy:"cb",startedAt:"sa",finishedAt:"fa",bets:"b",totalBetsTeam1:"tb1",totalBetsTeam2:"tb2",change:"c",reason:"rs",unlocked:"u",unlockedAt:"ua",progress:"p"};Object.fromEntries(Object.entries(Zd).map(([s,t])=>[t,s]));const Wd={player:0,agent:1,admin:2},Qd={0:"player",1:"agent",2:"admin"},Jd={"1v1":0,"2v2":1,mixed:2},Yd={tueur_gamelle:"tg",roi_jeudi:"rj",millionnaire:"ml",collectionneur:"cl",parieur_fou:"pf"};function xs(s){return Math.floor(s/1e3)}function Kd(s){return s*1e3}function Xd(s){const t=s.toLowerCase();return t.includes("bonus quotidien")||t.includes("daily")?0:t.includes("match")&&!t.includes("pari")?1:t.includes("gain pari")?2:t.includes("perte pari")?3:t.includes("achat")&&t.includes("shop")?4:t.includes("contribution")||t.includes("club")?5:t.includes("badge")?6:t.includes("lootbox")?7:t.includes("challenge")||t.includes("dÃ©fi")?8:t.includes("admin")||t.includes("ajustement")?9:t.includes("taxe")||t.includes("tax")?10:t.includes("booster")?11:t.includes("tournoi")&&t.includes("frais")?12:t.includes("tournoi")&&(t.includes("gain")||t.includes("rÃ©compense"))?13:t.includes("vente")&&t.includes("carte")?14:t.includes("achat")&&t.includes("carte")?15:9}function Ds(s){return s?1:0}function eu(s){return s===1}function tu(s){const t={};return s.username&&(t.un=s.username),s.email&&(t.em=s.email),s.avatar&&(t.av=s.avatar),s.createdAt&&(t.ca=xs(s.createdAt)),s.elo1v1!==void 0?t.e1=s.elo1v1:s.eloRating!==void 0&&(t.e1=s.eloRating),s.elo2v2!==void 0?t.e2=s.elo2v2:s.eloRating!==void 0&&(t.e2=s.eloRating),s.eloGlobal!==void 0?t.eg=s.eloGlobal:s.eloRating!==void 0&&(t.eg=s.eloRating),s.wins1v1!==void 0?t.w1=s.wins1v1:s.wins!==void 0&&(t.w1=s.wins),s.losses1v1!==void 0?t.l1=s.losses1v1:s.losses!==void 0&&(t.l1=s.losses),s.wins2v2!==void 0?t.w2=s.wins2v2:s.wins!==void 0&&(t.w2=s.wins),s.losses2v2!==void 0?t.l2=s.losses2v2:s.losses!==void 0&&(t.l2=s.losses),s.winsMixed!==void 0&&(t.wm=s.winsMixed),s.lossesMixed!==void 0&&(t.lm=s.lossesMixed),s.winStreak!==void 0&&(t.ws=s.winStreak),s.thursdayWins!==void 0&&(t.tw=s.thursdayWins),s.betWins!==void 0&&(t.bw=s.betWins),s.fortune!==void 0&&(t.f=s.fortune),s.totalEarned!==void 0&&(t.te=s.totalEarned),s.bettingGains!==void 0&&(t.bg=s.bettingGains),s.role&&(t.r=Wd[s.role]??0),s.banned!==void 0&&(t.b=Ds(s.banned)),s.cards&&(t.cards=s.cards),s.inventory&&(t.inventory=s.inventory),s.friends&&(t.friends=s.friends),s.settings&&(t.settings=s.settings),s.lastBonusClaim!==void 0&&(t.lastBonusClaim=xs(s.lastBonusClaim)),s.totalDailyBonus!==void 0&&(t.totalDailyBonus=s.totalDailyBonus),s.dailyBonusStreak!==void 0&&(t.dailyBonusStreak=s.dailyBonusStreak),s.hasSeenTutorial!==void 0&&(t.hasSeenTutorial=Ds(s.hasSeenTutorial)),s.clubId&&(t.clubId=s.clubId),t}function Vr(s){const t={};return s.un&&(t.username=s.un),s.em&&(t.email=s.em),s.av&&(t.avatar=s.av),s.ca&&(t.createdAt=Kd(s.ca)),s.e1!==void 0&&(t.elo1v1=s.e1),s.e2!==void 0&&(t.elo2v2=s.e2),s.eg!==void 0&&(t.eloGlobal=s.eg),s.w1!==void 0&&(t.wins1v1=s.w1),s.l1!==void 0&&(t.losses1v1=s.l1),s.w2!==void 0&&(t.wins2v2=s.w2),s.l2!==void 0&&(t.losses2v2=s.l2),s.wm!==void 0&&(t.winsMixed=s.wm),s.lm!==void 0&&(t.lossesMixed=s.lm),s.ws!==void 0&&(t.winStreak=s.ws),s.tw!==void 0&&(t.thursdayWins=s.tw),s.bw!==void 0&&(t.betWins=s.bw),s.f!==void 0&&(t.fortune=s.f),s.te!==void 0&&(t.totalEarned=s.te),s.bg!==void 0&&(t.bettingGains=s.bg),s.r!==void 0&&(t.role=Qd[s.r]||"player"),s.b!==void 0&&(t.banned=eu(s.b)),s.cards&&(t.cards=s.cards),s.inventory&&(t.inventory=s.inventory),s.friends&&(t.friends=s.friends),s.settings&&(t.settings=s.settings),t}function Ei(s){return{t1:s.team1,t2:s.team2,mt:Jd[s.matchType]??0,s1:s.score1,s2:s.score2,ts:xs(s.timestamp||Date.now()),rb:s.recordedBy,su:Ds(s.suspicious||!1),fb:Ds(s.fromBetting||!1)}}function su(s){return{ts:xs(s.timestamp||Date.now()),f:s.fortune,c:s.change,rs:Xd(s.reason)}}function ru(s){return{u:Ds(s.unlocked),ua:xs(s.unlockedAt||Date.now()),p:s.progress||0}}const Ri=u.createContext(void 0);function Me(){const s=u.useContext(Ri);if(s===void 0)throw new Error("useAuth must be used within an AuthProvider");return s}function au({children:s}){const[t,r]=u.useState(null),[n,a]=u.useState(null),[i,o]=u.useState(!0),l=async p=>{var f;try{const h=k(_,`users/${p}`),g=await q(h);if(g.exists()){const v=g.val();if(v.banned===!0){await wr(qt),$({title:"ðŸš« Compte banni",description:"Votre compte a Ã©tÃ© banni. Contactez un administrateur.",variant:"destructive"}),r(null),a(null),_r();return}a(v),p&&Hd(p,v.username,((f=qt.currentUser)==null?void 0:f.email)||void 0)}}catch(h){b.error("Error fetching user profile:",h)}};u.useEffect(()=>{const p=dc(qt,f=>{r(f),f?setTimeout(()=>{l(f.uid)},0):(a(null),_r()),o(!1)});return()=>p()},[]);const x={user:t,userProfile:n,loading:i,login:async(p,f)=>{try{const g=(await mc(qt,p,f)).user.uid,v=k(_,`users/${g}`),j=await q(v);return j.exists()&&j.val().banned===!0?(await wr(qt),{error:"ðŸš« Ce compte a Ã©tÃ© banni. Contactez un administrateur pour plus d'informations."}):{error:null}}catch(h){let g="Une erreur est survenue lors de la connexion.";switch(h.code){case"auth/invalid-email":g="Adresse email invalide.";break;case"auth/user-disabled":g="Ce compte a Ã©tÃ© dÃ©sactivÃ©.";break;case"auth/user-not-found":g="Aucun compte trouvÃ© avec cette adresse email.";break;case"auth/wrong-password":g="Mot de passe incorrect.";break;case"auth/invalid-credential":g="Email ou mot de passe incorrect.";break;case"auth/too-many-requests":g="Trop de tentatives. RÃ©essayez plus tard.";break}return{error:g}}},signup:async(p,f,h)=>{try{b.log("ðŸ“ CrÃ©ation du compte pour:",p);const v=(await li(qt,p,f)).user;await uc(v,{displayName:h});const j={username:h,eloRating:1e3,wins:0,losses:0,fortune:100,totalEarned:0,role:"player",banned:!1,hasSeenTutorial:!1,createdAt:new Date().toISOString()},M=Date.now(),P=24*60*60*1e3,C=tu({username:h,eloRating:1e3,wins:0,losses:0,fortune:100,totalEarned:0,role:"player",banned:!1,hasSeenTutorial:!1,createdAt:M,lastBonusClaim:M-P,totalDailyBonus:0,dailyBonusStreak:0,winStreak:0,thursdayWins:0,betWins:0});return await $e(k(_,`users/${v.uid}`),C),a(j),b.log("âœ… Profil crÃ©Ã© avec succÃ¨s pour:",v.uid),{error:null,userId:v.uid}}catch(g){b.error("âŒ Erreur inscription:",g);let v="Une erreur est survenue lors de l'inscription.";switch(g.code){case"auth/email-already-in-use":v="Cette adresse email est dÃ©jÃ  utilisÃ©e.";break;case"auth/invalid-email":v="Adresse email invalide.";break;case"auth/operation-not-allowed":v="L'inscription par email n'est pas activÃ©e.";break;case"auth/weak-password":v="Le mot de passe doit contenir au moins 6 caractÃ¨res.";break}return{error:v}}},logout:async()=>{try{await wr(qt),a(null),_r()}catch(p){b.error("Error signing out:",p)}}};return e.jsx(Ri.Provider,{value:x,children:s})}const nu=u.createContext(void 0),Ga={theme_purple:{primary:"270 100% 50%",secondary:"280 100% 50%",background:"270 20% 5%"},theme_green:{primary:"142 76% 36%",secondary:"142 76% 46%",background:"142 20% 5%"},theme_gold:{primary:"38 92% 50%",secondary:"45 93% 58%",background:"38 20% 5%"}};function iu({children:s}){const{user:t}=Me(),[r,n]=u.useState(""),[a,i]=u.useState(""),[o,l]=u.useState("");u.useEffect(()=>{if(!t)return;(async()=>{try{const m=k(_,`users/${t.uid}`),x=await q(m);if(x.exists()){const p=x.val(),f=p.equippedTheme||"",h=p.equippedBanner||"",g=p.equippedEffect||"";n(f),i(h),l(g),f&&Ga[f]&&c(f)}}catch(m){b.error("Erreur chargement items Ã©quipÃ©s:",m)}})()},[t]);const c=d=>{const m=Ga[d];m&&(document.documentElement.style.setProperty("--primary",m.primary),document.documentElement.style.setProperty("--secondary",m.secondary),document.documentElement.style.setProperty("--background",m.background),n(d))};return e.jsx(nu.Provider,{value:{currentTheme:r,currentBanner:a,currentEffect:o,applyTheme:c},children:s})}function Ke({children:s}){const{user:t,loading:r}=Me(),n=qs();return r?e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-background",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(ue,{className:"h-10 w-10 animate-spin text-primary"}),e.jsx("p",{className:"text-muted-foreground",children:"Chargement..."})]})}):t?e.jsx(e.Fragment,{children:s}):e.jsx(tc,{to:"/auth",state:{from:n},replace:!0})}const ha=hr("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-semibold transition-all duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-[0_0_20px_hsla(180,100%,50%,0.4)]",destructive:"bg-secondary text-secondary-foreground hover:bg-secondary/90 shadow-[0_0_20px_hsla(300,100%,50%,0.4)]",outline:"border border-border bg-transparent hover:bg-muted hover:border-primary hover:text-primary",secondary:"bg-muted text-foreground hover:bg-muted/80",ghost:"hover:bg-muted hover:text-foreground",link:"text-primary underline-offset-4 hover:underline",neon:"bg-transparent border-2 border-primary text-primary hover:bg-primary hover:text-primary-foreground shadow-[0_0_10px_hsla(180,100%,50%,0.4),inset_0_0_10px_hsla(180,100%,50%,0.1)]","neon-magenta":"bg-transparent border-2 border-secondary text-secondary hover:bg-secondary hover:text-secondary-foreground shadow-[0_0_10px_hsla(300,100%,50%,0.4),inset_0_0_10px_hsla(300,100%,50%,0.1)]",gaming:"bg-gradient-to-r from-primary/20 to-secondary/20 border border-primary/50 text-foreground hover:border-primary hover:from-primary/30 hover:to-secondary/30"},size:{default:"h-11 px-5 py-2",sm:"h-9 rounded-md px-3 text-xs",lg:"h-12 rounded-lg px-8 text-base",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),T=u.forwardRef(({className:s,variant:t,size:r,asChild:n=!1,...a},i)=>{const o=n?ol:"button";return e.jsx(o,{className:de(ha({variant:t,size:r,className:s})),ref:i,...a})});T.displayName="Button";const U=u.forwardRef(({className:s,...t},r)=>e.jsx("div",{ref:r,className:de("rounded-xl border border-border bg-card text-card-foreground shadow-lg backdrop-blur-sm transition-all duration-300 hover:border-primary/30",s),...t}));U.displayName="Card";const he=u.forwardRef(({className:s,...t},r)=>e.jsx("div",{ref:r,className:de("flex flex-col space-y-1.5 p-6",s),...t}));he.displayName="CardHeader";const fe=u.forwardRef(({className:s,...t},r)=>e.jsx("h3",{ref:r,className:de("text-xl font-semibold leading-none tracking-tight",s),...t}));fe.displayName="CardTitle";const fa=u.forwardRef(({className:s,...t},r)=>e.jsx("p",{ref:r,className:de("text-sm text-muted-foreground",s),...t}));fa.displayName="CardDescription";const H=u.forwardRef(({className:s,...t},r)=>e.jsx("div",{ref:r,className:de("p-6 pt-0",s),...t}));H.displayName="CardContent";const ou=u.forwardRef(({className:s,...t},r)=>e.jsx("div",{ref:r,className:de("flex items-center p-6 pt-0",s),...t}));ou.displayName="CardFooter";class lu extends u.Component{constructor(r){super(r);vr(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});vr(this,"handleGoHome",()=>{window.location.href="/"});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(r){return{hasError:!0,error:r,errorInfo:null}}componentDidCatch(r,n){b.error("ErrorBoundary caught an error:",r,n),this.setState({error:r,errorInfo:n})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-background p-4",children:e.jsxs(U,{className:"max-w-md w-full",children:[e.jsx(he,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"rounded-full bg-destructive/20 p-2",children:e.jsx(ls,{className:"h-6 w-6 text-destructive"})}),e.jsx(fe,{className:"text-xl",children:"Une erreur est survenue"})]})}),e.jsxs(H,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"DÃ©solÃ©, une erreur inattendue s'est produite. Veuillez rÃ©essayer."}),!1,e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(T,{onClick:this.handleReset,variant:"outline",className:"flex-1",children:[e.jsx(Al,{className:"h-4 w-4 mr-2"}),"RÃ©essayer"]}),e.jsxs(T,{onClick:this.handleGoHome,className:"flex-1",children:[e.jsx(ra,{className:"h-4 w-4 mr-2"}),"Accueil"]})]})]})]})}):this.props.children}}const cu=hr("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function le({className:s,variant:t,...r}){return e.jsx("div",{className:de(cu({variant:t}),s),...r})}const du=cl,uu=dl,$i=u.forwardRef(({className:s,align:t="center",sideOffset:r=4,...n},a)=>e.jsx(ll,{children:e.jsx(Cn,{ref:a,align:t,sideOffset:r,className:de("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...n})}));$i.displayName=Cn.displayName;const Ai=u.forwardRef(({className:s,children:t,...r},n)=>e.jsxs(Sn,{ref:n,className:de("relative overflow-hidden",s),...r,children:[e.jsx(ul,{className:"h-full w-full rounded-[inherit]",children:t}),e.jsx(Mi,{}),e.jsx(ml,{})]}));Ai.displayName=Sn.displayName;const Mi=u.forwardRef(({className:s,orientation:t="vertical",...r},n)=>e.jsx(kn,{ref:n,orientation:t,className:de("flex touch-none select-none transition-colors",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",t==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...r,children:e.jsx(xl,{className:"relative flex-1 rounded-full bg-border"})}));Mi.displayName=kn.displayName;const Ti=()=>{const{user:s}=Me(),[t,r]=u.useState([]),[n,a]=u.useState(!1),i=u.useRef(0);u.useEffect(()=>{"Notification"in window&&Notification.permission==="default"&&Notification.requestPermission()},[]);const o=(h=200)=>{"vibrate"in navigator&&navigator.vibrate(h)},l=h=>{if("Notification"in window&&Notification.permission==="granted"){const g=new window.Notification(h.title,{body:h.message,icon:"/favicon.ico",badge:"/favicon.ico",tag:h.id,requireInteraction:!1,silent:!1});o([100,50,100]),setTimeout(()=>g.close(),5e3),g.onclick=()=>{window.focus(),g.close(),h.relatedId&&b.log("Navigation vers:",h.relatedId)}}};u.useEffect(()=>{if(!s)return;const h=k(_,`notifications/${s.uid}`);return et(h,g=>{if(g.exists()){const v=g.val(),j=Object.entries(v).map(([C,I])=>!I||typeof I!="object"?null:{id:C,...I}).filter(C=>C!==null);j.sort((C,I)=>I.createdAt-C.createdAt);const M=j.filter(C=>!C.read).length;if(M>i.current){const C=j.filter(I=>!I.read).sort((I,O)=>O.createdAt-I.createdAt)[0];C&&Date.now()-C.createdAt<1e4&&l(C)}i.current=M,r(j)}else r([]),i.current=0}),()=>{ia(h)}},[s]);const c=t.filter(h=>!h.read).length,d=async h=>{if(s)try{await ce(k(_),{[`notifications/${s.uid}/${h}/read`]:!0})}catch(g){b.error("Erreur marquage notification:",g)}},m=async()=>{if(s)try{const h={};t.forEach(g=>{g.read||(h[`notifications/${s.uid}/${g.id}/read`]=!0)}),Object.keys(h).length>0&&await ce(k(_),h)}catch(h){b.error("Erreur marquage toutes notifications:",h)}},x=async h=>{if(s)try{await ce(k(_),{[`notifications/${s.uid}/${h}`]:null})}catch(g){b.error("Erreur suppression notification:",g)}},p=h=>{switch(h){case"offer_received":case"offer_countered":return e.jsx(Is,{className:"h-4 w-4 text-blue-500"});case"offer_accepted":return e.jsx(nt,{className:"h-4 w-4 text-green-500"});case"offer_rejected":return e.jsx(Ze,{className:"h-4 w-4 text-red-500"});case"listing_sold":return e.jsx(Zt,{className:"h-4 w-4 text-yellow-500"});default:return e.jsx(As,{className:"h-4 w-4"})}},f=h=>{const g=Math.floor((Date.now()-h)/1e3);if(g<60)return"Ã€ l'instant";const v=Math.floor(g/60);if(v<60)return`Il y a ${v}min`;const j=Math.floor(v/60);return j<24?`Il y a ${j}h`:`Il y a ${Math.floor(j/24)}j`};return s?e.jsxs(du,{open:n,onOpenChange:a,children:[e.jsx(uu,{asChild:!0,children:e.jsxs(T,{variant:"outline",size:"icon",className:"relative",children:[e.jsx(As,{className:"h-4 w-4"}),e.jsx(rt,{children:c>0&&e.jsx(W.div,{initial:{scale:0},animate:{scale:1},exit:{scale:0},className:"absolute -top-1 -right-1",children:e.jsx(le,{className:"h-5 w-5 p-0 flex items-center justify-center bg-red-500 text-white text-xs",children:c>9?"9+":c})})})]})}),e.jsxs($i,{className:"w-80 p-0",align:"end",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsx("h3",{className:"font-semibold",children:"Notifications"}),c>0&&e.jsx(T,{variant:"ghost",size:"sm",onClick:m,className:"text-xs",children:"Tout marquer comme lu"})]}),e.jsx(Ai,{className:"h-96",children:t.length===0?e.jsxs("div",{className:"p-8 text-center text-muted-foreground text-sm",children:[e.jsx(As,{className:"h-12 w-12 mx-auto mb-2 opacity-20"}),e.jsx("p",{children:"Aucune notification"})]}):e.jsx("div",{className:"divide-y",children:t.map(h=>!h||!h.type?null:e.jsx(W.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:`p-4 hover:bg-muted/50 transition-colors cursor-pointer ${h.read?"":"bg-blue-500/5"}`,onClick:()=>{h.read||d(h.id)},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-1",children:p(h.type)}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("p",{className:"text-sm font-medium leading-tight",children:h.title}),!h.read&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500 flex-shrink-0 mt-1"})]}),e.jsx("p",{className:"text-xs text-muted-foreground leading-tight",children:h.message}),e.jsxs("div",{className:"flex items-center justify-between pt-1",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:f(h.createdAt)}),e.jsx(T,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:g=>{g.stopPropagation(),x(h.id)},children:e.jsx(Ze,{className:"h-3 w-3"})})]})]})]})},h.id))})})]})]}):null};function Pi(){return"serviceWorker"in navigator&&"Notification"in window&&(window.location.protocol==="https:"||window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")}async function Ha(s){if(!Pi())return null;try{const t=await Notification.requestPermission();if(b.log("ðŸ“± [FCM] RÃ©sultat permission:",t),t!=="granted")return b.log("âŒ [FCM] Permission refusÃ©e par l'utilisateur"),null;b.log("ðŸ”‘ [FCM] Tentative d'obtention du token...");const r=await hc(xa,{vapidKey:Vd});return b.log("ðŸ”‘ [FCM] Token obtenu:",r?"OUI âœ…":"NON âŒ"),r?(b.log("âœ… [FCM] Token FCM complet:",r),b.log("ðŸ’¾ [FCM] Sauvegarde du token dans Firebase Database..."),await ce(k(_,`users/${s}`),{fcmToken:r,fcmTokenUpdatedAt:Date.now()}),b.log("âœ… [FCM] Token sauvegardÃ© avec succÃ¨s dans Firebase !"),b.log("ðŸ“ [FCM] Chemin: users/"+s+"/fcmToken"),r):(b.log("âŒ [FCM] Impossible d'obtenir le token (messaging non initialisÃ© ?)"),null)}catch(t){return b.error("âŒ [FCM] Erreur lors de l'obtention du token:",t),t instanceof Error&&(b.error("âŒ [FCM] Message d'erreur:",t.message),b.error("âŒ [FCM] Stack:",t.stack)),null}}function mu(s){if(Pi())try{xc(xa,t=>{b.log("ðŸ“© [FCM] Message reÃ§u en premier plan:",t),s(t),"vibrate"in navigator&&(navigator.vibrate([100,50,100]),b.log("ðŸ“³ [FCM] Vibration dÃ©clenchÃ©e"))}),b.log("âœ… [FCM] Listeners configurÃ©s avec succÃ¨s")}catch(t){b.error("âŒ [FCM] Erreur lors de la configuration des listeners:",t)}}const xu=()=>{const{user:s}=Me(),t=u.useRef(!1),r=u.useRef(!1);u.useEffect(()=>!s||t.current?void 0:(t.current=!0,b.log("ðŸ”” [useNotifications] Initialisation pour:",s.uid),(async()=>{const a=Notification.permission;a==="granted"?await Ha(s.uid):a==="default"&&await Ha(s.uid)&&$({title:"âœ… Notifications activÃ©es",description:"Vous recevrez les notifications mÃªme quand l'app est fermÃ©e",duration:4e3})})(),r.current||(r.current=!0,mu(a=>{var i,o,l;b.log("ðŸ“¬ [useNotifications] Message reÃ§u:",(i=a.notification)==null?void 0:i.title),$({title:((o=a.notification)==null?void 0:o.title)||"Notification",description:((l=a.notification)==null?void 0:l.body)||"",duration:5e3})})),()=>{t.current=!1}),[s])},hu={initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20}},fu={type:"tween",ease:"anticipate",duration:.3};function Ge({children:s}){return e.jsx(W.div,{initial:"initial",animate:"animate",exit:"exit",variants:hu,transition:fu,className:"w-full",children:s})}const pu=[{id:"daily_play_matches",title:"Joueur actif",description:"Jouer 3 matchs",category:"match",target:3,reward:{fortune:10}},{id:"daily_win_1v1",title:"MaÃ®tre du duel",description:"Gagner 2 matchs en 1v1",category:"win_1v1",target:2,reward:{fortune:15}},{id:"daily_win_2v2",title:"Esprit d'Ã©quipe",description:"Gagner 2 matchs en 2v2",category:"win_2v2",target:2,reward:{fortune:15}},{id:"daily_claim_bonus",title:"Assidu",description:"RÃ©cupÃ©rer le bonus quotidien",category:"progression",target:1,reward:{fortune:5}},{id:"daily_open_pack",title:"Collectionneur",description:"Ouvrir 1 pack de cartes",category:"collection",target:1,reward:{fortune:20}},{id:"daily_chat_message",title:"Social",description:"Envoyer 5 messages dans le chat",category:"social",target:5,reward:{fortune:8}}],gu=[{id:"weekly_win_matches",title:"Champion de la semaine",description:"Gagner 10 matchs",category:"win_any",target:10,reward:{fortune:100,packs:1}},{id:"weekly_elo_gain",title:"Ascension",description:"Gagner 50 points d'ELO",category:"progression",target:50,reward:{fortune:80,badge:"weekly_climber"}},{id:"weekly_tournament",title:"CompÃ©titeur",description:"Participer au tournoi hebdomadaire",category:"match",target:1,reward:{fortune:50}},{id:"weekly_collection",title:"MaÃ®tre collectionneur",description:"Collecter 5 nouvelles cartes",category:"collection",target:5,reward:{fortune:150,packs:2}}];function Gr(){const s=Date.now(),t=new Date;return t.setHours(23,59,59,999),pu.sort(()=>Math.random()-.5).slice(0,4).map(n=>({...n,id:`${n.id}_${s}`,type:"daily",progress:0,completed:!1,expiresAt:t.getTime()}))}function Hr(){const s=Date.now(),t=new Date,r=(8-t.getDay())%7||7;return t.setDate(t.getDate()+r),t.setHours(23,59,59,999),gu.map(n=>({...n,id:`${n.id}_${s}`,type:"weekly",progress:0,completed:!1,expiresAt:t.getTime()}))}async function pr(s){try{const t=k(_,`quests/${s}`),r=await q(t),n=Date.now(),a=new Date().setHours(0,0,0,0),i=yu();let o;return r.exists()?(o=r.val(),o.lastDailyReset<a&&(b.log("ðŸ”„ RÃ©initialisation quÃªtes quotidiennes pour:",s),o.daily=Gr(),o.lastDailyReset=a),o.lastWeeklyReset<i&&(b.log("ðŸ”„ RÃ©initialisation quÃªtes hebdomadaires pour:",s),o.weekly=Hr(),o.lastWeeklyReset=i)):o={daily:Gr(),weekly:Hr(),special:[],lastDailyReset:a,lastWeeklyReset:i},await $e(t,o),o}catch(t){throw b.error("Erreur checkAndResetQuests:",t),t}}async function bu(s,t,r=1){try{const n=await pr(s);let a=!1;if(["daily","weekly","special"].forEach(i=>{n[i].forEach(l=>{l.category===t&&!l.completed&&(l.progress=Math.min(l.progress+r,l.target),l.progress>=l.target&&(l.completed=!0,b.log("âœ… QuÃªte complÃ©tÃ©e:",l.title)),a=!0)})}),a){const i=k(_,`quests/${s}`);await $e(i,n)}}catch(n){b.error("Erreur updateQuestProgress:",n)}}async function Oi(s,t,r){var n,a;try{const i=await pr(s),o=i[t],l=o.findIndex(p=>p.id===r);if(l===-1)return{success:!1,error:"QuÃªte introuvable"};const c=o[l];if(!c.completed)return{success:!1,error:"QuÃªte non complÃ©tÃ©e"};if(c.claimedAt)return{success:!1,error:"RÃ©compense dÃ©jÃ  rÃ©clamÃ©e"};c.claimedAt=Date.now();const d=k(_,`users/${s}`),m=await q(d);if(m.exists()){const p=m.val(),f={};c.reward.fortune&&(f.fortune=(p.fortune||0)+c.reward.fortune,f.totalEarned=(p.totalEarned||0)+c.reward.fortune),c.reward.packs&&(f["inventory/packs/common"]=(((a=(n=p.inventory)==null?void 0:n.packs)==null?void 0:a.common)||0)+c.reward.packs),c.reward.badge&&(f[`badges/${c.reward.badge}`]={unlockedAt:Date.now(),type:"quest"}),await ce(d,f)}const x=k(_,`quests/${s}`);return await $e(x,i),{success:!0,reward:c.reward}}catch(i){return b.error("Erreur claimQuestReward:",i),{success:!1,error:"Erreur serveur"}}}function yu(){const s=new Date,t=s.getDay(),r=s.getDate()-t+(t===0?-6:1),n=new Date(s.setDate(r));return n.setHours(0,0,0,0),n.getTime()}async function Li(s){return pr(s)}const vu=Object.freeze(Object.defineProperty({__proto__:null,checkAndResetQuests:pr,claimQuestReward:Oi,generateDailyQuests:Gr,generateWeeklyQuests:Hr,getUserQuests:Li,updateQuestProgress:bu},Symbol.toStringTag,{value:"Module"})),pa=s=>{const[t,r]=u.useState(null),[n,a]=u.useState(!0),[i,o]=u.useState(!1);u.useEffect(()=>{if(!s){a(!1);return}(async()=>{try{const p=await Li(s);r(p)}catch(p){b.error("Erreur chargement quÃªtes:",p)}finally{a(!1)}})();const m=k(_,`quests/${s}`),x=et(m,p=>{p.exists()&&r(p.val())});return()=>x()},[s]);const l=async(d,m)=>{if(!(!s||i)){o(!0);try{const x=await Oi(s,d,m);x.success&&x.reward?$({title:"ðŸŽ‰ RÃ©compense rÃ©cupÃ©rÃ©e !",description:`${x.reward.fortune?`+${x.reward.fortune} Fortune`:""}${x.reward.packs?` +${x.reward.packs} Pack(s)`:""}${x.reward.badge?" +Badge spÃ©cial":""}`}):$({title:"Erreur",description:x.error||"Impossible de rÃ©cupÃ©rer la rÃ©compense",variant:"destructive"})}catch(x){b.error("Erreur rÃ©cupÃ©ration rÃ©compense:",x),$({title:"Erreur",description:"Une erreur est survenue",variant:"destructive"})}finally{o(!1)}}},c=t?{dailyCompleted:t.daily.filter(d=>d.completed).length,dailyTotal:t.daily.length,weeklyCompleted:t.weekly.filter(d=>d.completed).length,weeklyTotal:t.weekly.length,dailyProgress:Math.round(t.daily.filter(d=>d.completed).length/t.daily.length*100),weeklyProgress:Math.round(t.weekly.filter(d=>d.completed).length/t.weekly.length*100)}:null;return{quests:t,isLoading:n,isClaiming:i,claimReward:l,stats:c}},ju=()=>{const{user:s}=Me(),{quests:t}=pa(s==null?void 0:s.uid);if(!t)return null;const r=[...t.daily.filter(n=>n.completed&&!n.claimedAt),...t.weekly.filter(n=>n.completed&&!n.claimedAt)].length;return r===0?null:e.jsx("div",{className:"absolute -top-1 -right-1 flex h-5 w-5 items-center justify-center rounded-full bg-red-500 text-[10px] font-bold text-white border-2 border-card animate-pulse",children:r>9?"9+":r})},wu=[{to:"/",icon:ra,label:"Accueil",badge:null},{to:"/leaderboard",icon:Te,label:"Classement",badge:null},{to:"/match",icon:Re,label:"Match",badge:null},{to:"/quests",icon:ys,label:"QuÃªtes",badge:ju},{to:"/babydex",icon:Yn,label:"BabyDex",badge:null},{to:"/profile",icon:Us,label:"Profil",badge:null}];function Nu(){return e.jsx("nav",{className:"fixed bottom-0 left-0 right-0 z-50 border-t border-border bg-card/95 backdrop-blur-lg",children:e.jsx("div",{className:"mx-auto max-w-lg overflow-x-auto",children:e.jsx("div",{className:"flex h-16 items-center justify-around px-1",children:wu.map(s=>e.jsx(sc,{to:s.to,className:({isActive:t})=>de("relative flex flex-col items-center justify-center gap-1 px-2 py-1 text-[11px] font-medium transition-colors",t?"text-primary":"text-muted-foreground hover:text-foreground"),children:({isActive:t})=>e.jsxs(e.Fragment,{children:[t&&e.jsx(W.div,{layoutId:"activeTab",className:"absolute inset-0 rounded-lg bg-primary/10",initial:!1,transition:{type:"spring",stiffness:500,damping:30}}),e.jsxs("div",{className:"relative",children:[e.jsx(s.icon,{className:de("h-5 w-5 transition-all",t&&"text-glow-cyan")}),s.badge&&e.jsx(s.badge,{})]}),e.jsx("span",{className:"relative z-10",children:s.label})]})},s.to))})})})}function Cu(){const s=mt();return qs().pathname==="/"?null:e.jsx(T,{variant:"ghost",size:"icon",onClick:()=>s(-1),"aria-label":"Retour Ã  la page prÃ©cÃ©dente",className:"h-9 w-9",children:e.jsx(ur,{className:"h-5 w-5"})})}const De=({children:s})=>{const{logout:t}=Me(),r=mt(),n=async()=>{await t(),r("/auth")};return e.jsxs("div",{className:"min-h-screen bg-background pb-20",children:[e.jsx("header",{className:"sticky top-0 z-50 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:e.jsxs("div",{className:"container flex h-14 items-center justify-between px-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Cu,{}),e.jsx(T,{variant:"ghost",size:"icon",onClick:()=>r("/"),"aria-label":"Retour Ã  l'accueil",children:e.jsx(ra,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-xl font-bold",children:"Baby-Foot App"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ti,{}),e.jsx(T,{variant:"ghost",size:"icon",onClick:()=>r("/profile"),"aria-label":"Voir mon profil",children:e.jsx(Us,{className:"h-5 w-5"})}),e.jsx(T,{variant:"ghost",size:"icon",onClick:n,"aria-label":"Se dÃ©connecter",children:e.jsx(aa,{className:"h-5 w-5"})})]})]})}),e.jsx("main",{className:"container px-4 py-6",children:s}),e.jsx(Nu,{})]})};async function Su(s=10){try{const t=k(_,"matches"),r=await q(t);if(!r.exists())return[];const n=[];return r.forEach(a=>{n.push({id:a.key,...a.val()})}),n.sort((a,i)=>(i.timestamp||0)-(a.timestamp||0)).slice(0,s)}catch(t){return b.error("Erreur chargement matchs:",t),[]}}function Ii(s,t=10){const r=k(_,"matches");return et(r,a=>{const i=[];a.forEach(o=>{i.push({id:o.key,...o.val()})}),s(i.sort((o,l)=>(l.timestamp||0)-(o.timestamp||0)).slice(0,t))})}async function ku(){try{const s=k(_,"matchQueue"),t=await q(s);if(!t.exists())return[];const r=[];return t.forEach(n=>{r.push({id:n.key,...n.val()})}),r}catch(s){return b.error("Erreur chargement queue:",s),[]}}function Di(s){const t=k(_,"matchQueue");return et(t,n=>{const a=[];n.forEach(i=>{a.push({id:i.key,...i.val()})}),s(a)})}async function Fi(){try{const s=await q(k(_,"users")),t=await q(k(_,"matches")),r=[];s.forEach(o=>{r.push(o.val())});const n=r.length,a=r.length>0?Math.round(r.reduce((o,l)=>o+(l.eloRating||1e3),0)/r.length):0,i=t.size;return{totalPlayers:n,averageElo:a,totalMatches:i}}catch(s){return b.error("Erreur chargement stats:",s),{totalPlayers:0,averageElo:0,totalMatches:0}}}function _u(s){let t=null,r=null;const n=async()=>{const a=await Fi();s(a)};return t=et(k(_,"users"),()=>{n()}),r=et(k(_,"matches"),()=>{n()}),()=>{t==null||t(),r==null||r()}}const Eu="modulepreload",Ru=function(s){return"/"+s},Za={},Ot=function(t,r,n){let a=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));a=Promise.allSettled(r.map(c=>{if(c=Ru(c),c in Za)return;Za[c]=!0;const d=c.endsWith(".css"),m=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${m}`))return;const x=document.createElement("link");if(x.rel=d?"stylesheet":Eu,d||(x.as="script"),x.crossOrigin="",x.href=c,l&&x.setAttribute("nonce",l),document.head.appendChild(x),d)return new Promise((p,f)=>{x.addEventListener("load",p),x.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return a.then(o=>{for(const l of o||[])l.status==="rejected"&&i(l.reason);return t().catch(i)})},hs={season1:{N831:{nom:"Lilwenn.png",rarity:"Bronze-NR"},R174:{nom:"Cloe.png",rarity:"Bronze-NR"},J665:{nom:"Romane.png",rarity:"Bronze-R"},D384:{nom:"Maxence.png",rarity:"Bronze-R"},W350:{nom:"Ioana.png",rarity:"Silver-NR"},B298:{nom:"Eli-jah.png",rarity:"Silver-R"},Y912:{nom:"Kathell.png",rarity:"Silver-R"},U934:{nom:"Shana.png",rarity:"Silver-R"},Z473:{nom:"Faustin.png",rarity:"Silver-NR"},M483:{nom:"Abel.png",rarity:"Silver-R"},C407:{nom:"Lola.png",rarity:"Silver-NR"},Q493:{nom:"Lucas.png",rarity:"Silver-NR"},H997:{nom:"Yoris.png",rarity:"Gold-NR"},U532:{nom:"Prune.png",rarity:"Gold-NR"},S849:{nom:"Thais.png",rarity:"Gold-R"},K006:{nom:"Adams.png",rarity:"Gold-R"},F825:{nom:"Ambre.png",rarity:"Gold-R"},T209:{nom:"Marceau.png",rarity:"Espoir"},Q514:{nom:"Mathys.png",rarity:"Espoir"},L276:{nom:"Thimeo.png",rarity:"Icone"},C478:{nom:"Mael.png",rarity:"Icone"},X118:{nom:"Nathael.png",rarity:"Future-star"},A621:{nom:"Enzo.png",rarity:"Hist.Maker"},T294:{nom:"Larry.png",rarity:"God"},Q574:{nom:"Chenaie.png",rarity:"Createur"},U986:{nom:"BouBou.png",rarity:"BouBou"},U956:{nom:"Dracaufeu.png",rarity:"PikaPika"}},season2:{S2N001:{nom:"Player1.png",rarity:"Bronze-NR"},S2N002:{nom:"Player2.png",rarity:"Bronze-NR"},S2R001:{nom:"Player3.png",rarity:"Bronze-R"},S2R002:{nom:"Player4.png",rarity:"Bronze-R"},S2W001:{nom:"Player5.png",rarity:"Silver-NR"},S2B001:{nom:"Player6.png",rarity:"Silver-R"},S2Y001:{nom:"Player7.png",rarity:"Silver-R"},S2U001:{nom:"Player8.png",rarity:"Silver-R"},S2Z001:{nom:"Player9.png",rarity:"Silver-NR"},S2M001:{nom:"Player10.png",rarity:"Silver-R"},S2C001:{nom:"Player11.png",rarity:"Silver-NR"},S2Q001:{nom:"Player12.png",rarity:"Silver-NR"},S2H001:{nom:"Player13.png",rarity:"Gold-NR"},S2U002:{nom:"Player14.png",rarity:"Gold-NR"},S2S001:{nom:"Player15.png",rarity:"Gold-R"},S2K001:{nom:"Player16.png",rarity:"Gold-R"},S2F001:{nom:"Player17.png",rarity:"Gold-R"},S2T001:{nom:"Player18.png",rarity:"Espoir"},S2Q002:{nom:"Player19.png",rarity:"Espoir"},S2L001:{nom:"Player20.png",rarity:"Icone"},S2C002:{nom:"Player21.png",rarity:"Icone"},S2X001:{nom:"Player22.png",rarity:"Future-star"},S2A001:{nom:"Player23.png",rarity:"Hist.Maker"},S2T002:{nom:"Player24.png",rarity:"God"},S2Q003:{nom:"Player25.png",rarity:"Createur"},S2U003:{nom:"Player26.png",rarity:"BouBou"},S2U004:{nom:"Player27.png",rarity:"PikaPika"}}},$u={"Bronze-NR":40,"Bronze-R":25,"Silver-NR":15,"Silver-R":10,"Gold-NR":5,"Gold-R":3,Espoir:2,Icone:1.5,"Future-star":.8,God:1,Createur:.5,PikaPika:.2,BouBou:.1,"Hist.Maker":.1};function Au(s,t=new Set){const r=hs[s];if(!r)return null;const n=Object.entries(r).filter(([c])=>!t.has(c));if(n.length===0)return null;let a=0;const i=n.map(([c,d])=>{const m=$u[d.rarity]||1;return a+=m,{code:c,...d,weight:m}});let o=Math.random()*a;for(const c of i)if(o-=c.weight,o<=0)return{code:c.code,nom:c.nom,rarity:c.rarity,season:s};const l=i[0];return{code:l.code,nom:l.nom,rarity:l.rarity,season:s}}function Mu(s,t){const r=[],n=new Set,a=t*10;let i=0;for(;r.length<t&&i<a;){i++;const o=Au(s,n);if(o&&!n.has(o.code))r.push(o),n.add(o.code);else if(!o){b.error(`âŒ Impossible de tirer une carte aprÃ¨s ${i} tentatives`);break}}return r.length<t&&b.warn(`âš ï¸ Seulement ${r.length}/${t} cartes tirÃ©es`),r}function kt(s){const t=s.trim().toLowerCase();return t.includes("bronze")?"bronze":t.includes("silver")?"silver":t.includes("gold")?"gold":t==="espoir"?"espoir":t==="icone"?"icone":t==="future-star"?"future-star":["god","pikapika","boubou","hist.maker"].includes(t)?"god":t==="createur"?"creator":"unknown"}const zi=["God","Createur","PikaPika","BouBou","Hist.Maker","Future-star","Icone"];function Tu(s){return zi.some(t=>s.toLowerCase()===t.toLowerCase())}function Bi(){return Object.keys(hs).sort()}function ts(s){return{season1:"Saison 1",season2:"Saison 2",season3:"Saison 3"}[s]||s}function Ui(s){for(const[t,r]of Object.entries(hs))if(r[s])return{code:s,nom:r[s].nom,rarity:r[s].rarity,season:t,found:!0};return null}const Vs=Object.freeze(Object.defineProperty({__proto__:null,ULTRA_RARE_RARITIES:zi,codeToCardMap:hs,drawCards:Mu,getAvailableSeasons:Bi,getCardByCode:Ui,getRarityCategory:kt,getSeasonDisplayName:ts,isUltraRare:Tu},Symbol.toStringTag,{value:"Module"}));async function Pu(s){try{const t=k(_,`users/${s}/cards`),r=await q(t);return r.exists()?r.val():{}}catch(t){return b.error("âŒ Erreur chargement quantitÃ©s:",t),{}}}async function Ou(s,t="season1"){try{const n=k(_,`users/${s}`),{drawCards:a,getAvailableSeasons:i,codeToCardMap:o}=await Ot(async()=>{const{drawCards:f,getAvailableSeasons:h,codeToCardMap:g}=await Promise.resolve().then(()=>Vs);return{drawCards:f,getAvailableSeasons:h,codeToCardMap:g}},void 0);let l=[];if(t==="mixed"){const f=i();for(let h=0;h<5;h++){const g=f[Math.floor(Math.random()*f.length)],v=a(g,1);v.length>0&&l.push({...v[0],season:g})}}else{if(!o[t])throw new Error(`Saison "${t}" introuvable`);l=a(t,5).map(h=>({...h,season:t}))}if(l.length===0)throw new Error("Ã‰chec du tirage des cartes");const d=(await q(n)).val()||{},m=d.cards||{};let x=d.totalBabyCards||0;const p={};return l.forEach(f=>{const h=(m[f.code]||0)+1;p[`cards/${f.code}`]=h,x++}),p.totalBabyCards=x,p.lastBoosterOpened=new Date().toISOString(),await ce(n,p),l}catch(n){throw b.error("âŒ Erreur openBoosterPack:",n),n}}async function qi(s){try{const t=await Pu(s);let r=0,n=0,a=0,i=0;const o={},{codeToCardMap:l,isUltraRare:c}=await Ot(async()=>{const{codeToCardMap:d,isUltraRare:m}=await Promise.resolve().then(()=>Vs);return{codeToCardMap:d,isUltraRare:m}},void 0);for(const[d,m]of Object.entries(l)){o[d]=0;for(const[x,p]of Object.entries(t))p>0&&m[x]&&(r+=p,n++,o[d]++,c(m[x].rarity)&&(a+=p,i++))}return{totalCards:r,uniqueCards:n,rareCards:a,ultraRareCards:i,cardsBySeason:o}}catch{return{totalCards:0,uniqueCards:0,rareCards:0,ultraRareCards:0,cardsBySeason:{}}}}const Jt=u.forwardRef(({className:s,value:t,...r},n)=>e.jsx(_n,{ref:n,className:de("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...r,children:e.jsx(hl,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})}));Jt.displayName=_n.displayName;const Lu=()=>{const{user:s}=Me(),{quests:t,stats:r}=pa(s==null?void 0:s.uid);if(!t)return null;const n=t.daily.find(i=>!i.completed),a=((r==null?void 0:r.dailyCompleted)||0)+((r==null?void 0:r.weeklyCompleted)||0);return e.jsx(W.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3},children:e.jsx(Rs,{to:"/quests",children:e.jsxs(U,{className:"group cursor-pointer hover:border-primary/50 transition-all overflow-hidden relative",children:[a>0&&e.jsx("div",{className:"absolute top-0 right-0 w-16 h-16 bg-primary/10 rounded-bl-full"}),e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10 text-primary group-hover:scale-110 transition-transform",children:e.jsx(ys,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h3",{className:"font-semibold text-foreground flex items-center gap-2",children:["QuÃªtes du jour",a>0&&e.jsxs("span",{className:"text-xs bg-primary/20 text-primary px-2 py-0.5 rounded-full font-bold",children:[a," âœ“"]})]}),e.jsx(Kn,{className:"h-4 w-4 text-muted-foreground group-hover:text-primary group-hover:translate-x-1 transition-all"})]}),n?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-muted-foreground mb-2",children:[n.title,": ",n.description]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Jt,{value:n.progress/n.target*100,className:"flex-1 h-1.5"}),e.jsxs("span",{className:"text-xs text-muted-foreground whitespace-nowrap",children:[n.progress,"/",n.target]})]})]}):e.jsxs("div",{className:"flex items-center gap-2 text-sm text-primary",children:[e.jsx(Te,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Toutes les quÃªtes quotidiennes complÃ©tÃ©es !"})]})]})]})})]})})})},Iu=()=>{const{user:s}=Me(),[t,r]=u.useState({totalPlayers:0,averageElo:0,totalMatches:0}),[n,a]=u.useState([]),[i,o]=u.useState([]),[l,c]=u.useState({totalCards:0,uniqueCards:48}),[d,m]=u.useState(!0);u.useEffect(()=>{(async()=>{try{const[M,P,C]=await Promise.all([Fi(),Su(3),ku()]);if(r(M),a(P),o(C),s){const I=await qi(s.uid);c(I)}}catch(M){b.error("Erreur chargement donnÃ©es:",M)}finally{m(!1)}})();const g=_u(r),v=Ii(M=>{a(M.slice(0,3))},3),j=Di(o);return()=>{g(),v(),j()}},[s]);const x=h=>{const v=Date.now()-h,j=Math.floor(v/6e4),M=Math.floor(v/36e5),P=Math.floor(v/864e5);return j<1?"Ã€ l'instant":j<60?`Il y a ${j} min`:M<24?`Il y a ${M}h`:`Il y a ${P}j`},p=()=>{const h=[];return n.forEach(g=>{if(!g.team1Names||!g.team2Names)return;const v=g.score1>g.score2?g.team1Names.join(" & "):g.team2Names.join(" & ");h.push({text:`${v} a gagnÃ© ${g.score1}-${g.score2}`,time:x(g.timestamp),type:"match"})}),s&&l.uniqueCards>0&&h.push({text:`${l.uniqueCards} cartes uniques collectÃ©es`,time:"Collection",type:"card"}),h.slice(0,3)};if(d)return e.jsx(De,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Chargement..."})]})})});const f=p();return e.jsxs(De,{children:[e.jsxs(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mb-8 text-center",children:[e.jsx(W.div,{animate:{rotate:[0,5,-5,0]},transition:{duration:2,repeat:1/0},className:"mb-4 text-6xl",children:"âš½"}),e.jsxs("h1",{className:"mb-2 text-3xl font-bold text-foreground",children:["Baby-Foot ",e.jsx("span",{className:"text-primary text-glow-cyan",children:"App"})]}),e.jsx("p",{className:"text-muted-foreground",children:"CompÃ©tition â€¢ Collection â€¢ CommunautÃ©"})]}),e.jsxs(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"mb-6 grid grid-cols-3 gap-3",children:[e.jsx(U,{className:"text-center",children:e.jsxs(H,{className:"p-4",children:[e.jsx(vt,{className:"mx-auto mb-2 h-6 w-6 text-primary"}),d?e.jsx(ue,{className:"mx-auto mb-2 h-5 w-5 animate-spin"}):e.jsx("p",{className:"text-2xl font-bold text-foreground",children:t.averageElo}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ELO Moyen"})]})}),e.jsx(U,{className:"text-center",children:e.jsxs(H,{className:"p-4",children:[e.jsx(Re,{className:"mx-auto mb-2 h-6 w-6 text-secondary"}),d?e.jsx(ue,{className:"mx-auto mb-2 h-5 w-5 animate-spin"}):e.jsx("p",{className:"text-2xl font-bold text-foreground",children:t.totalPlayers}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Joueurs"})]})}),e.jsx(U,{className:"text-center",children:e.jsxs(H,{className:"p-4",children:[e.jsx(Te,{className:"mx-auto mb-2 h-6 w-6 text-rarity-gold"}),d?e.jsx(ue,{className:"mx-auto mb-2 h-5 w-5 animate-spin"}):e.jsx("p",{className:"text-2xl font-bold text-foreground",children:t.totalMatches}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Matchs"})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(W.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.2},children:e.jsx(Rs,{to:"/match",children:e.jsx(U,{className:"group cursor-pointer overflow-hidden transition-all hover:neon-border-cyan",children:e.jsxs(H,{className:"flex items-center gap-4 p-4",children:[e.jsx("div",{className:"rounded-xl bg-primary/20 p-3 transition-all group-hover:glow-cyan",children:e.jsx(Re,{className:"h-8 w-8 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-foreground",children:"Rejoindre un match"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[i.length," joueur",i.length!==1?"s":""," en attente"]})]}),e.jsx(T,{variant:"neon",size:"sm",children:"Jouer"})]})})})}),e.jsx(Lu,{}),e.jsx(W.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4},children:e.jsx(Rs,{to:"/leaderboard",children:e.jsx(U,{className:"group cursor-pointer overflow-hidden transition-all hover:border-rarity-gold/50",children:e.jsxs(H,{className:"flex items-center gap-4 p-4",children:[e.jsx("div",{className:"rounded-xl bg-rarity-gold/20 p-3",children:e.jsx(Te,{className:"h-8 w-8 text-rarity-gold"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-foreground",children:"Classement"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Voir le top des joueurs"})]}),e.jsx(Ie,{className:"h-5 w-5 text-muted-foreground"})]})})})}),e.jsx(W.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4},children:e.jsx(Rs,{to:"/babydex",children:e.jsx(U,{className:"group cursor-pointer overflow-hidden transition-all hover:neon-border-magenta",children:e.jsxs(H,{className:"flex items-center gap-4 p-4",children:[e.jsx("div",{className:"rounded-xl bg-secondary/20 p-3 transition-all group-hover:glow-magenta",children:e.jsx(Yn,{className:"h-8 w-8 text-secondary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-foreground",children:"BabyDex"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s?`${l.uniqueCards}/${l.uniqueCards} cartes collectÃ©es`:"Collection de cartes"})]}),e.jsx(T,{variant:"neon-magenta",size:"sm",children:"Ouvrir"})]})})})}),e.jsx(W.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.5},children:e.jsx(Rs,{to:"/tournament",children:e.jsx(U,{className:"group cursor-pointer overflow-hidden transition-all hover:border-yellow-500/50 bg-gradient-to-r from-yellow-500/5 to-orange-500/5",children:e.jsxs(H,{className:"flex items-center gap-4 p-4",children:[e.jsx("div",{className:"rounded-xl bg-yellow-500/20 p-3",children:e.jsx(Te,{className:"h-8 w-8 text-yellow-500"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold text-foreground",children:"Tournoi Quotidien"}),e.jsx("span",{className:"px-2 py-0.5 text-xs font-bold bg-yellow-500 text-black rounded-full",children:"NOUVEAU"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"13h00 - 14h15 â€¢ Frais 50â‚£"})]}),e.jsx(T,{variant:"outline",size:"sm",className:"border-yellow-500/50 text-yellow-500 hover:bg-yellow-500/10",children:"S'inscrire"})]})})})})]}),e.jsxs(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"mt-6",children:[e.jsx("h2",{className:"mb-4 text-lg font-semibold text-foreground",children:"ActivitÃ© rÃ©cente"}),e.jsx("div",{className:"space-y-2",children:f.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Aucune activitÃ© rÃ©cente"}):f.map((h,g)=>e.jsxs(W.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.6+g*.1},className:"flex items-center gap-3 rounded-lg bg-surface-alt p-3",children:[e.jsxs("span",{className:"text-lg",children:[h.type==="match"&&"âš½",h.type==="card"&&"ðŸƒ"]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-foreground",children:h.text}),e.jsx("p",{className:"text-xs text-muted-foreground",children:h.time})]})]},g))})]})]})},Ns=fl,Kt=u.forwardRef(({className:s,...t},r)=>e.jsx(En,{ref:r,className:de("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...t}));Kt.displayName=En.displayName;const qe=u.forwardRef(({className:s,...t},r)=>e.jsx(Rn,{ref:r,className:de("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",s),...t}));qe.displayName=Rn.displayName;const Qe=u.forwardRef(({className:s,...t},r)=>e.jsx($n,{ref:r,className:de("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...t}));Qe.displayName=$n.displayName;async function Vi(s,t,r,n,a){try{const i=k(_,"clubs"),o=xt(i),l=o.key,c={id:l,name:r,logo:n,color:a,founderId:s,members:{[s]:{userId:s,username:t,role:"founder",joinedAt:Date.now(),contributions:0}},treasury:0,totalEarnings:0,createdAt:Date.now(),bonuses:{}};return await $e(o,c),await ce(k(_,`users/${s}`),{clubId:l}),b.log(`âœ… Club crÃ©Ã©: ${l} par ${s}`),l}catch(i){throw b.error("Erreur crÃ©ation club:",i),new Error("Impossible de crÃ©er le club.")}}async function Gi(s,t,r){try{const n=k(_,`clubs/${s}`);if(!(await q(n)).exists())throw new Error("Club introuvable.");const i=k(_,`users/${t}`),o=await q(i);if(o.exists()&&o.val().clubId)throw new Error("Vous Ãªtes dÃ©jÃ  membre d'un autre club.");const l={userId:t,username:r,role:"member",joinedAt:Date.now(),contributions:0},c={};c[`clubs/${s}/members/${t}`]=l,c[`users/${t}/clubId`]=s,await ce(k(_),c),b.log(`âœ… ${t} a rejoint le club ${s}`)}catch(n){throw b.error("Erreur rejoindre club:",n),n}}async function Hi(s,t,r){var n,a;try{const i=k(_,`users/${s}`),o=await q(i);if(!o.exists())throw new Error("Utilisateur introuvable");const c=o.val().fortune||0;if(c<r)throw new Error("Fonds insuffisants");const d=k(_,`clubs/${t}`),m=await q(d);if(!m.exists())throw new Error("Club introuvable");const x=m.val();if(!x.members||!x.members[s])throw new Error("Vous devez Ãªtre membre du club pour contribuer");const p=((a=(n=x.members)==null?void 0:n[s])==null?void 0:a.contributions)||0,f=c-r,h={};h[`users/${s}/fortune`]=f,h[`clubs/${t}/treasury`]=(x.treasury||0)+r,h[`clubs/${t}/members/${s}/contributions`]=p+r,await ce(k(_),h),b.log(`âœ… Contribution de ${r}â‚¬ ajoutÃ©e au club ${t} par ${s}`),await Be(s,f,-r,`Contribution club ${t}`)}catch(i){throw b.error("Erreur contribution club:",i),i}}async function Zi(s,t,r){try{const n=k(_,`clubs/${s}`),a=await q(n);if(!a.exists())throw new Error("Club introuvable.");const i=a.val();if((i.treasury||0)<r)throw new Error("TrÃ©sorerie insuffisante pour acheter ce bonus.");if(i.bonuses[t])throw new Error("Ce bonus est dÃ©jÃ  actif.");const o={};o.treasury=(i.treasury||0)-r,o[`bonuses/${t}`]=!0,await ce(n,o),b.log(`âœ… Bonus ${t} achetÃ© pour le club ${s}`)}catch(n){throw b.error("Erreur achat bonus club:",n),n}}async function Wi(s,t){try{const r={};r[`clubs/${s}/members/${t}`]=null,r[`users/${t}/clubId`]=null,await ce(k(_),r),b.log(`âœ… ${t} a quittÃ© le club ${s}`)}catch(r){throw b.error("Erreur quitter club:",r),new Error("Impossible de quitter le club.")}}function Qi(s,t){const r=k(_,`clubs/${s}`);return et(r,a=>{if(a.exists()){const i=a.val();i.members||(i.members={}),t(i)}else t(null)},a=>{b.error("Erreur d'Ã©coute des donnÃ©es du club:",a),t(null)})}async function Be(s,t,r,n){try{const a=k(_,`fortuneHistory/${s}`),i=xt(a),o=su({timestamp:Date.now(),fortune:t,change:r,reason:n});await $e(i,o);const l=await q(a);if(l.exists()){const c=l.val(),d=xs(Date.now()-30*24*60*60*1e3),m={};Object.entries(c).forEach(([x,p])=>{p.ts<d&&(m[`fortuneHistory/${s}/${x}`]=null)}),Object.keys(m).length>0&&await ce(k(_),m)}}catch(a){b.error("Erreur ajout historique:",a)}}async function Ji(s,t=30){try{const r=k(_,`fortuneHistory/${s}`),n=await q(r);if(!n.exists())return[];const a=Object.values(n.val()),i=Date.now()-t*24*60*60*1e3;return a.filter(o=>o.timestamp>=i).sort((o,l)=>o.timestamp-l.timestamp)}catch(r){return b.error("Erreur lors de la rÃ©cupÃ©ration de l'historique de fortune:",r),[]}}async function Yi(s){try{if(!s||s.trim().length<2)return[];const t=k(_,"users"),r=await q(t);if(!r.exists())return[];const n=r.val(),a=s.toLowerCase().trim(),i=[];return Object.keys(n).forEach(o=>{const l=n[o];l.username&&l.username.toLowerCase().includes(a)&&i.push({id:o,username:l.username,role:l.role||"player",eloRating:l.eloRating||l.eloGlobal||1e3,wins:l.wins||0,losses:l.losses||0,fortune:l.fortune||0,totalEarned:l.totalEarned||0,createdAt:l.createdAt||new Date().toISOString(),clubId:l.clubId})}),i.sort((o,l)=>{const c=o.username.toLowerCase().startsWith(a),d=l.username.toLowerCase().startsWith(a);return c&&!d?-1:!c&&d?1:o.username.localeCompare(l.username)}),i.slice(0,20)}catch(t){return b.error("Erreur recherche utilisateurs:",t),[]}}const Du={lootbox_starter:{common:70,rare:25,epic:4,legendary:.9,mythic:.1},lootbox_silver:{common:40,rare:40,epic:15,legendary:4,mythic:1},lootbox_gold:{common:20,rare:35,epic:30,legendary:12,mythic:3},lootbox_diamond:{common:5,rare:20,epic:35,legendary:30,mythic:10},lootbox_mythic:{common:0,rare:10,epic:30,legendary:40,mythic:20}},Fu={common:{min:10,max:50},rare:{min:50,max:150},epic:{min:150,max:300},legendary:{min:300,max:600},mythic:{min:600,max:1200}};function zu(s){const t=Du[s];if(!t)return"common";const r=Math.random()*100;let n=0;for(const[a,i]of Object.entries(t))if(n+=i,r<=n)return a;return"common"}function Bu(s,t){const r=ze.filter(a=>a.rarity===s&&a.type!=="lootbox"&&!t.includes(a.id));if(r.length===0){const a=["mythic","legendary","epic","rare","common"],i=a.indexOf(s);for(let o=i+1;o<a.length;o++){const l=ze.filter(c=>c.rarity===a[o]&&c.type!=="lootbox"&&!t.includes(c.id));if(l.length>0)return{item:l[Math.floor(Math.random()*l.length)],rarity:a[o]}}return null}return{item:r[Math.floor(Math.random()*r.length)],rarity:s}}function Uu(s){const t=ze.find(a=>a.id===s),r=(t==null?void 0:t.rarity)||"common",n=Fu[r];return Math.floor(Math.random()*(n.max-n.min+1))+n.min}function ga(s,t){return s!=null&&s.lootbox&&typeof s.lootbox[t]=="number"?s.lootbox[t]:typeof(s==null?void 0:s[t])=="number"?s[t]:0}async function Ki(s,t){var r;try{const n=k(_,`users/${s}`),a=await q(n);if(!a.exists())throw new Error("Utilisateur non trouvÃ©");const i=a.val(),o=i.inventory||{},l=ga(o,t);if(l<=0)throw new Error("Vous ne possÃ©dez pas cette lootbox");if(!ze.find(v=>v.id===t))throw new Error("Lootbox introuvable");const d=[],m=[];for(let v=0;v<3;v++){const j=zu(t),M=Bu(j,m);if(M){const{item:P,rarity:C}=M;m.push(P.id);const I=!!((r=o[P.type])!=null&&r[P.id]);d.push({itemId:P.id,itemName:P.name,rarity:C,type:P.type,isNew:!I})}}const x=Uu(t),p={},f=l-1;f<=0?(p[`inventory/lootbox/${t}`]=null,o[t]&&(p[`inventory/${t}`]=null)):(p[`inventory/lootbox/${t}`]=f,o[t]&&(p[`inventory/${t}`]=null)),d.forEach(v=>{v.isNew&&(p[`inventory/${v.type}/${v.itemId}`]={obtainedAt:Date.now(),source:"lootbox",lootboxId:t})});const g=(i.fortune||0)+x;return p.fortune=g,await ce(n,p),b.log(`âœ… Lootbox ${t} ouverte par ${s}:`,{rewards:d.map(v=>`${v.itemName} (${v.rarity})`),fortuneBonus:x,newItems:d.filter(v=>v.isNew).length}),x!==0&&await Be(s,g,x,`Bonus lootbox: ${t}`),{rewards:d,fortuneBonus:x}}catch(n){throw b.error("âŒ Erreur lors de l'ouverture de la lootbox:",n),n}}async function Xi(s,t,r){try{const n=k(_,`users/${s}`),a=await q(n);if(!a.exists())throw new Error("Utilisateur non trouvÃ©");const i=a.val(),o=i.fortune||0;if(o<r)throw new Error("Fonds insuffisants");const l=i.inventory||{},c=ga(l,t),d=o-r,m={fortune:d,[`inventory/lootbox/${t}`]:c+1};l[t]&&(m[`inventory/${t}`]=null),await ce(n,m),b.log(`âœ… Lootbox ${t} achetÃ©e par ${s} (total: ${c+1})`),await Be(s,d,-r,`Achat lootbox: ${t}`)}catch(n){throw b.error("âŒ Erreur lors de l'achat de la lootbox:",n),n}}async function gr(s){try{const t=k(_,`userBadges/${s}`),r=await q(t);if(!r.exists())return[];const n=r.val();return Object.keys(n).map(a=>({id:a,...n[a],unlocked:n[a].unlocked||!1,progress:n[a].progress||0}))}catch(t){return b.error("Erreur lors de la rÃ©cupÃ©ration des badges:",t),[]}}const qu=[{id:"tueur_gamelle",name:"Tueur de Gamelles",description:"Gagner 10 matchs d'affilÃ©e",icon:"ðŸ”¥",rarity:"epic",reward:100,check:async s=>{const t=k(_,`users/${s}`),r=await q(t);return r.exists()?(r.val().winStreak||0)>=10:!1}},{id:"roi_jeudi",name:"Roi du Jeudi",description:"Gagner 5 matchs un jeudi",icon:"ðŸ‘‘",rarity:"rare",reward:50,check:async s=>{const t=k(_,`users/${s}`),r=await q(t);return r.exists()?(r.val().thursdayWins||0)>=5:!1}},{id:"millionnaire",name:"Millionnaire",description:"Atteindre 1000â‚¬ de fortune",icon:"ðŸ’°",rarity:"legendary",reward:200,check:async s=>{const t=k(_,`users/${s}`),r=await q(t);return r.exists()?(r.val().fortune||0)>=1e3:!1}},{id:"collectionneur",name:"Collectionneur",description:"PossÃ©der 50 cartes uniques",icon:"ðŸŽ´",rarity:"epic",reward:150,check:async s=>{const t=k(_,`users/${s}`),r=await q(t);if(!r.exists())return!1;const a=r.val().cards||{};return Object.keys(a).filter(o=>a[o]>0).length>=50}},{id:"parieur_fou",name:"Parieur Fou",description:"Gagner 10 paris",icon:"ðŸŽ²",rarity:"rare",reward:75,check:async s=>{const t=k(_,`users/${s}`),r=await q(t);return r.exists()?(r.val().betWins||0)>=10:!1}}];async function eo(s){try{const t=[],n=(await gr(s)).map(a=>a.id);for(const a of qu){if(n.includes(a.id))continue;if(await a.check(s)){b.log(`âœ… [ACHIEVEMENTS] Badge dÃ©bloquÃ©: ${a.name} (${a.reward}â‚¬)`);const o=Yd[a.id]||a.id,l=k(_,`userBadges/${s}/${o}`),c=ru({unlocked:!0,unlockedAt:Date.now(),progress:100});await $e(l,c);const d={id:a.id,name:a.name,icon:a.icon,unlocked:!0,unlockedAt:Date.now(),progress:100};if(a.reward>0){const m=k(_,`users/${s}`),x=await q(m);if(x.exists()){const h=(x.val().fortune||0)+a.reward;await ce(m,{fortune:h}),await Be(s,h,a.reward,`Badge dÃ©bloquÃ©: ${a.name}`),b.log(`ðŸ’° [ACHIEVEMENTS] RÃ©compense ajoutÃ©e: +${a.reward}â‚¬ (nouveau solde: ${h}â‚¬)`)}}t.push(d)}}return t}catch(t){return b.error("Erreur vÃ©rification achievements:",t),[]}}const Vu=[{id:"avatar_default",name:"Avatar Classique",description:"L'avatar par dÃ©faut",type:"avatar",price:0,rarity:"common",icon:"ðŸ˜Š"},{id:"avatar_king",name:"Roi",description:"Avatar royal avec couronne dorÃ©e",type:"avatar",price:150,rarity:"rare",icon:"ðŸ‘‘"},{id:"avatar_ninja",name:"Ninja",description:"Discret et rapide",type:"avatar",price:200,rarity:"rare",icon:"ðŸ¥·"},{id:"avatar_wizard",name:"Magicien",description:"MaÃ®tre des arcanes",type:"avatar",price:250,rarity:"epic",icon:"ðŸ§™"},{id:"avatar_robot",name:"Robot",description:"Technologie avancÃ©e",type:"avatar",price:180,rarity:"rare",icon:"ðŸ¤–"},{id:"avatar_alien",name:"Alien",description:"Venu d'une autre galaxie",type:"avatar",price:300,rarity:"epic",icon:"ðŸ‘½"},{id:"avatar_dragon",name:"Dragon",description:"Puissance lÃ©gendaire",type:"avatar",price:500,rarity:"legendary",icon:"ðŸ‰"},{id:"avatar_phoenix",name:"PhÃ©nix",description:"RenaÃ®t de ses cendres",type:"avatar",price:450,rarity:"legendary",icon:"ðŸ”¥"},{id:"avatar_ghost",name:"FantÃ´me",description:"MystÃ©rieux et insaisissable",type:"avatar",price:220,rarity:"epic",icon:"ðŸ‘»"},{id:"avatar_pirate",name:"Pirate",description:"Chasseur de trÃ©sors",type:"avatar",price:170,rarity:"rare",icon:"ðŸ´â€â˜ ï¸"},{id:"avatar_astronaut",name:"Astronaute",description:"Explorateur spatial",type:"avatar",price:280,rarity:"epic",icon:"ðŸ‘¨â€ðŸš€"},{id:"avatar_vampire",name:"Vampire",description:"Immortel de la nuit",type:"avatar",price:320,rarity:"epic",icon:"ðŸ§›"},{id:"avatar_knight",name:"Chevalier",description:"Gardien du royaume",type:"avatar",price:190,rarity:"rare",icon:"âš”ï¸"},{id:"avatar_samurai",name:"SamouraÃ¯",description:"Guerrier honorable",type:"avatar",price:350,rarity:"epic",icon:"ðŸ—¾"},{id:"avatar_cyborg",name:"Cyborg",description:"Fusion homme-machine",type:"avatar",price:400,rarity:"legendary",icon:"ðŸ¦¾"},{id:"avatar_demon",name:"DÃ©mon",description:"Seigneur des tÃ©nÃ¨bres",type:"avatar",price:550,rarity:"legendary",icon:"ðŸ˜ˆ"},{id:"avatar_angel",name:"Ange",description:"Messager cÃ©leste",type:"avatar",price:500,rarity:"legendary",icon:"ðŸ‘¼"},{id:"avatar_zeus",name:"Zeus",description:"Dieu de l'Olympe",type:"avatar",price:800,rarity:"mythic",icon:"âš¡ðŸ‘‘"},{id:"avatar_reaper",name:"Faucheuse",description:"Gardien des Ã¢mes",type:"avatar",price:600,rarity:"legendary",icon:"ðŸ’€"},{id:"avatar_titan",name:"Titan",description:"Colosse ancestral",type:"avatar",price:900,rarity:"mythic",icon:"â›°ï¸"}],Gu=[{id:"theme_default",name:"ThÃ¨me Par DÃ©faut",description:"Le thÃ¨me classique",type:"theme",price:0,rarity:"common",preview:"#6366f1",icon:"ðŸŽ¨"},{id:"theme_ocean",name:"OcÃ©an Profond",description:"Ambiance sous-marine",type:"theme",price:200,rarity:"rare",preview:"#1e40af",icon:"ðŸŒŠ"},{id:"theme_sunset",name:"Coucher de Soleil",description:"Tons chauds orangÃ©s",type:"theme",price:180,rarity:"rare",preview:"#ea580c",icon:"ðŸŒ…"},{id:"theme_forest",name:"ForÃªt EnchantÃ©e",description:"Vert naturel",type:"theme",price:220,rarity:"epic",preview:"#15803d",icon:"ðŸŒ²"},{id:"theme_neon",name:"NÃ©on Cyberpunk",description:"Style futuriste",type:"theme",price:350,rarity:"epic",preview:"#a855f7",icon:"âš¡"},{id:"theme_gold",name:"Or Royal",description:"Luxe et prestige",type:"theme",price:500,rarity:"legendary",preview:"#d97706",icon:"ðŸ‘‘"},{id:"theme_ice",name:"Glace Arctique",description:"Froid cristallin",type:"theme",price:250,rarity:"epic",preview:"#0ea5e9",icon:"â„ï¸"},{id:"theme_lava",name:"Lave Volcanique",description:"Chaleur intense",type:"theme",price:280,rarity:"epic",preview:"#dc2626",icon:"ðŸŒ‹"},{id:"theme_space",name:"Espace Infini",description:"Cosmos mystÃ©rieux",type:"theme",price:400,rarity:"legendary",preview:"#1e1b4b",icon:"ðŸŒŒ"},{id:"theme_sakura",name:"Sakura",description:"Fleurs de cerisier",type:"theme",price:300,rarity:"epic",preview:"#ec4899",icon:"ðŸŒ¸"},{id:"theme_matrix",name:"Matrix",description:"Code vert",type:"theme",price:450,rarity:"legendary",preview:"#22c55e",icon:"ðŸ’»"},{id:"theme_blood",name:"Sang Noir",description:"TÃ©nÃ¨bres profondes",type:"theme",price:550,rarity:"legendary",preview:"#7f1d1d",icon:"ðŸ©¸"},{id:"theme_rainbow",name:"Arc-en-ciel",description:"Toutes les couleurs",type:"theme",price:600,rarity:"legendary",preview:"#ff00ff",icon:"ðŸŒˆ"},{id:"theme_diamond",name:"Diamant",description:"Luxe absolu",type:"theme",price:800,rarity:"mythic",preview:"#38bdf8",icon:"ðŸ’Ž"},{id:"theme_cosmic",name:"Cosmique",description:"Galaxies infinies",type:"theme",price:1e3,rarity:"mythic",preview:"#4c1d95",icon:"âœ¨"}],Hu=[{id:"banner_default",name:"BanniÃ¨re Simple",description:"BanniÃ¨re de dÃ©part",type:"banner",price:0,rarity:"common",icon:"ðŸ“‹",preview:"linear-gradient(135deg, #1e293b 0%, #334155 100%)"},{id:"banner_stars",name:"Ciel Ã‰toilÃ©",description:"Ã‰toiles scintillantes",type:"banner",price:150,rarity:"rare",icon:"â­",preview:"linear-gradient(135deg, #0f172a 0%, #1e3a8a 50%, #312e81 100%)"},{id:"banner_fire",name:"Flammes",description:"BanniÃ¨re enflammÃ©e",type:"banner",price:200,rarity:"rare",icon:"ðŸ”¥",preview:"linear-gradient(135deg, #7f1d1d 0%, #dc2626 50%, #ea580c 100%)"},{id:"banner_lightning",name:"Ã‰clair",description:"BanniÃ¨re Ã©lectrique",type:"banner",price:250,rarity:"epic",icon:"âš¡",preview:"linear-gradient(135deg, #581c87 0%, #7c3aed 50%, #06b6d4 100%)"},{id:"banner_rainbow",name:"Arc-en-ciel",description:"BanniÃ¨re multicolore",type:"banner",price:180,rarity:"rare",icon:"ðŸŒˆ",preview:"linear-gradient(135deg, #dc2626 0%, #ea580c 20%, #eab308 40%, #22c55e 60%, #3b82f6 80%, #a855f7 100%)"},{id:"banner_galaxy",name:"Galaxie",description:"BanniÃ¨re cosmique",type:"banner",price:400,rarity:"legendary",icon:"ðŸŒŒ",preview:"linear-gradient(135deg, #0c4a6e 0%, #7c3aed 50%, #ec4899 100%)"},{id:"banner_diamond",name:"Diamant",description:"Luxe cristallin",type:"banner",price:500,rarity:"legendary",icon:"ðŸ’Ž",preview:"linear-gradient(135deg, #0c4a6e 0%, #06b6d4 50%, #e0f2fe 100%)"},{id:"banner_sakura",name:"Fleurs de Cerisier",description:"Ã‰lÃ©gance japonaise",type:"banner",price:280,rarity:"epic",icon:"ðŸŒ¸",preview:"linear-gradient(135deg, #9f1239 0%, #ec4899 50%, #fce7f3 100%)"},{id:"banner_dragon",name:"Dragon DorÃ©",description:"Mythique",type:"banner",price:450,rarity:"legendary",icon:"ðŸ²",preview:"linear-gradient(135deg, #78350f 0%, #f59e0b 50%, #fef3c7 100%)"},{id:"banner_ocean",name:"Vagues OcÃ©aniques",description:"Aquatique",type:"banner",price:220,rarity:"epic",icon:"ðŸŒŠ",preview:"linear-gradient(135deg, #0c4a6e 0%, #0891b2 50%, #06b6d4 100%)"},{id:"banner_aurora",name:"Aurore BorÃ©ale",description:"Lumineuse magique",type:"banner",price:350,rarity:"epic",icon:"ðŸŒŒ",preview:"linear-gradient(135deg, #064e3b 0%, #10b981 33%, #06b6d4 66%, #a855f7 100%)"},{id:"banner_blood",name:"Lune Sanglante",description:"Nocturne mystique",type:"banner",price:380,rarity:"epic",icon:"ðŸŒ™",preview:"linear-gradient(135deg, #450a0a 0%, #7f1d1d 50%, #dc2626 100%)"},{id:"banner_gold",name:"Or ImpÃ©rial",description:"Richesse absolue",type:"banner",price:600,rarity:"legendary",icon:"ðŸ†",preview:"linear-gradient(135deg, #713f12 0%, #f59e0b 50%, #fef3c7 100%)"},{id:"banner_phoenix",name:"PhÃ©nix CÃ©leste",description:"Renaissance Ã©ternelle",type:"banner",price:700,rarity:"mythic",icon:"ðŸ”¥ðŸ¦…",preview:"linear-gradient(135deg, #dc2626 0%, #f97316 25%, #facc15 50%, #f97316 75%, #dc2626 100%)"},{id:"banner_infinity",name:"Infini",description:"Au-delÃ  du temps",type:"banner",price:900,rarity:"mythic",icon:"â™¾ï¸",preview:"linear-gradient(135deg, #1e1b4b 0%, #5b21b6 25%, #ec4899 50%, #5b21b6 75%, #1e1b4b 100%)"}],Zu=[{id:"effect_none",name:"Aucun Effet",description:"Pas d'effet visuel",type:"effect",price:0,rarity:"common",icon:"âšª"},{id:"effect_sparkles",name:"Ã‰tincelles",description:"Particules brillantes",type:"effect",price:100,rarity:"common",icon:"âœ¨"},{id:"effect_glow",name:"Aura Lumineuse",description:"Halo colorÃ©",type:"effect",price:150,rarity:"rare",icon:"ðŸ’«"},{id:"effect_fire",name:"Flammes",description:"Feu animÃ©",type:"effect",price:200,rarity:"rare",icon:"ðŸ”¥"},{id:"effect_ice",name:"Cristaux de Glace",description:"Effet de gel",type:"effect",price:220,rarity:"epic",icon:"â„ï¸"},{id:"effect_lightning",name:"Ã‰lectricitÃ©",description:"Ã‰clairs animÃ©s",type:"effect",price:250,rarity:"epic",icon:"âš¡"},{id:"effect_rainbow",name:"Arc-en-ciel",description:"Effet multicolore",type:"effect",price:180,rarity:"rare",icon:"ðŸŒˆ"},{id:"effect_stars",name:"Ã‰toiles Filantes",description:"TraÃ®nÃ©e d'Ã©toiles",type:"effect",price:300,rarity:"epic",icon:"â­"},{id:"effect_portal",name:"Portail",description:"Effet dimensionnel",type:"effect",price:400,rarity:"legendary",icon:"ðŸŒ€"},{id:"effect_crown",name:"Couronne Flottante",description:"Couronne dorÃ©e",type:"effect",price:350,rarity:"legendary",icon:"ðŸ‘‘"},{id:"effect_wings",name:"Ailes d'Ange",description:"Ailes lumineuses",type:"effect",price:500,rarity:"legendary",icon:"ðŸª½"},{id:"effect_shadow",name:"Ombre Vivante",description:"Ombre qui bouge",type:"effect",price:280,rarity:"epic",icon:"ðŸŒ‘"},{id:"effect_sakura",name:"PÃ©tales de Sakura",description:"Fleurs qui tombent",type:"effect",price:320,rarity:"epic",icon:"ðŸŒ¸"},{id:"effect_smoke",name:"FumÃ©e Mystique",description:"Brume magique",type:"effect",price:260,rarity:"epic",icon:"ðŸ’¨"},{id:"effect_galaxy",name:"Tourbillon Galactique",description:"Ã‰toiles qui tournent",type:"effect",price:450,rarity:"legendary",icon:"ðŸŒŒ"},{id:"effect_blood",name:"Aura Sanguine",description:"Rouge pulsant",type:"effect",price:380,rarity:"epic",icon:"ðŸ©¸"},{id:"effect_divine",name:"LumiÃ¨re Divine",description:"Rayons cÃ©lestes",type:"effect",price:600,rarity:"legendary",icon:"â˜€ï¸"},{id:"effect_demon",name:"Flammes DÃ©moniaques",description:"Feu noir",type:"effect",price:550,rarity:"legendary",icon:"ðŸ˜ˆ"},{id:"effect_cosmic",name:"Ã‰nergie Cosmique",description:"Pouvoir ultime",type:"effect",price:800,rarity:"mythic",icon:"ðŸ’¥"},{id:"effect_infinity",name:"Boucle Infinie",description:"Symbole infini",type:"effect",price:1e3,rarity:"mythic",icon:"â™¾ï¸"}],Wu=[{id:"lootbox_starter",name:"Coffre DÃ©butant",description:"Cartes Bronze/Silver/Gold",type:"lootbox",price:100,rarity:"common",icon:"ðŸ“¦"},{id:"lootbox_silver",name:"BoÃ®te ArgentÃ©e",description:"Cartes Silver/Gold/Platinum",type:"lootbox",price:250,rarity:"rare",icon:"ðŸŽ"},{id:"lootbox_gold",name:"Coffre DorÃ©",description:"Cartes Gold/Platinum/Diamond",type:"lootbox",price:500,rarity:"epic",icon:"ðŸ’°"},{id:"lootbox_diamond",name:"Coffre Diamant",description:"Cartes Platinum/Diamond/Black",type:"lootbox",price:1e3,rarity:"legendary",icon:"ðŸ’Ž"},{id:"lootbox_mythic",name:"Coffre Mythique",description:"Cartes lÃ©gendaires garanties",type:"lootbox",price:2e3,rarity:"mythic",icon:"âœ¨"}],Qu=[{id:"title_newbie",name:"Bronze de Parking",description:"Pour ceux qui dÃ©couvrent encore le kick-off.",type:"title",price:0,rarity:"common",icon:"ðŸ¥‰",preview:"Bronze de Parking"},{id:"title_veteran",name:"Tryhard Platine",description:"Toujours en ranked, jamais en freeplay.",type:"title",price:300,rarity:"rare",icon:"ðŸ’¿",preview:"Tryhard Platine"},{id:"title_champion",name:"Champion de Garage",description:"Smurf ou gÃ©nie incompris, on ne sait pas.",type:"title",price:600,rarity:"epic",icon:"ðŸ†",preview:"Champion de Garage"},{id:"title_legend",name:"LÃ©gende du Reset",description:"Flip, musty, breezi... tout y passe.",type:"title",price:900,rarity:"legendary",icon:"âœ¨",preview:"LÃ©gende du Reset"},{id:"title_millionaire",name:"Marchand dâ€™Octanes",description:"RL Garage ouvert 24/7.",type:"title",price:1200,rarity:"legendary",icon:"ðŸš—",preview:"Marchand dâ€™Octanes"},{id:"title_godlike",name:"Insane Freestyler",description:"Clip ou leave, jamais entre les deux.",type:"title",price:2e3,rarity:"mythic",icon:"ðŸŽ¥",preview:"Insane Freestyler"},{id:"title_strategist",name:"Cerveau de la Rot",description:"Toujours dernier, jamais dans le mur.",type:"title",price:700,rarity:"epic",icon:"ðŸ§ ",preview:"Cerveau de la Rot"},{id:"title_gambler",name:"DÃ©mon de la SoloQ",description:"3 mates tiltÃ©s, 0 problÃ¨me.",type:"title",price:500,rarity:"rare",icon:"ðŸ˜ˆ",preview:"DÃ©mon de la SoloQ"},{id:"title_collector",name:"Full White Dealer",description:"Fennec, Octane, Interstellarâ€¦ tout en titanium.",type:"title",price:1600,rarity:"legendary",icon:"âšª",preview:"Full White Dealer"},{id:"title_immortal",name:"Le Goat du Baby",description:"Jamais AFK, jamais tilt, toujours clutch.",type:"title",price:3e3,rarity:"mythic",icon:"ðŸ",preview:"Le GOAT du Baby"}],ze=[...Vu,...Gu,...Hu,...Zu,...Wu,...Qu];async function to(s,t,r,n){var a,i,o;try{const l=k(_,`users/${s}`),c=await q(l);if(!c.exists())throw new Error("Utilisateur introuvable");const d=c.val(),m=d.fortune||0;if(m<n)throw new Error("Fonds insuffisants");if((i=(a=d.inventory)==null?void 0:a[r])!=null&&i[t])throw new Error("Vous possÃ©dez dÃ©jÃ  cet item");const x={},p=m-n;x[`users/${s}/fortune`]=p,x[`users/${s}/inventory/${r}/${t}`]={obtainedAt:Date.now(),source:"shop",price:n},!(((o=d.inventory)==null?void 0:o[r])&&Object.keys(d.inventory[r]).length>0)&&r!=="lootbox"&&(x[`users/${s}/${r}`]=t),await ce(k(_),x);const h=ze.find(g=>g.id===t);await Be(s,p,-n,`Achat boutique: ${(h==null?void 0:h.name)||t}`)}catch(l){throw b.error("Erreur achat article:",l),l}}async function ba(s,t,r){var n,a;try{const i=k(_,`users/${s}`),o=await q(i);if(!o.exists())throw new Error("Utilisateur introuvable");if(!((a=(n=o.val().inventory)==null?void 0:n[r])==null?void 0:a[t]))throw new Error("Vous ne possÃ©dez pas cet item");const d={avatar:"avatar",theme:"theme",banner:"banner",effect:"effect",title:"title",badge:"badge",lootbox:null}[r];if(!d)throw new Error("Ce type d'article n'est pas Ã©quipable.");const m={};m[`users/${s}/${d}`]=t,await ce(k(_),m)}catch(i){throw b.error("Erreur Ã©quiper article:",i),i}}const so=Object.freeze(Object.defineProperty({__proto__:null,SHOP_ITEMS:ze,addFortuneHistoryEntry:Be,buyClubBonus:Zi,buyLootbox:Xi,buyShopItem:to,checkAchievements:eo,contributeToClub:Hi,createClub:Vi,equipItem:ba,getFortuneHistory:Ji,getLootboxCount:ga,getUserBadges:gr,joinClub:Gi,leaveClub:Wi,onClubDataUpdate:Qi,openLootbox:Ki,searchUsers:Yi},Symbol.toStringTag,{value:"Module"}));async function Ju(s){var r,n,a;const t={xpBoost:!1,fortuneBoost:!1,premiumCards:!1};try{const i=k(_,`users/${s}`),o=await q(i);if(!o.exists())return t;const c=o.val().clubId;if(!c)return t;const d=k(_,`clubs/${c}`),m=await q(d);if(!m.exists())return t;const x=m.val();return{xpBoost:((r=x.bonuses)==null?void 0:r.xpBoost)||!1,fortuneBoost:((n=x.bonuses)==null?void 0:n.fortuneBoost)||!1,premiumCards:((a=x.bonuses)==null?void 0:a.premiumCards)||!1}}catch(i){return b.error("Erreur rÃ©cupÃ©ration bonus club:",i),t}}function ro(s,t){const r=s-t,n=Math.round(r*1.2);return t+n}function Yu(s){return Math.round(s*1.15)}const Zr=Ju,Zs=[{name:"Bronze",minElo:0,maxElo:1099,color:"#CD7F32",icon:"ðŸ¥‰"},{name:"Argent",minElo:1100,maxElo:1299,color:"#C0C0C0",icon:"ðŸ¥ˆ"},{name:"Or",minElo:1300,maxElo:1499,color:"#FFD700",icon:"ðŸ¥‡"},{name:"Platine",minElo:1500,maxElo:1699,color:"#E5E4E2",icon:"ðŸ’Ž"},{name:"Diamant",minElo:1700,maxElo:1899,color:"#B9F2FF",icon:"ðŸ’ "},{name:"MaÃ®tre",minElo:1900,maxElo:2099,color:"#9B59B6",icon:"ðŸ‘‘"},{name:"Grand MaÃ®tre",minElo:2100,maxElo:2299,color:"#E74C3C",icon:"âš¡"},{name:"Challenger",minElo:2300,maxElo:9999,color:"#F39C12",icon:"ðŸ”¥"}];function Gs(s){return typeof s!="number"||isNaN(s)||s<0?Zs[0]:Zs.find(r=>s>=r.minElo&&s<=r.maxElo)||Zs[Zs.length-1]}async function Ku(s,t,r,n,a){try{const i=k(_,`matchQueue/${s}`);await $e(i,{id:s,username:t,elo1v1:r,elo2v2:n,eloGlobal:a,joinedAt:Date.now()}),fc(i).remove()}catch(i){throw b.error("Erreur lors de l'ajout Ã  la queue:",i),new Error("Impossible de rejoindre la file d'attente")}}async function Xu(s){try{const t=k(_,`matchQueue/${s}`);await Ms(t)}catch(t){throw b.error("Erreur lors du retrait de la queue:",t),new Error("Impossible de quitter la file d'attente")}}function ao(s,t){return s===1&&t===1?"1v1":s===2&&t===2?"2v2":"mixed"}async function em(s,t,r){try{if(!Array.isArray(s)||!Array.isArray(t))throw new Error("Ã‰quipes invalides");if(s.length===0||t.length===0)throw new Error("Les Ã©quipes doivent contenir au moins un joueur");if(s.length>2||t.length>2)throw new Error("Maximum 2 joueurs par Ã©quipe");if(s.filter(j=>t.includes(j)).length>0)throw new Error("Un joueur ne peut pas Ãªtre dans les deux Ã©quipes");const a=k(_,"users"),i=await q(a);if(!i.exists())throw new Error("Aucun utilisateur trouvÃ©");const o=i.val(),l={};Object.keys(o).forEach(j=>{l[j]=deoptimizeUserData(o[j])});const d=[...s,...t].filter(j=>!l[j]);if(d.length>0)throw new Error(`Joueur(s) introuvable(s): ${d.join(", ")}`);const m=s.map(j=>{var M;return((M=l[j])==null?void 0:M.username)||"Unknown"}),x=t.map(j=>{var M;return((M=l[j])==null?void 0:M.username)||"Unknown"}),p=ao(s.length,t.length),f=k(_,"bettingMatches"),h=xt(f),g=h.key,v={id:g,team1:s,team2:t,team1Names:m,team2Names:x,matchType:p,status:"open",createdAt:Date.now(),createdBy:r,bets:{},totalBetsTeam1:0,totalBetsTeam2:0};return await $e(h,v),g}catch(n){throw b.error("Erreur lors de la crÃ©ation du match:",n),n}}async function tm(s,t,r,n,a){var i,o,l;try{if(!s||!t||!r)throw new Error("ParamÃ¨tres invalides");if(n<=0||n>1e4)throw new Error("Le montant doit Ãªtre entre 1â‚¬ et 10000â‚¬");if(a!==1&&a!==2)throw new Error("Ã‰quipe invalide");const c=k(_,`bettingMatches/${s}`),d=k(_,`users/${t}`);b.log("ðŸ” [PARI] Chargement des donnÃ©es...");const[m,x]=await Promise.all([q(c),q(d)]);if(!m.exists())throw new Error("Match introuvable");if(!x.exists())throw new Error("Utilisateur introuvable");const p=m.val(),f=x.val();if(b.log(`âœ… [PARI] DonnÃ©es chargÃ©es - Match status: ${p.status}, User fortune: ${f.fortune}â‚¬`),p.status!=="open")throw new Error("Les paris sont fermÃ©s pour ce match");if(Array.isArray(p.team1)&&p.team1.includes(t)||Array.isArray(p.team2)&&p.team2.includes(t))throw new Error("Vous ne pouvez pas parier sur un match oÃ¹ vous jouez");if(f.banned===!0)throw new Error("Compte banni");const g=f.fortune||0,v=(i=p.bets)==null?void 0:i[t],j=v?g+v.amount:g;if(b.log(`ðŸ’° [PARI] Fortune avant: ${g}â‚¬, Disponible: ${j}â‚¬`),j<n)throw new Error(`Vous n'avez pas assez d'argent (${j}â‚¬ disponibles)`);if(g<0||g>1e6)throw new Error("Fortune invalide");const M=j-n;let P=p.totalBetsTeam1||0,C=p.totalBetsTeam2||0;v&&(v.teamBet===1?P-=v.amount:C-=v.amount,b.log(`ðŸ”„ [PARI] Ancien pari trouvÃ©: ${v.amount}â‚¬ sur Ã©quipe ${v.teamBet}`)),a===1?P+=n:C+=n,b.log(`ðŸ“Š [PARI] Nouveaux totaux - Ã‰quipe 1: ${P}â‚¬, Ã‰quipe 2: ${C}â‚¬`);const I={};I[`users/${t}/fortune`]=M,I[`bettingMatches/${s}/bets/${t}`]={userId:t,username:r,amount:n,teamBet:a,timestamp:Date.now()},I[`bettingMatches/${s}/totalBetsTeam1`]=P,I[`bettingMatches/${s}/totalBetsTeam2`]=C,b.log("ðŸ’¾ [PARI] Application des mises Ã  jour atomiques..."),await ce(k(_),I),b.log(`âœ… [PARI] Fortune aprÃ¨s dÃ©duction: ${M}â‚¬`);const O=M-g;if(O!==0){const w=`Pari sur match: ${((o=p.team1Names)==null?void 0:o.join(" & "))??"Ã‰quipe 1"} vs ${((l=p.team2Names)==null?void 0:l.join(" & "))??"Ã‰quipe 2"}`;await Be(t,M,O,w),b.log(`ðŸ“ [PARI] Historique ajoutÃ©: ${O}â‚¬`)}b.log("âœ… [PARI] Pari placÃ© avec succÃ¨s!")}catch(c){throw b.error("âŒ [PARI] Erreur:",c),c}}async function sm(s){try{const t=k(_,`bettingMatches/${s}`);b.log("ðŸ” [START MATCH] Chargement des donnÃ©es du match...");const r=await q(t);if(!r.exists())throw new Error("Match introuvable");const n=r.val();if(b.log(`âœ… [START MATCH] Match chargÃ© - Status: ${n.status}`),n.status!=="open")throw new Error("Le match n'est pas en attente de dÃ©marrage");const a={};a[`bettingMatches/${s}/status`]="playing",a[`bettingMatches/${s}/startedAt`]=Date.now(),b.log("ðŸ’¾ [START MATCH] Application de la mise Ã  jour..."),await ce(k(_),a),b.log("âœ… [START MATCH] Match dÃ©marrÃ© avec succÃ¨s!")}catch(t){throw b.error("âŒ [START MATCH] Erreur:",t),t}}function rm(s){return s<1300?40:s<1700?32:s<2100?24:16}function no(s,t,r){(typeof s!="number"||isNaN(s)||s<0)&&(s=1e3),(typeof t!="number"||isNaN(t)||t<0)&&(t=1e3);const n=rm(s),a=1/(1+Math.pow(10,(t-s)/400)),o=Math.round(n*((r?1:0)-a)),l=s+o;return Math.max(0,l)}async function am(s,t,r){var n,a,i,o,l,c;try{if(typeof t!="number"||typeof r!="number")throw new Error("Scores invalides");if(!Number.isInteger(t)||!Number.isInteger(r))throw new Error("Les scores doivent Ãªtre des nombres entiers");if(t<0||r<0||t>100||r>100)throw new Error("Les scores doivent Ãªtre entre 0 et 100");if(t===r)throw new Error("Le score ne peut pas Ãªtre Ã©gal");const d=k(_,`bettingMatches/${s}`),m=await q(d);if(!m.exists())throw new Error("Match introuvable");const x=m.val();if(x.status==="finished")throw new Error("Ce match est dÃ©jÃ  terminÃ©");b.log(`ðŸ“Š [FIN MATCH] Total paris - Ã‰quipe 1: ${x.totalBetsTeam1}â‚¬, Ã‰quipe 2: ${x.totalBetsTeam2}â‚¬`),b.log(`ðŸ“Š [FIN MATCH] Nombre de parieurs: ${Object.keys(x.bets||{}).length}`);const p=await io(x.team1,x.team2,t,r),f=k(_,"users");if(!(await q(f)).exists())throw new Error("Aucun utilisateur trouvÃ©");const g=x.matchType,v=[...x.team1,...x.team2],j=await co(v),M=v.filter(R=>!j[R]);if(M.length>0)throw new Error(`Joueur(s) introuvable(s): ${M.join(", ")}`);const P=j,C=R=>{const Z=P[R];if(!Z)return 1e3;switch(g){case"1v1":return Z.elo1v1||1e3;case"2v2":return Z.elo2v2||1e3;case"mixed":return Z.eloGlobal||1e3}},I=x.team1.map(R=>{const Z=P[R];if(!Z)throw new Error(`Joueur ${R} introuvable`);return{id:R,username:Z.username||"Unknown",eloRating:C(R),wins:Z[`wins${g==="1v1"?"1v1":g==="2v2"?"2v2":"Mixed"}`]||0,losses:Z[`losses${g==="1v1"?"1v1":g==="2v2"?"2v2":"Mixed"}`]||0}}),O=x.team2.map(R=>{const Z=P[R];if(!Z)throw new Error(`Joueur ${R} introuvable`);return{id:R,username:Z.username||"Unknown",eloRating:C(R),wins:Z[`wins${g==="1v1"?"1v1":g==="2v2"?"2v2":"Mixed"}`]||0,losses:Z[`losses${g==="1v1"?"1v1":g==="2v2"?"2v2":"Mixed"}`]||0}}),w=I.reduce((R,Z)=>R+Z.eloRating,0)/I.length,E=O.reduce((R,Z)=>R+Z.eloRating,0)/O.length,V=t>r,A=[],B={},S=async(R,Z,se)=>{if(p)return;let N=no(R.eloRating,Z,se);const D=N-R.eloRating;(await Zr(R.id)).xpBoost&&se&&(N=ro(N,R.eloRating),b.log(`ðŸŽ¯ [Bonus Club] ${R.username}: ELO ${R.eloRating} â†’ ${N} (avec bonus +20%)`));const y=N-R.eloRating,G=g==="1v1"?"elo1v1":g==="2v2"?"elo2v2":"eloGlobal";B[`users/${R.id}/${G}`]=N;const Y=P[R.id];if(!Y)throw new Error(`Utilisateur ${R.id} introuvable`);const ae=g==="1v1"?N:Y.elo1v1||1e3,Ce=g==="2v2"?N:Y.elo2v2||1e3,Ee=g==="mixed"?N:Y.eloGlobal||1e3,Ue=[];(g==="1v1"||Y.elo1v1!==void 0)&&Ue.push(ae),(g==="2v2"||Y.elo2v2!==void 0)&&Ue.push(Ce),(g==="mixed"||Y.eloGlobal!==void 0)&&Ue.push(Ee);const tt=Ue.length>0?Math.round(Ue.reduce((We,es)=>We+es,0)/Ue.length):1e3;B[`users/${R.id}/eloGlobal`]=tt;const st=`wins${g==="1v1"?"1v1":g==="2v2"?"2v2":"Mixed"}`,Xe=`losses${g==="1v1"?"1v1":g==="2v2"?"2v2":"Mixed"}`;B[`users/${R.id}/${st}`]=se?R.wins+1:R.wins,B[`users/${R.id}/${Xe}`]=se?R.losses:R.losses+1;const wt=Y.winStreak||0;se?B[`users/${R.id}/winStreak`]=wt+1:B[`users/${R.id}/winStreak`]=0;const ht=new Date().getDay()===4;if(se&&ht){const We=Y.thursdayWins||0;B[`users/${R.id}/thursdayWins`]=We+1}const Cs=Gs(N);A.push({userId:R.id,username:R.username,oldElo:R.eloRating,newElo:N,eloChange:y,matchType:g,rank:Cs})};await Promise.all([...I.map(R=>S(R,E,V)),...O.map(R=>S(R,w,!V))]);const J=V?1:2,me=x.totalBetsTeam1+x.totalBetsTeam2,re=J===1?x.totalBetsTeam1:x.totalBetsTeam2,Se=J===1?x.totalBetsTeam2:x.totalBetsTeam1,ve={},je=[];if(b.log(`ðŸ† [FIN MATCH] Ã‰quipe gagnante: ${J}`),b.log(`ðŸ’° [FIN MATCH] Pot gagnant: ${re}â‚¬, Pot perdant: ${Se}â‚¬, Total: ${me}â‚¬`),x.bets&&Object.keys(x.bets).length>0)for(const[R,Z]of Object.entries(x.bets))if(b.log(`ðŸ‘¤ [FIN MATCH] Traitement pari de ${Z.username}: ${Z.amount}â‚¬ sur Ã©quipe ${Z.teamBet}`),Z.teamBet===J)if(re>0){const se=me/re,N=Math.max(se,1.1),D=Math.round(Z.amount*N);ve[R]=D;const Q=D-Z.amount;b.log(`âœ… [FIN MATCH] ${Z.username} GAGNE ${D}â‚¬ (mise: ${Z.amount}â‚¬, profit: ${Q}â‚¬, cote: ${N.toFixed(2)}x)`);const y=k(_,`users/${R}`),G=await q(y);if(G.exists()){const Y=G.val(),ae=Y.fortune||0,Ce=Y.bettingGains||0,Ee=await Zr(R);let Ue=D;Ee.fortuneBoost&&(Ue=Yu(D),b.log(`ðŸ’° [Bonus Club] ${Z.username}: Gain ${D}â‚¬ â†’ ${Ue}â‚¬ (avec bonus +15%)`));const tt=ae+Ue,st=Ue-Z.amount;B[`users/${R}/fortune`]=tt,B[`users/${R}/bettingGains`]=Ce+st,B[`users/${R}/totalEarned`]=(Y.totalEarned||0)+st;const Xe=Y.betWins||0;B[`users/${R}/betWins`]=Xe+1,je.push(Be(R,tt,Ue,`Gain pari: ${((n=x.team1Names)==null?void 0:n.join(" & "))??"Ã‰quipe 1"} vs ${((a=x.team2Names)==null?void 0:a.join(" & "))??"Ã‰quipe 2"}`))}}else{ve[R]=Z.amount,b.log(`ðŸ”„ [FIN MATCH] ${Z.username} REMBOURSÃ‰ ${Z.amount}â‚¬ (aucun pari sur Ã©quipe gagnante)`);const se=k(_,`users/${R}`),N=await q(se);if(N.exists()){const y=(N.val().fortune||0)+Z.amount;B[`users/${R}/fortune`]=y,je.push(Be(R,y,Z.amount,`Remboursement pari: ${((i=x.team1Names)==null?void 0:i.join(" & "))??"Ã‰quipe 1"} vs ${((o=x.team2Names)==null?void 0:o.join(" & "))??"Ã‰quipe 2"}`))}}else{ve[R]=-Z.amount,b.log(`âŒ [FIN MATCH] ${Z.username} PERD ${Z.amount}â‚¬`);const se=k(_,`users/${R}`),N=await q(se);if(N.exists()){const D=N.val(),Q=D.fortune||0,y=D.bettingGains||0;B[`users/${R}/bettingGains`]=y-Z.amount,je.push(Be(R,Q,0,`Perte pari: ${((l=x.team1Names)==null?void 0:l.join(" & "))??"Ã‰quipe 1"} vs ${((c=x.team2Names)==null?void 0:c.join(" & "))??"Ã‰quipe 2"} (-${Z.amount}â‚¬)`))}}b.log("ðŸ“Š [FIN MATCH] RÃ©sumÃ© des gains:",ve);const K=k(_,"matches"),ee=xt(K),z=Ei({team1:x.team1,team2:x.team2,matchType:g,score1:t,score2:r,timestamp:Date.now(),recordedBy:x.createdBy,fromBetting:!0,suspicious:p});B[`matches/${ee.key}`]=z,B[`bettingMatches/${s}/status`]="finished",B[`bettingMatches/${s}/score1`]=t,B[`bettingMatches/${s}/score2`]=r,B[`bettingMatches/${s}/finishedAt`]=Date.now(),await ce(k(_),B),await Promise.all(je),lo();const{checkAchievements:xe}=await Ot(async()=>{const{checkAchievements:R}=await Promise.resolve().then(()=>so);return{checkAchievements:R}},void 0),L=[...x.team1,...x.team2];return await Promise.all(L.map(async R=>{try{await xe(R)}catch(Z){b.error(`Erreur vÃ©rification achievements pour ${R}:`,Z)}})),b.log("âœ… [FIN MATCH] Match terminÃ© avec succÃ¨s!"),{eloUpdates:A,winnings:ve}}catch(d){throw b.error("âŒ [FIN MATCH] Erreur:",d),d}}async function nm(s,t,r,n,a){try{if(!a)throw new Error("Utilisateur non authentifiÃ©");if(!Array.isArray(s)||!Array.isArray(t))throw new Error("Ã‰quipes invalides");if(s.length===0||t.length===0)throw new Error("Les Ã©quipes doivent contenir au moins un joueur");if(s.length>2||t.length>2)throw new Error("Maximum 2 joueurs par Ã©quipe");if(typeof r!="number"||typeof n!="number")throw new Error("Scores invalides");if(!Number.isInteger(r)||!Number.isInteger(n))throw new Error("Les scores doivent Ãªtre des nombres entiers");if(r<0||n<0||r>100||n>100)throw new Error("Les scores doivent Ãªtre entre 0 et 100");if(r===n)throw new Error("Le score ne peut pas Ãªtre Ã©gal");if(s.filter(S=>t.includes(S)).length>0)throw new Error("Un joueur ne peut pas Ãªtre dans les deux Ã©quipes");const o=s.filter((S,J)=>s.indexOf(S)!==J),l=t.filter((S,J)=>t.indexOf(S)!==J);if(o.length>0||l.length>0)throw new Error("Un joueur ne peut pas Ãªtre deux fois dans la mÃªme Ã©quipe");const c=await io(s,t,r,n),d=ao(s.length,t.length),m=[...s,...t],x=await co(m),p=m.filter(S=>!x[S]);if(p.length>0)throw new Error(`Joueur(s) introuvable(s): ${p.join(", ")}`);const f=x,h=S=>{const J=f[S];if(!J)return 1e3;switch(d){case"1v1":return J.elo1v1||1e3;case"2v2":return J.elo2v2||1e3;case"mixed":return J.eloGlobal||1e3}},g=s.map(S=>{const J=f[S];if(!J)throw new Error(`Joueur ${S} introuvable`);return{id:S,username:J.username||"Unknown",eloRating:h(S),wins:J[`wins${d==="1v1"?"1v1":d==="2v2"?"2v2":"Mixed"}`]||0,losses:J[`losses${d==="1v1"?"1v1":d==="2v2"?"2v2":"Mixed"}`]||0}}),v=t.map(S=>{const J=f[S];if(!J)throw new Error(`Joueur ${S} introuvable`);return{id:S,username:J.username||"Unknown",eloRating:h(S),wins:J[`wins${d==="1v1"?"1v1":d==="2v2"?"2v2":"Mixed"}`]||0,losses:J[`losses${d==="1v1"?"1v1":d==="2v2"?"2v2":"Mixed"}`]||0}}),j=g.reduce((S,J)=>S+J.eloRating,0)/g.length,M=v.reduce((S,J)=>S+J.eloRating,0)/v.length,P=r>n,C=[],I={},O=async(S,J,me)=>{if(c)return;let re=no(S.eloRating,J,me);const Se=re-S.eloRating;(await Zr(S.id)).xpBoost&&me&&(re=ro(re,S.eloRating),b.log(`ðŸŽ¯ [Bonus Club] ${S.username}: ELO ${S.eloRating} â†’ ${re} (avec bonus +20%)`));const je=re-S.eloRating,K=d==="1v1"?"elo1v1":d==="2v2"?"elo2v2":"eloGlobal";I[`users/${S.id}/${K}`]=re;const ee=f[S.id];if(!ee)throw new Error(`Utilisateur ${S.id} introuvable lors de la mise Ã  jour ELO`);const z=d==="1v1"?re:ee.elo1v1||1e3,xe=d==="2v2"?re:ee.elo2v2||1e3,L=d==="mixed"?re:ee.eloGlobal||1e3,R=[];(d==="1v1"||ee.elo1v1!==void 0)&&R.push(z),(d==="2v2"||ee.elo2v2!==void 0)&&R.push(xe),(d==="mixed"||ee.eloGlobal!==void 0)&&R.push(L);const Z=R.length>0?Math.round(R.reduce((Y,ae)=>Y+ae,0)/R.length):1e3;I[`users/${S.id}/eloGlobal`]=Z;const se=`wins${d==="1v1"?"1v1":d==="2v2"?"2v2":"Mixed"}`,N=`losses${d==="1v1"?"1v1":d==="2v2"?"2v2":"Mixed"}`;I[`users/${S.id}/${se}`]=me?S.wins+1:S.wins,I[`users/${S.id}/${N}`]=me?S.losses:S.losses+1;const D=ee.winStreak||0;me?I[`users/${S.id}/winStreak`]=D+1:I[`users/${S.id}/winStreak`]=0;const y=new Date().getDay()===4;if(me&&y){const Y=ee.thursdayWins||0;I[`users/${S.id}/thursdayWins`]=Y+1}const G=Gs(re);C.push({userId:S.id,username:S.username,oldElo:S.eloRating,newElo:re,eloChange:je,matchType:d,rank:G})};await Promise.all([...g.map(S=>O(S,M,P)),...v.map(S=>O(S,j,!P))]);const w=k(_,"matches"),E=xt(w),V=Ei({team1:s,team2:t,matchType:d,score1:r,score2:n,timestamp:Date.now(),recordedBy:a,suspicious:c,fromBetting:!1});I[`matches/${E.key}`]=V,await ce(k(_),I),lo();const{checkAchievements:A}=await Ot(async()=>{const{checkAchievements:S}=await Promise.resolve().then(()=>so);return{checkAchievements:S}},void 0);await Promise.all(m.map(async S=>{try{await A(S)}catch(J){b.error(`Erreur vÃ©rification achievements pour ${S}:`,J)}}));const{updateQuestProgress:B}=await Ot(async()=>{const{updateQuestProgress:S}=await Promise.resolve().then(()=>vu);return{updateQuestProgress:S}},void 0);return await Promise.all(m.map(async S=>{try{await B(S,"match",1),(P&&s.includes(S)||!P&&t.includes(S))&&(d==="1v1"?await B(S,"win_1v1",1):d==="2v2"&&await B(S,"win_2v2",1),await B(S,"win_any",1))}catch(J){b.error(`Erreur mise Ã  jour quÃªtes pour ${S}:`,J)}})),{eloUpdates:C}}catch(i){throw b.error("Erreur lors de l'enregistrement du match:",i),i}}function Ws(s,t){if(!Array.isArray(s)||!Array.isArray(t)||s.length!==t.length)return!1;const r=new Set(s),n=new Set(t);if(r.size!==n.size)return!1;for(const a of r)if(!n.has(a))return!1;return!0}async function io(s,t,r,n){try{const a=k(_,"matches"),i=await q(a);if(!i.exists())return!1;const o=Date.now(),l=6*60*60*1e3;let c=0;i.forEach(m=>{const x=m.val();if(!x||!Array.isArray(x.team1)||!Array.isArray(x.team2)||!x.timestamp||o-x.timestamp>l)return;const p=Ws(x.team1,s)&&Ws(x.team2,t),f=Ws(x.team1,t)&&Ws(x.team2,s);(p||f)&&c++});const d=Math.abs(r-n);return c>=5||c>=3&&d>=10}catch(a){return b.error("Erreur dÃ©tection match suspicieux:",a),!1}}async function im(){try{const s=k(_,"bettingMatches"),t=await q(s);if(!t.exists())return[];const r=[];return t.forEach(n=>{const a={id:n.key,...n.val()};(a.status==="open"||a.status==="playing")&&r.push(a)}),r.sort((n,a)=>a.createdAt-n.createdAt)}catch(s){return b.error("Erreur lors de la rÃ©cupÃ©ration des matchs:",s),[]}}const er=new Map,om=3e4;async function oo(s=!0){const t="all_players",r=er.get(t);if(s&&r&&Date.now()-r.timestamp<om)return r.data;try{const n=k(_,"users"),a=await q(n);if(!a.exists()){const l=[];return er.set(t,{data:l,timestamp:Date.now()}),l}const i=a.val(),o=Object.entries(i).map(([l,c])=>({id:l,username:c.username||"Unknown",elo1v1:c.elo1v1||1e3,elo2v2:c.elo2v2||1e3,eloGlobal:c.eloGlobal||1e3}));return er.set(t,{data:o,timestamp:Date.now()}),o}catch(n){return b.error("Erreur lors de la rÃ©cupÃ©ration des joueurs:",n),r?r.data:[]}}function lo(){er.clear()}async function co(s){const t={};return await Promise.all(s.map(async r=>{try{const n=k(_,`users/${r}`),a=await q(n);if(a.exists()){const i=a.val();t[r]={id:r,username:i.username||"Unknown",elo1v1:i.elo1v1||1e3,elo2v2:i.elo2v2||1e3,eloGlobal:i.eloGlobal||1e3,wins1v1:i.wins1v1||0,losses1v1:i.losses1v1||0,wins2v2:i.wins2v2||0,losses2v2:i.losses2v2||0,winsMixed:i.winsMixed||0,lossesMixed:i.lossesMixed||0}}}catch(n){b.error(`Erreur chargement joueur ${r}:`,n)}})),t}function Qs({className:s,variant:t="default"}){const r="animate-pulse bg-muted rounded",n={default:"h-4 w-full",circular:"h-12 w-12 rounded-full",text:"h-4 w-3/4",card:"h-32 w-full rounded-lg"};return e.jsx("div",{className:de(r,n[t],s)})}function lm(){return e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((s,t)=>e.jsx("div",{className:"rounded-lg border border-border bg-surface-alt p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Qs,{variant:"circular",className:"h-12 w-12"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(Qs,{className:"h-4 w-32"}),e.jsx(Qs,{className:"h-3 w-24"})]}),e.jsx(Qs,{className:"h-8 w-16"})]})},t))})}const cm=s=>s===1?"text-rarity-gold":s===2?"text-rarity-silver":s===3?"text-rarity-bronze":"text-muted-foreground",dm=s=>s===1?"ðŸ‘‘":s===2?"ðŸ¥ˆ":s===3?"ðŸ¥‰":s,um=(s,t)=>{const r=t==="1v1"?s.wins1v1:t==="2v2"?s.wins2v2:s.winsMixed,n=t==="1v1"?s.losses1v1:t==="2v2"?s.losses2v2:s.lossesMixed,a=r+n;return a===0?0:Math.round(r/a*100)},tr=s=>{const t=Gs(s);return e.jsxs(le,{style:{backgroundColor:`${t.color}20`,borderColor:t.color,color:t.color},className:"border",children:[e.jsx("span",{className:"mr-1",children:t.icon}),t.name]})},mm=rl.memo(({player:s,rank:t,index:r,selectedMode:n})=>{const a=n==="1v1"?s.elo1v1:n==="2v2"?s.elo2v2:s.eloGlobal,o=um(s,n==="1v1"?"1v1":n==="2v2"?"2v2":"mixed");return e.jsx(W.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1+r*.05},className:`rounded-lg border p-4 ${t<=3?"border-primary/40 bg-gradient-to-r from-primary/10 to-transparent":"border-border bg-surface-alt"}`,children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`flex h-12 w-12 items-center justify-center rounded-lg bg-surface font-bold ${cm(t)}`,children:dm(t)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"font-semibold text-foreground",children:s.username}),tr(a)]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["WR: ",o,"%"]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:[n==="1v1"&&`${s.wins1v1}V - ${s.losses1v1}D`,n==="2v2"&&`${s.wins2v2}V - ${s.losses2v2}D`,n==="global"&&`${s.winsMixed}V - ${s.lossesMixed}D`]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:a}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ELO"})]})]})})},(s,t)=>s.player.id===t.player.id&&s.player.elo1v1===t.player.elo1v1&&s.player.elo2v2===t.player.elo2v2&&s.player.eloGlobal===t.player.eloGlobal&&s.rank===t.rank&&s.selectedMode===t.selectedMode),xm=()=>{const[s,t]=u.useState([]),[r,n]=u.useState(!0),[a,i]=u.useState("global"),[o,l]=u.useState(1),c=20;u.useEffect(()=>{const h=k(_,"users"),g=et(h,v=>{if(!v.exists()){t([]),n(!1);return}const j=[];v.forEach(M=>{const P=M.val(),C=Vr(P);j.push({id:M.key,username:C.username||"Joueur",elo1v1:C.elo1v1||C.eloRating||1e3,elo2v2:C.elo2v2||C.eloRating||1e3,eloGlobal:C.eloGlobal||C.eloRating||1e3,wins1v1:C.wins1v1||0,losses1v1:C.losses1v1||0,wins2v2:C.wins2v2||0,losses2v2:C.losses2v2||0,winsMixed:C.winsMixed||0,lossesMixed:C.lossesMixed||0})}),t(j),n(!1)},v=>{b.error("Erreur chargement leaderboard:",v),n(!1)});return()=>g()},[]);const d=u.useMemo(()=>{const h=a==="1v1"?"elo1v1":a==="2v2"?"elo2v2":"eloGlobal";return[...s].sort((g,v)=>v[h]-g[h])},[s,a]),m=u.useMemo(()=>{const h={Bronze:0,Argent:0,Or:0,Platine:0,Diamant:0,MaÃ®tre:0,"G.MaÃ®tre":0,Challenger:0},g=a==="1v1"?"elo1v1":a==="2v2"?"elo2v2":"eloGlobal";s.forEach(j=>{const M=j[g],P=Gs(M);h.hasOwnProperty(P.name)&&h[P.name]++});const v=s.length||1;return Object.entries(h).map(([j,M])=>({name:j,percentage:Math.round(M/v*100)}))},[s,a]),x=u.useMemo(()=>d.slice(0,3),[d]),p=u.useMemo(()=>{const h=(o-1)*c;return d.slice(h,h+c)},[d,o]),f=u.useMemo(()=>Math.ceil(d.length/c),[d.length]);return r?e.jsx(De,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"rounded-xl bg-rarity-gold/20 p-3",children:e.jsx(Te,{className:"h-6 w-6 text-rarity-gold"})}),e.jsxs("div",{children:[e.jsx("div",{className:"h-7 w-32 bg-muted animate-pulse rounded mb-2"}),e.jsx("div",{className:"h-4 w-24 bg-muted animate-pulse rounded"})]})]}),e.jsx(lm,{})]})}):e.jsxs(De,{children:[e.jsxs(W.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"rounded-xl bg-rarity-gold/20 p-3",children:e.jsx(Te,{className:"h-6 w-6 text-rarity-gold"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Classement"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Saison 1 - Multi-Modes"})]})]}),e.jsx(Ns,{value:a,onValueChange:h=>i(h),className:"w-full",children:e.jsxs(Kt,{className:"grid w-full grid-cols-3",children:[e.jsxs(qe,{value:"global",className:"gap-2",children:[e.jsx(Ml,{className:"h-4 w-4"}),"Global"]}),e.jsxs(qe,{value:"1v1",className:"gap-2",children:[e.jsx(Xn,{className:"h-4 w-4"}),"1v1"]}),e.jsxs(qe,{value:"2v2",className:"gap-2",children:[e.jsx(Re,{className:"h-4 w-4"}),"2v2"]})]})})]}),x.length>0&&e.jsxs(W.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.1},className:"mb-6 flex items-end justify-center gap-2",children:[x[1]&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"mb-2 flex h-16 w-16 items-center justify-center rounded-full border-4 border-rarity-silver bg-surface-alt",children:e.jsx("span",{className:"text-2xl",children:"ðŸ¥ˆ"})}),e.jsx("p",{className:"text-sm font-medium text-foreground mb-1",children:x[1].username}),tr(a==="1v1"?x[1].elo1v1:a==="2v2"?x[1].elo2v2:x[1].eloGlobal),e.jsx("div",{className:"mt-2 h-20 w-20 rounded-t-lg bg-gradient-to-b from-rarity-silver/40 to-rarity-silver/20 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl font-bold text-rarity-silver",children:a==="1v1"?x[1].elo1v1:a==="2v2"?x[1].elo2v2:x[1].eloGlobal})})]}),x[0]&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(W.div,{animate:{y:[0,-5,0]},transition:{duration:2,repeat:1/0},className:"mb-2",children:e.jsx("span",{className:"text-3xl",children:"ðŸ‘‘"})}),e.jsx("div",{className:"mb-2 flex h-20 w-20 items-center justify-center rounded-full border-4 border-rarity-gold bg-surface-alt glow-gold",children:e.jsx("span",{className:"text-3xl",children:"ðŸ†"})}),e.jsx("p",{className:"font-semibold text-foreground mb-1",children:x[0].username}),tr(a==="1v1"?x[0].elo1v1:a==="2v2"?x[0].elo2v2:x[0].eloGlobal),e.jsx("div",{className:"mt-2 h-28 w-24 rounded-t-lg bg-gradient-to-b from-rarity-gold/40 to-rarity-gold/20 flex items-center justify-center",children:e.jsx("span",{className:"text-3xl font-bold text-rarity-gold",children:a==="1v1"?x[0].elo1v1:a==="2v2"?x[0].elo2v2:x[0].eloGlobal})})]}),x[2]&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"mb-2 flex h-14 w-14 items-center justify-center rounded-full border-4 border-rarity-bronze bg-surface-alt",children:e.jsx("span",{className:"text-xl",children:"ðŸ¥‰"})}),e.jsx("p",{className:"text-sm font-medium text-foreground mb-1",children:x[2].username}),tr(a==="1v1"?x[2].elo1v1:a==="2v2"?x[2].elo2v2:x[2].eloGlobal),e.jsx("div",{className:"mt-2 h-16 w-18 rounded-t-lg bg-gradient-to-b from-rarity-bronze/40 to-rarity-bronze/20 flex items-center justify-center px-6",children:e.jsx("span",{className:"text-xl font-bold text-rarity-bronze",children:a==="1v1"?x[2].elo1v1:a==="2v2"?x[2].elo2v2:x[2].eloGlobal})})]})]}),e.jsx(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"mb-6",children:e.jsxs(U,{children:[e.jsx(he,{children:e.jsx(fe,{className:"text-lg",children:"Distribution des Rangs"})}),e.jsx(H,{children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:[{name:"Bronze",icon:"ðŸ¥‰",color:"#CD7F32"},{name:"Argent",icon:"ðŸ¥ˆ",color:"#C0C0C0"},{name:"Or",icon:"ðŸ¥‡",color:"#FFD700"},{name:"Platine",icon:"ðŸ’Ž",color:"#E5E4E2"},{name:"Diamant",icon:"ðŸ’ ",color:"#B9F2FF"},{name:"MaÃ®tre",icon:"ðŸ‘‘",color:"#9B59B6"},{name:"G.MaÃ®tre",icon:"âš¡",color:"#E74C3C"},{name:"Challenger",icon:"ðŸ”¥",color:"#F39C12"}].map(h=>{const g=m.find(v=>v.name===h.name);return e.jsxs("div",{className:"flex flex-col items-center rounded-lg border border-border bg-surface-alt p-2",children:[e.jsx("span",{className:"text-2xl mb-1",children:h.icon}),e.jsx("span",{className:"text-xs font-medium",style:{color:h.color},children:h.name}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[(g==null?void 0:g.percentage)||0,"%"]})]},h.name)})})})]})}),e.jsx("div",{className:"space-y-3",children:p.length>0?p.map((h,g)=>{const v=(o-1)*c+g+1;return e.jsx(mm,{player:h,rank:v,index:g,selectedMode:a},h.id)}):e.jsx(U,{children:e.jsx(H,{className:"p-8 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"Aucun joueur trouvÃ©"})})})}),f>1&&e.jsxs("div",{className:"mt-6 flex items-center justify-center gap-2",children:[e.jsx(T,{variant:"outline",size:"sm",onClick:()=>l(h=>Math.max(1,h-1)),disabled:o===1,children:"PrÃ©cÃ©dent"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",o," sur ",f]}),e.jsx(T,{variant:"outline",size:"sm",onClick:()=>l(h=>Math.min(f,h+1)),disabled:o===f,children:"Suivant"})]})]})};function hm({queuedPlayers:s,isInQueue:t,onJoinQueue:r,onLeaveQueue:n,isJoining:a=!1,isLeaving:i=!1}){return e.jsxs(U,{className:"overflow-hidden",children:[e.jsx(he,{className:"border-b border-border bg-surface-alt/50",children:e.jsxs(fe,{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-5 w-5 text-primary"}),"File d'attente",e.jsxs("span",{className:"ml-auto rounded-full bg-primary/20 px-3 py-1 text-sm text-primary",children:[s.length,"/4"]})]})}),e.jsxs(H,{className:"p-4",children:[e.jsx("div",{className:"mb-6 grid grid-cols-4 gap-2",children:[0,1,2,3].map(o=>{const l=s[o];return e.jsx(W.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:o*.1},className:`flex aspect-square flex-col items-center justify-center rounded-xl border-2 border-dashed transition-all ${l?"border-primary bg-primary/10 neon-border-cyan":"border-border bg-surface-alt"}`,children:l?e.jsxs(e.Fragment,{children:[e.jsx(Us,{className:"h-8 w-8 text-primary"}),e.jsx("span",{className:"mt-1 text-xs font-medium truncate w-full text-center px-1",children:l.username}),e.jsx("span",{className:"text-[10px] text-primary",children:l.eloRating})]}):e.jsxs(e.Fragment,{children:[e.jsx(it,{className:"h-6 w-6 text-muted-foreground"}),e.jsx("span",{className:"mt-1 text-xs text-muted-foreground",children:"En attente"})]})},o)})}),t?e.jsx(T,{variant:"neon-magenta",className:"w-full",onClick:n,disabled:i,children:i?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"mr-2 h-4 w-4 animate-spin"}),"DÃ©part..."]}):"Quitter la file"}):e.jsx(T,{variant:"neon",className:"w-full",onClick:r,disabled:a,children:a?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"mr-2 h-4 w-4 animate-spin"}),"Rejoindre..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ei,{className:"mr-2 h-4 w-4"}),"Rejoindre la file"]})}),s.length===4&&e.jsx(W.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mt-4 rounded-lg bg-primary/20 p-3 text-center",children:e.jsx("p",{className:"font-semibold text-primary text-glow-cyan",children:"ðŸŽ® Match prÃªt Ã  dÃ©marrer !"})})]})]})}const fm=()=>{const{user:s,userProfile:t}=Me(),r=mt(),[n,a]=u.useState(!1),[i,o]=u.useState([]),[l,c]=u.useState([]),[d,m]=u.useState(!0),[x,p]=u.useState(!0),[f,h]=u.useState(!1),[g,v]=u.useState(!1),{elo1v1:j=1e3,elo2v2:M=1e3,eloGlobal:P=1e3}=t;u.useEffect(()=>{m(!0);const E=Di(V=>{if(o(V),m(!1),s){const A=V.some(B=>B.id===s.uid);a(A)}});return()=>E()},[s]),u.useEffect(()=>{p(!0);const E=Ii(V=>{c(V),p(!1)},10);return()=>E()},[]);const C=async()=>{if(!s||!t){$({title:"Erreur",description:"Vous devez Ãªtre connectÃ©",variant:"destructive"});return}h(!0);try{await Ku(s.uid,t.username,j,M,P),$({title:"File d'attente",description:"Vous avez rejoint la file d'attente!"})}catch(E){b.error("Erreur:",E),$({title:"Erreur",description:"Impossible de rejoindre la file",variant:"destructive"})}finally{h(!1)}},I=async()=>{if(s){v(!0);try{await Xu(s.uid),$({title:"File d'attente",description:"Vous avez quittÃ© la file d'attente."})}catch(E){b.error("Erreur:",E),$({title:"Erreur",description:"Impossible de quitter la file",variant:"destructive"})}finally{v(!1)}}},O=E=>{try{return(typeof E=="string"?new Date(E):new Date(E)).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Date inconnue"}},w=(E,V)=>{const A=V===1?E.team1:E.team2,B=V===1?E.team1Names:E.team2Names;return B&&Array.isArray(B)?B.join(" & "):A&&A.length>0&&typeof A[0]=="string"?A.join(" & "):`Ã‰quipe ${V}`};return e.jsxs(De,{children:[e.jsxs(W.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"rounded-xl bg-primary/20 p-3",children:e.jsx(Xn,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Match"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Trouvez une partie"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto",children:[e.jsxs(T,{onClick:()=>r("/record-match"),variant:"outline",className:"gap-2 w-full sm:w-auto",children:[e.jsx(ti,{className:"h-4 w-4"}),"Enregistrer Match"]}),e.jsxs(T,{onClick:()=>r("/betting"),variant:"neon",className:"gap-2 w-full sm:w-auto",children:[e.jsx(ns,{className:"h-4 w-4"}),"Match avec Paris"]})]})]}),e.jsx(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"mb-6",children:d?e.jsx(U,{children:e.jsxs(H,{className:"flex items-center justify-center p-8",children:[e.jsx(ue,{className:"h-6 w-6 animate-spin text-primary"}),e.jsx("p",{className:"ml-3 text-muted-foreground",children:"Chargement de la file..."})]})}):e.jsx(hm,{queuedPlayers:i,isInQueue:n,onJoinQueue:C,onLeaveQueue:I,isJoining:f,isLeaving:g})}),e.jsx(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"mb-6",children:e.jsx(U,{className:"border-rarity-gold/30 bg-gradient-to-r from-rarity-gold/10 to-transparent",children:e.jsxs(H,{className:"flex items-center gap-4 p-4",children:[e.jsx("div",{className:"rounded-xl bg-rarity-gold/20 p-3",children:e.jsx(Tl,{className:"h-6 w-6 text-rarity-gold"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-foreground",children:"Tournoi du Jeudi"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"DÃ©but dans 2h (13:00)"})]}),e.jsx(T,{onClick:()=>r("/tournament"),variant:"outline",size:"sm",className:"border-rarity-gold text-rarity-gold hover:bg-rarity-gold/10",children:"S'inscrire"})]})})}),e.jsx(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:e.jsxs(U,{children:[e.jsx(he,{className:"border-b border-border",children:e.jsxs(fe,{className:"flex items-center gap-2 text-lg",children:[e.jsx(Pl,{className:"h-5 w-5 text-muted-foreground"}),"Matchs rÃ©cents"]})}),e.jsx(H,{className:"p-4",children:x?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(ue,{className:"h-6 w-6 animate-spin text-primary"}),e.jsx("p",{className:"ml-3 text-muted-foreground",children:"Chargement des matchs..."})]}):e.jsx("div",{className:"space-y-4",children:l.length>0?l.map((E,V)=>e.jsxs(W.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4+V*.1},className:"rounded-lg bg-surface-alt p-4 hover:bg-surface-alt/70 transition-colors",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:O(E.date)}),e.jsx("span",{className:E.score1>E.score2?"text-primary":"text-red-500",children:E.score1>E.score2?"Ã‰quipe 1 gagne":"Ã‰quipe 2 gagne"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1 text-center",children:e.jsx("p",{className:"text-sm font-medium text-foreground",children:w(E,1)})}),e.jsxs("div",{className:"mx-4 flex items-center gap-2",children:[e.jsx("span",{className:`text-2xl font-bold ${E.score1>E.score2?"text-primary text-glow-cyan":"text-muted-foreground"}`,children:E.score1}),e.jsx("span",{className:"text-muted-foreground",children:"-"}),e.jsx("span",{className:`text-2xl font-bold ${E.score2>E.score1?"text-red-500":"text-muted-foreground"}`,children:E.score2})]}),e.jsx("div",{className:"flex-1 text-center",children:e.jsx("p",{className:"text-sm font-medium text-foreground",children:w(E,2)})})]})]},E.id)):e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Aucun match rÃ©cent"})})})]})})]})};async function Hs(s,t,r,n,a){try{const i=`${Date.now()}_${Math.random().toString(36).substr(2,9)}`;await ce(k(_),{[`notifications/${s}/${i}`]:{userId:s,type:t,title:r,message:n,relatedId:a,read:!1,createdAt:Date.now()}})}catch(i){b.error("Erreur crÃ©ation notification:",i)}}async function pm(s,t,r,n,a){if(!s)throw new Error("Utilisateur non authentifiÃ©");if(a<=0)throw new Error("Le prix doit Ãªtre supÃ©rieur Ã  0");const i=k(_,`users/${s}`),o=k(_),l=await q(i);if(!l.exists())throw new Error("Utilisateur introuvable");const m=((l.val()||{}).cards||{})[t]||0;if(m<=0)throw new Error("Vous ne possÃ©dez pas cette carte");const p=xt(k(_,"cardMarket")).key,f={};f[`users/${s}/cards/${t}`]=m-1,f[`cardMarket/${p}`]={cardCode:t,cardName:r,rarity:n,sellerId:s,price:a,createdAt:Date.now(),status:"open",views:0,offersCount:0},await ce(o,f)}async function gm(){const s=k(_,"cardMarket"),t=await q(s);if(!t.exists())return[];const r=t.val(),n=[];for(const[a,i]of Object.entries(r)){const o=i;o.status==="open"&&n.push({id:a,cardCode:o.cardCode,cardName:o.cardName,rarity:o.rarity,sellerId:o.sellerId,price:o.price,createdAt:o.createdAt,status:o.status,buyerId:o.buyerId,views:o.views||0,offersCount:o.offersCount||0})}return n.sort((a,i)=>i.createdAt-a.createdAt)}async function bm(s){const t=k(_,`cardMarket/${s}`),r=await q(t);if(!r.exists())return;const a=r.val().views||0;await ce(k(_),{[`cardMarket/${s}/views`]:a+1})}async function ym(s,t){const r=k(_,`cardMarket/${t}`),n=await q(r);if(!n.exists())throw new Error("Annonce introuvable");const a=n.val();if(a.sellerId!==s)throw new Error("Vous ne pouvez pas annuler cette annonce");if(a.status!=="open")throw new Error("Cette annonce n'est plus ouverte");const i=k(_),o=k(_,`users/${s}`),l=await q(o),m=((l.exists()?l.val():{}).cards||{})[a.cardCode]||0,x={};x[`users/${s}/cards/${a.cardCode}`]=m+1,x[`cardMarket/${t}/status`]="cancelled",await ce(i,x)}async function vm(s,t){if(!s)throw new Error("Utilisateur non authentifiÃ©");const r=k(_,`cardMarket/${t}`),n=await q(r);if(!n.exists())throw new Error("Annonce introuvable");const a=n.val();if(a.status!=="open")throw new Error("Cette annonce n'est plus disponible");if(a.sellerId===s)throw new Error("Vous ne pouvez pas acheter votre propre annonce");const i=k(_,`users/${a.sellerId}`),o=k(_,`users/${s}`),[l,c]=await Promise.all([q(i),q(o)]);if(!c.exists())throw new Error("Acheteur introuvable");if(!l.exists())throw new Error("Vendeur introuvable");const d=l.val()||{},m=c.val()||{},x=m.fortune||0;if(x<a.price)throw new Error("Fonds insuffisants pour acheter cette carte");const f=(m.cards||{})[a.cardCode]||0,h=d.fortune||0,g=x-a.price,v=h+a.price,j={};j[`users/${s}/fortune`]=g,j[`users/${s}/cards/${a.cardCode}`]=f+1,j[`users/${a.sellerId}/fortune`]=v,j[`cardMarket/${t}/status`]="sold",j[`cardMarket/${t}/buyerId`]=s,j[`cardMarket/${t}/finalPrice`]=a.price,j[`cardMarket/${t}/soldAt`]=Date.now();try{await ce(k(_),j)}catch(C){throw b.error("âŒ Erreur lors de la transaction:",C),new Error("La transaction a Ã©chouÃ©. Aucune modification n'a Ã©tÃ© effectuÃ©e.")}((await q(o)).val()||{}).fortune!==g&&b.error("âš ï¸ ALERTE: La fortune de l'acheteur ne correspond pas!");try{await Promise.all([Be(s,g,-a.price,`Achat carte: ${a.cardName}`),Be(a.sellerId,v,a.price,`Vente carte: ${a.cardName}`)])}catch(C){b.error("âš ï¸ Erreur historique (non bloquant):",C)}try{await Hs(a.sellerId,"listing_sold","Carte vendue ! ðŸŽ‰",`Votre ${a.cardName} a Ã©tÃ© vendue pour ${a.price}â‚¬`,t)}catch(C){b.error("âš ï¸ Erreur notification (non bloquant):",C)}try{await po(a.cardCode,a.price)}catch(C){b.error("âš ï¸ Erreur stats (non bloquant):",C)}}async function jm(s,t,r,n){if(!s)throw new Error("Utilisateur non authentifiÃ©");if(r<=0)throw new Error("Le montant doit Ãªtre supÃ©rieur Ã  0");const a=k(_,`cardMarket/${t}`),i=await q(a);if(!i.exists())throw new Error("Annonce introuvable");const o=i.val();if(o.status!=="open")throw new Error("Cette annonce n'est plus disponible");if(o.sellerId===s)throw new Error("Vous ne pouvez pas faire une offre sur votre propre annonce");const l=k(_,`users/${s}`);if((((await q(l)).val()||{}).fortune||0)<r)throw new Error("Fonds insuffisants pour cette offre");const p=xt(k(_,"cardOffers")).key,f=Date.now(),h=f+48*60*60*1e3,g={id:p,listingId:t,buyerId:s,sellerId:o.sellerId,amount:r,message:n,status:"pending",createdAt:f,expiresAt:h},v=o.offersCount||0;return await ce(k(_),{[`cardOffers/${p}`]:g,[`cardMarket/${t}/offersCount`]:v+1}),await Hs(o.sellerId,"offer_received","Nouvelle offre reÃ§ue ðŸ’°",`Une offre de ${r}â‚¬ a Ã©tÃ© faite pour votre ${o.cardName}`,p),p}async function uo(s,t){const r=k(_,`cardOffers/${t}`),n=await q(r);if(!n.exists())throw new Error("Offre introuvable");const a=n.val();if(a.sellerId!==s)throw new Error("Vous n'Ãªtes pas le vendeur de cette annonce");if(a.status!=="pending")throw new Error("Cette offre n'est plus valide");if(Date.now()>a.expiresAt)throw new Error("Cette offre a expirÃ©");const i=k(_,`cardMarket/${a.listingId}`),l=(await q(i)).val(),c=k(_,`users/${a.buyerId}`),d=k(_,`users/${s}`),[m,x]=await Promise.all([q(c),q(d)]),p=m.val()||{},f=x.val()||{},h=p.fortune||0,g=f.fortune||0;if(h<a.amount)throw new Error("L'acheteur n'a plus les fonds suffisants");const j=(p.cards||{})[l.cardCode]||0;await ce(k(_),{[`users/${a.buyerId}/fortune`]:h-a.amount,[`users/${a.buyerId}/cards/${l.cardCode}`]:j+1}),await ce(k(_),{[`users/${s}/fortune`]:g+a.amount}),await ce(k(_),{[`cardMarket/${a.listingId}/status`]:"sold",[`cardMarket/${a.listingId}/buyerId`]:a.buyerId,[`cardMarket/${a.listingId}/finalPrice`]:a.amount,[`cardOffers/${t}/status`]:"accepted"}),await Promise.all([Be(a.buyerId,h-a.amount,-a.amount,`Achat carte: ${l.cardName} (offre acceptÃ©e)`),Be(s,g+a.amount,a.amount,`Vente carte: ${l.cardName} (offre acceptÃ©e)`)]),await Hs(a.buyerId,"offer_accepted","Offre acceptÃ©e ! âœ…",`Votre offre de ${a.amount}â‚¬ pour ${l.cardName} a Ã©tÃ© acceptÃ©e`,t),await po(l.cardCode,a.amount)}async function mo(s,t){const r=k(_,`cardOffers/${t}`),n=await q(r);if(!n.exists())throw new Error("Offre introuvable");const a=n.val();if(a.sellerId!==s)throw new Error("Vous n'Ãªtes pas le vendeur");if(a.status!=="pending")throw new Error("Cette offre n'est plus valide");await ce(k(_),{[`cardOffers/${t}/status`]:"rejected"});const i=k(_,`cardMarket/${a.listingId}`),l=(await q(i)).val();await Hs(a.buyerId,"offer_rejected","Offre rejetÃ©e âŒ",`Votre offre de ${a.amount}â‚¬ pour ${l.cardName} a Ã©tÃ© rejetÃ©e`,t)}async function xo(s,t,r){const n=k(_,`cardOffers/${t}`),a=await q(n);if(!a.exists())throw new Error("Offre introuvable");const i=a.val();if(i.sellerId!==s)throw new Error("Vous n'Ãªtes pas le vendeur");if(i.status!=="pending")throw new Error("Cette offre n'est plus valide");if(r<=0)throw new Error("Le montant doit Ãªtre supÃ©rieur Ã  0");await ce(k(_),{[`cardOffers/${t}/status`]:"countered",[`cardOffers/${t}/counterOffer`]:r});const o=k(_,`cardMarket/${i.listingId}`),c=(await q(o)).val();await Hs(i.buyerId,"offer_countered","Contre-offre reÃ§ue ðŸ”„",`Le vendeur propose ${r}â‚¬ pour ${c.cardName} (votre offre: ${i.amount}â‚¬)`,t)}async function ho(s){const t=k(_,"cardOffers"),r=await q(t);if(!r.exists())return[];const n=r.val(),a=[];for(const[i,o]of Object.entries(n))o.sellerId===s&&o.status==="pending"&&a.push({...o,id:i});return a.sort((i,o)=>o.createdAt-i.createdAt)}async function fo(s){const t=k(_,"cardOffers"),r=await q(t);if(!r.exists())return[];const n=r.val(),a=[];for(const[i,o]of Object.entries(n))o.buyerId===s&&a.push({...o,id:i});return a.sort((i,o)=>o.createdAt-i.createdAt)}async function po(s,t){const r=k(_,`marketStats/${s}`),n=await q(r),a=Date.now();let i;if(n.exists()){i=n.val(),i.totalSales+=1,i.lastSalePrice=t,i.lastSaleDate=a,i.priceHistory.push({date:a,price:t});const o=a-30*24*60*60*1e3;i.priceHistory=i.priceHistory.filter(c=>c.date>o);const l=i.priceHistory.map(c=>c.price);i.averagePrice=l.reduce((c,d)=>c+d,0)/l.length,i.lowestPrice=Math.min(...l),i.highestPrice=Math.max(...l)}else i={cardCode:s,totalSales:1,lastSalePrice:t,lastSaleDate:a,averagePrice:t,lowestPrice:t,highestPrice:t,priceHistory:[{date:a,price:t}]};await ce(k(_),{[`marketStats/${s}`]:i})}async function br(s){const t=k(_,`marketStats/${s}`),r=await q(t);if(!r.exists())return null;const n=r.val();b.log("ðŸ“Š [getMarketStats] Type priceHistory:",typeof n.priceHistory),b.log("ðŸ“Š [getMarketStats] priceHistory:",n.priceHistory);let a=[];return n.priceHistory&&(Array.isArray(n.priceHistory)?(a=n.priceHistory,b.log("âœ… [getMarketStats] priceHistory est un array:",a.length,"entrÃ©es")):typeof n.priceHistory=="object"&&(a=Object.values(n.priceHistory),b.log("ðŸ”„ [getMarketStats] priceHistory converti d'objet vers array:",a.length,"entrÃ©es"))),a=a.filter(o=>o&&typeof o=="object"&&typeof o.date=="number"&&typeof o.price=="number"&&o.price>0),b.log("âœ… [getMarketStats] priceHistory filtrÃ©:",a.length,"entrÃ©es valides"),{cardCode:n.cardCode||s,totalSales:n.totalSales||0,lastSalePrice:n.lastSalePrice,lastSaleDate:n.lastSaleDate,averagePrice:n.averagePrice||0,lowestPrice:n.lowestPrice||0,highestPrice:n.highestPrice||0,priceHistory:a}}async function wm(s){const t=await br(s);if(!t||t.totalSales===0)return 10;const r=Date.now()-7*24*60*60*1e3,n=t.priceHistory.filter(a=>a.date>r).map(a=>a.price);return n.length===0?Math.round(t.averagePrice):Math.round(n.reduce((a,i)=>a+i,0)/n.length)}const ye=u.forwardRef(({className:s,type:t,...r},n)=>e.jsx("input",{type:t,className:de("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:n,...r}));ye.displayName="Input";const St=50,Nm=2*60*60*1e3,Wa={bronze:1,silver:2,gold:3,espoir:4,icone:5,"future-star":6,god:7,creator:8,unknown:0},Wr={bronze:"Bronze",silver:"Silver",gold:"Gold",espoir:"Espoir",icone:"IcÃ´ne","future-star":"Future Star",god:"GOD",creator:"CRÃ‰ATEUR",unknown:"Inconnu"},Cm=({season:s,nom:t,alt:r,className:n})=>{const[a,i]=u.useState(!1),o=`/images/cards/${s}/${t}`;return a?e.jsx("div",{className:de("flex items-center justify-center bg-muted/50",n),children:e.jsxs("div",{className:"text-center p-2",children:[e.jsx("span",{className:"text-xl mb-1 block",children:"âš½"}),e.jsx("p",{className:"text-[8px] text-muted-foreground uppercase",children:t})]})}):e.jsx("img",{src:o,alt:r,className:n,onError:()=>i(!0),loading:"lazy"})};function Er({rarity:s,season:t,nom:r,owned:n=!0,onClick:a}){return e.jsx(W.div,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:a,className:de("relative cursor-pointer overflow-hidden rounded-xl p-1 transition-all",`card-rarity-${s}`,!n&&"opacity-40 grayscale"),children:e.jsxs("div",{className:"relative aspect-[3/4] overflow-hidden rounded-lg bg-background/50 backdrop-blur-sm",children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(Cm,{season:t,nom:r,alt:r,className:"h-full w-full object-cover"})}),e.jsx("div",{className:de("absolute right-2 top-2 rounded-full px-2 py-0.5 text-[10px] font-bold uppercase shadow-lg z-10",s==="bronze"&&"bg-amber-600/90 text-white",s==="silver"&&"bg-gray-400/90 text-background",s==="gold"&&"bg-yellow-500/90 text-background",s==="espoir"&&"bg-blue-500/90 text-white",s==="icone"&&"bg-purple-500/90 text-white",s==="future-star"&&"bg-cyan-500/90 text-white",s==="god"&&"bg-purple-600/90 text-white",s==="creator"&&"bg-pink-600/90 text-white",s==="unknown"&&"bg-gray-500/90 text-white"),children:Wr[s]}),!n&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-background/60",children:e.jsx("span",{className:"text-2xl",children:"ðŸ”’"})})]})})}const Sm=()=>{const{user:s}=Me(),[t,r]=u.useState("season1"),[n,a]=u.useState("all"),[i,o]=u.useState(!1),[l,c]=u.useState(!0),[d,m]=u.useState([]),[x,p]=u.useState([]),[f,h]=u.useState(0),[g,v]=u.useState(null),[j,M]=u.useState(""),[P,C]=u.useState(!1),[I,O]=u.useState(0),[w,E]=u.useState(null),[V,A]=u.useState(!1),[B,S]=u.useState(""),[J,me]=u.useState([]),[re,Se]=u.useState(!1),ve=u.useCallback(async()=>{if(s){c(!0);try{const z=k(_,`users/${s.uid}`),xe=await q(z);if(xe.exists()){const L=xe.val();O(L.fortune||0),E(L.lastFreeBooster||null);const R=L.cards||{},{codeToCardMap:Z}=await Ot(async()=>{const{codeToCardMap:D}=await Promise.resolve().then(()=>Vs);return{codeToCardMap:D}},void 0),se=Bi();me(se);const N=[];for(const D of se){const Q=Z[D]||{};for(const[y,G]of Object.entries(Q)){const Y=R[y]||0;N.push({code:y,nom:G.nom,rarity:G.rarity,season:D,ownedCount:Y,owned:Y>0})}}m(N.sort((D,Q)=>D.season.localeCompare(Q.season)||D.code.localeCompare(Q.code)))}}catch{$({title:"Erreur",description:"Impossible de charger la collection.",variant:"destructive"})}finally{c(!1)}}},[s]);u.useEffect(()=>{ve()},[ve]),u.useEffect(()=>{const xe=setInterval(()=>{if(!w){A(!0);return}const L=Nm-(Date.now()-w);if(L<=0)A(!0),S("");else{A(!1);const R=Math.floor(L/36e5),Z=Math.floor(L%36e5/6e4),se=Math.floor(L%6e4/1e3);S(`${R}h ${Z}m ${se}s`)}},1e3);return()=>clearInterval(xe)},[w]);const je=async(z=!1)=>{if(s){if(!z&&I<St){$({title:"Pas assez d'argent",description:`Il vous faut ${St}â‚¬`,variant:"destructive"});return}if(!(z&&!V)){o(!0),Se(z);try{const xe=z?"mixed":t,L=await Ou(s.uid,xe);p(L.sort((Z,se)=>Wa[kt(Z.rarity)]-Wa[kt(se.rarity)])),h(0);const R=z?{lastFreeBooster:Date.now()}:{fortune:I-St};if(await ce(k(_,`users/${s.uid}`),R),z)E(Date.now());else{const Z=I-St;await Be(s.uid,Z,-St,`Achat de booster (${ts(t)})`),O(se=>se-St)}await ve()}catch{$({title:"Erreur",description:"ProblÃ¨me avec le booster.",variant:"destructive"})}finally{o(!1)}}}},K=u.useMemo(()=>{let z=d.filter(xe=>xe.season===t);return n!=="all"&&(z=z.filter(xe=>kt(xe.rarity)===n)),z},[d,t,n]),ee=async()=>{if(!s||!g)return;const z=Number(j);if(!z||z<=0){$({title:"Prix invalide",variant:"destructive"});return}C(!0);try{await pm(s.uid,g.code,g.nom,g.rarity,z),$({title:"Carte mise en vente âœ…"}),v(null),await ve()}catch(xe){$({title:"Erreur",description:xe.message,variant:"destructive"})}finally{C(!1)}};return e.jsxs(De,{children:[e.jsxs("div",{className:"container mx-auto p-4 max-w-7xl",children:[e.jsxs("div",{className:"mb-8 flex flex-col md:flex-row md:items-end justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Ma Collection"}),e.jsx("p",{className:"text-muted-foreground",children:"GÃ©rez vos cartes et ouvrez des boosters"})]}),e.jsx("div",{className:"bg-primary/10 px-4 py-2 rounded-xl border border-primary/20",children:e.jsxs("p",{className:"text-primary font-bold text-xl flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ’°"})," ",I.toLocaleString(),"â‚¬"]})})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-6 bg-muted/30 p-2 rounded-lg inline-flex",children:J.map(z=>e.jsx(T,{variant:t===z?"default":"ghost",onClick:()=>r(z),className:"rounded-md",children:ts(z)},z))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 mb-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(T,{onClick:()=>je(!1),disabled:i||I<St,className:"flex-1 h-14 text-lg font-bold shadow-lg shadow-primary/20",children:[i?e.jsx(ue,{className:"animate-spin mr-2"}):e.jsx(ct,{className:"mr-2"}),"Booster ",ts(t)," (",St,"â‚¬)"]}),e.jsxs(T,{onClick:()=>je(!0),disabled:i||!V,variant:"secondary",className:"flex-1 h-14 text-lg font-bold",children:[e.jsx(it,{className:"mr-2 h-5 w-5"}),V?"Pack Gratuit (S1+S2)":B]})]}),e.jsxs("div",{className:"flex flex-wrap gap-1 items-center justify-end",children:[e.jsxs("span",{className:"text-xs font-medium text-muted-foreground mr-2 flex items-center gap-1",children:[e.jsx(mr,{className:"h-3 w-3"})," FILTRER:"]}),["all","bronze","silver","gold","espoir","icone","future-star","god","creator"].map(z=>e.jsx(T,{size:"sm",variant:n===z?"default":"outline",onClick:()=>a(z),className:"text-[10px] h-7 px-2 uppercase font-bold",children:z==="all"?"Tous":Wr[z]},z))]})]}),l?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx(ue,{className:"animate-spin h-10 w-10 text-primary mb-4"}),e.jsx("p",{className:"text-muted-foreground animate-pulse",children:"Chargement de votre deck..."})]}):e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-4",children:K.map(z=>e.jsxs("div",{className:"relative",children:[z.ownedCount>1&&e.jsxs("div",{className:"absolute -top-2 -right-2 z-20 bg-primary text-white text-[10px] rounded-full h-6 w-6 flex items-center justify-center font-bold border-2 border-background shadow-md",children:["x",z.ownedCount]}),e.jsx(Er,{rarity:kt(z.rarity),season:z.season,nom:z.nom,owned:z.owned,onClick:()=>v(z)})]},z.code))})]}),e.jsx(rt,{children:g&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4",onClick:()=>v(null),children:e.jsx(W.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"w-full max-w-sm",onClick:z=>z.stopPropagation(),children:e.jsxs(U,{className:"overflow-hidden border-2 border-slate-800",children:[e.jsxs(he,{className:"relative pb-2 bg-slate-900/50",children:[e.jsx(T,{variant:"ghost",size:"icon",className:"absolute right-2 top-2 text-muted-foreground hover:text-white",onClick:()=>v(null),children:e.jsx(Ze,{className:"h-4 w-4"})}),e.jsxs("div",{className:"text-center space-y-1",children:[e.jsx(fe,{className:"text-xl font-bold",children:g.nom.replace(".png","").replace(".jpg","")}),e.jsxs("p",{className:"text-[10px] font-mono text-primary uppercase tracking-widest opacity-70",children:["ID: ",g.code]})]})]}),e.jsxs(H,{className:"space-y-4 pt-6",children:[e.jsxs("div",{className:"w-48 mx-auto relative group",children:[e.jsxs("div",{className:"absolute -top-2 -right-2 z-10 bg-slate-950 border border-slate-700 px-2 py-0.5 rounded text-[9px] font-mono text-white shadow-xl",children:["#",g.code]}),e.jsx(Er,{rarity:kt(g.rarity),season:g.season,nom:g.nom,owned:g.owned})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-muted/50 p-2 rounded-lg text-center border border-slate-800",children:[e.jsx("p",{className:"text-muted-foreground mb-0.5",children:"RaretÃ©"}),e.jsx("p",{className:"font-bold",children:Wr[kt(g.rarity)]})]}),e.jsxs("div",{className:"bg-muted/50 p-2 rounded-lg text-center border border-slate-800",children:[e.jsx("p",{className:"text-muted-foreground mb-0.5",children:"Saison"}),e.jsx("p",{className:"font-bold",children:ts(g.season)})]})]}),g.owned&&e.jsxs("div",{className:"pt-4 border-t border-slate-800 space-y-3",children:[e.jsx("p",{className:"text-sm font-semibold text-center",children:"Mettre en vente sur le marchÃ©"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ye,{type:"number",placeholder:"Prix",value:j,onChange:z=>M(z.target.value),className:"pr-8"}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground",children:"â‚¬"})]}),e.jsx(T,{onClick:ee,disabled:P,children:P?e.jsx(ue,{className:"animate-spin h-4 w-4"}):"Lister"})]})]})]})]})})})}),e.jsx(rt,{children:x.length>0&&e.jsxs("div",{className:"fixed inset-0 z-[60] flex flex-col items-center justify-center bg-black/95 p-4 overflow-hidden",children:[e.jsxs(W.div,{initial:{y:-50,opacity:0},animate:{y:0,opacity:1},className:"text-center mb-8",children:[e.jsx("h2",{className:"text-primary text-3xl font-black italic tracking-tighter mb-2",children:re?"PACK MIXTE DÃ‰BLOQUÃ‰ !":"NOUVEAU BOOSTER !"}),e.jsx("div",{className:"h-1 w-32 bg-primary mx-auto rounded-full"})]}),e.jsxs(W.div,{initial:{rotateY:90,scale:.5,opacity:0},animate:{rotateY:0,scale:1,opacity:1},transition:{type:"spring",damping:12},className:"w-72 sm:w-80",children:[e.jsx(Er,{rarity:kt(x[f].rarity),season:x[f].season,nom:x[f].nom}),e.jsxs("div",{className:"mt-6 text-center",children:[e.jsx("p",{className:"text-white font-bold text-2xl mb-1",children:x[f].nom.split(".")[0]}),e.jsx("p",{className:"text-primary/80 font-medium uppercase tracking-widest text-xs",children:ts(x[f].season)})]})]},f),e.jsxs("div",{className:"flex gap-4 mt-12 w-full max-w-xs",children:[e.jsxs(T,{disabled:f===0,onClick:()=>h(z=>z-1),variant:"outline",className:"flex-1 bg-white/5 border-white/10 text-white",children:[e.jsx(Ol,{className:"mr-2"})," PrÃ©cÃ©dent"]}),f===x.length-1?e.jsx(T,{onClick:()=>p([]),className:"flex-1 font-bold",children:"Terminer"}):e.jsxs(T,{onClick:()=>h(z=>z+1),className:"flex-1 font-bold",children:["Suivant ",e.jsx(Ll,{className:"ml-2"})]})]}),e.jsxs("p",{className:"text-white/30 text-xs mt-8",children:["Carte ",f+1," sur ",x.length]})]})})]})};function km(s,t=500){const[r,n]=u.useState(s);return u.useEffect(()=>{const a=setTimeout(()=>{n(s)},t);return()=>{clearTimeout(a)}},[s,t]),r}const _m=({username:s,role:t,eloRating:r,rank:n,equippedAvatar:a,equippedBanner:i,equippedTitle:o})=>{const c={player:{label:"Joueur",color:"bg-blue-500",icon:jt},agent:{label:"Agent",color:"bg-purple-500",icon:$t},admin:{label:"Admin",color:"bg-yellow-500",icon:$t}}[t],d=c.icon,m=a?ze.find(g=>g.id===a):null,x=(m==null?void 0:m.icon)||"ðŸ˜Š",p=i?ze.find(g=>g.id===i):null,f=o?ze.find(g=>g.id===o):null,h=Gs(r);return e.jsxs(U,{className:"relative overflow-hidden",children:[p&&e.jsxs("div",{className:"absolute inset-0",children:[e.jsx("div",{className:"w-full h-full",style:{background:p.preview||"linear-gradient(135deg, #1e293b 0%, #334155 100%)"}}),e.jsx("div",{className:"absolute inset-0 bg-black/40"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-9xl opacity-20",children:p.icon})]}),e.jsx("div",{className:"relative p-6",children:e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"h-24 w-24 rounded-full bg-gradient-to-br from-primary to-secondary flex items-center justify-center text-5xl shadow-xl border-4 border-background",children:x}),e.jsx("div",{className:`absolute -bottom-1 -right-1 ${c.color} rounded-full p-2 shadow-lg border-2 border-background`,children:e.jsx(d,{className:"h-4 w-4 text-white"})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex flex-col gap-1 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:s}),e.jsx(le,{variant:"outline",className:`${c.color} text-white border-0`,children:c.label})]}),f&&e.jsxs("div",{className:"inline-flex items-center gap-2 mt-1 px-3 py-1 rounded-full bg-gradient-to-r from-sky-500/30 via-cyan-500/30 to-indigo-500/30 border border-cyan-400/60 shadow-md backdrop-blur",children:[e.jsx("span",{className:"text-lg drop-shadow",children:f.icon}),e.jsx("span",{className:"text-[11px] font-semibold tracking-wide uppercase text-cyan-100 drop-shadow-sm",children:f.preview||f.name})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"h-4 w-4 text-primary"}),e.jsxs("span",{className:"text-sm",children:["ELO: ",e.jsx("span",{className:"font-bold text-foreground",children:r})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($t,{className:"h-4 w-4 text-yellow-500"}),e.jsxs("span",{className:"text-sm",children:["Rang:"," ",e.jsxs("span",{className:"font-bold",style:{color:h.color},children:[h.icon," ",h.name]})]})]})]})]})]})})]})};function Em({wins:s,losses:t,fortune:r,totalEarned:n}){const a=s+t>0?Math.round(s/(s+t)*100):0,i=[{label:"Victoires",value:s,icon:Te,color:"text-primary",bgColor:"bg-primary/10"},{label:"DÃ©faites",value:t,icon:Ze,color:"text-secondary",bgColor:"bg-secondary/10"},{label:"Win Rate",value:`${a}%`,icon:si,color:"text-rarity-gold",bgColor:"bg-rarity-gold/10"},{label:"Fortune",value:`${r}â‚¬`,icon:Vt,color:"text-primary",bgColor:"bg-primary/10"}];return e.jsx("div",{className:"grid grid-cols-2 gap-3",children:i.map((o,l)=>e.jsx(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:l*.1},children:e.jsx(U,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`rounded-lg p-2 ${o.bgColor}`,children:e.jsx(o.icon,{className:`h-5 w-5 ${o.color}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:o.label}),e.jsx("p",{className:`text-xl font-bold ${o.color}`,children:o.value})]})]})})},o.label))})}const Rr={common:"bg-gray-500",rare:"bg-blue-500",epic:"bg-purple-500",legendary:"bg-orange-500"},Qa={common:"Commun",rare:"Rare",epic:"Ã‰pique",legendary:"LÃ©gendaire"},Js=[{id:"tueur_gamelle",name:"Tueur de Gamelles",description:"Gagner 10 matchs d'affilÃ©e",icon:"ðŸ”¥",rarity:"epic",reward:100},{id:"roi_jeudi",name:"Roi du Jeudi",description:"Gagner 5 matchs un jeudi",icon:"ðŸ‘‘",rarity:"rare",reward:50},{id:"millionnaire",name:"Millionnaire",description:"Atteindre 1000â‚¬ de fortune",icon:"ðŸ’°",rarity:"legendary",reward:200},{id:"collectionneur",name:"Collectionneur",description:"PossÃ©der 50 cartes uniques",icon:"ðŸŽ´",rarity:"epic",reward:150},{id:"parieur_fou",name:"Parieur Fou",description:"Gagner 10 paris",icon:"ðŸŽ²",rarity:"rare",reward:75}];function Rm({userId:s}){const[t,r]=u.useState([]),[n,a]=u.useState(!0),[i,o]=u.useState(!1),[l,c]=u.useState(null);u.useEffect(()=>{s&&d()},[s]);const d=async()=>{try{const f=await gr(s);r(f||[])}catch(f){b.error("Erreur chargement badges:",f),r([])}finally{a(!1)}},m=async()=>{o(!0);try{const f=await eo(s);f&&f.length>0?(await d(),f.forEach(h=>{const g=Js.find(v=>v.id===h.id);$({title:"ðŸŽ‰ Nouveau badge dÃ©bloquÃ© !",description:`${h.icon} ${h.name} - +${(g==null?void 0:g.reward)||0}â‚¬`})})):$({title:"Aucun nouveau badge",description:"Continue Ã  jouer pour dÃ©bloquer plus de badges !"})}catch(f){b.error("Erreur vÃ©rification achievements:",f),$({title:"Erreur",description:"Impossible de vÃ©rifier les achievements",variant:"destructive"})}finally{o(!1)}},x=t.map(f=>f.id),p=Math.round(t.length/Js.length*100);return n?e.jsx(U,{children:e.jsx(H,{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):e.jsxs(U,{children:[e.jsxs(he,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Gt,{className:"h-5 w-5 text-primary"}),e.jsx(fe,{children:"Badges & SuccÃ¨s"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"ComplÃ©tion"}),e.jsxs("p",{className:"text-lg font-bold text-primary",children:[p,"%"]})]}),e.jsx(T,{variant:"outline",size:"sm",onClick:m,disabled:i,children:i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary mr-2"}),"VÃ©rification..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Mt,{className:"h-4 w-4 mr-2"}),"VÃ©rifier"]})})]})]}),e.jsx(Jt,{value:p,className:"mt-2"})]}),e.jsxs(H,{children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3",children:Js.map(f=>{const h=x.includes(f.id),g=t.find(j=>j.id===f.id),v=l===f.id;return e.jsxs(W.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},whileHover:{scale:1.05},className:"relative",onMouseEnter:()=>c(f.id),onMouseLeave:()=>c(null),children:[e.jsxs("div",{className:`relative p-3 rounded-lg border-2 transition-all cursor-help ${h?"border-primary bg-primary/5":"border-border bg-surface-alt opacity-60"}`,children:[e.jsx("div",{className:`absolute top-1 right-1 w-2 h-2 rounded-full ${Rr[f.rarity]}`}),e.jsx("div",{className:`text-4xl text-center mb-2 ${!h&&"grayscale"}`,children:h?f.icon:"ðŸ”’"}),e.jsx("p",{className:"text-xs font-bold text-center mb-1 line-clamp-2",children:f.name}),h?e.jsx("div",{className:"text-center",children:e.jsx(le,{variant:"default",className:"text-[10px] py-0 px-1 bg-green-500",children:"âœ“"})}):e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(Wt,{className:"h-3 w-3 text-muted-foreground"})})]}),v&&e.jsx(W.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 z-50 pointer-events-none",children:e.jsxs("div",{className:"bg-popover border-2 border-primary/50 rounded-lg p-3 shadow-2xl whitespace-nowrap min-w-[200px]",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 pb-2 border-b border-border",children:[e.jsx("span",{className:"text-2xl",children:h?f.icon:"ðŸ”’"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-bold text-foreground",children:f.name}),e.jsx(le,{className:`${Rr[f.rarity]} text-white text-[10px] mt-0.5`,children:Qa[f.rarity]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ht,{className:"h-3 w-3 text-primary mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:f.description})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-border",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"RÃ©compense"}),e.jsxs("span",{className:"text-sm font-bold text-primary",children:[f.reward,"â‚¬"]})]}),h&&g&&e.jsxs("div",{className:"flex items-center justify-between pt-1",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"DÃ©bloquÃ© le"}),e.jsx("span",{className:"text-xs text-green-400 font-medium",children:new Date(g.unlockedAt).toLocaleDateString("fr-FR",{day:"2-digit",month:"short",year:"numeric"})})]})]}),e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 -mt-[1px]",children:e.jsx("div",{className:"border-8 border-transparent border-t-primary/50"})})]})})]},f.id)})}),t.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Gt,{className:"h-12 w-12 mx-auto mb-3 text-muted-foreground opacity-50"}),e.jsx("p",{className:"text-muted-foreground mb-3",children:"Aucun badge dÃ©bloquÃ© pour le moment"}),e.jsx(T,{onClick:m,disabled:i,children:"VÃ©rifier mes accomplissements"})]}),t.length>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-border",children:[e.jsx("h4",{className:"text-sm font-semibold mb-2",children:"Badges rÃ©cents"}),e.jsx("div",{className:"space-y-2",children:t.sort((f,h)=>h.unlockedAt-f.unlockedAt).slice(0,3).map(f=>{const h=Js.find(g=>g.id===f.id);return h?e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg bg-surface-alt",children:[e.jsx("div",{className:"text-2xl",children:h.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:h.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:h.description}),e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:new Date(f.unlockedAt).toLocaleDateString("fr-FR")})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(le,{className:Rr[h.rarity],children:Qa[h.rarity]}),e.jsxs("p",{className:"text-xs text-primary font-bold mt-1",children:["+",h.reward,"â‚¬"]})]})]},f.id):null})})]})]})]})}async function Dt(s,t,r,n,a){try{const i=k(_,`notifications/${s}`),o=xt(i);await ce(o,{type:t,title:r,message:n,relatedId:a||"",read:!1,createdAt:Date.now()}),b.log(`âœ… Notification envoyÃ©e Ã  ${s}: ${r}`)}catch(i){throw b.error("âŒ Erreur crÃ©ation notification:",i),i}}async function $m(s,t,r){await Dt(s,"offer_accepted","Offre acceptÃ©e âœ…",`${t} a acceptÃ© votre offre pour ${r}`,void 0)}async function Am(s,t,r){await Dt(s,"offer_rejected","Offre refusÃ©e",`${t} a refusÃ© votre offre pour ${r}`,void 0)}async function Mm(s,t,r,n){await Dt(s,"offer_countered","Contre-offre reÃ§ue",`${t} propose ${r}â‚¬ pour ${n}`,void 0)}async function Tm(s,t,r,n){await Dt(s,"new_message",`Message de ${t}`,r,n)}async function Pm(s,t,r){const n=r>0?`+${r} ELO`:`${r} ELO`;await Dt(s,"match_completed","Match terminÃ©",`${t} â€¢ ${n}`,void 0)}async function Om(s,t,r){await Dt(s,"tournament_starting","Tournoi sur le point de commencer",`${t} dÃ©bute ${r}`,void 0)}async function Lm(s,t,r){await Dt(s,t?"bet_won":"bet_lost",t?"Pari gagnÃ©! ðŸŽ‰":"Pari perdu",t?`Vous avez gagnÃ© ${r}â‚¬!`:`Vous avez perdu ${r}â‚¬`,void 0)}async function Qr(s,t,r){await Dt(s,"admin_announcement",`ðŸ“¢ ${t}`,r,void 0)}const Im=s=>{switch(s){case"tournament_entry":return"ðŸŽ«";case"tournament_prize":return"ðŸ†";case"match_win":return"âœ…";case"match_loss":return"âŒ";case"bet_win":return"ðŸ’°";case"bet_loss":return"ðŸ“‰";case"daily_bonus":return"ðŸŽ";case"admin_adjustment":return"âš™ï¸";case"card_sale":return"ðŸ’³";case"card_purchase":return"ðŸ›’";case"shop_purchase":return"ðŸ›ï¸";default:return"ðŸ’µ"}},Dm=(s,t)=>t==="tournament_entry"?"text-orange-500":t==="tournament_prize"||s>0?"text-green-500":s<0?"text-red-500":"text-muted-foreground";function Fm({userId:s}){var h,g;const[t,r]=u.useState([]),[n,a]=u.useState(7),[i,o]=u.useState(!0);u.useEffect(()=>{l()},[s,n]);const l=async()=>{o(!0);try{const v=await Ji(s,n);r(v)}catch(v){b.error("Erreur chargement historique:",v)}finally{o(!1)}},c=((h=t[t.length-1])==null?void 0:h.fortune)||0,d=((g=t[0])==null?void 0:g.fortune)||0,m=c-d,x=d>0?(m/d*100).toFixed(1):0,p=t.map(v=>({date:new Date(v.timestamp).toLocaleDateString("fr-FR",{month:"short",day:"numeric"}),fortune:v.fortune,timestamp:v.timestamp})),f=({active:v,payload:j})=>v&&j&&j.length?e.jsxs("div",{className:"bg-card border border-border p-3 rounded-lg shadow-lg",children:[e.jsxs("p",{className:"font-bold text-primary",children:[j[0].value,"â‚¬"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:j[0].payload.date})]}):null;return i?e.jsx(U,{children:e.jsx(H,{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):t.length===0?e.jsxs(U,{children:[e.jsx(he,{children:e.jsxs(fe,{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"h-5 w-5 text-primary"}),"Historique de Fortune"]})}),e.jsxs(H,{className:"text-center py-8",children:[e.jsx(vs,{className:"h-12 w-12 mx-auto mb-3 text-muted-foreground opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:"Aucune donnÃ©e d'historique disponible"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Commence Ã  jouer pour voir ton Ã©volution !"})]})]}):e.jsxs(U,{children:[e.jsx(he,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"h-5 w-5 text-primary"}),e.jsx(fe,{children:"Historique de Fortune"})]}),e.jsx("div",{className:"flex gap-2",children:[1,7,30].map(v=>e.jsxs("button",{onClick:()=>a(v),className:`px-3 py-1 rounded-lg text-sm font-medium transition-colors ${n===v?"bg-primary text-primary-foreground":"bg-surface-alt text-muted-foreground hover:bg-surface"}`,children:[v,"j"]},v))})]})}),e.jsxs(H,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-surface-alt",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Ã‰volution"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:`text-xl font-bold ${m>=0?"text-green-500":"text-red-500"}`,children:[m>=0?"+":"",m,"â‚¬"]}),m>=0?e.jsx(Ie,{className:"h-4 w-4 text-green-500"}):e.jsx(cs,{className:"h-4 w-4 text-red-500"})]}),e.jsxs("p",{className:`text-xs ${m>=0?"text-green-500":"text-red-500"}`,children:[m>=0?"+":"",x,"%"]})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-surface-alt",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Transactions"}),e.jsx("p",{className:"text-xl font-bold",children:t.length}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.filter(v=>v.change>0).length," â†‘ / ",t.filter(v=>v.change<0).length," â†“"]})]})]}),e.jsx("div",{className:"h-48 w-full",children:e.jsx(Il,{width:"100%",height:"100%",children:e.jsxs(Dl,{data:p,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"fortuneGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"hsl(var(--primary))",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"hsl(var(--primary))",stopOpacity:0})]})}),e.jsx(Fl,{strokeDasharray:"3 3",stroke:"hsl(var(--border))",opacity:.3}),e.jsx(zl,{dataKey:"date",stroke:"hsl(var(--muted-foreground))",style:{fontSize:"10px"},tick:{fill:"hsl(var(--muted-foreground))"}}),e.jsx(Bl,{stroke:"hsl(var(--muted-foreground))",style:{fontSize:"10px"},tick:{fill:"hsl(var(--muted-foreground))"}}),e.jsx(Ul,{content:e.jsx(f,{})}),e.jsx(ql,{type:"monotone",dataKey:"fortune",stroke:"hsl(var(--primary))",strokeWidth:2,fill:"url(#fortuneGradient)"})]})})}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-border",children:[e.jsx("h4",{className:"text-sm font-semibold mb-2",children:"Transactions rÃ©centes"}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:t.slice(-5).reverse().map((v,j)=>{var M,P,C;return e.jsxs(W.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:j*.05},className:"flex items-center justify-between p-2 rounded-lg bg-surface-alt text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:Im(v.type||"")}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-xs",children:v.reason}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:new Date(v.timestamp).toLocaleDateString("fr-FR",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"})}),((M=v.metadata)==null?void 0:M.position)&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Position: ",v.metadata.position," â€¢ Cagnotte: ",v.metadata.prizePool,"â‚¬"]}),((P=v.metadata)==null?void 0:P.mode)==="duo"&&((C=v.metadata)==null?void 0:C.partnerName)&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Avec ",v.metadata.partnerName]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:`font-bold text-xs ${Dm(v.change,v.type||"")}`,children:[v.change>0?"+":"",v.change,"â‚¬"]})})]},j)})})]})]})]})}function zm({userId:s}){var m,x,p;const t=mt(),[r,n]=u.useState(null),[a,i]=u.useState(!0),[o,l]=u.useState(0);u.useEffect(()=>{c()},[s]);const c=async()=>{var f;i(!0);try{const h=k(_,`users/${s}`),g=await q(h);if(g.exists()){const v=g.val();if(v.clubId){const j=k(_,`clubs/${v.clubId}`),M=await q(j);if(M.exists()){const P=M.val();n({id:v.clubId,...P}),l(((f=P.members)==null?void 0:f.length)||0)}}}}catch(h){b.error("Erreur chargement club:",h)}finally{i(!1)}};if(a)return e.jsx(U,{children:e.jsx(H,{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});if(!r)return e.jsxs(U,{children:[e.jsx(he,{children:e.jsxs(fe,{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-5 w-5 text-primary"}),"Mon Club"]})}),e.jsxs(H,{className:"text-center py-8",children:[e.jsx(Re,{className:"h-12 w-12 mx-auto mb-3 text-muted-foreground opacity-50"}),e.jsx("p",{className:"text-muted-foreground mb-3",children:"Tu ne fais partie d'aucun club"}),e.jsx(T,{onClick:()=>t("/clubs"),variant:"neon",children:"CrÃ©er ou rejoindre un club"})]})]});const d=r.bonuses?Object.values(r.bonuses).filter(Boolean).length:0;return e.jsxs(U,{className:"relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-1",style:{backgroundColor:r.color}}),e.jsx(he,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-5 w-5 text-primary"}),e.jsx(fe,{children:"Mon Club"})]}),e.jsx(T,{variant:"ghost",size:"sm",onClick:()=>t("/clubs"),children:e.jsx(Vl,{className:"h-4 w-4"})})]})}),e.jsx(H,{children:e.jsxs(W.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4 p-3 rounded-lg bg-surface-alt",children:[e.jsx("div",{className:"text-4xl w-14 h-14 flex items-center justify-center rounded-lg",style:{backgroundColor:r.color+"20"},children:r.logo}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-lg",children:r.name}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(Re,{className:"h-3 w-3"}),o," membre",o>1?"s":""]}),r.founderId===s&&e.jsxs(le,{variant:"outline",className:"text-xs",children:[e.jsx($t,{className:"h-3 w-3 mr-1"}),"Fondateur"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-surface-alt",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"TrÃ©sorerie"}),e.jsxs("p",{className:"text-xl font-bold text-primary",children:[r.treasury||0,"â‚¬"]})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-surface-alt",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total gagnÃ©"}),e.jsxs("p",{className:"text-xl font-bold text-green-500",children:[r.totalEarnings||0,"â‚¬"]})]})]}),d>0?e.jsxs("div",{className:"p-3 rounded-lg bg-primary/5 border border-primary/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ie,{className:"h-4 w-4 text-primary"}),e.jsx("p",{className:"text-sm font-semibold",children:"Bonus actifs"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[((m=r.bonuses)==null?void 0:m.xpBoost)&&e.jsx(le,{variant:"default",className:"text-xs",children:"+20% ELO"}),((x=r.bonuses)==null?void 0:x.fortuneBoost)&&e.jsx(le,{variant:"default",className:"text-xs",children:"+15% Fortune"}),((p=r.bonuses)==null?void 0:p.premiumCards)&&e.jsx(le,{variant:"default",className:"text-xs",children:"x2 Cartes rares"})]})]}):e.jsx("div",{className:"p-3 rounded-lg bg-surface-alt",children:e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Aucun bonus actif â€¢ Contribuez pour dÃ©bloquer des avantages"})}),e.jsx(T,{onClick:()=>t("/clubs"),variant:"outline",className:"w-full",children:"Voir le club"})]})})]})}const Fe=bl,nr=yl,Bm=pl,go=u.forwardRef(({className:s,...t},r)=>e.jsx(An,{ref:r,className:de("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...t}));go.displayName=An.displayName;const Pe=u.forwardRef(({className:s,children:t,...r},n)=>e.jsxs(Bm,{children:[e.jsx(go,{}),e.jsxs(Mn,{ref:n,className:de("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...r,children:[t,e.jsxs(gl,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[e.jsx(Ze,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Pe.displayName=Mn.displayName;const Oe=({className:s,...t})=>e.jsx("div",{className:de("flex flex-col space-y-1.5 text-center sm:text-left",s),...t});Oe.displayName="DialogHeader";const Le=u.forwardRef(({className:s,...t},r)=>e.jsx(Tn,{ref:r,className:de("text-lg font-semibold leading-none tracking-tight",s),...t}));Le.displayName=Tn.displayName;const Je=u.forwardRef(({className:s,...t},r)=>e.jsx(Pn,{ref:r,className:de("text-sm text-muted-foreground",s),...t}));Je.displayName=Pn.displayName;const Um={common:"bg-gray-500",rare:"bg-blue-500",epic:"bg-purple-500",legendary:"bg-orange-500"};function qm({friendId:s,friendUsername:t,isOpen:r,onClose:n,onRemoveFriend:a,canRemove:i=!0}){const[o,l]=u.useState(null),[c,d]=u.useState([]),[m,x]=u.useState({totalCards:0,uniqueCards:0,rareCards:0}),[p,f]=u.useState(null),[h,g]=u.useState(!0);u.useEffect(()=>{!r||!s||v()},[r,s]);const v=async()=>{var I;g(!0);try{const O=k(_,`users/${s}`),w=await q(O);if(w.exists()){const E=w.val();l({username:E.username||t,role:E.role||"player",eloRating:E.eloRating||1e3,wins:E.wins||0,losses:E.losses||0,fortune:E.fortune||0,totalEarned:E.totalEarned||0,createdAt:E.createdAt||new Date().toISOString(),clubId:E.clubId});const V=await gr(s);d(V||[]);const A=await qi(s);if(x(A),E.clubId){const B=k(_,`clubs/${E.clubId}`),S=await q(B);if(S.exists()){const J=S.val();f({name:J.name,logo:J.logo,color:J.color,memberCount:((I=J.members)==null?void 0:I.length)||0})}}else f(null)}}catch(O){b.error("Erreur chargement profil ami:",O),$({title:"Erreur",description:"Impossible de charger le profil",variant:"destructive"})}finally{g(!1)}},j=()=>{a&&o&&(a(s,o.username),n())};if(!r)return null;const M={player:{label:"Joueur",icon:Te,color:"text-primary"},agent:{label:"Agent",icon:ds,color:"text-yellow-500"},admin:{label:"Admin",icon:$t,color:"text-gold"}},P=o&&o.wins+o.losses>0?Math.round(o.wins/(o.wins+o.losses)*100):0,C=Math.round(c.length/5*100);return e.jsx(Fe,{open:r,onOpenChange:n,children:e.jsxs(Pe,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Oe,{children:e.jsxs(Le,{className:"flex items-center justify-between",children:[e.jsxs("span",{children:["Profil de ",t]}),i&&a&&e.jsxs(T,{variant:"ghost",size:"sm",onClick:j,className:"text-destructive hover:text-destructive",children:[e.jsx(Gl,{className:"h-4 w-4 mr-2"}),"Retirer"]})]})}),h?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ue,{className:"h-8 w-8 animate-spin text-primary"})}):o?e.jsxs("div",{className:"space-y-6",children:[e.jsx(U,{children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx(W.div,{whileHover:{scale:1.05},className:"relative",children:e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-primary to-secondary flex items-center justify-center text-3xl font-bold shadow-lg",children:o.username.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h2",{className:"text-2xl font-bold",children:o.username}),e.jsxs(le,{variant:"outline",className:"gap-1",children:[(()=>{const I=M[o.role].icon;return I?e.jsx(I,{className:`h-3 w-3 ${M[o.role].color}`}):null})(),M[o.role].label]})]}),e.jsx("div",{className:"flex items-center gap-4 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(vt,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-muted-foreground",children:"ELO:"}),e.jsx("span",{className:"font-bold text-primary",children:o.eloRating})]})})]})]})})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(U,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"rounded-lg p-2 bg-primary/10",children:e.jsx(Te,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Victoires"}),e.jsx("p",{className:"text-xl font-bold text-primary",children:o.wins})]})]})}),e.jsx(U,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"rounded-lg p-2 bg-secondary/10",children:e.jsx(Ze,{className:"h-5 w-5 text-secondary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"DÃ©faites"}),e.jsx("p",{className:"text-xl font-bold text-secondary",children:o.losses})]})]})}),e.jsx(U,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"rounded-lg p-2 bg-gold/10",children:e.jsx(si,{className:"h-5 w-5 text-gold"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Win Rate"}),e.jsxs("p",{className:"text-xl font-bold text-gold",children:[P,"%"]})]})]})}),e.jsx(U,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"rounded-lg p-2 bg-primary/10",children:e.jsx(Vt,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Fortune"}),e.jsxs("p",{className:"text-xl font-bold text-primary",children:[o.fortune,"â‚¬"]})]})]})})]}),e.jsx(U,{children:e.jsxs(H,{className:"p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold mb-3 flex items-center gap-2",children:[e.jsx(ds,{className:"h-4 w-4 text-primary"}),"Collection de Cartes"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"text-center p-3 rounded-lg bg-surface-alt",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:m.totalCards}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total"})]}),e.jsxs("div",{className:"text-center p-3 rounded-lg bg-surface-alt",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:m.uniqueCards}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Uniques"})]}),e.jsxs("div",{className:"text-center p-3 rounded-lg bg-surface-alt",children:[e.jsx("p",{className:"text-2xl font-bold text-gold",children:m.rareCards}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Rares"})]})]})]})}),p&&e.jsx(U,{children:e.jsxs(H,{className:"p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold mb-3 flex items-center gap-2",children:[e.jsx(Re,{className:"h-4 w-4 text-primary"}),"Club"]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-surface-alt",children:[e.jsx("div",{className:"text-3xl w-12 h-12 flex items-center justify-center rounded-lg",style:{backgroundColor:p.color+"20"},children:p.logo}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-bold",children:p.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[p.memberCount," membre",p.memberCount>1?"s":""]})]})]})]})}),e.jsx(U,{children:e.jsxs(H,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(Gt,{className:"h-4 w-4 text-primary"}),"Badges & SuccÃ¨s"]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[C,"% complet"]})]}),e.jsx(Jt,{value:C,className:"mb-4"}),c.length>0?e.jsx("div",{className:"grid grid-cols-5 gap-2",children:c.map(I=>e.jsxs(W.div,{whileHover:{scale:1.05},className:"relative p-2 rounded-lg border-2 border-primary bg-primary/5",children:[e.jsx("div",{className:`absolute top-0.5 right-0.5 w-1.5 h-1.5 rounded-full ${Um[I.rarity]}`}),e.jsx("div",{className:"text-2xl text-center mb-1",children:I.icon}),e.jsx("p",{className:"text-[10px] font-bold text-center line-clamp-1",children:I.name})]},I.id))}):e.jsx("p",{className:"text-center text-muted-foreground text-sm py-4",children:"Aucun badge dÃ©bloquÃ©"})]})}),e.jsx(U,{children:e.jsxs(H,{className:"p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold mb-3 flex items-center gap-2",children:[e.jsx(jt,{className:"h-4 w-4 text-primary"}),"Informations"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Membre depuis"}),e.jsx("span",{className:"font-medium",children:new Date(o.createdAt).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric"})})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total gagnÃ©"}),e.jsxs("span",{className:"font-medium text-green-500",children:[o.totalEarned,"â‚¬"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Matchs jouÃ©s"}),e.jsx("span",{className:"font-medium",children:o.wins+o.losses})]})]})]})})]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"Profil introuvable"})})]})})}const gt=u.forwardRef(({className:s,...t},r)=>e.jsx(On,{className:de("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",s),...t,ref:r,children:e.jsx(vl,{className:de("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));gt.displayName=On.displayName;const Vm=hr("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),bt=u.forwardRef(({className:s,...t},r)=>e.jsx(Ln,{ref:r,className:de(Vm(),s),...t}));bt.displayName=Ln.displayName;async function Gm(s,t,r){try{const n=k(_,`users/${r}`);if(!(await q(n)).exists())throw new Error("Utilisateur introuvable");const i=k(_,`friendRequests/${s}_${r}`);if((await q(i)).exists())throw new Error("Demande d'ami dÃ©jÃ  envoyÃ©e");const l=k(_,`friends/${s}/${r}`);if((await q(l)).exists())throw new Error("Vous Ãªtes dÃ©jÃ  amis");const d=`${s}_${r}`,m={id:d,from:s,fromUsername:t,to:r,status:"pending",timestamp:Date.now()};await $e(k(_,`friendRequests/${d}`),m)}catch(n){throw b.error("Erreur lors de l'envoi de la demande:",n),n}}async function Hm(s){try{const t=k(_,`friendRequests/${s}`),r=await q(t);if(!r.exists())throw new Error("Demande introuvable");const n=r.val(),a=k(_,`users/${n.from}`),i=k(_,`users/${n.to}`),[o,l]=await Promise.all([q(a),q(i)]);if(!o.exists()||!l.exists())throw new Error("Utilisateur introuvable");const c=o.val(),d=l.val(),m=Vr(c),x=Vr(d),p={};p[`friends/${n.from}/${n.to}`]={id:n.to,username:x.username,eloRating:x.eloRating||1e3,avatar:x.avatar||null,addedAt:Date.now()},p[`friends/${n.to}/${n.from}`]={id:n.from,username:m.username,eloRating:m.eloRating||1e3,avatar:m.avatar||null,addedAt:Date.now()},p[`friendRequests/${s}/status`]="accepted",await ce(k(_),p)}catch(t){throw b.error("Erreur lors de l'acceptation:",t),t}}async function Zm(s){try{await ce(k(_,`friendRequests/${s}`),{status:"declined"})}catch(t){throw b.error("Erreur lors du refus:",t),t}}async function Wm(s,t){try{const r={};r[`friends/${s}/${t}`]=null,r[`friends/${t}/${s}`]=null,await ce(k(_),r)}catch(r){throw b.error("Erreur lors de la suppression:",r),r}}async function Qm(s){try{const t=k(_,`friends/${s}`),r=await q(t);if(!r.exists())return[];const n=r.val(),a=[];for(const[i,o]of Object.entries(n)){const l=o,c=k(_,`userStatus/${i}`),d=await q(c),m=d.exists()?d.val().status:"offline",x=d.exists()?d.val().lastSeen:null;a.push({id:i,username:l.username||"Unknown",eloRating:l.eloRating||1e3,avatar:l.avatar,status:m,lastSeen:x})}return a}catch(t){return b.error("Erreur lors de la rÃ©cupÃ©ration des amis:",t),[]}}async function $r(s){try{const t=k(_,"friendRequests"),r=await q(t);if(!r.exists())return[];const n=r.val(),a=[];for(const[i,o]of Object.entries(n)){const l=o;l.to===s&&l.status==="pending"&&a.push({...l,id:i})}return a.sort((i,o)=>o.timestamp-i.timestamp)}catch(t){return b.error("Erreur lors de la rÃ©cupÃ©ration des demandes:",t),[]}}function Jm(s,t){const r=k(_,`friends/${s}`);return et(r,async a=>{if(!a.exists()){t([]);return}const i=a.val(),o=[];for(const[l,c]of Object.entries(i)){const d=c,m=k(_,`userStatus/${l}`),x=await q(m),p=x.exists()?x.val().status:"offline",f=x.exists()?x.val().lastSeen:null;o.push({id:l,username:d.username||"Unknown",eloRating:d.eloRating||1e3,avatar:d.avatar,status:p,lastSeen:f})}t(o)})}const Ar={notifications:{enabled:!0,matchReminders:!0,friendRequests:!0,achievements:!0},sound:{enabled:!0,volume:50},privacy:{profilePublic:!0,showStats:!0,allowFriendRequests:!0,showOnlineStatus:!0},appearance:{darkMode:!0,language:"fr"}};async function bo(s){try{const t=k(_,`userSettings/${s}`),r=await q(t);return r.exists()?r.val():(await $e(t,Ar),Ar)}catch(t){return b.error("Erreur lors de la rÃ©cupÃ©ration des paramÃ¨tres:",t),Ar}}async function Ym(s,t){try{const r=k(_,`userSettings/${s}`),n=await bo(s),a={...n,...t,notifications:{...n.notifications,...t.notifications},sound:{...n.sound,...t.sound},privacy:{...n.privacy,...t.privacy},appearance:{...n.appearance,...t.appearance}};await $e(r,a)}catch(r){throw b.error("Erreur lors de la mise Ã  jour des paramÃ¨tres:",r),r}}async function Km(s,t){try{const r=k(_,"users"),n=await q(r);if(!n.exists())return[];const a=n.val(),i=[];for(const[o,l]of Object.entries(a)){const c=l;if(o===t)continue;const d=c.username||"";d.toLowerCase().includes(s.toLowerCase())&&i.push({id:o,username:d,eloRating:c.eloRating||1e3,avatar:c.avatar,status:"offline"})}return i}catch(r){return b.error("Erreur lors de la recherche:",r),[]}}function Jr(s=new Date){const t=s.getFullYear(),r=s.getMonth(),n=new Date(t,r+1,1),a=new Date(n.getTime()-1);let i=new Date(a);for(;i.getDay()!==6;)i.setDate(i.getDate()-1);let o=new Date(i);return o.setDate(o.getDate()+1),{start:i,end:o}}function yo(){const s=new Date,t=Jr(s);return s>=t.start&&s<=t.end}function Ls(){const s=new Date,t=Jr(s);if(s>=t.start&&s<=t.end)return 0;if(s>t.end){const r=new Date(s.getFullYear(),s.getMonth()+1,15),n=Jr(r);return Math.ceil((n.start.getTime()-s.getTime())/(1e3*60*60*24))}return Math.ceil((t.start.getTime()-s.getTime())/(1e3*60*60*24))}function vo(s){const t=Ur(s);return Math.round(s*t)}async function Xm(s){try{const t=k(_,`users/${s}`),r=await q(t);if(!r.exists())return{bettingGains:0,taxesDue:0,taxesPaid:!1,lastTaxPaymentDate:Date.now(),latePenalty:!1,daysUntilNextTax:Ls()};const n=r.val(),a=n.bettingGains||0,i=n.taxesPaidThisMonth||!1,o=n.lastTaxPaymentDate||0,l=vo(a);return{bettingGains:a,taxesDue:l,taxesPaid:i,lastTaxPaymentDate:o,latePenalty:!1,daysUntilNextTax:Ls()}}catch(t){return b.error("Erreur rÃ©cupÃ©ration infos fiscales:",t),{bettingGains:0,taxesDue:0,taxesPaid:!1,lastTaxPaymentDate:Date.now(),latePenalty:!1,daysUntilNextTax:Ls()}}}async function ex(s){try{if(!yo())return{success:!1,message:`Les taxes ne peuvent Ãªtre payÃ©es que le dernier week-end du mois. ${Ls()} jour(s) restant(s).`};const t=k(_,`users/${s}`),r=await q(t);if(!r.exists())return{success:!1,message:"Utilisateur non trouvÃ©"};const n=r.val();if(n.taxesPaidThisMonth)return{success:!1,message:"Vous avez dÃ©jÃ  payÃ© vos taxes ce mois-ci."};const a=n.bettingGains||0,i=n.fortune||0,o=vo(a);if(i<o)return{success:!1,message:`Fonds insuffisants. Vous avez besoin de ${o}â‚¬ (vous en avez ${i}â‚¬)`};const l=i-o,c={};return c[`users/${s}/fortune`]=l,c[`users/${s}/taxesPaidThisMonth`]=!0,c[`users/${s}/lastTaxPaymentDate`]=Date.now(),c[`users/${s}/totalTaxesPaid`]=(n.totalTaxesPaid||0)+o,await ce(k(_),c),await Be(s,l,-o,`Paiement de taxes (${taxRate}% sur ${a}â‚¬ de gains)`),{success:!0,message:`${o}â‚¬ de taxes payÃ©es avec succÃ¨s`}}catch(t){return b.error("Erreur paiement taxes:",t),{success:!1,message:t.message||"Erreur lors du paiement des taxes"}}}function tx(s){const t=document.documentElement,n=(a=>{a=a.replace("#","");const i=parseInt(a.substring(0,2),16)/255,o=parseInt(a.substring(2,4),16)/255,l=parseInt(a.substring(4,6),16)/255,c=Math.max(i,o,l),d=Math.min(i,o,l);let m=0,x=0,p=(c+d)/2;if(c!==d){const f=c-d;switch(x=p>.5?f/(2-c-d):f/(c+d),c){case i:m=((o-l)/f+(o<l?6:0))/6;break;case o:m=((l-i)/f+2)/6;break;case l:m=((i-o)/f+4)/6;break}}return{h:Math.round(m*360),s:Math.round(x*100),l:Math.round(p*100)}})(s);t.style.setProperty("--primary",`${n.h} ${n.s}% ${n.l}%`),t.style.setProperty("--primary-foreground",`0 0% ${n.l>50?10:98}%`),t.style.setProperty("--primary-hover",`${n.h} ${n.s}% ${Math.max(n.l-10,0)}%`),t.style.setProperty("--primary-active",`${n.h} ${n.s}% ${Math.max(n.l-20,0)}%`),t.style.setProperty("--secondary",`${(n.h+180)%360} ${n.s}% ${n.l}%`),t.style.setProperty("--accent",`${(n.h+30)%360} ${n.s}% ${n.l}%`)}const sx=({userId:s,fortune:t,bettingGains:r})=>{const[n,a]=u.useState(!1),[i,o]=u.useState(null),l=async()=>{a(!0);try{const j=await Xm(s);o(j)}catch(j){b.error("Erreur chargement taxes:",j)}finally{a(!1)}};!i&&!n&&l();const c=Ur(r),d=Math.round(r*c),m=Ls(),x=yo(),p=i==null?void 0:i.taxesPaid,f=!p&&x&&t>=d,g=(j=>j>=2e3?{next:null,toNext:0,color:"text-red-500",bgColor:"bg-red-500/10",borderColor:"border-red-500/30"}:j>=1e3?{next:2e3,toNext:2e3-j,color:"text-orange-500",bgColor:"bg-orange-500/10",borderColor:"border-orange-500/30"}:j>=100?{next:1e3,toNext:1e3-j,color:"text-yellow-500",bgColor:"bg-yellow-500/10",borderColor:"border-yellow-500/30"}:{next:100,toNext:100-j,color:"text-green-500",bgColor:"bg-green-500/10",borderColor:"border-green-500/30"})(r),v=async()=>{if(f){a(!0);try{const j=await ex(s);j.success?($({title:"Paiement rÃ©ussi! ðŸ’¸",description:j.message}),l()):$({title:"Erreur",description:j.message,variant:"destructive"})}catch(j){$({title:"Erreur",description:j.message,variant:"destructive"})}finally{a(!1)}}};return i?e.jsxs(U,{className:`border-2 ${g.borderColor} bg-gradient-to-br from-secondary/5 to-transparent`,children:[e.jsx(he,{children:e.jsxs(fe,{className:"flex items-center gap-2 text-secondary",children:[e.jsx(ls,{className:"h-5 w-5"}),"SystÃ¨me Fiscal - Dernier Week-end du Mois"]})}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-surface-alt border border-border",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Statut"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Ce mois-ci"})]}),p?e.jsx(le,{className:"bg-green-500/20 text-green-400 border border-green-500/50",children:"âœ“ PAYÃ‰"}):x?e.jsx(le,{className:"bg-yellow-500/20 text-yellow-400 border border-yellow-500/50 animate-pulse",children:"â° EN COURS"}):e.jsx(le,{className:"bg-muted text-muted-foreground",children:"â³ NON DISPONIBLE"})]}),p&&e.jsx("div",{className:"p-3 rounded-lg bg-green-500/10 border border-green-500/30",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ht,{className:"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-green-400 mb-1",children:"âœ“ Taxes PayÃ©es"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Vous avez dÃ©jÃ  payÃ© vos taxes ce mois-ci. Prochain paiement possible le mois prochain."})]})]})}),e.jsxs("div",{className:`p-4 rounded-lg ${g.bgColor} border ${g.borderColor}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Taxes Ã  payer"}),e.jsxs("span",{className:`text-3xl font-bold ${g.color}`,children:[p?"0":d,"â‚¬"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:"Taux actuel"}),e.jsxs("span",{className:`font-bold ${g.color}`,children:[Math.round(c*100),"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs mt-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"BasÃ© sur vos gains de paris"}),e.jsxs("span",{className:"font-medium",children:[r,"â‚¬"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs mt-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"Fortune actuelle"}),e.jsxs("span",{className:"font-medium",children:[t,"â‚¬"]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Prochaine pÃ©riode de paiement"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:x?"ðŸ”´ EN COURS":`${m} jour(s)`})]}),x?e.jsxs("div",{className:"p-3 rounded-lg bg-yellow-500/10 border border-yellow-500/30",children:[e.jsx("p",{className:"text-xs font-semibold text-yellow-400",children:"â° Le dernier week-end du mois est ACTIF !"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Vous pouvez payer vos taxes maintenant jusqu'Ã  dimanche minuit."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"relative h-3 bg-gray-700 rounded-full overflow-hidden mb-2",children:e.jsx("div",{className:"absolute inset-y-0 left-0 bg-gradient-to-r from-blue-500 via-cyan-500 to-blue-500 transition-all duration-500 rounded-full",style:{width:`${Math.max(5,(30-m)/30*100)}%`}})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Les taxes peuvent Ãªtre payÃ©es le dernier week-end du mois (samedi-dimanche)."})]})]}),g.next&&e.jsxs("div",{className:"p-3 rounded-lg bg-surface-alt border border-border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ie,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-medium",children:"Progression vers prochaine tranche"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Encore ",e.jsxs("span",{className:"font-bold text-primary",children:[g.toNext,"â‚¬"]})," de gains pour atteindre la tranche Ã  ",Math.round(Ur(g.next)*100),"%"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(Ht,{className:"h-4 w-4"}),"BarÃ¨me d'imposition"]}),e.jsx("div",{className:"space-y-1.5",children:[{range:"0â‚¬ - 99â‚¬",rate:10,current:r<100},{range:"100â‚¬ - 999â‚¬",rate:15,current:r>=100&&r<1e3},{range:"1000â‚¬ - 1999â‚¬",rate:19,current:r>=1e3&&r<2e3},{range:"2000â‚¬+",rate:23,current:r>=2e3}].map(j=>e.jsxs("div",{className:`flex justify-between p-2.5 rounded-lg text-sm transition-all ${j.current?"bg-secondary/20 border-2 border-secondary/40 font-bold":"bg-surface-alt border border-transparent"}`,children:[e.jsx("span",{className:j.current?"text-foreground":"text-muted-foreground",children:j.range}),e.jsxs("span",{className:j.current?"text-secondary":"text-muted-foreground",children:[j.rate,"%"]})]},j.range))})]}),!x&&e.jsx("div",{className:"p-3 rounded-lg bg-blue-500/10 border border-blue-500/30",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ht,{className:"h-4 w-4 text-blue-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs font-semibold text-blue-400 mb-1",children:"â„¹ï¸ Paiement indisponible"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Les taxes ne peuvent Ãªtre payÃ©es que le dernier week-end du mois. Revenez dans ",m," jour(s)."]})]})]})}),f?e.jsx(T,{className:"w-full bg-green-600 hover:bg-green-700",onClick:v,disabled:n,children:n?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"h-4 w-4 animate-spin mr-2"}),"Paiement en cours..."]}):e.jsxs(e.Fragment,{children:["ðŸ’¸ Payer ",d,"â‚¬ de taxes"]})}):p?e.jsx(T,{variant:"outline",className:"w-full opacity-50 cursor-not-allowed",disabled:!0,children:"âœ“ DÃ©jÃ  payÃ© ce mois-ci"}):x?t<d?e.jsxs(T,{variant:"outline",className:"w-full opacity-50 cursor-not-allowed",disabled:!0,children:["Fonds insuffisants (",t,"â‚¬ / ",d,"â‚¬)"]}):null:e.jsxs(T,{variant:"outline",className:"w-full opacity-50 cursor-not-allowed",disabled:!0,children:["â³ Disponible le dernier week-end (",m,"j)"]})]})]}):e.jsx(U,{children:e.jsx(H,{className:"flex items-center justify-center p-8",children:e.jsx(ue,{className:"h-6 w-6 animate-spin text-primary"})})})},rx=({equipped:s,inventory:t})=>{const r=d=>{if(!d||!ze||!Array.isArray(ze))return null;const m=ze.find(x=>x&&x.id===d)||null;return b.log("âœ… [EquippedItems] Item trouvÃ©:",(m==null?void 0:m.name)||"null"),m},n=s!=null&&s.avatar&&s.avatar!==""?r(s.avatar):null,a=s!=null&&s.theme&&s.theme!==""?r(s.theme):null,i=s!=null&&s.banner&&s.banner!==""?r(s.banner):null,o=s!=null&&s.title&&s.title!==""?r(s.title):null,l=s!=null&&s.effect&&s.effect!==""?r(s.effect):null;b.log("ðŸŽ­ [EquippedItems] Items Ã©quipÃ©s:",{avatar:(n==null?void 0:n.name)||"none",theme:(a==null?void 0:a.name)||"none",banner:(i==null?void 0:i.name)||"none",title:(o==null?void 0:o.name)||"none",effect:(l==null?void 0:l.name)||"none"});const c=Object.keys(t||{}).reduce((d,m)=>t&&typeof t[m]=="object"?d+Object.keys(t[m]).length:d,0);return e.jsxs(U,{className:"border-2 border-primary/20 bg-gradient-to-br from-primary/5 to-transparent",children:[e.jsx(he,{children:e.jsxs(fe,{className:"flex items-center gap-2",children:[e.jsx(Mt,{className:"h-5 w-5 text-primary"}),"Items Ã‰quipÃ©s"]})}),e.jsxs(H,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-surface-alt border border-border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-3xl",children:(n==null?void 0:n.icon)||"ðŸ˜Š"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:(n==null?void 0:n.name)||"Avatar par dÃ©faut"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Avatar"})]})]}),n&&e.jsx(le,{variant:"outline",className:"bg-primary/10 text-primary border-primary/30",children:"Ã‰quipÃ©"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-surface-alt border border-border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[a!=null&&a.preview?e.jsx("div",{className:"w-8 h-8 rounded-lg border-2 border-white/20",style:{backgroundColor:a.preview}}):e.jsx("div",{className:"text-3xl",children:"ðŸŽ¨"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:(a==null?void 0:a.name)||"ThÃ¨me par dÃ©faut"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ThÃ¨me"})]})]}),a&&e.jsx(le,{variant:"outline",className:"bg-primary/10 text-primary border-primary/30",children:"Ã‰quipÃ©"})]}),i&&e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-surface-alt border border-border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[i.preview?e.jsx("div",{className:"w-24 h-12 rounded-lg border-2 border-white/20 relative overflow-hidden",style:{background:i.preview},children:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:i.icon||"ðŸŽª"})})}):e.jsx("div",{className:"text-3xl",children:i.icon||"ðŸŽª"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:i.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"BanniÃ¨re"})]})]}),e.jsx(le,{variant:"outline",className:"bg-primary/10 text-primary border-primary/30",children:"Ã‰quipÃ©"})]}),o&&e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-surface-alt border border-border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-gradient-to-r from-sky-500/30 via-cyan-500/30 to-indigo-500/30 border border-cyan-400/60",children:[e.jsx("span",{className:"text-xl",children:o.icon||"ðŸ‘‘"}),e.jsx("span",{className:"text-[11px] font-semibold tracking-wide uppercase text-cyan-100",children:o.preview||o.name})]}),e.jsx("div",{children:e.jsx("p",{className:"text-xs text-muted-foreground",children:"Titre"})})]}),e.jsx(le,{variant:"outline",className:"bg-primary/10 text-primary border-primary/30",children:"Ã‰quipÃ©"})]}),l&&e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-surface-alt border border-border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-3xl",children:l.icon||"âœ¨"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:l.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Effet"})]})]}),e.jsx(le,{variant:"outline",className:"bg-primary/10 text-primary border-primary/30",children:"Ã‰quipÃ©"})]}),e.jsx("div",{className:"pt-3 border-t border-border",children:e.jsxs("p",{className:"text-xs text-muted-foreground text-center",children:["Collection : ",c," items possÃ©dÃ©s"]})})]})]})},ax=({userId:s})=>{const[t,r]=u.useState([]),[n,a]=u.useState(!0);u.useEffect(()=>{(async()=>{a(!0);try{const c=k(_,"matches"),d=await q(c);if(!d.exists()){r([]);return}const m=[];d.forEach(x=>{const p=x.val();if(!p)return;const f=Array.isArray(p.team1)?p.team1:[],h=Array.isArray(p.team2)?p.team2:[];!f.includes(s)&&!h.includes(s)||m.push({id:x.key||"",team1:f,team2:h,team1Names:p.team1Names,team2Names:p.team2Names,score1:p.score1,score2:p.score2,timestamp:p.timestamp||Date.now()})}),m.sort((x,p)=>p.timestamp-x.timestamp),r(m.slice(0,6))}catch(c){b.error("Erreur chargement matchs rÃ©cents:",c)}finally{a(!1)}})()},[s]);const o=(()=>{let l=0;for(const c of t){const d=c.team1.includes(s),m=c.team2.includes(s);if(!d&&!m)continue;const x=c.score1>c.score2;if(d&&x||m&&!x)l++;else break}return l})();return e.jsxs(U,{children:[e.jsx(he,{children:e.jsxs(fe,{className:"text-sm sm:text-base flex items-center gap-2",children:[e.jsx(Ie,{className:"h-4 w-4 text-primary"}),"Historique des derniers matchs"]})}),e.jsx(H,{className:"space-y-3",children:n?e.jsxs("div",{className:"flex items-center justify-center py-4 text-xs text-muted-foreground",children:[e.jsx(ue,{className:"h-4 w-4 mr-2 animate-spin"}),"Chargement des matchs..."]}):t.length===0?e.jsx("p",{className:"text-xs text-muted-foreground",children:"Aucun match enregistrÃ© pour l'instant."}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["SÃ©rie actuelle :"," ",e.jsxs("span",{className:"font-semibold text-foreground",children:[o," victoire",o>1?"s":""," d'affilÃ©e"]})]}),e.jsx("div",{className:"space-y-2",children:t.map(l=>{const c=l.team1.includes(s),d=l.score1>l.score2,m=c&&d||!c&&!d,x=c?l.team2Names||l.team2:l.team1Names||l.team1,f=new Date(l.timestamp).toLocaleDateString(void 0,{day:"2-digit",month:"2-digit"});return e.jsxs("div",{className:"flex items-center justify-between rounded-md border border-border bg-surface-alt px-2 py-1.5",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:`text-xs font-semibold ${m?"text-green-400":"text-red-400"}`,children:[m?"Victoire":"DÃ©faite"," ",l.score1,"-",l.score2]}),e.jsxs("span",{className:"text-[11px] text-muted-foreground",children:["vs ",Array.isArray(x)?x.join(", "):x]})]}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:f})]},l.id)})})]})})]})},nx=({cards:s})=>{const r=Object.entries(s||{}).sort((n,a)=>a[1]-n[1]).slice(0,3);return e.jsxs(U,{children:[e.jsx(he,{children:e.jsxs(fe,{className:"text-sm sm:text-base flex items-center gap-2",children:[e.jsx(js,{className:"h-4 w-4 text-secondary"}),"Cartes BabyDex mises en avant"]})}),e.jsx(H,{className:"space-y-3",children:r.length===0?e.jsx("p",{className:"text-xs text-muted-foreground",children:"Ouvre quelques boosters dans le BabyDex pour commencer ta collection."}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"SÃ©lection automatique de tes cartes les plus prÃ©sentes (par code)."}),e.jsx("div",{className:"space-y-2",children:r.map(([n,a])=>e.jsxs("div",{className:"flex items-center justify-between rounded-md border border-border bg-surface-alt px-2 py-1.5",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs font-medium text-foreground",children:n.replace(/\.(png|jpg|jpeg|gif)$/i,"")}),e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Carte BabyDex"})]}),e.jsxs(le,{variant:"outline",className:"text-[10px] px-2 py-0.5",children:["x",a]})]},n))})]})})]})},ix=({userId:s})=>{const{userProfile:t}=Me(),[r,n]=u.useState([]),[a,i]=u.useState([]),[o,l]=u.useState(!0),[c,d]=u.useState(null),[m,x]=u.useState(null),[p,f]=u.useState(!1),[h,g]=u.useState("");u.useEffect(()=>{v()},[s]);const v=async()=>{l(!0);try{const[O,w]=await Promise.all([ho(s),fo(s)]);n(O),i(w)}catch(O){b.error("Erreur chargement offres:",O)}finally{l(!1)}},j=async O=>{d(O);try{const w=r.find(E=>E.id===O);await uo(s,O),w&&await $m(w.buyerId,(t==null?void 0:t.username)||"Un vendeur",w.listingId).catch(E=>{b.error("Erreur notification:",E)}),$({title:"Offre acceptÃ©e âœ…",description:"La transaction a Ã©tÃ© effectuÃ©e et l'acheteur a Ã©tÃ© notifiÃ©."}),await v()}catch(w){$({title:"Erreur",description:w.message,variant:"destructive"})}finally{d(null)}},M=async O=>{d(O);try{const w=r.find(E=>E.id===O);await mo(s,O),w&&await Am(w.buyerId,(t==null?void 0:t.username)||"Un vendeur",w.listingId).catch(E=>{b.error("Erreur notification:",E)}),$({title:"Offre rejetÃ©e",description:"L'acheteur a Ã©tÃ© notifiÃ©."}),await v()}catch(w){$({title:"Erreur",description:w.message,variant:"destructive"})}finally{d(null)}},P=async()=>{if(!m||!h)return;const O=parseFloat(h);if(isNaN(O)||O<=0){$({title:"Erreur",description:"Montant invalide",variant:"destructive"});return}try{await xo(s,m.id,O),await Mm(m.buyerId,(t==null?void 0:t.username)||"Un vendeur",O,m.listingId).catch(w=>{b.error("Erreur notification:",w)}),$({title:"Contre-offre envoyÃ©e âœ…",description:`Proposition de ${O}â‚¬ envoyÃ©e Ã  l'acheteur`}),f(!1),g(""),await v()}catch(w){$({title:"Erreur",description:w.message,variant:"destructive"})}},C=O=>{const w=O-Date.now();if(w<=0)return"ExpirÃ©e";const E=Math.floor(w/(1e3*60*60));return E<24?`${E}h restantes`:`${Math.floor(E/24)}j restantes`},I=O=>{switch(O){case"pending":return e.jsx(le,{variant:"outline",className:"bg-yellow-500/10 text-yellow-600 border-yellow-500",children:"En attente"});case"accepted":return e.jsx(le,{variant:"outline",className:"bg-green-500/10 text-green-600 border-green-500",children:"AcceptÃ©e"});case"rejected":return e.jsx(le,{variant:"outline",className:"bg-red-500/10 text-red-600 border-red-500",children:"RejetÃ©e"});case"countered":return e.jsx(le,{variant:"outline",className:"bg-blue-500/10 text-blue-600 border-blue-500",children:"Contre-offre"});case"expired":return e.jsx(le,{variant:"outline",className:"bg-gray-500/10 text-gray-600 border-gray-500",children:"ExpirÃ©e"});default:return null}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-4",children:e.jsxs(Ns,{defaultValue:"received",children:[e.jsxs(Kt,{className:"grid w-full grid-cols-2",children:[e.jsxs(qe,{value:"received",children:["Offres ReÃ§ues",r.filter(O=>O.status==="pending").length>0&&e.jsx(le,{className:"ml-2 h-5 w-5 p-0 flex items-center justify-center bg-red-500",children:r.filter(O=>O.status==="pending").length})]}),e.jsxs(qe,{value:"sent",children:["Offres EnvoyÃ©es",a.filter(O=>O.status==="countered").length>0&&e.jsx(le,{className:"ml-2 h-5 w-5 p-0 flex items-center justify-center bg-blue-500",children:a.filter(O=>O.status==="countered").length})]})]}),e.jsx(Qe,{value:"received",className:"mt-4 space-y-3",children:o?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(ue,{className:"h-4 w-4 animate-spin"})}):r.length===0?e.jsx(U,{children:e.jsx(H,{className:"py-8 text-center text-sm text-muted-foreground",children:"Aucune offre reÃ§ue pour le moment."})}):r.map(O=>{const w=Date.now()>O.expiresAt,E=O.status==="pending"&&!w;return e.jsxs(U,{className:E?"border-yellow-500/50":"",children:[e.jsx(he,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs(fe,{className:"text-sm",children:["Listing #",O.listingId.slice(-6)]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["De: ",O.buyerId.slice(0,6),"..."]})]}),I(O.status)]})}),e.jsxs(H,{className:"space-y-3 text-xs",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Montant proposÃ©"}),e.jsxs("span",{className:"font-semibold text-lg",children:[O.amount,"â‚¬"]})]}),O.counterOffer&&e.jsxs("div",{className:"flex items-center justify-between bg-blue-500/10 p-2 rounded",children:[e.jsxs("span",{className:"text-blue-600 flex items-center gap-1",children:[e.jsx(Ie,{className:"h-3 w-3"}),"Contre-offre"]}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[O.counterOffer,"â‚¬"]})]}),O.message&&e.jsx("div",{className:"bg-muted p-2 rounded",children:e.jsxs("p",{className:"text-xs italic",children:['"',O.message,'"']})}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(it,{className:"h-3 w-3"}),C(O.expiresAt)]}),e.jsx("span",{className:"text-muted-foreground",children:new Date(O.createdAt).toLocaleDateString("fr-FR")})]})]}),E&&e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(T,{size:"sm",variant:"outline",className:"flex-1 text-xs",onClick:()=>M(O.id),disabled:c===O.id,children:[e.jsx(Ze,{className:"h-4 w-4 mr-1"}),"Rejeter"]}),e.jsxs(T,{size:"sm",variant:"outline",className:"flex-1 text-xs",onClick:()=>{x(O),g((O.amount*1.1).toFixed(0)),f(!0)},disabled:c===O.id,children:[e.jsx(Ie,{className:"h-4 w-4 mr-1"}),"Contre-offre"]}),e.jsxs(T,{size:"sm",className:"flex-1 text-xs bg-green-600 hover:bg-green-700",onClick:()=>j(O.id),disabled:c===O.id,children:[e.jsx(nt,{className:"h-4 w-4 mr-1"}),"Accepter"]})]})]})]},O.id)})}),e.jsx(Qe,{value:"sent",className:"mt-4 space-y-3",children:o?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(ue,{className:"h-4 w-4 animate-spin"})}):a.length===0?e.jsx(U,{children:e.jsx(H,{className:"py-8 text-center text-sm text-muted-foreground",children:"Aucune offre envoyÃ©e pour le moment."})}):a.map(O=>e.jsxs(U,{children:[e.jsx(he,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs(fe,{className:"text-sm",children:["Listing #",O.listingId.slice(-6)]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Ã€: ",O.sellerId.slice(0,6),"..."]})]}),I(O.status)]})}),e.jsx(H,{className:"space-y-3 text-xs",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Montant proposÃ©"}),e.jsxs("span",{className:"font-semibold text-lg",children:[O.amount,"â‚¬"]})]}),O.counterOffer&&e.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded p-3 text-center",children:[e.jsx(ls,{className:"h-4 w-4 text-blue-600 mx-auto mb-1"}),e.jsxs("p",{className:"text-blue-600 text-xs",children:["Le vendeur a proposÃ© ",O.counterOffer,"â‚¬"]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(it,{className:"h-3 w-3"}),C(O.expiresAt)]}),e.jsx("span",{className:"text-muted-foreground",children:new Date(O.createdAt).toLocaleDateString("fr-FR")})]})]})})]},O.id))})]})}),e.jsx(Fe,{open:p,onOpenChange:f,children:e.jsxs(Pe,{children:[e.jsxs(Oe,{children:[e.jsx(Le,{children:"Faire une contre-offre"}),e.jsx(Je,{children:"Proposez un nouveau prix Ã  l'acheteur"})]}),e.jsxs("div",{className:"space-y-4",children:[m&&e.jsxs("div",{className:"bg-muted p-3 rounded-lg space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Offre initiale:"}),e.jsxs("span",{className:"font-semibold",children:[m.amount,"â‚¬"]})]}),m.message&&e.jsxs("div",{className:"text-xs italic text-muted-foreground pt-2 border-t",children:['"',m.message,'"']})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Votre contre-offre (â‚¬)"}),e.jsx(ye,{type:"number",placeholder:"Montant",value:h,onChange:O=>g(O.target.value)}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:"ðŸ’¡ Proposez un prix intermÃ©diaire pour maximiser vos chances"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(T,{variant:"outline",onClick:()=>f(!1),className:"flex-1",children:"Annuler"}),e.jsxs(T,{onClick:P,className:"flex-1",children:[e.jsx(xr,{className:"h-4 w-4 mr-2"}),"Envoyer"]})]})]})]})})]})},ox=()=>{var x;const[s,t]=u.useState(""),[r,n]=u.useState(null),[a,i]=u.useState(!1),[o,l]=u.useState([]),c=async()=>{const p=s.trim().toLowerCase();if(!p){$({title:"Erreur",description:"Veuillez entrer un nom ou un code.",variant:"destructive"});return}i(!0);try{let f="";const{getCardByCode:h,codeToCardMap:g}=await Ot(async()=>{const{getCardByCode:M,codeToCardMap:P}=await Promise.resolve().then(()=>Vs);return{getCardByCode:M,codeToCardMap:P}},void 0),v=h(p.toUpperCase());if(b.log("ðŸ—‚ï¸ [Profile] Carte directe trouvÃ©e:",v),v&&v.found)f=v.code;else{b.log("ðŸ” [Profile] Recherche par nom dans codeToCardMap...");let M=null;for(const P of Object.keys(g)){const C=g[P];if(M=Object.keys(C).find(I=>C[I].nom.toLowerCase().replace(/\.(png|jpg|jpeg|gif)$/i,"").includes(p)||C[I].nom.toLowerCase().includes(p))||null,M){b.log("âœ… [Profile] Code trouvÃ©:",M,"dans la saison:",P);break}}if(!M){b.log("âŒ [Profile] Aucune carte trouvÃ©e pour:",p),$({title:"Non trouvÃ©",description:`Aucune carte ne correspond Ã  "${s}". VÃ©rifiez l'orthographe.`,variant:"destructive"}),i(!1);return}f=M}b.log("ðŸŽ¯ [Profile] Code cible final:",f),b.log("ðŸ“Š [Profile] Appel getMarketStats pour:",f);const j=await br(f);b.log("ðŸ“ˆ [Profile] Stats rÃ©cupÃ©rÃ©es:",j),b.log("ðŸ’° [Profile] Prix history:",j==null?void 0:j.priceHistory),j?(n(j),l(M=>{const P=M.filter(C=>C.cardCode!==j.cardCode);return[j,...P].slice(0,3)}),$({title:"âœ… Carte trouvÃ©e",description:`Statistiques de ${j.cardCode} chargÃ©es`})):($({title:"Aucune donnÃ©e",description:`La carte "${f}" n'a pas encore Ã©tÃ© vendue sur le marchÃ©.`,variant:"destructive"}),n(null))}catch(f){b.error("âŒ [Profile] Erreur recherche stats:",f),$({title:"Erreur",description:f.message||"Impossible de charger les statistiques.",variant:"destructive"})}finally{i(!1)}},d=p=>{if(!p||!Array.isArray(p)||p.length<2)return null;const f=p[0].price,g=(p[p.length-1].price-f)/f*100;return{percentage:Math.abs(g).toFixed(1),isIncrease:g>0}},m=({history:p})=>{if(!p||!Array.isArray(p)||p.length===0)return e.jsx("div",{className:"h-32 bg-muted/50 rounded-lg p-4 flex items-center justify-center",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun historique disponible"})});const f=p.filter(j=>j&&typeof j=="object"&&typeof j.price=="number"&&typeof j.date=="number"&&j.price>0);if(f.length===0)return e.jsx("div",{className:"h-32 bg-muted/50 rounded-lg p-4 flex items-center justify-center",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"DonnÃ©es invalides"})});const h=Math.max(...f.map(j=>j.price)),g=Math.min(...f.map(j=>j.price)),v=h-g||1;return e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-end gap-1 h-32 bg-muted/50 rounded-lg p-4",children:f.map((j,M)=>{const P=(j.price-g)/v*100,C=M===f.length-1;return e.jsxs("div",{className:"flex-1 flex flex-col items-center gap-1",children:[e.jsx("div",{className:`w-full rounded-t transition-all ${C?"bg-gradient-to-t from-green-600 to-green-400":"bg-gradient-to-t from-purple-600 to-purple-400"}`,style:{height:`${Math.max(P,10)}%`},title:`${j.price}â‚¬`}),e.jsx("span",{className:"text-[8px] text-muted-foreground",children:new Date(j.date).toLocaleDateString("fr-FR",{day:"2-digit",month:"short"})})]},M)})}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Min: ",g,"â‚¬"]}),e.jsxs("span",{children:["Max: ",h,"â‚¬"]}),e.jsxs("span",{children:["Moyenne: ",(f.reduce((j,M)=>j+M.price,0)/f.length).toFixed(2),"â‚¬"]})]})]})};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(U,{children:[e.jsx(he,{children:e.jsxs(fe,{className:"text-sm flex items-center gap-2",children:[e.jsx(Qt,{className:"h-4 w-4 text-purple-400"}),"Rechercher une carte"]})}),e.jsxs(H,{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ye,{placeholder:"Nom du joueur ou code (ex: Lilwenn, N831...)",value:s,onChange:p=>t(p.target.value),onKeyPress:p=>p.key==="Enter"&&c(),className:"flex-1"}),e.jsx(T,{onClick:c,disabled:a,children:a?e.jsx(ue,{className:"h-4 w-4 animate-spin"}):e.jsx(ot,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-start gap-2 p-2 rounded-lg bg-blue-500/10 border border-blue-500/20",children:[e.jsx(Ht,{className:"h-4 w-4 text-blue-500 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400",children:'ðŸ’¡ Recherche intelligente : tapez "Lilwenn" ou "N831", les deux fonctionnent !'})]})]})]}),r&&e.jsxs(U,{className:"overflow-hidden",children:[e.jsx(he,{className:"bg-gradient-to-r from-purple-500/10 to-blue-500/10 border-b",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs(fe,{className:"text-xl flex items-center gap-2",children:[r.cardCode||"Carte inconnue",r.priceHistory&&r.priceHistory.length>0&&d(r.priceHistory)&&e.jsxs(le,{variant:"outline",className:d(r.priceHistory).isIncrease?"bg-green-500/10 text-green-600 border-green-500":"bg-red-500/10 text-red-600 border-red-500",children:[d(r.priceHistory).isIncrease?e.jsx(ri,{className:"h-3 w-3 mr-1"}):e.jsx(ai,{className:"h-3 w-3 mr-1"}),d(r.priceHistory).percentage,"%"]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["DonnÃ©es sur ",((x=r.priceHistory)==null?void 0:x.length)||0," vente(s)"]})]}),e.jsxs(le,{className:"bg-primary",children:[e.jsx(Et,{className:"h-3 w-3 mr-1"}),r.totalSales||0," ventes"]})]})}),e.jsxs(H,{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-500/10 to-blue-600/5 rounded-lg p-4 border border-blue-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-600 text-sm mb-2",children:[e.jsx(Zt,{className:"h-4 w-4"}),"Prix Moyen"]}),e.jsxs("div",{className:"text-2xl font-bold text-foreground",children:[r.averagePrice.toFixed(2),"â‚¬"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-500/10 to-green-600/5 rounded-lg p-4 border border-green-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-600 text-sm mb-2",children:[e.jsx(cs,{className:"h-4 w-4"}),"Prix Min"]}),e.jsxs("div",{className:"text-2xl font-bold text-foreground",children:[r.lowestPrice,"â‚¬"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-red-500/10 to-red-600/5 rounded-lg p-4 border border-red-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm mb-2",children:[e.jsx(Ie,{className:"h-4 w-4"}),"Prix Max"]}),e.jsxs("div",{className:"text-2xl font-bold text-foreground",children:[r.highestPrice,"â‚¬"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-500/10 to-purple-600/5 rounded-lg p-4 border border-purple-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2 text-purple-600 text-sm mb-2",children:[e.jsx(vs,{className:"h-4 w-4"}),"DerniÃ¨re Vente"]}),e.jsxs("div",{className:"text-2xl font-bold text-foreground",children:[r.lastSalePrice||"N/A","â‚¬"]}),r.lastSaleDate&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:new Date(r.lastSaleDate).toLocaleDateString("fr-FR")})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold mb-3 flex items-center gap-2",children:[e.jsx(Qt,{className:"h-4 w-4"}),"Historique des Prix"]}),r.priceHistory&&r.priceHistory.length>0?e.jsx(m,{history:r.priceHistory}):e.jsx("div",{className:"h-32 bg-muted/50 rounded-lg p-4 flex items-center justify-center",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun historique disponible"})})]}),e.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-blue-600 mb-2 flex items-center gap-2",children:"ðŸ’¡ Recommandation de Prix"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Pour vendre rapidement, fixez votre prix entre"," ",e.jsxs("span",{className:"font-semibold text-foreground",children:[(r.averagePrice*.9).toFixed(2),"â‚¬"]})," ","et"," ",e.jsxs("span",{className:"font-semibold text-foreground",children:[(r.averagePrice*1.1).toFixed(2),"â‚¬"]})]})]})]})]}),o.length>0&&!r&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold mb-3",children:"Recherches rÃ©centes"}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:o.map(p=>e.jsx(U,{className:"cursor-pointer hover:border-primary transition-colors",onClick:()=>{t(p.cardCode),n(p)},children:e.jsxs(H,{className:"p-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:p.cardCode}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[p.totalSales," ventes Â· Moy: ",p.averagePrice.toFixed(2),"â‚¬"]})]}),e.jsx(js,{className:"h-4 w-4 text-muted-foreground"})]})},p.cardCode))})]})]})},lx=()=>{const s=mt(),{user:t,userProfile:r,logout:n}=Me(),[a,i]=u.useState(!1),[o,l]=u.useState(!1),[c,d]=u.useState(!1),[m,x]=u.useState(!1),[p,f]=u.useState(!1),[h,g]=u.useState(""),[v,j]=u.useState([]),[M,P]=u.useState([]),[C,I]=u.useState([]),[O,w]=u.useState(!1),[E,V]=u.useState(null),[A,B]=u.useState(null),[S,J]=u.useState(null),[me,re]=u.useState(!1),[Se,ve]=u.useState("overview"),[je,K]=u.useState({fortune:0,bettingGains:0,equipped:{avatar:"",theme:"",banner:"",title:"",effect:""},inventory:{},cards:{}}),[ee,z]=u.useState(!1),xe=km(h,300);u.useEffect(()=>{if(!t)return;z(!0);const y=k(_,`users/${t.uid}`),G=et(y,Y=>{try{if(Y.exists()){const ae=Y.val(),Ce={avatar:ae.avatar||"",theme:ae.theme||"",banner:ae.banner||"",title:ae.title||"",effect:ae.effect||""};if(K({fortune:ae.fortune||0,bettingGains:ae.bettingGains||0,equipped:Ce,inventory:ae.inventory||{},cards:ae.cards||{}}),Ce.theme){const Ee=ze.find(Ue=>Ue.id===Ce.theme);Ee&&Ee.preview&&tx(Ee.preview)}b.log("âœ… [Profile] DonnÃ©es mises Ã  jour en temps rÃ©el")}}catch(ae){b.error("Erreur chargement donnÃ©es utilisateur:",ae)}finally{z(!1)}});return()=>G()},[t]),u.useEffect(()=>{if(!t)return;(async()=>{w(!0);try{const[Y,ae]=await Promise.all([Qm(t.uid),$r(t.uid)]);P(Y),I(ae)}catch(Y){b.error("Erreur chargement amis:",Y)}finally{w(!1)}})();const G=Jm(t.uid,Y=>{P(Y)});return()=>G()},[t]),u.useEffect(()=>{if(!t)return;(async()=>{re(!0);try{const G=await bo(t.uid);J(G)}catch(G){b.error("Erreur chargement paramÃ¨tres:",G)}finally{re(!1)}})()},[t]),u.useEffect(()=>{if(!t||xe.length<2){j([]);return}(async()=>{const G=await Km(xe,t.uid);j(G)})()},[xe,t]);const L=async()=>{try{await n(),$({title:"DÃ©connexion rÃ©ussie",description:"Ã€ bientÃ´t !"}),s("/auth")}catch{$({title:"Erreur",description:"Impossible de se dÃ©connecter.",variant:"destructive"})}},R=async()=>{if(!(!t||!S))try{await Ym(t.uid,S),$({title:"ParamÃ¨tres sauvegardÃ©s! âš™ï¸",description:"Vos prÃ©fÃ©rences ont Ã©tÃ© mises Ã  jour."}),i(!1)}catch{$({title:"Erreur",description:"Impossible de sauvegarder les paramÃ¨tres.",variant:"destructive"})}},Z=async(y,G)=>{if(!(!t||!r)){V(y);try{await Gm(t.uid,r.username,y),$({title:"Demande envoyÃ©e! ðŸ¤",description:`Demande d'ami envoyÃ©e Ã  ${G}`}),g(""),j([])}catch(Y){$({title:"Erreur",description:Y.message,variant:"destructive"})}finally{V(null)}}},se=async(y,G)=>{try{if(await Hm(y),$({title:"Ami ajoutÃ©! âœ…",description:`${G} est maintenant votre ami`}),t){const Y=await $r(t.uid);I(Y)}}catch(Y){$({title:"Erreur",description:Y.message,variant:"destructive"})}},N=async y=>{try{if(await Zm(y),$({title:"Demande refusÃ©e",description:"La demande a Ã©tÃ© refusÃ©e"}),t){const G=await $r(t.uid);I(G)}}catch(G){$({title:"Erreur",description:G.message,variant:"destructive"})}},D=async(y,G)=>{if(t)try{await Wm(t.uid,y),$({title:"Ami supprimÃ©",description:`${G} a Ã©tÃ© retirÃ© de vos amis`}),(A==null?void 0:A.id)===y&&B(null)}catch(Y){$({title:"Erreur",description:Y.message,variant:"destructive"})}};if(!t||!r)return e.jsx(De,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:e.jsx(ue,{className:"h-8 w-8 animate-spin text-primary"})})});const Q=r||{username:(t==null?void 0:t.displayName)||"Joueur",role:"player",eloRating:1e3,wins:0,losses:0};return e.jsxs(De,{children:[e.jsxs(W.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-6 flex justify-end gap-2",children:[e.jsxs(T,{variant:"ghost",size:"icon",onClick:()=>l(!0),className:"relative",children:[e.jsx(As,{className:"h-5 w-5"}),C.length>0&&e.jsx("span",{className:"absolute right-1 top-1 flex h-4 w-4 items-center justify-center rounded-full bg-secondary text-[10px] font-bold animate-pulse",children:C.length})]}),e.jsx(T,{variant:"ghost",size:"icon",onClick:()=>i(!0),children:e.jsx(Ra,{className:"h-5 w-5"})})]}),e.jsx(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mb-4 sm:mb-6",children:e.jsx(_m,{username:Q.username,role:Q.role,eloRating:Q.eloRating,rank:1,equippedAvatar:je.equipped.avatar,equippedBanner:je.equipped.banner,equippedTitle:je.equipped.title})}),e.jsx(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mb-6",children:e.jsxs(Ns,{value:Se,onValueChange:y=>ve(y),className:"w-full",children:[e.jsxs(Kt,{className:"grid w-full grid-cols-2 sm:grid-cols-3 md:grid-cols-5",children:[e.jsx(qe,{value:"overview",children:"RÃ©sumÃ©"}),e.jsx(qe,{value:"stats",children:"Stats"}),e.jsx(qe,{value:"club",children:"Club"}),e.jsx(qe,{value:"offers",children:"Offres"}),e.jsx(qe,{value:"market",children:"MarchÃ©"})]}),e.jsxs(Qe,{value:"overview",className:"mt-4 space-y-4",children:[e.jsx(Em,{wins:Q.wins,losses:Q.losses,fortune:je.fortune,totalEarned:je.bettingGains}),ee?e.jsx(U,{children:e.jsxs(H,{className:"flex items-center justify-center p-8",children:[e.jsx(ue,{className:"h-6 w-6 animate-spin text-primary"}),e.jsx("p",{className:"ml-3 text-muted-foreground",children:"Chargement..."})]})}):e.jsx(rx,{equipped:je.equipped,inventory:je.inventory}),e.jsxs(U,{children:[e.jsx(he,{children:e.jsx(fe,{className:"text-lg",children:"Actions rapides"})}),e.jsxs(H,{className:"space-y-2",children:[e.jsxs(T,{variant:"outline",className:"w-full justify-start gap-3",onClick:()=>s("/shop"),children:[e.jsx(Et,{className:"h-4 w-4 text-primary"}),"Boutique"]}),e.jsxs(T,{variant:"outline",className:"w-full justify-start gap-3",onClick:()=>s("/inventory"),children:[e.jsx(_s,{className:"h-4 w-4 text-primary"}),"Inventaire"]}),e.jsxs(T,{variant:"outline",className:"w-full justify-start gap-3",onClick:()=>s("/market"),children:[e.jsx(Zt,{className:"h-4 w-4 text-primary"}),"MarchÃ© des Cartes"]}),e.jsxs(T,{variant:"outline",className:"w-full justify-start gap-3",onClick:()=>s("/chat"),children:[e.jsx(Es,{className:"h-4 w-4 text-primary"}),"Messages"]}),(r==null?void 0:r.role)==="admin"&&e.jsxs(T,{variant:"outline",className:"w-full justify-start gap-3 border-yellow-500/50 text-yellow-500 hover:bg-yellow-500/10",onClick:()=>s("/admin"),children:[e.jsx(jt,{className:"h-4 w-4"}),"Panneau Admin"]}),e.jsxs(T,{variant:"outline",className:"w-full justify-start gap-3",onClick:()=>d(!0),children:[e.jsx(rs,{className:"h-4 w-4 text-primary"}),"GÃ©rer les amis",e.jsx("span",{className:"ml-auto rounded-full bg-primary/20 px-2 py-0.5 text-xs text-primary",children:M.length})]}),e.jsxs(T,{variant:"outline",className:"w-full justify-start gap-3",onClick:()=>f(!0),children:[e.jsx(jt,{className:"h-4 w-4 text-muted-foreground"}),"ConfidentialitÃ©"]}),e.jsxs(T,{variant:"outline",className:"w-full justify-start gap-3 text-secondary hover:text-secondary",onClick:L,children:[e.jsx(aa,{className:"h-4 w-4"}),"DÃ©connexion"]})]})]})]}),e.jsxs(Qe,{value:"stats",className:"mt-4 space-y-4",children:[t&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx(ax,{userId:t.uid}),e.jsx(nx,{cards:je.cards})]}),t&&e.jsx(sx,{userId:t.uid,fortune:je.fortune,bettingGains:je.bettingGains}),t&&e.jsx(Rm,{userId:t.uid}),t&&e.jsx(Fm,{userId:t.uid})]}),e.jsx(Qe,{value:"club",className:"mt-4 space-y-4",children:t&&e.jsx(zm,{userId:t.uid})}),e.jsx(Qe,{value:"offers",className:"mt-4 space-y-4",children:t&&e.jsx(ix,{userId:t.uid})}),e.jsx(Qe,{value:"market",className:"mt-4 space-y-4",children:e.jsx(ox,{})})]})}),e.jsx(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"mt-6",children:e.jsx(U,{children:e.jsx(H,{className:"p-4",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["ConnectÃ© en tant que: ",e.jsx("span",{className:"text-foreground",children:t==null?void 0:t.email})]})})})}),e.jsx(Fe,{open:o,onOpenChange:l,children:e.jsxs(Pe,{children:[e.jsx(Oe,{children:e.jsxs(Le,{className:"flex items-center gap-2",children:[e.jsx(As,{className:"h-5 w-5 text-primary"}),"Demandes d'ami (",C.length,")"]})}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:C.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Aucune demande en attente"}):C.map(y=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-surface-alt",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:y.fromUsername}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Demande d'ami"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(T,{size:"sm",variant:"default",onClick:()=>se(y.id,y.fromUsername),children:e.jsx(nt,{className:"h-4 w-4"})}),e.jsx(T,{size:"sm",variant:"destructive",onClick:()=>N(y.id),children:e.jsx(Ze,{className:"h-4 w-4"})})]})]},y.id))})]})}),e.jsx(Fe,{open:c,onOpenChange:d,children:e.jsxs(Pe,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsx(Oe,{children:e.jsxs(Le,{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-5 w-5 text-primary"}),"Mes Amis (",M.length,")"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(T,{variant:"outline",className:"w-full",onClick:()=>{d(!1),x(!0)},children:[e.jsx(rs,{className:"h-4 w-4 mr-2"}),"Ajouter un ami"]}),O?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(ue,{className:"h-6 w-6 animate-spin text-primary"})}):M.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Re,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Vous n'avez pas encore d'amis"}),e.jsx("p",{className:"text-sm mt-2",children:"Ajoutez des amis pour jouer ensemble !"})]}):e.jsx("div",{className:"space-y-2",children:M.map(y=>{const G=y.avatar&&y.avatar!==""?ze.find(ae=>ae&&ae.id===y.avatar):null,Y=(G==null?void 0:G.icon)||"ðŸ˜Š";return e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-surface-alt hover:bg-surface-alt/80 transition-colors cursor-pointer",onClick:()=>{B({id:y.id,username:y.username}),d(!1)},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-2xl",children:Y}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:y.username}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["ELO: ",y.eloRating]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{className:y.status==="online"?"text-green-500 flex items-center gap-1":"text-muted-foreground",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${y.status==="online"?"bg-green-500":"bg-muted-foreground"}`}),y.status==="online"?"En ligne":"Hors ligne"]})]})]})]}),e.jsx(T,{variant:"ghost",size:"icon",onClick:ae=>{ae.stopPropagation(),D(y.id,y.username)},children:e.jsx(Ze,{className:"h-4 w-4"})})]},y.id)})})]})]})}),e.jsx(Fe,{open:m,onOpenChange:x,children:e.jsxs(Pe,{children:[e.jsxs(Oe,{children:[e.jsxs(Le,{className:"flex items-center gap-2",children:[e.jsx(rs,{className:"h-5 w-5 text-primary"}),"Ajouter un ami"]}),e.jsx(Je,{children:"Recherchez un joueur par son nom d'utilisateur"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ot,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(ye,{placeholder:"Rechercher un utilisateur...",value:h,onChange:y=>g(y.target.value),className:"pl-10"})]}),v.length>0&&e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:v.map(y=>{const G=M.some(Ee=>Ee.id===y.id),Y=E===y.id,ae=y.avatar&&y.avatar!==""?ze.find(Ee=>Ee&&Ee.id===y.avatar):null,Ce=(ae==null?void 0:ae.icon)||"ðŸ˜Š";return e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-surface-alt",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-2xl",children:Ce}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:y.username}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["ELO: ",y.eloRating]})]})]}),G?e.jsx(le,{variant:"outline",children:"DÃ©jÃ  ami"}):e.jsx(T,{size:"sm",onClick:()=>Z(y.id,y.username),disabled:Y,children:Y?e.jsx(ue,{className:"h-4 w-4 animate-spin"}):e.jsx(rs,{className:"h-4 w-4"})})]},y.id)})}),h.length>=2&&v.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ot,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Aucun utilisateur trouvÃ©"})]})]})]})}),e.jsx(Fe,{open:a,onOpenChange:i,children:e.jsxs(Pe,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsx(Oe,{children:e.jsxs(Le,{className:"flex items-center gap-2",children:[e.jsx(Ra,{className:"h-5 w-5 text-primary"}),"ParamÃ¨tres"]})}),me?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(ue,{className:"h-6 w-6 animate-spin text-primary"})}):S?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Notifications"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(bt,{htmlFor:"notifications",children:"Activer les notifications"}),e.jsx(gt,{id:"notifications",checked:S.notifications.enabled,onCheckedChange:y=>J({...S,notifications:{...S.notifications,enabled:y}})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(bt,{htmlFor:"matchReminders",children:"Rappels de matchs"}),e.jsx(gt,{id:"matchReminders",checked:S.notifications.matchReminders,onCheckedChange:y=>J({...S,notifications:{...S.notifications,matchReminders:y}})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(bt,{htmlFor:"friendRequests",children:"Demandes d'ami"}),e.jsx(gt,{id:"friendRequests",checked:S.notifications.friendRequests,onCheckedChange:y=>J({...S,notifications:{...S.notifications,friendRequests:y}})})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Son"}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(bt,{htmlFor:"sound",children:"Activer le son"}),e.jsx(gt,{id:"sound",checked:S.sound.enabled,onCheckedChange:y=>J({...S,sound:{...S.sound,enabled:y}})})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(T,{variant:"outline",onClick:()=>i(!1),className:"flex-1",children:"Annuler"}),e.jsx(T,{onClick:R,className:"flex-1",children:"Sauvegarder"})]})]}):null]})}),e.jsx(Fe,{open:p,onOpenChange:f,children:e.jsxs(Pe,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsx(Oe,{children:e.jsxs(Le,{className:"flex items-center gap-2",children:[e.jsx(jt,{className:"h-5 w-5 text-primary"}),"ConfidentialitÃ©"]})}),me?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(ue,{className:"h-6 w-6 animate-spin text-primary"})}):S?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"VisibilitÃ©"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(bt,{htmlFor:"profilePublic",children:"Profil public"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Permettre aux autres joueurs de voir votre profil"})]}),e.jsx(gt,{id:"profilePublic",checked:S.privacy.profilePublic,onCheckedChange:y=>J({...S,privacy:{...S.privacy,profilePublic:y}})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(bt,{htmlFor:"showStats",children:"Afficher les statistiques"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Afficher vos stats sur votre profil public"})]}),e.jsx(gt,{id:"showStats",checked:S.privacy.showStats,onCheckedChange:y=>J({...S,privacy:{...S.privacy,showStats:y}})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(bt,{htmlFor:"allowFriendRequests",children:"Demandes d'ami"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Autoriser les autres Ã  vous envoyer des demandes"})]}),e.jsx(gt,{id:"allowFriendRequests",checked:S.privacy.allowFriendRequests,onCheckedChange:y=>J({...S,privacy:{...S.privacy,allowFriendRequests:y}})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(bt,{htmlFor:"showOnlineStatus",children:"Statut en ligne"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Afficher votre statut en ligne aux autres"})]}),e.jsx(gt,{id:"showOnlineStatus",checked:S.privacy.showOnlineStatus,onCheckedChange:y=>J({...S,privacy:{...S.privacy,showOnlineStatus:y}})})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(T,{variant:"outline",onClick:()=>f(!1),className:"flex-1",children:"Annuler"}),e.jsx(T,{onClick:async()=>{await R(),f(!1)},className:"flex-1",children:"Sauvegarder"})]})]}):null]})}),e.jsx(qm,{isOpen:!!A,onClose:()=>{B(null),d(!0)},friendId:(A==null?void 0:A.id)||"",friendUsername:(A==null?void 0:A.username)||"",onRemoveFriend:D,canRemove:!0})]})};var _e;(function(s){s.assertEqual=a=>{};function t(a){}s.assertIs=t;function r(a){throw new Error}s.assertNever=r,s.arrayToEnum=a=>{const i={};for(const o of a)i[o]=o;return i},s.getValidEnumValues=a=>{const i=s.objectKeys(a).filter(l=>typeof a[a[l]]!="number"),o={};for(const l of i)o[l]=a[l];return s.objectValues(o)},s.objectValues=a=>s.objectKeys(a).map(function(i){return a[i]}),s.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{const i=[];for(const o in a)Object.prototype.hasOwnProperty.call(a,o)&&i.push(o);return i},s.find=(a,i)=>{for(const o of a)if(i(o))return o},s.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&Number.isFinite(a)&&Math.floor(a)===a;function n(a,i=" | "){return a.map(o=>typeof o=="string"?`'${o}'`:o).join(i)}s.joinValues=n,s.jsonStringifyReplacer=(a,i)=>typeof i=="bigint"?i.toString():i})(_e||(_e={}));var Ja;(function(s){s.mergeShapes=(t,r)=>({...t,...r})})(Ja||(Ja={}));const ne=_e.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),_t=s=>{switch(typeof s){case"undefined":return ne.undefined;case"string":return ne.string;case"number":return Number.isNaN(s)?ne.nan:ne.number;case"boolean":return ne.boolean;case"function":return ne.function;case"bigint":return ne.bigint;case"symbol":return ne.symbol;case"object":return Array.isArray(s)?ne.array:s===null?ne.null:s.then&&typeof s.then=="function"&&s.catch&&typeof s.catch=="function"?ne.promise:typeof Map<"u"&&s instanceof Map?ne.map:typeof Set<"u"&&s instanceof Set?ne.set:typeof Date<"u"&&s instanceof Date?ne.date:ne.object;default:return ne.unknown}},X=_e.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class dt extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=t}format(t){const r=t||function(i){return i.message},n={_errors:[]},a=i=>{for(const o of i.issues)if(o.code==="invalid_union")o.unionErrors.map(a);else if(o.code==="invalid_return_type")a(o.returnTypeError);else if(o.code==="invalid_arguments")a(o.argumentsError);else if(o.path.length===0)n._errors.push(r(o));else{let l=n,c=0;for(;c<o.path.length;){const d=o.path[c];c===o.path.length-1?(l[d]=l[d]||{_errors:[]},l[d]._errors.push(r(o))):l[d]=l[d]||{_errors:[]},l=l[d],c++}}};return a(this),n}static assert(t){if(!(t instanceof dt))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,_e.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=r=>r.message){const r={},n=[];for(const a of this.issues)if(a.path.length>0){const i=a.path[0];r[i]=r[i]||[],r[i].push(t(a))}else n.push(t(a));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}}dt.create=s=>new dt(s);const Yr=(s,t)=>{let r;switch(s.code){case X.invalid_type:s.received===ne.undefined?r="Required":r=`Expected ${s.expected}, received ${s.received}`;break;case X.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(s.expected,_e.jsonStringifyReplacer)}`;break;case X.unrecognized_keys:r=`Unrecognized key(s) in object: ${_e.joinValues(s.keys,", ")}`;break;case X.invalid_union:r="Invalid input";break;case X.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${_e.joinValues(s.options)}`;break;case X.invalid_enum_value:r=`Invalid enum value. Expected ${_e.joinValues(s.options)}, received '${s.received}'`;break;case X.invalid_arguments:r="Invalid function arguments";break;case X.invalid_return_type:r="Invalid function return type";break;case X.invalid_date:r="Invalid date";break;case X.invalid_string:typeof s.validation=="object"?"includes"in s.validation?(r=`Invalid input: must include "${s.validation.includes}"`,typeof s.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${s.validation.position}`)):"startsWith"in s.validation?r=`Invalid input: must start with "${s.validation.startsWith}"`:"endsWith"in s.validation?r=`Invalid input: must end with "${s.validation.endsWith}"`:_e.assertNever(s.validation):s.validation!=="regex"?r=`Invalid ${s.validation}`:r="Invalid";break;case X.too_small:s.type==="array"?r=`Array must contain ${s.exact?"exactly":s.inclusive?"at least":"more than"} ${s.minimum} element(s)`:s.type==="string"?r=`String must contain ${s.exact?"exactly":s.inclusive?"at least":"over"} ${s.minimum} character(s)`:s.type==="number"?r=`Number must be ${s.exact?"exactly equal to ":s.inclusive?"greater than or equal to ":"greater than "}${s.minimum}`:s.type==="bigint"?r=`Number must be ${s.exact?"exactly equal to ":s.inclusive?"greater than or equal to ":"greater than "}${s.minimum}`:s.type==="date"?r=`Date must be ${s.exact?"exactly equal to ":s.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(s.minimum))}`:r="Invalid input";break;case X.too_big:s.type==="array"?r=`Array must contain ${s.exact?"exactly":s.inclusive?"at most":"less than"} ${s.maximum} element(s)`:s.type==="string"?r=`String must contain ${s.exact?"exactly":s.inclusive?"at most":"under"} ${s.maximum} character(s)`:s.type==="number"?r=`Number must be ${s.exact?"exactly":s.inclusive?"less than or equal to":"less than"} ${s.maximum}`:s.type==="bigint"?r=`BigInt must be ${s.exact?"exactly":s.inclusive?"less than or equal to":"less than"} ${s.maximum}`:s.type==="date"?r=`Date must be ${s.exact?"exactly":s.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(s.maximum))}`:r="Invalid input";break;case X.custom:r="Invalid input";break;case X.invalid_intersection_types:r="Intersection results could not be merged";break;case X.not_multiple_of:r=`Number must be a multiple of ${s.multipleOf}`;break;case X.not_finite:r="Number must be finite";break;default:r=t.defaultError,_e.assertNever(s)}return{message:r}};let cx=Yr;function dx(){return cx}const ux=s=>{const{data:t,path:r,errorMaps:n,issueData:a}=s,i=[...r,...a.path||[]],o={...a,path:i};if(a.message!==void 0)return{...a,path:i,message:a.message};let l="";const c=n.filter(d=>!!d).slice().reverse();for(const d of c)l=d(o,{data:t,defaultError:l}).message;return{...a,path:i,message:l}};function te(s,t){const r=dx(),n=ux({issueData:t,data:s.data,path:s.path,errorMaps:[s.common.contextualErrorMap,s.schemaErrorMap,r,r===Yr?void 0:Yr].filter(a=>!!a)});s.common.issues.push(n)}class at{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,r){const n=[];for(const a of r){if(a.status==="aborted")return pe;a.status==="dirty"&&t.dirty(),n.push(a.value)}return{status:t.value,value:n}}static async mergeObjectAsync(t,r){const n=[];for(const a of r){const i=await a.key,o=await a.value;n.push({key:i,value:o})}return at.mergeObjectSync(t,n)}static mergeObjectSync(t,r){const n={};for(const a of r){const{key:i,value:o}=a;if(i.status==="aborted"||o.status==="aborted")return pe;i.status==="dirty"&&t.dirty(),o.status==="dirty"&&t.dirty(),i.value!=="__proto__"&&(typeof o.value<"u"||a.alwaysSet)&&(n[i.value]=o.value)}return{status:t.value,value:n}}}const pe=Object.freeze({status:"aborted"}),$s=s=>({status:"dirty",value:s}),lt=s=>({status:"valid",value:s}),Ya=s=>s.status==="aborted",Ka=s=>s.status==="dirty",fs=s=>s.status==="valid",ir=s=>typeof Promise<"u"&&s instanceof Promise;var oe;(function(s){s.errToObj=t=>typeof t=="string"?{message:t}:t||{},s.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(oe||(oe={}));class Lt{constructor(t,r,n,a){this._cachedPath=[],this.parent=t,this.data=r,this._path=n,this._key=a}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Xa=(s,t)=>{if(fs(t))return{success:!0,data:t.value};if(!s.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const r=new dt(s.common.issues);return this._error=r,this._error}}};function we(s){if(!s)return{};const{errorMap:t,invalid_type_error:r,required_error:n,description:a}=s;if(t&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:a}:{errorMap:(o,l)=>{const{message:c}=s;return o.code==="invalid_enum_value"?{message:c??l.defaultError}:typeof l.data>"u"?{message:c??n??l.defaultError}:o.code!=="invalid_type"?{message:l.defaultError}:{message:c??r??l.defaultError}},description:a}}class ke{get description(){return this._def.description}_getType(t){return _t(t.data)}_getOrReturnCtx(t,r){return r||{common:t.parent.common,data:t.data,parsedType:_t(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new at,ctx:{common:t.parent.common,data:t.data,parsedType:_t(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const r=this._parse(t);if(ir(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(t){const r=this._parse(t);return Promise.resolve(r)}parse(t,r){const n=this.safeParse(t,r);if(n.success)return n.data;throw n.error}safeParse(t,r){const n={common:{issues:[],async:(r==null?void 0:r.async)??!1,contextualErrorMap:r==null?void 0:r.errorMap},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:_t(t)},a=this._parseSync({data:t,path:n.path,parent:n});return Xa(n,a)}"~validate"(t){var n,a;const r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:_t(t)};if(!this["~standard"].async)try{const i=this._parseSync({data:t,path:[],parent:r});return fs(i)?{value:i.value}:{issues:r.common.issues}}catch(i){(a=(n=i==null?void 0:i.message)==null?void 0:n.toLowerCase())!=null&&a.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:r}).then(i=>fs(i)?{value:i.value}:{issues:r.common.issues})}async parseAsync(t,r){const n=await this.safeParseAsync(t,r);if(n.success)return n.data;throw n.error}async safeParseAsync(t,r){const n={common:{issues:[],contextualErrorMap:r==null?void 0:r.errorMap,async:!0},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:_t(t)},a=this._parse({data:t,path:n.path,parent:n}),i=await(ir(a)?a:Promise.resolve(a));return Xa(n,i)}refine(t,r){const n=a=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(a):r;return this._refinement((a,i)=>{const o=t(a),l=()=>i.addIssue({code:X.custom,...n(a)});return typeof Promise<"u"&&o instanceof Promise?o.then(c=>c?!0:(l(),!1)):o?!0:(l(),!1)})}refinement(t,r){return this._refinement((n,a)=>t(n)?!0:(a.addIssue(typeof r=="function"?r(n,a):r),!1))}_refinement(t){return new gs({schema:this,typeName:ge.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return At.create(this,this._def)}nullable(){return bs.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ut.create(this)}promise(){return dr.create(this,this._def)}or(t){return lr.create([this,t],this._def)}and(t){return cr.create(this,t,this._def)}transform(t){return new gs({...we(this._def),schema:this,typeName:ge.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const r=typeof t=="function"?t:()=>t;return new Xr({...we(this._def),innerType:this,defaultValue:r,typeName:ge.ZodDefault})}brand(){return new Px({typeName:ge.ZodBranded,type:this,...we(this._def)})}catch(t){const r=typeof t=="function"?t:()=>t;return new ea({...we(this._def),innerType:this,catchValue:r,typeName:ge.ZodCatch})}describe(t){const r=this.constructor;return new r({...this._def,description:t})}pipe(t){return ya.create(this,t)}readonly(){return ta.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const mx=/^c[^\s-]{8,}$/i,xx=/^[0-9a-z]+$/,hx=/^[0-9A-HJKMNP-TV-Z]{26}$/i,fx=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,px=/^[a-z0-9_-]{21}$/i,gx=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,bx=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,yx=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,vx="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Mr;const jx=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,wx=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Nx=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Cx=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Sx=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,kx=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,jo="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",_x=new RegExp(`^${jo}$`);function wo(s){let t="[0-5]\\d";s.precision?t=`${t}\\.\\d{${s.precision}}`:s.precision==null&&(t=`${t}(\\.\\d+)?`);const r=s.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${r}`}function Ex(s){return new RegExp(`^${wo(s)}$`)}function Rx(s){let t=`${jo}T${wo(s)}`;const r=[];return r.push(s.local?"Z?":"Z"),s.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,new RegExp(`^${t}$`)}function $x(s,t){return!!((t==="v4"||!t)&&jx.test(s)||(t==="v6"||!t)&&Nx.test(s))}function Ax(s,t){if(!gx.test(s))return!1;try{const[r]=s.split(".");if(!r)return!1;const n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),a=JSON.parse(atob(n));return!(typeof a!="object"||a===null||"typ"in a&&(a==null?void 0:a.typ)!=="JWT"||!a.alg||t&&a.alg!==t)}catch{return!1}}function Mx(s,t){return!!((t==="v4"||!t)&&wx.test(s)||(t==="v6"||!t)&&Cx.test(s))}class Rt extends ke{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==ne.string){const i=this._getOrReturnCtx(t);return te(i,{code:X.invalid_type,expected:ne.string,received:i.parsedType}),pe}const n=new at;let a;for(const i of this._def.checks)if(i.kind==="min")t.data.length<i.value&&(a=this._getOrReturnCtx(t,a),te(a,{code:X.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="max")t.data.length>i.value&&(a=this._getOrReturnCtx(t,a),te(a,{code:X.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="length"){const o=t.data.length>i.value,l=t.data.length<i.value;(o||l)&&(a=this._getOrReturnCtx(t,a),o?te(a,{code:X.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):l&&te(a,{code:X.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),n.dirty())}else if(i.kind==="email")yx.test(t.data)||(a=this._getOrReturnCtx(t,a),te(a,{validation:"email",code:X.invalid_string,message:i.message}),n.dirty());else if(i.kind==="emoji")Mr||(Mr=new RegExp(vx,"u")),Mr.test(t.data)||(a=this._getOrReturnCtx(t,a),te(a,{validation:"emoji",code:X.invalid_string,message:i.message}),n.dirty());else if(i.kind==="uuid")fx.test(t.data)||(a=this._getOrReturnCtx(t,a),te(a,{validation:"uuid",code:X.invalid_string,message:i.message}),n.dirty());else if(i.kind==="nanoid")px.test(t.data)||(a=this._getOrReturnCtx(t,a),te(a,{validation:"nanoid",code:X.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid")mx.test(t.data)||(a=this._getOrReturnCtx(t,a),te(a,{validation:"cuid",code:X.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid2")xx.test(t.data)||(a=this._getOrReturnCtx(t,a),te(a,{validation:"cuid2",code:X.invalid_string,message:i.message}),n.dirty());else if(i.kind==="ulid")hx.test(t.data)||(a=this._getOrReturnCtx(t,a),te(a,{validation:"ulid",code:X.invalid_string,message:i.message}),n.dirty());else if(i.kind==="url")try{new URL(t.data)}catch{a=this._getOrReturnCtx(t,a),te(a,{validation:"url",code:X.invalid_string,message:i.message}),n.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(t.data)||(a=this._getOrReturnCtx(t,a),te(a,{validation:"regex",code:X.invalid_string,message:i.message}),n.dirty())):i.kind==="trim"?t.data=t.data.trim():i.kind==="includes"?t.data.includes(i.value,i.position)||(a=this._getOrReturnCtx(t,a),te(a,{code:X.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),n.dirty()):i.kind==="toLowerCase"?t.data=t.data.toLowerCase():i.kind==="toUpperCase"?t.data=t.data.toUpperCase():i.kind==="startsWith"?t.data.startsWith(i.value)||(a=this._getOrReturnCtx(t,a),te(a,{code:X.invalid_string,validation:{startsWith:i.value},message:i.message}),n.dirty()):i.kind==="endsWith"?t.data.endsWith(i.value)||(a=this._getOrReturnCtx(t,a),te(a,{code:X.invalid_string,validation:{endsWith:i.value},message:i.message}),n.dirty()):i.kind==="datetime"?Rx(i).test(t.data)||(a=this._getOrReturnCtx(t,a),te(a,{code:X.invalid_string,validation:"datetime",message:i.message}),n.dirty()):i.kind==="date"?_x.test(t.data)||(a=this._getOrReturnCtx(t,a),te(a,{code:X.invalid_string,validation:"date",message:i.message}),n.dirty()):i.kind==="time"?Ex(i).test(t.data)||(a=this._getOrReturnCtx(t,a),te(a,{code:X.invalid_string,validation:"time",message:i.message}),n.dirty()):i.kind==="duration"?bx.test(t.data)||(a=this._getOrReturnCtx(t,a),te(a,{validation:"duration",code:X.invalid_string,message:i.message}),n.dirty()):i.kind==="ip"?$x(t.data,i.version)||(a=this._getOrReturnCtx(t,a),te(a,{validation:"ip",code:X.invalid_string,message:i.message}),n.dirty()):i.kind==="jwt"?Ax(t.data,i.alg)||(a=this._getOrReturnCtx(t,a),te(a,{validation:"jwt",code:X.invalid_string,message:i.message}),n.dirty()):i.kind==="cidr"?Mx(t.data,i.version)||(a=this._getOrReturnCtx(t,a),te(a,{validation:"cidr",code:X.invalid_string,message:i.message}),n.dirty()):i.kind==="base64"?Sx.test(t.data)||(a=this._getOrReturnCtx(t,a),te(a,{validation:"base64",code:X.invalid_string,message:i.message}),n.dirty()):i.kind==="base64url"?kx.test(t.data)||(a=this._getOrReturnCtx(t,a),te(a,{validation:"base64url",code:X.invalid_string,message:i.message}),n.dirty()):_e.assertNever(i);return{status:n.value,value:t.data}}_regex(t,r,n){return this.refinement(a=>t.test(a),{validation:r,code:X.invalid_string,...oe.errToObj(n)})}_addCheck(t){return new Rt({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...oe.errToObj(t)})}url(t){return this._addCheck({kind:"url",...oe.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...oe.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...oe.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...oe.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...oe.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...oe.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...oe.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...oe.errToObj(t)})}base64url(t){return this._addCheck({kind:"base64url",...oe.errToObj(t)})}jwt(t){return this._addCheck({kind:"jwt",...oe.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...oe.errToObj(t)})}cidr(t){return this._addCheck({kind:"cidr",...oe.errToObj(t)})}datetime(t){return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,offset:(t==null?void 0:t.offset)??!1,local:(t==null?void 0:t.local)??!1,...oe.errToObj(t==null?void 0:t.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,...oe.errToObj(t==null?void 0:t.message)})}duration(t){return this._addCheck({kind:"duration",...oe.errToObj(t)})}regex(t,r){return this._addCheck({kind:"regex",regex:t,...oe.errToObj(r)})}includes(t,r){return this._addCheck({kind:"includes",value:t,position:r==null?void 0:r.position,...oe.errToObj(r==null?void 0:r.message)})}startsWith(t,r){return this._addCheck({kind:"startsWith",value:t,...oe.errToObj(r)})}endsWith(t,r){return this._addCheck({kind:"endsWith",value:t,...oe.errToObj(r)})}min(t,r){return this._addCheck({kind:"min",value:t,...oe.errToObj(r)})}max(t,r){return this._addCheck({kind:"max",value:t,...oe.errToObj(r)})}length(t,r){return this._addCheck({kind:"length",value:t,...oe.errToObj(r)})}nonempty(t){return this.min(1,oe.errToObj(t))}trim(){return new Rt({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Rt({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Rt({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return!!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return!!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxLength(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}}Rt.create=s=>new Rt({checks:[],typeName:ge.ZodString,coerce:(s==null?void 0:s.coerce)??!1,...we(s)});function Tx(s,t){const r=(s.toString().split(".")[1]||"").length,n=(t.toString().split(".")[1]||"").length,a=r>n?r:n,i=Number.parseInt(s.toFixed(a).replace(".","")),o=Number.parseInt(t.toFixed(a).replace(".",""));return i%o/10**a}class Fs extends ke{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==ne.number){const i=this._getOrReturnCtx(t);return te(i,{code:X.invalid_type,expected:ne.number,received:i.parsedType}),pe}let n;const a=new at;for(const i of this._def.checks)i.kind==="int"?_e.isInteger(t.data)||(n=this._getOrReturnCtx(t,n),te(n,{code:X.invalid_type,expected:"integer",received:"float",message:i.message}),a.dirty()):i.kind==="min"?(i.inclusive?t.data<i.value:t.data<=i.value)&&(n=this._getOrReturnCtx(t,n),te(n,{code:X.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),a.dirty()):i.kind==="max"?(i.inclusive?t.data>i.value:t.data>=i.value)&&(n=this._getOrReturnCtx(t,n),te(n,{code:X.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),a.dirty()):i.kind==="multipleOf"?Tx(t.data,i.value)!==0&&(n=this._getOrReturnCtx(t,n),te(n,{code:X.not_multiple_of,multipleOf:i.value,message:i.message}),a.dirty()):i.kind==="finite"?Number.isFinite(t.data)||(n=this._getOrReturnCtx(t,n),te(n,{code:X.not_finite,message:i.message}),a.dirty()):_e.assertNever(i);return{status:a.value,value:t.data}}gte(t,r){return this.setLimit("min",t,!0,oe.toString(r))}gt(t,r){return this.setLimit("min",t,!1,oe.toString(r))}lte(t,r){return this.setLimit("max",t,!0,oe.toString(r))}lt(t,r){return this.setLimit("max",t,!1,oe.toString(r))}setLimit(t,r,n,a){return new Fs({...this._def,checks:[...this._def.checks,{kind:t,value:r,inclusive:n,message:oe.toString(a)}]})}_addCheck(t){return new Fs({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:oe.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:oe.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:oe.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:oe.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:oe.toString(t)})}multipleOf(t,r){return this._addCheck({kind:"multipleOf",value:t,message:oe.toString(r)})}finite(t){return this._addCheck({kind:"finite",message:oe.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:oe.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:oe.toString(t)})}get minValue(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxValue(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&_e.isInteger(t.value))}get isFinite(){let t=null,r=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(t===null||n.value<t)&&(t=n.value)}return Number.isFinite(r)&&Number.isFinite(t)}}Fs.create=s=>new Fs({checks:[],typeName:ge.ZodNumber,coerce:(s==null?void 0:s.coerce)||!1,...we(s)});class zs extends ke{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch{return this._getInvalidInput(t)}if(this._getType(t)!==ne.bigint)return this._getInvalidInput(t);let n;const a=new at;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?t.data<i.value:t.data<=i.value)&&(n=this._getOrReturnCtx(t,n),te(n,{code:X.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),a.dirty()):i.kind==="max"?(i.inclusive?t.data>i.value:t.data>=i.value)&&(n=this._getOrReturnCtx(t,n),te(n,{code:X.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),a.dirty()):i.kind==="multipleOf"?t.data%i.value!==BigInt(0)&&(n=this._getOrReturnCtx(t,n),te(n,{code:X.not_multiple_of,multipleOf:i.value,message:i.message}),a.dirty()):_e.assertNever(i);return{status:a.value,value:t.data}}_getInvalidInput(t){const r=this._getOrReturnCtx(t);return te(r,{code:X.invalid_type,expected:ne.bigint,received:r.parsedType}),pe}gte(t,r){return this.setLimit("min",t,!0,oe.toString(r))}gt(t,r){return this.setLimit("min",t,!1,oe.toString(r))}lte(t,r){return this.setLimit("max",t,!0,oe.toString(r))}lt(t,r){return this.setLimit("max",t,!1,oe.toString(r))}setLimit(t,r,n,a){return new zs({...this._def,checks:[...this._def.checks,{kind:t,value:r,inclusive:n,message:oe.toString(a)}]})}_addCheck(t){return new zs({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:oe.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:oe.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:oe.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:oe.toString(t)})}multipleOf(t,r){return this._addCheck({kind:"multipleOf",value:t,message:oe.toString(r)})}get minValue(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxValue(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}}zs.create=s=>new zs({checks:[],typeName:ge.ZodBigInt,coerce:(s==null?void 0:s.coerce)??!1,...we(s)});class en extends ke{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==ne.boolean){const n=this._getOrReturnCtx(t);return te(n,{code:X.invalid_type,expected:ne.boolean,received:n.parsedType}),pe}return lt(t.data)}}en.create=s=>new en({typeName:ge.ZodBoolean,coerce:(s==null?void 0:s.coerce)||!1,...we(s)});class or extends ke{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==ne.date){const i=this._getOrReturnCtx(t);return te(i,{code:X.invalid_type,expected:ne.date,received:i.parsedType}),pe}if(Number.isNaN(t.data.getTime())){const i=this._getOrReturnCtx(t);return te(i,{code:X.invalid_date}),pe}const n=new at;let a;for(const i of this._def.checks)i.kind==="min"?t.data.getTime()<i.value&&(a=this._getOrReturnCtx(t,a),te(a,{code:X.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),n.dirty()):i.kind==="max"?t.data.getTime()>i.value&&(a=this._getOrReturnCtx(t,a),te(a,{code:X.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),n.dirty()):_e.assertNever(i);return{status:n.value,value:new Date(t.data.getTime())}}_addCheck(t){return new or({...this._def,checks:[...this._def.checks,t]})}min(t,r){return this._addCheck({kind:"min",value:t.getTime(),message:oe.toString(r)})}max(t,r){return this._addCheck({kind:"max",value:t.getTime(),message:oe.toString(r)})}get minDate(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t!=null?new Date(t):null}}or.create=s=>new or({checks:[],coerce:(s==null?void 0:s.coerce)||!1,typeName:ge.ZodDate,...we(s)});class tn extends ke{_parse(t){if(this._getType(t)!==ne.symbol){const n=this._getOrReturnCtx(t);return te(n,{code:X.invalid_type,expected:ne.symbol,received:n.parsedType}),pe}return lt(t.data)}}tn.create=s=>new tn({typeName:ge.ZodSymbol,...we(s)});class sn extends ke{_parse(t){if(this._getType(t)!==ne.undefined){const n=this._getOrReturnCtx(t);return te(n,{code:X.invalid_type,expected:ne.undefined,received:n.parsedType}),pe}return lt(t.data)}}sn.create=s=>new sn({typeName:ge.ZodUndefined,...we(s)});class rn extends ke{_parse(t){if(this._getType(t)!==ne.null){const n=this._getOrReturnCtx(t);return te(n,{code:X.invalid_type,expected:ne.null,received:n.parsedType}),pe}return lt(t.data)}}rn.create=s=>new rn({typeName:ge.ZodNull,...we(s)});class an extends ke{constructor(){super(...arguments),this._any=!0}_parse(t){return lt(t.data)}}an.create=s=>new an({typeName:ge.ZodAny,...we(s)});class nn extends ke{constructor(){super(...arguments),this._unknown=!0}_parse(t){return lt(t.data)}}nn.create=s=>new nn({typeName:ge.ZodUnknown,...we(s)});class It extends ke{_parse(t){const r=this._getOrReturnCtx(t);return te(r,{code:X.invalid_type,expected:ne.never,received:r.parsedType}),pe}}It.create=s=>new It({typeName:ge.ZodNever,...we(s)});class on extends ke{_parse(t){if(this._getType(t)!==ne.undefined){const n=this._getOrReturnCtx(t);return te(n,{code:X.invalid_type,expected:ne.void,received:n.parsedType}),pe}return lt(t.data)}}on.create=s=>new on({typeName:ge.ZodVoid,...we(s)});class ut extends ke{_parse(t){const{ctx:r,status:n}=this._processInputParams(t),a=this._def;if(r.parsedType!==ne.array)return te(r,{code:X.invalid_type,expected:ne.array,received:r.parsedType}),pe;if(a.exactLength!==null){const o=r.data.length>a.exactLength.value,l=r.data.length<a.exactLength.value;(o||l)&&(te(r,{code:o?X.too_big:X.too_small,minimum:l?a.exactLength.value:void 0,maximum:o?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),n.dirty())}if(a.minLength!==null&&r.data.length<a.minLength.value&&(te(r,{code:X.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),n.dirty()),a.maxLength!==null&&r.data.length>a.maxLength.value&&(te(r,{code:X.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((o,l)=>a.type._parseAsync(new Lt(r,o,r.path,l)))).then(o=>at.mergeArray(n,o));const i=[...r.data].map((o,l)=>a.type._parseSync(new Lt(r,o,r.path,l)));return at.mergeArray(n,i)}get element(){return this._def.type}min(t,r){return new ut({...this._def,minLength:{value:t,message:oe.toString(r)}})}max(t,r){return new ut({...this._def,maxLength:{value:t,message:oe.toString(r)}})}length(t,r){return new ut({...this._def,exactLength:{value:t,message:oe.toString(r)}})}nonempty(t){return this.min(1,t)}}ut.create=(s,t)=>new ut({type:s,minLength:null,maxLength:null,exactLength:null,typeName:ge.ZodArray,...we(t)});function ss(s){if(s instanceof He){const t={};for(const r in s.shape){const n=s.shape[r];t[r]=At.create(ss(n))}return new He({...s._def,shape:()=>t})}else return s instanceof ut?new ut({...s._def,type:ss(s.element)}):s instanceof At?At.create(ss(s.unwrap())):s instanceof bs?bs.create(ss(s.unwrap())):s instanceof Yt?Yt.create(s.items.map(t=>ss(t))):s}class He extends ke{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),r=_e.objectKeys(t);return this._cached={shape:t,keys:r},this._cached}_parse(t){if(this._getType(t)!==ne.object){const d=this._getOrReturnCtx(t);return te(d,{code:X.invalid_type,expected:ne.object,received:d.parsedType}),pe}const{status:n,ctx:a}=this._processInputParams(t),{shape:i,keys:o}=this._getCached(),l=[];if(!(this._def.catchall instanceof It&&this._def.unknownKeys==="strip"))for(const d in a.data)o.includes(d)||l.push(d);const c=[];for(const d of o){const m=i[d],x=a.data[d];c.push({key:{status:"valid",value:d},value:m._parse(new Lt(a,x,a.path,d)),alwaysSet:d in a.data})}if(this._def.catchall instanceof It){const d=this._def.unknownKeys;if(d==="passthrough")for(const m of l)c.push({key:{status:"valid",value:m},value:{status:"valid",value:a.data[m]}});else if(d==="strict")l.length>0&&(te(a,{code:X.unrecognized_keys,keys:l}),n.dirty());else if(d!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const d=this._def.catchall;for(const m of l){const x=a.data[m];c.push({key:{status:"valid",value:m},value:d._parse(new Lt(a,x,a.path,m)),alwaysSet:m in a.data})}}return a.common.async?Promise.resolve().then(async()=>{const d=[];for(const m of c){const x=await m.key,p=await m.value;d.push({key:x,value:p,alwaysSet:m.alwaysSet})}return d}).then(d=>at.mergeObjectSync(n,d)):at.mergeObjectSync(n,c)}get shape(){return this._def.shape()}strict(t){return oe.errToObj,new He({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(r,n)=>{var i,o;const a=((o=(i=this._def).errorMap)==null?void 0:o.call(i,r,n).message)??n.defaultError;return r.code==="unrecognized_keys"?{message:oe.errToObj(t).message??a}:{message:a}}}:{}})}strip(){return new He({...this._def,unknownKeys:"strip"})}passthrough(){return new He({...this._def,unknownKeys:"passthrough"})}extend(t){return new He({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new He({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:ge.ZodObject})}setKey(t,r){return this.augment({[t]:r})}catchall(t){return new He({...this._def,catchall:t})}pick(t){const r={};for(const n of _e.objectKeys(t))t[n]&&this.shape[n]&&(r[n]=this.shape[n]);return new He({...this._def,shape:()=>r})}omit(t){const r={};for(const n of _e.objectKeys(this.shape))t[n]||(r[n]=this.shape[n]);return new He({...this._def,shape:()=>r})}deepPartial(){return ss(this)}partial(t){const r={};for(const n of _e.objectKeys(this.shape)){const a=this.shape[n];t&&!t[n]?r[n]=a:r[n]=a.optional()}return new He({...this._def,shape:()=>r})}required(t){const r={};for(const n of _e.objectKeys(this.shape))if(t&&!t[n])r[n]=this.shape[n];else{let i=this.shape[n];for(;i instanceof At;)i=i._def.innerType;r[n]=i}return new He({...this._def,shape:()=>r})}keyof(){return No(_e.objectKeys(this.shape))}}He.create=(s,t)=>new He({shape:()=>s,unknownKeys:"strip",catchall:It.create(),typeName:ge.ZodObject,...we(t)});He.strictCreate=(s,t)=>new He({shape:()=>s,unknownKeys:"strict",catchall:It.create(),typeName:ge.ZodObject,...we(t)});He.lazycreate=(s,t)=>new He({shape:s,unknownKeys:"strip",catchall:It.create(),typeName:ge.ZodObject,...we(t)});class lr extends ke{_parse(t){const{ctx:r}=this._processInputParams(t),n=this._def.options;function a(i){for(const l of i)if(l.result.status==="valid")return l.result;for(const l of i)if(l.result.status==="dirty")return r.common.issues.push(...l.ctx.common.issues),l.result;const o=i.map(l=>new dt(l.ctx.common.issues));return te(r,{code:X.invalid_union,unionErrors:o}),pe}if(r.common.async)return Promise.all(n.map(async i=>{const o={...r,common:{...r.common,issues:[]},parent:null};return{result:await i._parseAsync({data:r.data,path:r.path,parent:o}),ctx:o}})).then(a);{let i;const o=[];for(const c of n){const d={...r,common:{...r.common,issues:[]},parent:null},m=c._parseSync({data:r.data,path:r.path,parent:d});if(m.status==="valid")return m;m.status==="dirty"&&!i&&(i={result:m,ctx:d}),d.common.issues.length&&o.push(d.common.issues)}if(i)return r.common.issues.push(...i.ctx.common.issues),i.result;const l=o.map(c=>new dt(c));return te(r,{code:X.invalid_union,unionErrors:l}),pe}}get options(){return this._def.options}}lr.create=(s,t)=>new lr({options:s,typeName:ge.ZodUnion,...we(t)});function Kr(s,t){const r=_t(s),n=_t(t);if(s===t)return{valid:!0,data:s};if(r===ne.object&&n===ne.object){const a=_e.objectKeys(t),i=_e.objectKeys(s).filter(l=>a.indexOf(l)!==-1),o={...s,...t};for(const l of i){const c=Kr(s[l],t[l]);if(!c.valid)return{valid:!1};o[l]=c.data}return{valid:!0,data:o}}else if(r===ne.array&&n===ne.array){if(s.length!==t.length)return{valid:!1};const a=[];for(let i=0;i<s.length;i++){const o=s[i],l=t[i],c=Kr(o,l);if(!c.valid)return{valid:!1};a.push(c.data)}return{valid:!0,data:a}}else return r===ne.date&&n===ne.date&&+s==+t?{valid:!0,data:s}:{valid:!1}}class cr extends ke{_parse(t){const{status:r,ctx:n}=this._processInputParams(t),a=(i,o)=>{if(Ya(i)||Ya(o))return pe;const l=Kr(i.value,o.value);return l.valid?((Ka(i)||Ka(o))&&r.dirty(),{status:r.value,value:l.data}):(te(n,{code:X.invalid_intersection_types}),pe)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([i,o])=>a(i,o)):a(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}cr.create=(s,t,r)=>new cr({left:s,right:t,typeName:ge.ZodIntersection,...we(r)});class Yt extends ke{_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==ne.array)return te(n,{code:X.invalid_type,expected:ne.array,received:n.parsedType}),pe;if(n.data.length<this._def.items.length)return te(n,{code:X.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),pe;!this._def.rest&&n.data.length>this._def.items.length&&(te(n,{code:X.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());const i=[...n.data].map((o,l)=>{const c=this._def.items[l]||this._def.rest;return c?c._parse(new Lt(n,o,n.path,l)):null}).filter(o=>!!o);return n.common.async?Promise.all(i).then(o=>at.mergeArray(r,o)):at.mergeArray(r,i)}get items(){return this._def.items}rest(t){return new Yt({...this._def,rest:t})}}Yt.create=(s,t)=>{if(!Array.isArray(s))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Yt({items:s,typeName:ge.ZodTuple,rest:null,...we(t)})};class ln extends ke{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==ne.map)return te(n,{code:X.invalid_type,expected:ne.map,received:n.parsedType}),pe;const a=this._def.keyType,i=this._def.valueType,o=[...n.data.entries()].map(([l,c],d)=>({key:a._parse(new Lt(n,l,n.path,[d,"key"])),value:i._parse(new Lt(n,c,n.path,[d,"value"]))}));if(n.common.async){const l=new Map;return Promise.resolve().then(async()=>{for(const c of o){const d=await c.key,m=await c.value;if(d.status==="aborted"||m.status==="aborted")return pe;(d.status==="dirty"||m.status==="dirty")&&r.dirty(),l.set(d.value,m.value)}return{status:r.value,value:l}})}else{const l=new Map;for(const c of o){const d=c.key,m=c.value;if(d.status==="aborted"||m.status==="aborted")return pe;(d.status==="dirty"||m.status==="dirty")&&r.dirty(),l.set(d.value,m.value)}return{status:r.value,value:l}}}}ln.create=(s,t,r)=>new ln({valueType:t,keyType:s,typeName:ge.ZodMap,...we(r)});class Bs extends ke{_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==ne.set)return te(n,{code:X.invalid_type,expected:ne.set,received:n.parsedType}),pe;const a=this._def;a.minSize!==null&&n.data.size<a.minSize.value&&(te(n,{code:X.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),r.dirty()),a.maxSize!==null&&n.data.size>a.maxSize.value&&(te(n,{code:X.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),r.dirty());const i=this._def.valueType;function o(c){const d=new Set;for(const m of c){if(m.status==="aborted")return pe;m.status==="dirty"&&r.dirty(),d.add(m.value)}return{status:r.value,value:d}}const l=[...n.data.values()].map((c,d)=>i._parse(new Lt(n,c,n.path,d)));return n.common.async?Promise.all(l).then(c=>o(c)):o(l)}min(t,r){return new Bs({...this._def,minSize:{value:t,message:oe.toString(r)}})}max(t,r){return new Bs({...this._def,maxSize:{value:t,message:oe.toString(r)}})}size(t,r){return this.min(t,r).max(t,r)}nonempty(t){return this.min(1,t)}}Bs.create=(s,t)=>new Bs({valueType:s,minSize:null,maxSize:null,typeName:ge.ZodSet,...we(t)});class cn extends ke{get schema(){return this._def.getter()}_parse(t){const{ctx:r}=this._processInputParams(t);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}}cn.create=(s,t)=>new cn({getter:s,typeName:ge.ZodLazy,...we(t)});class dn extends ke{_parse(t){if(t.data!==this._def.value){const r=this._getOrReturnCtx(t);return te(r,{received:r.data,code:X.invalid_literal,expected:this._def.value}),pe}return{status:"valid",value:t.data}}get value(){return this._def.value}}dn.create=(s,t)=>new dn({value:s,typeName:ge.ZodLiteral,...we(t)});function No(s,t){return new ps({values:s,typeName:ge.ZodEnum,...we(t)})}class ps extends ke{_parse(t){if(typeof t.data!="string"){const r=this._getOrReturnCtx(t),n=this._def.values;return te(r,{expected:_e.joinValues(n),received:r.parsedType,code:X.invalid_type}),pe}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(t.data)){const r=this._getOrReturnCtx(t),n=this._def.values;return te(r,{received:r.data,code:X.invalid_enum_value,options:n}),pe}return lt(t.data)}get options(){return this._def.values}get enum(){const t={};for(const r of this._def.values)t[r]=r;return t}get Values(){const t={};for(const r of this._def.values)t[r]=r;return t}get Enum(){const t={};for(const r of this._def.values)t[r]=r;return t}extract(t,r=this._def){return ps.create(t,{...this._def,...r})}exclude(t,r=this._def){return ps.create(this.options.filter(n=>!t.includes(n)),{...this._def,...r})}}ps.create=No;class un extends ke{_parse(t){const r=_e.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(t);if(n.parsedType!==ne.string&&n.parsedType!==ne.number){const a=_e.objectValues(r);return te(n,{expected:_e.joinValues(a),received:n.parsedType,code:X.invalid_type}),pe}if(this._cache||(this._cache=new Set(_e.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){const a=_e.objectValues(r);return te(n,{received:n.data,code:X.invalid_enum_value,options:a}),pe}return lt(t.data)}get enum(){return this._def.values}}un.create=(s,t)=>new un({values:s,typeName:ge.ZodNativeEnum,...we(t)});class dr extends ke{unwrap(){return this._def.type}_parse(t){const{ctx:r}=this._processInputParams(t);if(r.parsedType!==ne.promise&&r.common.async===!1)return te(r,{code:X.invalid_type,expected:ne.promise,received:r.parsedType}),pe;const n=r.parsedType===ne.promise?r.data:Promise.resolve(r.data);return lt(n.then(a=>this._def.type.parseAsync(a,{path:r.path,errorMap:r.common.contextualErrorMap})))}}dr.create=(s,t)=>new dr({type:s,typeName:ge.ZodPromise,...we(t)});class gs extends ke{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===ge.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:r,ctx:n}=this._processInputParams(t),a=this._def.effect||null,i={addIssue:o=>{te(n,o),o.fatal?r.abort():r.dirty()},get path(){return n.path}};if(i.addIssue=i.addIssue.bind(i),a.type==="preprocess"){const o=a.transform(n.data,i);if(n.common.async)return Promise.resolve(o).then(async l=>{if(r.value==="aborted")return pe;const c=await this._def.schema._parseAsync({data:l,path:n.path,parent:n});return c.status==="aborted"?pe:c.status==="dirty"||r.value==="dirty"?$s(c.value):c});{if(r.value==="aborted")return pe;const l=this._def.schema._parseSync({data:o,path:n.path,parent:n});return l.status==="aborted"?pe:l.status==="dirty"||r.value==="dirty"?$s(l.value):l}}if(a.type==="refinement"){const o=l=>{const c=a.refinement(l,i);if(n.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return l};if(n.common.async===!1){const l=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return l.status==="aborted"?pe:(l.status==="dirty"&&r.dirty(),o(l.value),{status:r.value,value:l.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(l=>l.status==="aborted"?pe:(l.status==="dirty"&&r.dirty(),o(l.value).then(()=>({status:r.value,value:l.value}))))}if(a.type==="transform")if(n.common.async===!1){const o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!fs(o))return pe;const l=a.transform(o.value,i);if(l instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:l}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>fs(o)?Promise.resolve(a.transform(o.value,i)).then(l=>({status:r.value,value:l})):pe);_e.assertNever(a)}}gs.create=(s,t,r)=>new gs({schema:s,typeName:ge.ZodEffects,effect:t,...we(r)});gs.createWithPreprocess=(s,t,r)=>new gs({schema:t,effect:{type:"preprocess",transform:s},typeName:ge.ZodEffects,...we(r)});class At extends ke{_parse(t){return this._getType(t)===ne.undefined?lt(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}At.create=(s,t)=>new At({innerType:s,typeName:ge.ZodOptional,...we(t)});class bs extends ke{_parse(t){return this._getType(t)===ne.null?lt(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}bs.create=(s,t)=>new bs({innerType:s,typeName:ge.ZodNullable,...we(t)});class Xr extends ke{_parse(t){const{ctx:r}=this._processInputParams(t);let n=r.data;return r.parsedType===ne.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}}Xr.create=(s,t)=>new Xr({innerType:s,typeName:ge.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...we(t)});class ea extends ke{_parse(t){const{ctx:r}=this._processInputParams(t),n={...r,common:{...r.common,issues:[]}},a=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return ir(a)?a.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new dt(n.common.issues)},input:n.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new dt(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}ea.create=(s,t)=>new ea({innerType:s,typeName:ge.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...we(t)});class mn extends ke{_parse(t){if(this._getType(t)!==ne.nan){const n=this._getOrReturnCtx(t);return te(n,{code:X.invalid_type,expected:ne.nan,received:n.parsedType}),pe}return{status:"valid",value:t.data}}}mn.create=s=>new mn({typeName:ge.ZodNaN,...we(s)});class Px extends ke{_parse(t){const{ctx:r}=this._processInputParams(t),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}}class ya extends ke{_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?pe:i.status==="dirty"?(r.dirty(),$s(i.value)):this._def.out._parseAsync({data:i.value,path:n.path,parent:n})})();{const a=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?pe:a.status==="dirty"?(r.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:n.path,parent:n})}}static create(t,r){return new ya({in:t,out:r,typeName:ge.ZodPipeline})}}class ta extends ke{_parse(t){const r=this._def.innerType._parse(t),n=a=>(fs(a)&&(a.value=Object.freeze(a.value)),a);return ir(r)?r.then(a=>n(a)):n(r)}unwrap(){return this._def.innerType}}ta.create=(s,t)=>new ta({innerType:s,typeName:ge.ZodReadonly,...we(t)});var ge;(function(s){s.ZodString="ZodString",s.ZodNumber="ZodNumber",s.ZodNaN="ZodNaN",s.ZodBigInt="ZodBigInt",s.ZodBoolean="ZodBoolean",s.ZodDate="ZodDate",s.ZodSymbol="ZodSymbol",s.ZodUndefined="ZodUndefined",s.ZodNull="ZodNull",s.ZodAny="ZodAny",s.ZodUnknown="ZodUnknown",s.ZodNever="ZodNever",s.ZodVoid="ZodVoid",s.ZodArray="ZodArray",s.ZodObject="ZodObject",s.ZodUnion="ZodUnion",s.ZodDiscriminatedUnion="ZodDiscriminatedUnion",s.ZodIntersection="ZodIntersection",s.ZodTuple="ZodTuple",s.ZodRecord="ZodRecord",s.ZodMap="ZodMap",s.ZodSet="ZodSet",s.ZodFunction="ZodFunction",s.ZodLazy="ZodLazy",s.ZodLiteral="ZodLiteral",s.ZodEnum="ZodEnum",s.ZodEffects="ZodEffects",s.ZodNativeEnum="ZodNativeEnum",s.ZodOptional="ZodOptional",s.ZodNullable="ZodNullable",s.ZodDefault="ZodDefault",s.ZodCatch="ZodCatch",s.ZodPromise="ZodPromise",s.ZodBranded="ZodBranded",s.ZodPipeline="ZodPipeline",s.ZodReadonly="ZodReadonly"})(ge||(ge={}));const yt=Rt.create;It.create;ut.create;const va=He.create;lr.create;cr.create;Yt.create;ps.create;dr.create;At.create;bs.create;const Ox=va({email:yt().email("Adresse email invalide"),password:yt().min(6,"Le mot de passe doit contenir au moins 6 caractÃ¨res")}),Lx=va({username:yt().min(3,"Le pseudo doit contenir au moins 3 caractÃ¨res").max(20,"Le pseudo ne peut pas dÃ©passer 20 caractÃ¨res"),email:yt().email("Adresse email invalide"),password:yt().min(6,"Le mot de passe doit contenir au moins 6 caractÃ¨res"),confirmPassword:yt()}).refine(s=>s.password===s.confirmPassword,{message:"Les mots de passe ne correspondent pas",path:["confirmPassword"]}),Ix=()=>{const[s,t]=u.useState(!0),[r,n]=u.useState(!1),[a,i]=u.useState(!1),[o,l]=u.useState(null),[c,d]=u.useState({}),[m,x]=u.useState(""),[p,f]=u.useState(""),[h,g]=u.useState(""),[v,j]=u.useState(""),[M,P]=u.useState(!1),[C,I]=u.useState(""),[O,w]=u.useState(!1),[E,V]=u.useState(!1),{user:A,login:B,signup:S}=Me(),J=mt(),me=qs();u.useEffect(()=>{b.log("  - user:",A==null?void 0:A.uid)},[A,E]),u.useEffect(()=>{var ee,z;if(b.log("ðŸ”„ useEffect redirection - user:",A==null?void 0:A.uid,"showTutorial:",E),A&&!E){const xe=((z=(ee=me.state)==null?void 0:ee.from)==null?void 0:z.pathname)||"/";J(xe,{replace:!0})}},[A,J,me,E]);const re=()=>{x(""),f(""),g(""),j(""),l(null),d({}),P(!1),I(""),w(!1)},Se=async ee=>{ee.preventDefault(),l(null),d({});try{s?Ox.parse({email:m,password:p}):Lx.parse({username:v,email:m,password:p,confirmPassword:h})}catch(z){if(z instanceof dt){const xe={};z.errors.forEach(L=>{L.path[0]&&(xe[L.path[0]]=L.message)}),d(xe);return}}i(!0);try{if(s){b.log("ðŸ”‘ Tentative de connexion...");const z=await B(m,p);z.error?(b.log("âŒ Erreur de connexion:",z.error),l(z.error)):b.log("âœ… Connexion rÃ©ussie")}else{b.log("ðŸ“ Tentative d'inscription...");const z=await S(m,p,v);b.log("ðŸ“Š RÃ©sultat inscription:",z),z.error?(b.log("âŒ Erreur d'inscription:",z.error),l(z.error)):z.userId?(b.log("âœ… Inscription rÃ©ussie! UserId:",z.userId),b.log("ðŸŽ“ Activation du tutoriel..."),V(!0),b.log("ðŸŽ“ Ã‰tat showTutorialAfterSignup:",!0)):b.log("âš ï¸ Inscription rÃ©ussie mais pas de userId retournÃ©")}}catch(z){b.error("ðŸ’¥ Erreur inattendue:",z)}finally{i(!1)}},ve=()=>{t(!s),re()},je=async ee=>{ee.preventDefault(),l(null),d({});try{yt().email().parse(C)}catch{d({resetEmail:"Adresse email invalide"});return}i(!0);try{const z=na();await pc(z,C),w(!0)}catch(z){z.code==="auth/user-not-found"?l("Aucun compte avec cet email"):l("Une erreur est survenue. Veuillez rÃ©essayer.")}finally{i(!1)}},K=async()=>{if(!(A!=null&&A.uid)){b.error("âŒ Pas d'utilisateur connectÃ©");return}try{b.log("âœ… Marquage du tutoriel comme complÃ©tÃ© pour:",A.uid);const ee=k(_,`users/${A.uid}`);await ce(ee,{hasSeenTutorial:!0,tutorialCompletedAt:Date.now()}),V(!1),J("/")}catch(ee){b.error("âŒ Erreur completion tutoriel:",ee),V(!1),J("/")}};return e.jsxs("div",{className:"flex min-h-screen items-center justify-center bg-background p-4",children:[(b.log("ðŸŽ¨ Rendu - user:",A==null?void 0:A.uid),null),E&&A&&e.jsxs(e.Fragment,{children:[b.log("ðŸŽ“ AFFICHAGE DU TUTORIEL CONFIRMÃ‰"),e.jsx(TutorialOverlay,{onComplete:K})]}),E&&!A&&e.jsx(e.Fragment,{children:b.log("âš ï¸ showTutorialAfterSignup=true MAIS user=null")}),!E&&e.jsx(e.Fragment,{children:b.log("â„¹ï¸ Tutoriel non affichÃ© (showTutorialAfterSignup=false)")}),e.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[e.jsx("div",{className:"absolute left-1/4 top-1/4 h-64 w-64 rounded-full bg-primary/5 blur-3xl"}),e.jsx("div",{className:"absolute bottom-1/4 right-1/4 h-64 w-64 rounded-full bg-secondary/5 blur-3xl"})]}),e.jsxs(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative z-10 w-full max-w-md",children:[e.jsxs(W.div,{initial:{scale:.8},animate:{scale:1},className:"mb-8 text-center",children:[e.jsx(W.span,{animate:{rotate:[0,5,-5,0]},transition:{duration:2,repeat:1/0},className:"mb-4 inline-block text-6xl",children:"âš½"}),e.jsxs("h1",{className:"text-3xl font-bold text-foreground",children:["Baby-Foot ",e.jsx("span",{className:"text-primary text-glow-cyan",children:"App"})]})]}),e.jsxs(U,{className:"border-border/50 bg-card/80 backdrop-blur-xl",children:[e.jsxs(he,{className:"text-center",children:[e.jsx(fe,{className:"text-2xl",children:M?"Mot de passe oubliÃ©":s?"Connexion":"Inscription"}),e.jsx(fa,{children:M?"Entrez votre email pour rÃ©initialiser votre mot de passe":s?"Connectez-vous pour accÃ©der Ã  votre compte":"CrÃ©ez votre compte pour rejoindre la communautÃ©"})]}),e.jsxs(H,{children:[M?e.jsxs("form",{onSubmit:je,className:"space-y-4",children:[O?e.jsxs(W.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"rounded-lg bg-green-500/10 p-4 text-center",children:[e.jsxs("p",{className:"text-sm text-green-600 dark:text-green-400",children:["âœ“ Un email de rÃ©initialisation a Ã©tÃ© envoyÃ© Ã  ",C]}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:"VÃ©rifiez votre boÃ®te mail (et les spams)"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx($a,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(ye,{type:"email",placeholder:"Email",value:C,onChange:ee=>I(ee.target.value),className:"pl-10",disabled:a})]}),c.resetEmail&&e.jsx("p",{className:"text-xs text-destructive",children:c.resetEmail})]}),o&&e.jsxs(W.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"flex items-center gap-2 rounded-lg bg-destructive/10 p-3 text-sm text-destructive",children:[e.jsx(us,{className:"h-4 w-4 shrink-0"}),o]}),e.jsx(T,{type:"submit",className:"w-full",disabled:a,children:a?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"mr-2 h-4 w-4 animate-spin"}),"Envoi en cours..."]}):"Envoyer le lien de rÃ©initialisation"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{type:"button",onClick:()=>{P(!1),I(""),w(!1),l(null),d({})},className:"text-sm text-muted-foreground hover:text-foreground",disabled:a,children:"â† Retour Ã  la connexion"})})]}):e.jsxs("form",{onSubmit:Se,className:"space-y-4",children:[e.jsx(rt,{mode:"wait",children:!s&&e.jsxs(W.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Us,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(ye,{type:"text",placeholder:"Pseudo",value:v,onChange:ee=>j(ee.target.value),className:"pl-10",disabled:a})]}),c.username&&e.jsx("p",{className:"text-xs text-destructive",children:c.username})]},"username")}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx($a,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(ye,{type:"email",placeholder:"Email",value:m,onChange:ee=>x(ee.target.value),className:"pl-10",disabled:a})]}),c.email&&e.jsx("p",{className:"text-xs text-destructive",children:c.email})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Wt,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(ye,{type:r?"text":"password",placeholder:"Mot de passe",value:p,onChange:ee=>f(ee.target.value),className:"pl-10 pr-10",disabled:a}),e.jsx("button",{type:"button",onClick:()=>n(!r),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:r?e.jsx(ni,{className:"h-4 w-4"}):e.jsx(js,{className:"h-4 w-4"})})]}),c.password&&e.jsx("p",{className:"text-xs text-destructive",children:c.password})]}),e.jsx(rt,{mode:"wait",children:!s&&e.jsxs(W.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Wt,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(ye,{type:r?"text":"password",placeholder:"Confirmer le mot de passe",value:h,onChange:ee=>g(ee.target.value),className:"pl-10",disabled:a})]}),c.confirmPassword&&e.jsx("p",{className:"text-xs text-destructive",children:c.confirmPassword})]},"confirmPassword")}),e.jsx(rt,{children:o&&e.jsxs(W.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex items-center gap-2 rounded-lg bg-destructive/10 p-3 text-sm text-destructive",children:[e.jsx(us,{className:"h-4 w-4 shrink-0"}),o]})}),e.jsx(T,{type:"submit",className:"w-full",disabled:a,children:a?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"mr-2 h-4 w-4 animate-spin"}),s?"Connexion...":"Inscription..."]}):e.jsx(e.Fragment,{children:s?"Se connecter":"S'inscrire"})}),s&&e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"button",onClick:()=>P(!0),className:"text-sm text-muted-foreground hover:text-primary hover:underline",disabled:a,children:"Mot de passe oubliÃ© ?"})})]}),!M&&e.jsxs("div",{className:"mt-6 text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s?"Pas encore de compte ?":"DÃ©jÃ  un compte ?"}),e.jsx("button",{type:"button",onClick:ve,className:"mt-1 text-sm font-medium text-primary hover:underline",disabled:a,children:s?"CrÃ©er un compte":"Se connecter"})]})]})]}),e.jsx(W.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},className:"mt-4 text-center",children:e.jsx("button",{onClick:()=>J("/"),className:"text-sm text-muted-foreground hover:text-foreground",children:"â† Retour Ã  l'accueil"})})]})]})},Dx=()=>{const s=qs();return u.useEffect(()=>{b.error("404 Error: User attempted to access non-existent route:",s.pathname)},[s.pathname]),e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-muted",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"mb-4 text-4xl font-bold",children:"404"}),e.jsx("p",{className:"mb-4 text-xl text-muted-foreground",children:"Oops! Page not found"}),e.jsx("a",{href:"/",className:"text-primary underline hover:text-primary/90",children:"Return to Home"})]})})},Fx=va({password:yt().min(6,"Le mot de passe doit contenir au moins 6 caractÃ¨res"),confirmPassword:yt()}).refine(s=>s.password===s.confirmPassword,{message:"Les mots de passe ne correspondent pas",path:["confirmPassword"]}),zx=()=>{const{token:s}=rc(),t=mt(),[r,n]=u.useState(""),[a,i]=u.useState(""),[o,l]=u.useState(!1),[c,d]=u.useState(!1),[m,x]=u.useState(null),[p,f]=u.useState({}),[h,g]=u.useState(!1),v=async j=>{j.preventDefault(),x(null),f({});try{Fx.parse({password:r,confirmPassword:a})}catch(M){if(M instanceof dt){const P={};M.errors.forEach(C=>{C.path[0]&&(P[C.path[0]]=C.message)}),f(P);return}}d(!0);try{const M=await fetch(`/api/auth/reset-password/${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:r})}),P=await M.json();if(!M.ok)throw new Error(P.error||"Une erreur est survenue");g(!0),setTimeout(()=>{t("/auth")},3e3)}catch(M){x(M instanceof Error?M.message:"Une erreur est survenue. Veuillez rÃ©essayer.")}finally{d(!1)}};return e.jsxs("div",{className:"flex min-h-screen items-center justify-center bg-background p-4",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[e.jsx("div",{className:"absolute left-1/4 top-1/4 h-64 w-64 rounded-full bg-primary/5 blur-3xl"}),e.jsx("div",{className:"absolute bottom-1/4 right-1/4 h-64 w-64 rounded-full bg-secondary/5 blur-3xl"})]}),e.jsxs(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative z-10 w-full max-w-md",children:[e.jsxs(W.div,{initial:{scale:.8},animate:{scale:1},className:"mb-8 text-center",children:[e.jsx(W.span,{animate:{rotate:[0,5,-5,0]},transition:{duration:2,repeat:1/0},className:"mb-4 inline-block text-6xl",children:"âš½"}),e.jsxs("h1",{className:"text-3xl font-bold text-foreground",children:["Baby-Foot ",e.jsx("span",{className:"text-primary text-glow-cyan",children:"App"})]})]}),e.jsxs(U,{className:"border-border/50 bg-card/80 backdrop-blur-xl",children:[e.jsxs(he,{className:"text-center",children:[e.jsx(fe,{className:"text-2xl",children:h?"Mot de passe modifiÃ© !":"Nouveau mot de passe"}),e.jsx(fa,{children:h?"Vous allez Ãªtre redirigÃ© vers la page de connexion":"Choisissez un nouveau mot de passe pour votre compte"})]}),e.jsx(H,{children:h?e.jsxs(W.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"space-y-4 text-center",children:[e.jsx("div",{className:"mx-auto flex h-16 w-16 items-center justify-center rounded-full bg-green-500/10",children:e.jsx(zr,{className:"h-8 w-8 text-green-600 dark:text-green-400"})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Votre mot de passe a Ã©tÃ© rÃ©initialisÃ© avec succÃ¨s."}),e.jsx(T,{onClick:()=>t("/auth"),className:"w-full",children:"Se connecter maintenant"})]}):e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Wt,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(ye,{type:o?"text":"password",placeholder:"Nouveau mot de passe",value:r,onChange:j=>n(j.target.value),className:"pl-10 pr-10",disabled:c}),e.jsx("button",{type:"button",onClick:()=>l(!o),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:o?e.jsx(ni,{className:"h-4 w-4"}):e.jsx(js,{className:"h-4 w-4"})})]}),p.password&&e.jsx("p",{className:"text-xs text-destructive",children:p.password})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Wt,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(ye,{type:o?"text":"password",placeholder:"Confirmer le mot de passe",value:a,onChange:j=>i(j.target.value),className:"pl-10",disabled:c})]}),p.confirmPassword&&e.jsx("p",{className:"text-xs text-destructive",children:p.confirmPassword})]}),m&&e.jsxs(W.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"flex items-center gap-2 rounded-lg bg-destructive/10 p-3 text-sm text-destructive",children:[e.jsx(us,{className:"h-4 w-4 shrink-0"}),m]}),e.jsx(T,{type:"submit",className:"w-full",disabled:c,children:c?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"mr-2 h-4 w-4 animate-spin"}),"RÃ©initialisation..."]}):"RÃ©initialiser le mot de passe"})]})})]}),!h&&e.jsx(W.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},className:"mt-4 text-center",children:e.jsx("button",{onClick:()=>t("/auth"),className:"text-sm text-muted-foreground hover:text-foreground",children:"â† Retour Ã  la connexion"})})]})]})};async function xn(s,t={}){const{timeout:r=1e4,errorMessage:n="Une erreur est survenue",retries:a=1}=t;let i=null;for(let l=0;l<a;l++)try{return{data:await Promise.race([s(),new Promise((d,m)=>setTimeout(()=>m(new Error("Timeout")),r))]),error:null}}catch(c){if(i=c,logger.error(`Firebase query attempt ${l+1}/${a} failed:`,c),l<a-1){await new Promise(d=>setTimeout(d,1e3*(l+1)));continue}}let o=n;return i&&(i.message==="Timeout"?o="La requÃªte a pris trop de temps. VÃ©rifiez votre connexion.":i.code==="unavailable"||i.code==="network-request-failed"?o="Pas de connexion internet. VÃ©rifiez votre rÃ©seau.":i.code==="permission-denied"?o="Permission refusÃ©e. Vous n'avez pas accÃ¨s Ã  cette ressource.":i.code==="unauthenticated"?o="Vous devez Ãªtre connectÃ© pour effectuer cette action.":i.message&&(o=i.message)),{data:null,error:o}}const Bx=()=>{const{user:s,userProfile:t}=Me(),r=mt(),[n,a]=u.useState([]),[i,o]=u.useState([]),[l,c]=u.useState(""),[d,m]=u.useState(!0),[x,p]=u.useState(!1),[f,h]=u.useState(0),[g,v]=u.useState(!1),[j,M]=u.useState([]),[P,C]=u.useState([]),[I,O]=u.useState({}),[w,E]=u.useState({}),[V,A]=u.useState(null),[B,S]=u.useState(0),[J,me]=u.useState(0);u.useEffect(()=>{Se(),re()},[s]);const re=async()=>{if(s)try{const L=k(_,`users/${s.uid}`),R=await q(L);R.exists()&&h(R.val().fortune||0)}catch(L){b.error("Erreur chargement fortune:",L)}},Se=async()=>{m(!0);try{const[L,R]=await Promise.all([xn(()=>im(),{errorMessage:"Impossible de charger les matchs",retries:2}),xn(()=>oo(),{errorMessage:"Impossible de charger les joueurs",retries:2})]);if(L.error?$({title:"Erreur",description:L.error,variant:"destructive"}):L.data&&a(L.data),R.error)$({title:"Erreur",description:R.error,variant:"destructive"});else if(R.data){const Z=R.data.map(se=>({id:se.id,username:se.username,eloRating:se.eloGlobal}));o(Z)}}catch(L){$({title:"Erreur",description:L.message||"Impossible de charger les donnÃ©es",variant:"destructive"})}finally{m(!1)}},ve=async()=>{if(!s||j.length===0||P.length===0){$({title:"Erreur",description:"SÃ©lectionnez au moins 1 joueur par Ã©quipe",variant:"destructive"});return}p(!0);try{const L=await em(j,P,s.uid),R=[...j,...P],Z=R.map(se=>Qr(se,"âš½ Nouveau match disponible","Un nouveau match est ouvert aux paris. Tentez votre chance !").catch(N=>{b.error(`Erreur notification pour ${se}:`,N)}));await Promise.allSettled(Z),$({title:"Match crÃ©Ã©! ðŸŽ®",description:`${R.length} joueur(s) notifiÃ©(s)`}),v(!1),M([]),C([]),Se()}catch(L){b.error("Erreur crÃ©ation match:",L),$({title:"Erreur",description:L.message||"Impossible de crÃ©er le match",variant:"destructive"})}finally{p(!1)}},je=async(L,R)=>{if(!s||!t)return;const Z=I[L];if(!Z||Z<=0||!R){$({title:"Erreur",description:"Montant ou Ã©quipe invalide",variant:"destructive"});return}try{await tm(L,s.uid,t.username,Z,R),$({title:"Pari placÃ©! ðŸ’°",description:`${Z}â‚¬ sur l'Ã©quipe ${R}`}),Se(),re()}catch(se){$({title:"Erreur",description:se.message,variant:"destructive"})}},K=async L=>{try{await sm(L),$({title:"Match dÃ©marrÃ©! âš½",description:"Les paris sont fermÃ©s"}),Se()}catch(R){$({title:"Erreur",description:R.message,variant:"destructive"})}},ee=async()=>{if(V){if(B===J){$({title:"Erreur",description:"Match nul interdit",variant:"destructive"});return}try{const L=await am(V,B,J);if(L.winnings&&Object.keys(L.winnings).length>0){const R=Object.entries(L.winnings).map(([N,D])=>{const Q=Math.abs(D),y=D>0;return Lm(N,y,Q).catch(G=>{b.error(`Erreur notification pour ${N}:`,G)})});await Promise.allSettled(R);const Z=Object.values(L.winnings).filter(N=>N>0).length,se=Object.keys(L.winnings).length-Z;$({title:"Match terminÃ©! ðŸ†",description:`${Z} gagnant(s), ${se} perdant(s) notifiÃ©(s)`})}else $({title:"Match terminÃ©! ðŸ†",description:"Aucun pari n'a Ã©tÃ© placÃ©"});A(null),S(0),me(0),await Se(),await re()}catch(L){b.error("Erreur fin de match:",L),$({title:"Erreur",description:L.message||"Impossible de terminer le match",variant:"destructive"})}}},z=(L,R)=>{const Z=R===1?j:P,se=R===1?P:j,N=R===1?M:C,D=R===1?C:M;se.includes(L)&&D(se.filter(Q=>Q!==L)),Z.includes(L)?N(Z.filter(Q=>Q!==L)):Z.length<2&&N([...Z,L])},xe=L=>{const R=L.totalBetsTeam1+L.totalBetsTeam2;if(R===0)return{odds1:"2.00",odds2:"2.00"};const Z=L.totalBetsTeam1===0?R:R/L.totalBetsTeam1,se=L.totalBetsTeam2===0?R:R/L.totalBetsTeam2,N=Math.max(Z,1.1),D=Math.max(se,1.1);return b.log(`ðŸ“Š [COTES] Ã‰quipe 1: brut=${Z.toFixed(2)}, final=${N.toFixed(2)}`),b.log(`ðŸ“Š [COTES] Ã‰quipe 2: brut=${se.toFixed(2)}, final=${D.toFixed(2)}`),{odds1:N.toFixed(2),odds2:D.toFixed(2)}};return d?e.jsx(De,{children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(ue,{className:"h-8 w-8 animate-spin text-primary"})})}):e.jsxs(De,{children:[e.jsxs(W.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-4 sm:mb-6 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx(T,{variant:"ghost",size:"icon",onClick:()=>r("/match"),className:"rounded-xl",children:e.jsx(ur,{className:"h-4 w-4 sm:h-5 sm:w-5"})}),e.jsx("div",{className:"rounded-xl bg-primary/20 p-2 sm:p-3",children:e.jsx(Vt,{className:"h-5 w-5 sm:h-6 sm:w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg sm:text-2xl font-bold",children:"Paris"}),e.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground",children:[f.toLocaleString(),"â‚¬ disponibles"]})]})]}),e.jsxs(Fe,{open:g,onOpenChange:v,children:[e.jsx(nr,{asChild:!0,children:e.jsxs(T,{variant:"neon",children:[e.jsx(ns,{className:"h-4 w-4 mr-2"}),"CrÃ©er Match"]})}),e.jsxs(Pe,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Oe,{children:[e.jsx(Le,{className:"text-lg sm:text-xl",children:"CrÃ©er un match avec paris"}),e.jsx(Je,{children:"CrÃ©ez un match et permettez aux autres joueurs de parier sur le rÃ©sultat."})]}),e.jsxs("div",{className:"flex flex-col gap-3 sm:gap-4 mt-4",children:[e.jsx(ye,{placeholder:"Rechercher un joueur",value:l,onChange:L=>c(L.target.value)}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"font-semibold text-primary",children:["Ã‰quipe 1 (",j.length,"/2)"]}),e.jsx("div",{className:"space-y-1 max-h-64 overflow-y-auto",children:i.filter(L=>L.username.toLowerCase().includes(l.toLowerCase())).map(L=>e.jsxs("div",{onClick:()=>z(L.id,1),className:`p-2 rounded cursor-pointer transition ${j.includes(L.id)?"bg-primary text-primary-foreground":"bg-surface-alt hover:bg-surface-alt/70"}`,children:[L.username," (",L.eloRating,")"]},L.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"font-semibold text-red-500",children:["Ã‰quipe 2 (",P.length,"/2)"]}),e.jsx("div",{className:"space-y-1 max-h-64 overflow-y-auto",children:i.filter(L=>L.username.toLowerCase().includes(l.toLowerCase())).map(L=>e.jsxs("div",{onClick:()=>z(L.id,2),className:`p-2 rounded cursor-pointer transition ${P.includes(L.id)?"bg-red-500 text-white":"bg-surface-alt hover:bg-surface-alt/70"}`,children:[L.username," (",L.eloRating,")"]},L.id))})]})]})]}),e.jsx(T,{onClick:ve,disabled:x||j.length===0||P.length===0,className:"w-full mt-4",variant:"neon",children:x?e.jsx(ue,{className:"h-4 w-4 animate-spin"}):"CrÃ©er"})]})]})]}),e.jsx("div",{className:"space-y-4",children:n.length===0?e.jsx(U,{children:e.jsx(H,{className:"p-8 text-center text-muted-foreground",children:"Aucun match disponible"})}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"border-primary/30 bg-primary/5",children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"rounded-lg bg-primary/20 p-2",children:e.jsx(Ie,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-sm text-foreground mb-1",children:"ðŸ’¡ SystÃ¨me de cotes"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Distribution proportionnelle: vous rÃ©cupÃ©rez votre mise + votre part des pertes adverses. Plus l'Ã©quipe est favorite (plus de mises), plus la cote est basse. Pariez sur l'outsider pour des gains maximums !"})]})]})})}),n.map((L,R)=>{var N,D,Q;const Z=xe(L),se=s?(N=L.bets)==null?void 0:N[s.uid]:null;return e.jsx(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:R*.1},children:e.jsxs(U,{children:[e.jsx(he,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(fe,{className:"text-lg flex items-center gap-2",children:[e.jsx(Te,{className:"h-5 w-5 text-primary"}),((D=L.team1Names)==null?void 0:D.join(" & "))||"Ã‰quipe 1"," vs ",((Q=L.team2Names)==null?void 0:Q.join(" & "))||"Ã‰quipe 2"]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${L.status==="open"?"bg-green-500/20 text-green-500":L.status==="playing"?"bg-yellow-500/20 text-yellow-500":"bg-gray-500/20 text-gray-500"}`,children:L.status==="open"?"Paris ouverts":L.status==="playing"?"En cours":"TerminÃ©"})]})}),e.jsxs(H,{className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-primary/10",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ã‰quipe 1"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:[L.totalBetsTeam1,"â‚¬"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Cote: x",Z.odds1]})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-red-500/10",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ã‰quipe 2"}),e.jsxs("p",{className:"text-2xl font-bold text-red-500",children:[L.totalBetsTeam2,"â‚¬"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Cote: x",Z.odds2]})]})]}),se&&e.jsx("div",{className:"p-3 rounded-lg bg-accent/10 border border-accent",children:e.jsxs("p",{className:"text-sm",children:["Votre pari: ",e.jsxs("span",{className:"font-bold",children:[se.amount,"â‚¬"]})," sur"," ",e.jsxs("span",{className:"font-bold",children:["Ã‰quipe ",se.teamBet]})]})}),L.status==="open"&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx(ye,{type:"number",placeholder:"Montant (â‚¬)",value:I[L.id]||"",onChange:y=>O({...I,[L.id]:Number(y.target.value)}),className:"flex-1"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(T,{variant:w[L.id]===1?"default":"outline",onClick:()=>{E({...w,[L.id]:1}),je(L.id,1)},className:"flex-1",children:"Ã‰quipe 1"}),e.jsx(T,{variant:w[L.id]===2?"destructive":"outline",onClick:()=>{E({...w,[L.id]:2}),je(L.id,2)},className:"flex-1",children:"Ã‰quipe 2"})]})]}),L.status==="open"&&L.createdBy===(s==null?void 0:s.uid)&&e.jsxs(T,{onClick:()=>K(L.id),variant:"neon",className:"w-full",children:[e.jsx(ei,{className:"h-4 w-4 mr-2"}),"DÃ©marrer le match"]}),L.status==="playing"&&L.createdBy===(s==null?void 0:s.uid)&&e.jsxs(Fe,{open:V===L.id,onOpenChange:y=>A(y?L.id:null),children:[e.jsx(nr,{asChild:!0,children:e.jsxs(T,{variant:"neon",className:"w-full",children:[e.jsx(Te,{className:"h-4 w-4 mr-2"}),"Terminer le match"]})}),e.jsxs(Pe,{children:[e.jsxs(Oe,{children:[e.jsx(Le,{children:"Entrer les scores"}),e.jsx(Je,{children:"Entrez les scores finaux du match pour finaliser les paris."})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-primary",children:"Score Ã‰quipe 1"}),e.jsx(ye,{type:"number",value:B,onChange:y=>S(Number(y.target.value)),min:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-red-500",children:"Score Ã‰quipe 2"}),e.jsx(ye,{type:"number",value:J,onChange:y=>me(Number(y.target.value)),min:"0"})]})]}),e.jsx(T,{onClick:ee,variant:"neon",className:"w-full mt-4",children:"Valider"})]})]})]})]})},L.id)})]})})]})},ja=u.forwardRef(({className:s,...t},r)=>e.jsx("textarea",{className:de("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:r,...t}));ja.displayName="Textarea";const Ux=({cardCode:s,cardName:t,className:r})=>{const[n,a]=u.useState(!1),[i,o]=u.useState("season1");u.useEffect(()=>{(async()=>{const{getCardByCode:d}=await Ot(async()=>{const{getCardByCode:x}=await Promise.resolve().then(()=>Vs);return{getCardByCode:x}},void 0),m=d(s);m&&o(m.season)})()},[s]);const l=`/images/cards/${i}/${t}`;return n?e.jsx("div",{className:de("flex items-center justify-center bg-muted/50 rounded-lg",r),children:e.jsxs("div",{className:"text-center p-4",children:[e.jsx(Wl,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Image indisponible"})]})}):e.jsx("div",{className:de("relative overflow-hidden rounded-lg",r),children:e.jsx("img",{src:l,alt:t,className:"w-full h-full object-cover",onError:()=>{a(!0)},loading:"lazy"})})},qx=()=>{const{user:s}=Me(),[t,r]=u.useState([]),[n,a]=u.useState("all"),[i,o]=u.useState(""),[l,c]=u.useState(""),[d,m]=u.useState("recent"),[x,p]=u.useState(!1),[f,h]=u.useState(null),[g,v]=u.useState(""),[j,M]=u.useState(null),[P,C]=u.useState(""),[I,O]=u.useState(""),[w,E]=u.useState(!1),[V,A]=u.useState({}),B=async()=>{p(!0);try{const K=await gm();r(K);const z=[...new Set(K.map(R=>R.cardCode))].map(async R=>{const Z=await br(R);return{code:R,stats:Z}}),xe=await Promise.all(z),L={};xe.forEach(({code:R,stats:Z})=>{Z&&(L[R]=Z)}),A(L)}catch(K){b.error("âŒ Erreur chargement marchÃ©:",K),$({title:"Erreur",description:"Impossible de charger les annonces du marchÃ©.",variant:"destructive"})}finally{p(!1)}};u.useEffect(()=>{B()},[]);const S=u.useMemo(()=>{let K=t.filter(ee=>{if(n==="mine"&&ee.sellerId!==(s==null?void 0:s.uid)||n==="others"&&ee.sellerId===(s==null?void 0:s.uid))return!1;const z=i?ee.price>=Number(i):!0,xe=l?ee.price<=Number(l):!0,L=g?ee.cardCode.toLowerCase().includes(g.toLowerCase())||ee.cardName.toLowerCase().includes(g.toLowerCase()):!0;return z&&xe&&L});switch(d){case"price-low":K.sort((ee,z)=>ee.price-z.price);break;case"price-high":K.sort((ee,z)=>z.price-ee.price);break;case"popular":K.sort((ee,z)=>(z.views||0)-(ee.views||0));break;case"recent":default:K.sort((ee,z)=>z.createdAt-ee.createdAt);break}return K},[t,n,i,l,g,d,s==null?void 0:s.uid]),J=async K=>{if(s){h(K);try{await vm(s.uid,K),$({title:"Achat rÃ©ussi âœ…",description:"La carte a Ã©tÃ© ajoutÃ©e Ã  votre collection."}),await B()}catch(ee){$({title:"Erreur",description:ee.message||"Impossible d'acheter cette carte.",variant:"destructive"})}finally{h(null)}}},me=async K=>{if(s){h(K);try{await ym(s.uid,K),$({title:"Annonce annulÃ©e",description:"La carte a Ã©tÃ© remise dans votre collection."}),await B()}catch(ee){$({title:"Erreur",description:ee.message||"Impossible d'annuler cette annonce.",variant:"destructive"})}finally{h(null)}}},re=async K=>{M(K),E(!0),await bm(K.id);const ee=await wm(K.cardCode);C(ee.toString())},Se=async()=>{if(!s||!j)return;const K=Number(P);if(isNaN(K)||K<=0){$({title:"Erreur",description:"Montant invalide",variant:"destructive"});return}try{await jm(s.uid,j.id,K,I),$({title:"Offre envoyÃ©e âœ…",description:"Le vendeur a Ã©tÃ© notifiÃ© de votre offre."}),E(!1),C(""),O(""),await B()}catch(ee){$({title:"Erreur",description:ee.message||"Impossible d'envoyer l'offre.",variant:"destructive"})}},ve=(K,ee)=>{const z=V[ee];if(!z)return null;const xe=z.averagePrice,L=(K-xe)/xe*100;return{percentage:Math.abs(L).toFixed(1),isHigher:L>0,isGoodDeal:L<-10}},je=K=>{const ee=Math.floor((Date.now()-K)/1e3);if(ee<60)return`${ee}s`;const z=Math.floor(ee/60);if(z<60)return`${z}min`;const xe=Math.floor(z/60);return xe<24?`${xe}h`:`${Math.floor(xe/24)}j`};return e.jsxs(De,{children:[e.jsxs("div",{className:"container mx-auto max-w-6xl p-4",children:[e.jsxs("div",{className:"mb-6 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(Vt,{className:"h-7 w-7 text-yellow-400"}),"MarchÃ© des Cartes"]}),e.jsx("p",{className:"mt-1 text-muted-foreground text-sm",children:"Achetez et vendez vos cartes BabyDex entre joueurs."})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(T,{variant:"outline",size:"icon",onClick:B,disabled:x,children:e.jsx(ii,{className:`h-4 w-4 ${x?"animate-spin":""}`})})})]}),e.jsxs(U,{className:"mb-6",children:[e.jsx(he,{children:e.jsxs(fe,{className:"flex items-center gap-2 text-sm",children:[e.jsx(mr,{className:"h-4 w-4"}),"Filtres et Tri"]})}),e.jsxs(H,{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ot,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(ye,{placeholder:"Rechercher par nom ou code (ex: Lilwenn, N831)",value:g,onChange:K=>v(K.target.value),className:"pl-10"})]}),g&&e.jsx(T,{variant:"ghost",size:"icon",onClick:()=>v(""),className:"shrink-0",children:e.jsx(sr,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(T,{size:"sm",variant:n==="all"?"default":"outline",onClick:()=>a("all"),children:"Tout"}),e.jsx(T,{size:"sm",variant:n==="mine"?"default":"outline",onClick:()=>a("mine"),children:"Mes annonces"}),e.jsx(T,{size:"sm",variant:n==="others"?"default":"outline",onClick:()=>a("others"),children:"Annonces des autres"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(ye,{placeholder:"Prix min (â‚¬)",type:"number",value:i,onChange:K=>o(K.target.value),className:"w-32 text-xs"}),e.jsx(ye,{placeholder:"Prix max (â‚¬)",type:"number",value:l,onChange:K=>c(K.target.value),className:"w-32 text-xs"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground self-center",children:"Trier par:"}),e.jsx(T,{size:"sm",variant:d==="recent"?"default":"outline",onClick:()=>m("recent"),children:"RÃ©cents"}),e.jsx(T,{size:"sm",variant:d==="price-low"?"default":"outline",onClick:()=>m("price-low"),children:"Prix â†‘"}),e.jsx(T,{size:"sm",variant:d==="price-high"?"default":"outline",onClick:()=>m("price-high"),children:"Prix â†“"}),e.jsx(T,{size:"sm",variant:d==="popular"?"default":"outline",onClick:()=>m("popular"),children:"Populaires"})]})]})]}),x?e.jsxs("div",{className:"flex justify-center py-12 text-muted-foreground text-sm",children:[e.jsx(ue,{className:"h-6 w-6 animate-spin mr-2"}),"Chargement des annonces..."]}):S.length===0?e.jsx(U,{children:e.jsx(H,{className:"py-12 text-center text-muted-foreground text-sm",children:"Aucune annonce disponible pour le moment."})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:S.map(K=>{const ee=K.sellerId===(s==null?void 0:s.uid),z=ve(K.price,K.cardCode);return e.jsx(W.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:e.jsxs(U,{className:"h-full flex flex-col relative overflow-hidden",children:[(z==null?void 0:z.isGoodDeal)&&e.jsxs(le,{className:"absolute top-2 right-2 bg-green-500 text-white gap-1 z-10",children:[e.jsx(Hl,{className:"h-3 w-3"}),"Bon Deal"]}),e.jsx("div",{className:"relative h-48 bg-muted",children:e.jsx(Ux,{cardCode:K.cardCode,cardName:K.cardName,className:"h-full w-full"})}),e.jsx(he,{className:"pb-2",children:e.jsxs(fe,{className:"text-sm flex items-center justify-between gap-2",children:[e.jsx("span",{className:"truncate",children:K.cardName.replace(/\.(png|jpg|gif)$/i,"")}),e.jsx(le,{variant:"outline",className:"text-xs uppercase shrink-0",children:K.rarity})]})}),e.jsxs(H,{className:"flex-1 flex flex-col justify-between space-y-3 text-xs",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Code"}),e.jsx("span",{className:"font-mono text-primary",children:K.cardCode})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Prix"}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsxs("span",{className:"font-semibold text-foreground text-base",children:[K.price,"â‚¬"]}),z&&e.jsxs("span",{className:`text-[10px] flex items-center gap-1 ${z.isHigher?"text-red-500":"text-green-500"}`,children:[z.isHigher?e.jsx(Ie,{className:"h-3 w-3"}):e.jsx(cs,{className:"h-3 w-3"}),z.isHigher?"+":"-",z.percentage,"% vs moy."]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Vendeur"}),e.jsx("span",{className:"text-[11px] text-muted-foreground",children:ee?"Vous":K.sellerId.slice(0,8)+"..."})]}),e.jsxs("div",{className:"flex items-center justify-between pt-1 border-t",children:[e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(js,{className:"h-3 w-3"}),e.jsx("span",{children:K.views||0})]}),e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(Is,{className:"h-3 w-3"}),e.jsx("span",{children:K.offersCount||0})]}),e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(it,{className:"h-3 w-3"}),e.jsx("span",{children:je(K.createdAt)})]})]})]}),e.jsx("div",{className:"flex gap-2 pt-2",children:ee?e.jsxs(T,{size:"sm",variant:"outline",className:"flex-1 text-xs",onClick:()=>me(K.id),disabled:f===K.id,children:[e.jsx(sr,{className:"h-4 w-4 mr-1"}),f===K.id?"Annulation...":"Annuler"]}):e.jsxs(e.Fragment,{children:[e.jsxs(T,{size:"sm",className:"flex-1 text-xs",onClick:()=>J(K.id),disabled:f===K.id,children:[e.jsx(Zl,{className:"h-4 w-4 mr-1"}),f===K.id?"Achat...":"Acheter"]}),e.jsx(T,{size:"sm",variant:"outline",className:"text-xs",onClick:()=>re(K),children:e.jsx(Is,{className:"h-4 w-4"})})]})})]})]})},K.id)})})]}),e.jsx(Fe,{open:w,onOpenChange:E,children:e.jsxs(Pe,{children:[e.jsxs(Oe,{children:[e.jsx(Le,{children:"Faire une offre"}),e.jsxs(Je,{children:["Proposez un prix pour ",j==null?void 0:j.cardName]})]}),e.jsxs("div",{className:"space-y-4",children:[j&&V[j.cardCode]&&e.jsxs("div",{className:"bg-muted p-3 rounded-lg space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(Ht,{className:"h-4 w-4"}),e.jsx("span",{className:"font-semibold",children:"Statistiques de marchÃ©"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Prix demandÃ©:"}),e.jsxs("span",{className:"font-semibold",children:[j.price,"â‚¬"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Prix moyen:"}),e.jsxs("span",{className:"font-semibold",children:[V[j.cardCode].averagePrice.toFixed(2),"â‚¬"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"DerniÃ¨re vente:"}),e.jsxs("span",{className:"font-semibold",children:[V[j.cardCode].lastSalePrice||"N/A","â‚¬"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Votre offre (â‚¬)"}),e.jsx(ye,{type:"number",placeholder:"Montant",value:P,onChange:K=>C(K.target.value)}),P&&j&&e.jsxs("p",{className:"mt-2 text-xs",children:[Number(P)<j.price*.7&&e.jsx("span",{className:"text-destructive",children:"âš ï¸ Offre trÃ¨s basse, risque de rejet"}),Number(P)>=j.price*.7&&Number(P)<j.price*.9&&e.jsx("span",{className:"text-yellow-600",children:"ðŸ’¡ Offre raisonnable"}),Number(P)>=j.price*.9&&e.jsx("span",{className:"text-green-600",children:"âœ“ Offre trÃ¨s compÃ©titive"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Message (optionnel)"}),e.jsx(ja,{placeholder:"Ajoutez un message au vendeur...",value:I,onChange:K=>O(K.target.value),rows:3})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(T,{variant:"outline",onClick:()=>E(!1),className:"flex-1",children:"Annuler"}),e.jsx(T,{onClick:Se,className:"flex-1",children:"Envoyer l'offre"})]})]})]})})]})},Vx={common:{label:"Commun",color:"bg-gray-500",textColor:"text-gray-400",borderColor:"border-gray-500/50",bgGlow:"bg-gray-500/10"},rare:{label:"Rare",color:"bg-blue-500",textColor:"text-blue-400",borderColor:"border-blue-500/50",bgGlow:"bg-blue-500/10"},epic:{label:"Ã‰pique",color:"bg-purple-500",textColor:"text-purple-400",borderColor:"border-purple-500/50",bgGlow:"bg-purple-500/10"},legendary:{label:"LÃ©gendaire",color:"bg-orange-500",textColor:"text-orange-400",borderColor:"border-orange-500/50",bgGlow:"bg-orange-500/10"},mythic:{label:"Mythique",color:"bg-gradient-to-r from-pink-500 via-purple-500 to-cyan-500",textColor:"text-transparent bg-clip-text bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400",borderColor:"border-pink-500/50",bgGlow:"bg-gradient-to-br from-pink-500/10 via-purple-500/10 to-cyan-500/10"}},Tr={all:{label:"Tout",icon:Et},avatar:{label:"Avatars",icon:ds},theme:{label:"ThÃ¨mes",icon:Mt},banner:{label:"BanniÃ¨res",icon:Ie},title:{label:"Titres",icon:Gt},effect:{label:"Effets",icon:vt},lootbox:{label:"Lootboxes",icon:ct}},Gx=()=>{const{user:s}=Me(),[t,r]=u.useState(0),[n,a]=u.useState({}),[i,o]=u.useState({avatar:"",theme:"",banner:"",title:"",effect:""}),[l,c]=u.useState(!1),[d,m]=u.useState("all"),[x,p]=u.useState(""),[f,h]=u.useState("price-asc"),[g,v]=u.useState(!1);u.useEffect(()=>{window.scrollTo({top:0,behavior:"auto"})},[]),u.useEffect(()=>{if(!s)return;const w=k(_,`users/${s.uid}`),E=et(w,V=>{try{if(V.exists()){const A=V.val();r(A.fortune||0),a(A.inventory||{}),o({avatar:A.avatar||A.equippedAvatar||"",theme:A.theme||A.equippedTheme||"",banner:A.banner||A.equippedBanner||"",title:A.title||A.equippedTitle||"",effect:A.effect||A.equippedEffect||""}),b.log("âœ… [Shop] Fortune mise Ã  jour en temps rÃ©el:",A.fortune||0)}}catch(A){b.error("Erreur chargement donnÃ©es:",A)}});return()=>E()},[s]);const j=ze.filter(w=>{const E=d==="all"||w.type===d,V=x===""||w.name.toLowerCase().includes(x.toLowerCase())||w.description.toLowerCase().includes(x.toLowerCase());return E&&V}).sort((w,E)=>{if(f==="price-asc")return w.price-E.price;if(f==="price-desc")return E.price-w.price;if(f==="rarity"){const V={common:0,rare:1,epic:2,legendary:3,mythic:4};return V[E.rarity||"common"]-V[w.rarity||"common"]}return 0}),M=async w=>{if(s){if(t<w.price){$({title:"Fonds insuffisants ðŸ’¸",description:`Il vous faut ${w.price}â‚¬ (vous avez ${t}â‚¬)`,variant:"destructive"});return}if(w.type==="lootbox"){c(!0);try{await Xi(s.uid,w.id,w.price);const E=k(_,`users/${s.uid}`),V=await q(E);if(V.exists()){const A=V.val();r(A.fortune||0),a(A.inventory||{})}$({title:"ðŸŽ Lootbox achetÃ©e!",description:`${w.name} a Ã©tÃ© ajoutÃ©e Ã  votre inventaire`})}catch(E){$({title:"Erreur",description:E.message,variant:"destructive"})}finally{c(!1)}return}if(C(w)){$({title:"DÃ©jÃ  possÃ©dÃ©",description:"Vous possÃ©dez dÃ©jÃ  cet item",variant:"destructive"});return}c(!0);try{await to(s.uid,w.id,w.type,w.price);const E=k(_,`users/${s.uid}`),V=await q(E);if(V.exists()){const A=V.val();r(A.fortune||0),a(A.inventory||{}),o({avatar:A.avatar||"",theme:A.theme||"",banner:A.banner||"",title:A.title||"",effect:A.effect||""})}$({title:"Achat rÃ©ussi! ðŸŽ‰",description:`${w.name} a Ã©tÃ© ajoutÃ© Ã  votre inventaire`}),w.type==="theme"&&Object.keys(n.theme||{}).length===0&&setTimeout(()=>window.location.reload(),1500)}catch(E){$({title:"Erreur",description:E.message,variant:"destructive"})}finally{c(!1)}}},P=async w=>{if(s){if(!C(w)){$({title:"Item non possÃ©dÃ©",description:"Vous devez d'abord acheter cet item",variant:"destructive"});return}c(!0);try{await ba(s.uid,w.id,w.type),o(E=>({...E,[w.type]:w.id})),$({title:"Ã‰quipÃ©! âœ…",description:`${w.name} est maintenant actif`}),w.type==="theme"&&setTimeout(()=>{window.location.reload()},1e3)}catch(E){$({title:"Erreur",description:E.message,variant:"destructive"})}finally{c(!1)}}},C=w=>w.type==="lootbox"?!1:n[w.type]&&typeof n[w.type]=="object"?!!n[w.type][w.id]:!!n[w.id],I=w=>n.lootbox&&n.lootbox[w]?n.lootbox[w]:n[w]?n[w]:0,O={total:ze.filter(w=>w.type!=="lootbox").length,owned:ze.filter(w=>w.type!=="lootbox"&&C(w)).length,affordable:j.filter(w=>t>=w.price).length};return e.jsx(De,{children:e.jsxs(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(Et,{className:"h-8 w-8 text-primary"}),"Boutique Premium"]}),e.jsx("p",{className:"mt-1 text-muted-foreground",children:"Personnalisez votre expÃ©rience de jeu"})]}),e.jsxs(U,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Votre fortune"}),e.jsxs("p",{className:"text-3xl font-bold text-primary",children:[t,"â‚¬"]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[O.affordable," item(s) disponible(s)"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx(U,{className:"bg-gradient-to-br from-primary/10 to-transparent border-primary/20",children:e.jsxs(H,{className:"p-4 flex items-center gap-3",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-primary/20 flex items-center justify-center",children:e.jsx(Et,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold",children:[O.owned,"/",O.total]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Items possÃ©dÃ©s"})]})]})}),e.jsx(U,{className:"bg-gradient-to-br from-green-500/10 to-transparent border-green-500/20",children:e.jsxs(H,{className:"p-4 flex items-center gap-3",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-green-500/20 flex items-center justify-center",children:e.jsx(nt,{className:"h-6 w-6 text-green-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:O.affordable}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ã€ votre portÃ©e"})]})]})}),e.jsx(U,{className:"bg-gradient-to-br from-orange-500/10 to-transparent border-orange-500/20",children:e.jsxs(H,{className:"p-4 flex items-center gap-3",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-orange-500/20 flex items-center justify-center",children:e.jsx(ds,{className:"h-6 w-6 text-orange-500"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold",children:[Math.round(O.owned/O.total*100),"%"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Collection"})]})]})})]}),e.jsx(U,{className:"mb-6",children:e.jsxs(H,{className:"p-4",children:[e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ot,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(ye,{placeholder:"Rechercher un item...",value:x,onChange:w=>p(w.target.value),className:"pl-10"}),x&&e.jsx(T,{variant:"ghost",size:"sm",className:"absolute right-1 top-1/2 transform -translate-y-1/2 h-7 w-7 p-0",onClick:()=>p(""),children:e.jsx(Ze,{className:"h-4 w-4"})})]}),e.jsx(T,{variant:"outline",size:"icon",onClick:()=>v(!g),children:e.jsx(mr,{className:"h-4 w-4"})})]}),e.jsx(rt,{children:g&&e.jsx(W.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsxs("div",{className:"pt-4 border-t space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"CatÃ©gories"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.keys(Tr).map(w=>{const E=Tr[w].icon;return e.jsxs(T,{variant:d===w?"default":"outline",size:"sm",onClick:()=>m(w),children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),Tr[w].label]},w)})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Trier par"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(T,{variant:f==="price-asc"?"default":"outline",size:"sm",onClick:()=>h("price-asc"),children:"Prix â†‘"}),e.jsx(T,{variant:f==="price-desc"?"default":"outline",size:"sm",onClick:()=>h("price-desc"),children:"Prix â†“"}),e.jsx(T,{variant:f==="rarity"?"default":"outline",size:"sm",onClick:()=>h("rarity"),children:"RaretÃ©"})]})]})]})})})]})}),j.length===0?e.jsx(U,{children:e.jsxs(H,{className:"p-12 text-center",children:[e.jsx(Et,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium text-muted-foreground",children:"Aucun item trouvÃ©"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Essayez de modifier vos filtres ou votre recherche"})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:j.map((w,E)=>{const V=C(w),A=i[w.type]===w.id,B=t>=w.price,S=Vx[w.rarity||"common"],J=w.type==="lootbox"?I(w.id):0;return e.jsx(W.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:E*.05},whileHover:{scale:1.03,y:-5},children:e.jsxs(U,{className:`relative overflow-hidden h-full transition-all ${A?`border-2 ${S.borderColor} shadow-lg`:"border-border hover:border-primary/50"} ${S.bgGlow}`,children:[e.jsx("div",{className:`absolute top-2 right-2 px-2 py-1 rounded-full text-xs font-bold text-white ${S.color} shadow-lg z-10`,children:S.label}),A&&e.jsxs("div",{className:"absolute top-2 left-2 px-2 py-1 rounded-full text-xs font-bold bg-primary text-primary-foreground shadow-lg z-10 flex items-center gap-1",children:[e.jsx(nt,{className:"h-3 w-3"}),"Ã‰quipÃ©"]}),J>0&&e.jsx("div",{className:"absolute top-2 left-2 bg-orange-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold text-sm z-10 shadow-lg",children:J}),e.jsxs(he,{className:"pb-3",children:[e.jsx("div",{className:"flex items-center justify-center h-24 text-6xl mb-2",children:w.type==="theme"&&w.preview?e.jsx("div",{className:"w-20 h-20 rounded-lg shadow-xl border-2 border-white/20",style:{backgroundColor:w.preview}}):w.type==="banner"&&w.preview?e.jsx("div",{className:"w-full h-16 rounded-lg shadow-xl border-2 border-white/20 relative overflow-hidden",style:{background:w.preview},children:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:w.icon})})}):w.type==="title"&&w.preview?e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("span",{className:"text-4xl",children:w.icon}),e.jsx("span",{className:"text-xs font-bold text-primary",children:w.preview})]}):e.jsx("span",{children:w.icon||"ðŸŽ"})}),e.jsx(fe,{className:"text-center text-lg",children:w.name}),e.jsx("p",{className:"text-sm text-muted-foreground text-center line-clamp-2",children:w.description})]}),e.jsxs(H,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("span",{className:`text-2xl font-bold ${S.textColor}`,children:[w.price,"â‚¬"]}),w.type!=="lootbox"&&e.jsx(le,{variant:V?"default":"outline",children:V?"PossÃ©dÃ©":"Non possÃ©dÃ©"})]}),w.type==="lootbox"?e.jsx(T,{className:"w-full",onClick:()=>M(w),disabled:!B||l,variant:B?"default":"secondary",children:B?e.jsxs(e.Fragment,{children:[e.jsx(ct,{className:"h-4 w-4 mr-2"}),"Acheter"]}):e.jsxs(e.Fragment,{children:[e.jsx(Wt,{className:"h-4 w-4 mr-2"}),"Fonds insuffisants"]})}):V?A?e.jsxs(T,{className:"w-full",variant:"outline",disabled:!0,children:[e.jsx(nt,{className:"h-4 w-4 mr-2"}),"Ã‰quipÃ©"]}):e.jsxs(T,{className:"w-full",onClick:()=>P(w),disabled:l,children:[e.jsx(Mt,{className:"h-4 w-4 mr-2"}),"Ã‰quiper"]}):e.jsx(T,{className:"w-full",onClick:()=>M(w),disabled:!B||l,variant:B?"default":"secondary",children:B?e.jsxs(e.Fragment,{children:[e.jsx(Et,{className:"h-4 w-4 mr-2"}),"Acheter"]}):e.jsxs(e.Fragment,{children:[e.jsx(Wt,{className:"h-4 w-4 mr-2"}),"Fonds insuffisants"]})})]})]})},w.id)})})]})})},Hx=wl,Zx=jl,Co=u.forwardRef(({className:s,...t},r)=>e.jsx(In,{className:de("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...t,ref:r}));Co.displayName=In.displayName;const So=u.forwardRef(({className:s,...t},r)=>e.jsxs(Zx,{children:[e.jsx(Co,{}),e.jsx(Dn,{ref:r,className:de("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...t})]}));So.displayName=Dn.displayName;const ko=({className:s,...t})=>e.jsx("div",{className:de("flex flex-col space-y-2 text-center sm:text-left",s),...t});ko.displayName="AlertDialogHeader";const _o=({className:s,...t})=>e.jsx("div",{className:de("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t});_o.displayName="AlertDialogFooter";const Eo=u.forwardRef(({className:s,...t},r)=>e.jsx(Fn,{ref:r,className:de("text-lg font-semibold",s),...t}));Eo.displayName=Fn.displayName;const Ro=u.forwardRef(({className:s,...t},r)=>e.jsx(zn,{ref:r,className:de("text-sm text-muted-foreground",s),...t}));Ro.displayName=zn.displayName;const $o=u.forwardRef(({className:s,...t},r)=>e.jsx(Bn,{ref:r,className:de(ha(),s),...t}));$o.displayName=Bn.displayName;const Ao=u.forwardRef(({className:s,...t},r)=>e.jsx(Un,{ref:r,className:de(ha({variant:"outline"}),"mt-2 sm:mt-0",s),...t}));Ao.displayName=Un.displayName;function Wx({open:s,onOpenChange:t,title:r,description:n,confirmText:a="Confirmer",cancelText:i="Annuler",onConfirm:o,variant:l="default"}){const c=()=>{o(),t(!1)};return e.jsx(Hx,{open:s,onOpenChange:t,children:e.jsxs(So,{children:[e.jsxs(ko,{children:[e.jsx(Eo,{children:r}),e.jsx(Ro,{children:n})]}),e.jsxs(_o,{children:[e.jsx(Ao,{children:i}),e.jsx($o,{onClick:c,className:l==="destructive"?"bg-destructive text-destructive-foreground hover:bg-destructive/90":"",children:a})]})]})})}const Pr=["âš½","ðŸ†","ðŸ”¥","âš¡","ðŸŽ¯","ðŸŒŸ","ðŸ’Ž","ðŸ‘‘"],Or=["#3b82f6","#8b5cf6","#ec4899","#f59e0b","#10b981","#06b6d4"],hn=[{id:"xpBoost",name:"Boost XP",description:"+20% d'ELO gagnÃ©",cost:500,icon:"ðŸ“ˆ"},{id:"fortuneBoost",name:"Boost Fortune",description:"+15% de gains",cost:750,icon:"ðŸ’°"},{id:"premiumCards",name:"Cartes Premium",description:"Double chance de cartes rares",cost:1e3,icon:"ðŸŽ´"}],Qx=()=>{const{user:s,userProfile:t}=Me(),[r,n]=u.useState(!1),[a,i]=u.useState(!1),[o,l]=u.useState(!1),[c,d]=u.useState(!1),[m,x]=u.useState(null),[p,f]=u.useState([]),[h,g]=u.useState(0),[v,j]=u.useState([]),[M,P]=u.useState(""),[C,I]=u.useState(!1),[O,w]=u.useState(!0),[E,V]=u.useState(""),[A,B]=u.useState(Pr[0]),[S,J]=u.useState(Or[0]),[me,re]=u.useState("");u.useEffect(()=>{if(!s){w(!1);return}let R=null;const Z=k(_,`users/${s.uid}`),se=et(Z,N=>{if(!N.exists()){w(!1);return}const D=N.val();g(D.fortune||0),R&&(R(),R=null),D.clubId?R=Qi(D.clubId,Q=>{if(Q){x(Q);const y=Q.members&&typeof Q.members=="object"?Object.values(Q.members):[];f(y)}else x(null),f([]);w(!1)}):(x(null),f([]),w(!1))},N=>{b.error("Erreur chargement donnÃ©es utilisateur:",N),w(!1)});return()=>{se(),R&&R()}},[s]);const Se=async()=>{I(!0);try{const R=k(_,"clubs"),Z=await q(R);if(!Z.exists()){j([]),I(!1);return}const se=Z.val(),N=Object.entries(se).map(([Q,y])=>({id:Q,name:y.name||"Club sans nom",logo:y.logo||"ðŸ†",color:y.color||"#3b82f6",founderId:y.founderId||"",treasury:y.treasury||0,totalEarnings:y.totalEarnings||0,members:y.members||{},bonuses:y.bonuses||{},createdAt:y.createdAt||Date.now()}));let D=N;M.trim()&&(D=N.filter(Q=>Q.name.toLowerCase().includes(M.toLowerCase()))),j(D)}catch(R){b.error("Erreur chargement clubs:",R),$({title:"Erreur",description:"Impossible de charger les clubs",variant:"destructive"})}finally{I(!1)}};u.useEffect(()=>{a&&Se()},[a,M]);const ve=async()=>{if(!(!s||!t)){if(!E.trim()){$({title:"Erreur",description:"Veuillez entrer un nom de club",variant:"destructive"});return}try{const R=await Vi(s.uid,t.username,E,A,S);await Qr(s.uid,"ðŸ† Club crÃ©Ã© avec succÃ¨s",`Votre club "${E}" est maintenant actif. Invitez des membres !`).catch(Z=>{b.error("Erreur notification crÃ©ation:",Z)}),$({title:"Club crÃ©Ã©! ðŸŽ‰",description:`${E} a Ã©tÃ© crÃ©Ã© avec succÃ¨s`}),n(!1),V(""),B(Pr[0]),J(Or[0])}catch(R){b.error("Erreur crÃ©ation club:",R),$({title:"Erreur",description:R.message||"Impossible de crÃ©er le club",variant:"destructive"})}}},je=async(R,Z)=>{if(!s||!t){$({title:"Erreur",description:"Vous devez Ãªtre connectÃ©",variant:"destructive"});return}try{const se=k(_,`clubs/${R}`);if(!(await q(se)).exists()){$({title:"Erreur",description:"Ce club n'existe plus",variant:"destructive"}),await Se();return}const D=k(_,`users/${s.uid}`),Q=await q(D);if(Q.exists()&&Q.val().clubId){$({title:"Erreur",description:"Vous Ãªtes dÃ©jÃ  dans un club. Quittez-le d'abord.",variant:"destructive"});return}await Gi(R,s.uid,t.username),$({title:"Club rejoint! ðŸŽ‰",description:`Vous avez rejoint ${Z}`}),i(!1),P("")}catch(se){b.error("Erreur rejoindre club:",se),$({title:"Erreur",description:se.message||"Impossible de rejoindre le club",variant:"destructive"})}},K=async()=>{if(!(!s||!m)){if(m.founderId===s.uid){$({title:"Action impossible",description:"Le fondateur ne peut pas quitter le club",variant:"destructive"});return}d(!0)}},ee=async()=>{if(!(!s||!m))try{await Wi(m.id,s.uid),$({title:"Club quittÃ©",description:"Vous avez quittÃ© le club avec succÃ¨s"})}catch(R){b.error("Erreur quitter club:",R),$({title:"Erreur",description:R.message||"Impossible de quitter le club",variant:"destructive"})}},z=async()=>{if(!s||!m)return;const R=parseInt(me);if(isNaN(R)||R<=0){$({title:"Erreur",description:"Montant invalide",variant:"destructive"});return}if(R>h){$({title:"Erreur",description:"Fonds insuffisants",variant:"destructive"});return}try{await Hi(s.uid,m.id,R),$({title:"Contribution ajoutÃ©e! ðŸ’°",description:`${R}â‚¬ ajoutÃ©s Ã  la trÃ©sorerie`}),l(!1),re("")}catch(Z){b.error("Erreur contribution:",Z),$({title:"Erreur",description:Z.message||"Impossible de contribuer",variant:"destructive"})}},xe=async(R,Z)=>{var se;if(!(!m||!s)){if((m.treasury||0)<Z){$({title:"Fonds insuffisants",description:"La trÃ©sorerie du club est insuffisante",variant:"destructive"});return}try{if(await Zi(m.id,R,Z),m.members){const N=((se=hn.find(y=>y.id===R))==null?void 0:se.name)||"Bonus",D=Object.keys(m.members),Q=D.map(y=>Qr(y,"ðŸŽ Nouveau bonus de club",`Le bonus "${N}" est maintenant actif pour tous les membres !`).catch(G=>{b.error(`Erreur notification pour ${y}:`,G)}));await Promise.allSettled(Q),$({title:"Bonus achetÃ©! ðŸŽ‰",description:`${D.length} membre(s) notifiÃ©(s)`})}else $({title:"Bonus achetÃ©! ðŸŽ‰",description:"Le bonus est maintenant actif"})}catch(N){b.error("Erreur achat bonus:",N),$({title:"Erreur",description:N.message||"Impossible d'acheter le bonus",variant:"destructive"})}}},L=R=>!R||!R.members?0:Object.keys(R.members).length;return O?e.jsx(De,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ue,{className:"h-8 w-8 animate-spin text-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Chargement..."})]})})}):m?e.jsxs(De,{children:[e.jsxs(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsx(U,{className:"mb-6",style:{borderColor:m.color},children:e.jsx(he,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"text-6xl w-20 h-20 flex items-center justify-center rounded-lg",style:{backgroundColor:m.color+"20"},children:m.logo}),e.jsxs("div",{children:[e.jsx(fe,{className:"text-2xl",children:m.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[L(m)," membre",L(m)>1?"s":""]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"TrÃ©sorerie"}),e.jsxs("p",{className:"text-3xl font-bold text-primary",children:[m.treasury||0,"â‚¬"]})]}),m.founderId!==(s==null?void 0:s.uid)&&e.jsxs(T,{variant:"destructive",size:"sm",onClick:K,children:[e.jsx(aa,{className:"h-4 w-4 mr-2"}),"Quitter"]})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs(U,{children:[e.jsx(he,{children:e.jsxs(fe,{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"h-5 w-5 text-primary"}),"Contribuer"]})}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Votre fortune: ",e.jsxs("span",{className:"font-bold text-foreground",children:[h,"â‚¬"]})]}),e.jsxs(T,{onClick:()=>l(!0),className:"w-full",children:[e.jsx(ct,{className:"h-4 w-4 mr-2"}),"Faire un don"]})]})]}),e.jsxs(U,{children:[e.jsx(he,{children:e.jsx(fe,{children:"Statistiques"})}),e.jsxs(H,{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total gagnÃ©"}),e.jsxs("span",{className:"font-bold",children:[m.totalEarnings||0,"â‚¬"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Membres actifs"}),e.jsx("span",{className:"font-bold",children:L(m)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Bonus actifs"}),e.jsx("span",{className:"font-bold",children:m.bonuses?Object.values(m.bonuses).filter(Boolean).length:0})]})]})]})]}),e.jsxs(U,{className:"mb-6",children:[e.jsx(he,{children:e.jsx(fe,{children:"Bonus du club"})}),e.jsx(H,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:hn.map(R=>{const Z=m.bonuses&&m.bonuses[R.id],se=(m.treasury||0)>=R.cost;return e.jsx(U,{className:Z?"border-primary":"",children:e.jsxs(H,{className:"p-4",children:[e.jsx("div",{className:"text-4xl mb-2 text-center",children:R.icon}),e.jsx("h3",{className:"font-bold text-center mb-1",children:R.name}),e.jsx("p",{className:"text-xs text-muted-foreground text-center mb-3",children:R.description}),Z?e.jsx(T,{size:"sm",className:"w-full",variant:"outline",disabled:!0,children:"Actif âœ“"}):e.jsxs(T,{size:"sm",className:"w-full",onClick:()=>xe(R.id,R.cost),disabled:!se,variant:se?"default":"secondary",children:[R.cost,"â‚¬"]})]})},R.id)})})})]}),e.jsxs(U,{children:[e.jsx(he,{children:e.jsxs(fe,{children:["Membres (",p.length,")"]})}),e.jsx(H,{children:p.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Aucun membre"}):e.jsx("div",{className:"space-y-2",children:p.sort((R,Z)=>Z.contributions-R.contributions).map(R=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-surface-alt",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[R.role==="founder"&&e.jsx($t,{className:"h-5 w-5 text-gold"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:R.username}),e.jsx("p",{className:"text-xs text-muted-foreground",children:R.role==="founder"?"Fondateur":"Membre"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-bold text-primary",children:[R.contributions,"â‚¬"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Contributions"})]})]},R.userId))})})]}),e.jsx(Fe,{open:o,onOpenChange:l,children:e.jsxs(Pe,{children:[e.jsxs("button",{onClick:()=>l(!1),className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none z-50",children:[e.jsx(Ze,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Fermer"})]}),e.jsxs(Oe,{children:[e.jsx(Le,{children:"Contribuer Ã  la trÃ©sorerie"}),e.jsx(Je,{children:"Ajoutez de la fortune Ã  la trÃ©sorerie de votre club."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Votre fortune: ",e.jsxs("span",{className:"font-bold text-foreground",children:[h,"â‚¬"]})]}),e.jsx(ye,{type:"number",value:me,onChange:R=>re(R.target.value),placeholder:"Montant",min:"1",max:h}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(T,{onClick:()=>l(!1),variant:"outline",className:"flex-1",children:"Annuler"}),e.jsx(T,{onClick:z,className:"flex-1",children:"Contribuer"})]})]})]})})]}),e.jsx(Wx,{open:c,onOpenChange:d,title:"Quitter le club",description:"ÃŠtes-vous sÃ»r de vouloir quitter ce club ? Vos contributions resteront dans la trÃ©sorerie.",confirmText:"Quitter",cancelText:"Annuler",onConfirm:ee,variant:"destructive"})]}):e.jsx(De,{children:e.jsxs(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"max-w-2xl mx-auto",children:[e.jsxs(U,{className:"text-center p-8 sm:p-12",children:[e.jsx(Re,{className:"h-16 w-16 mx-auto mb-4 text-muted-foreground"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Vous n'avez pas de club"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"CrÃ©ez ou rejoignez un club pour profiter des bonus collectifs"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsxs(T,{onClick:()=>n(!0),size:"lg",className:"w-full sm:w-auto",children:[e.jsx(ns,{className:"h-5 w-5 mr-2"}),"CrÃ©er un club"]}),e.jsxs(T,{onClick:()=>i(!0),size:"lg",variant:"outline",className:"w-full sm:w-auto",children:[e.jsx(ot,{className:"h-5 w-5 mr-2"}),"Rejoindre un club"]})]})]}),e.jsx(Fe,{open:r,onOpenChange:n,children:e.jsxs(Pe,{children:[e.jsxs("button",{onClick:()=>n(!1),className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none z-50",children:[e.jsx(Ze,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Fermer"})]}),e.jsxs(Oe,{children:[e.jsx(Le,{children:"CrÃ©er un club"}),e.jsx(Je,{children:"CrÃ©ez votre propre club et invitez d'autres joueurs Ã  vous rejoindre."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Nom du club"}),e.jsx(ye,{value:E,onChange:R=>V(R.target.value),placeholder:"Les Champions",maxLength:20})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Logo"}),e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-2",children:Pr.map(R=>e.jsx("button",{onClick:()=>B(R),className:`text-4xl p-4 rounded-lg border-2 transition-all ${A===R?"border-primary bg-primary/10":"border-border hover:border-primary/50"}`,children:R},R))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Couleur"}),e.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-6 gap-2",children:Or.map(R=>e.jsx("button",{onClick:()=>J(R),className:`h-12 rounded-lg border-2 transition-all ${S===R?"border-white scale-110":"border-transparent"}`,style:{backgroundColor:R}},R))})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(T,{onClick:()=>n(!1),variant:"outline",className:"flex-1",children:"Annuler"}),e.jsx(T,{onClick:ve,className:"flex-1",children:"CrÃ©er le club"})]})]})]})}),e.jsx(Fe,{open:a,onOpenChange:i,children:e.jsxs(Pe,{className:"max-w-2xl max-h-[80vh]",children:[e.jsxs("button",{onClick:()=>i(!1),className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none z-50",children:[e.jsx(Ze,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Fermer"})]}),e.jsxs(Oe,{children:[e.jsx(Le,{children:"Rejoindre un club"}),e.jsx(Je,{children:"Recherchez et rejoignez un club existant."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ot,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(ye,{placeholder:"Rechercher un club...",value:M,onChange:R=>P(R.target.value),className:"pl-10"})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto space-y-2",children:C?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(ue,{className:"h-6 w-6 animate-spin text-primary"})}):v.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Re,{className:"h-12 w-12 mx-auto mb-3 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:M?"Aucun club trouvÃ©":"Aucun club disponible"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Soyez le premier Ã  crÃ©er un club !"})]}):v.map(R=>e.jsx(U,{className:"hover:border-primary/50 transition-colors",children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"text-4xl w-14 h-14 flex items-center justify-center rounded-lg",style:{backgroundColor:R.color+"20"},children:R.logo}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:R.name}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[e.jsxs("span",{children:[L(R)," membre",L(R)>1?"s":""]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:[R.treasury||0,"â‚¬ de trÃ©sorerie"]})]})]})]}),e.jsx(T,{onClick:()=>je(R.id,R.name),size:"sm",children:"Rejoindre"})]})})},R.id))}),e.jsx(T,{onClick:()=>{i(!1),P("")},variant:"outline",className:"w-full mt-4",children:"Fermer"})]})]})})]})})},Lr={common:{label:"Commun",color:"bg-gray-500",textColor:"text-gray-400",borderColor:"border-gray-500/50",glowColor:"shadow-gray-500/50"},rare:{label:"Rare",color:"bg-blue-500",textColor:"text-blue-400",borderColor:"border-blue-500/50",glowColor:"shadow-blue-500/50"},epic:{label:"Ã‰pique",color:"bg-purple-500",textColor:"text-purple-400",borderColor:"border-purple-500/50",glowColor:"shadow-purple-500/50"},legendary:{label:"LÃ©gendaire",color:"bg-orange-500",textColor:"text-orange-400",borderColor:"border-orange-500/50",glowColor:"shadow-orange-500/50"},mythic:{label:"Mythique",color:"bg-gradient-to-r from-pink-500 via-purple-500 to-cyan-500",textColor:"text-transparent bg-clip-text bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400",borderColor:"border-pink-500/50",glowColor:"shadow-pink-500/50"}},Jx=()=>{const{user:s}=Me(),[t,r]=u.useState({}),[n,a]=u.useState({avatar:"",theme:"",banner:"",title:"",effect:""}),[i,o]=u.useState(!0),[l,c]=u.useState(!1),[d,m]=u.useState("items"),[x,p]=u.useState(!1),[f,h]=u.useState(null),[g,v]=u.useState(!1);u.useEffect(()=>{if(!s)return;o(!0);const A=k(_,`users/${s.uid}`),B=et(A,S=>{try{if(S.exists()){const J=S.val();r(J.inventory||{}),a({avatar:J.avatar||"",theme:J.theme||"",banner:J.banner||"",title:J.title||"",effect:J.effect||""}),b.log("âœ… [Inventory] Inventaire mis Ã  jour en temps rÃ©el")}}catch(J){b.error("Erreur chargement inventaire:",J),$({title:"Erreur",description:"Impossible de charger l'inventaire",variant:"destructive"})}finally{o(!1)}});return()=>B()},[s]);const j=async()=>{},M=async(A,B)=>{if(s){c(!0);try{await ba(s.uid,A,B),a(J=>({...J,[B]:A}));const S=ze.find(J=>J.id===A);$({title:"Ã‰quipÃ©! âœ…",description:`${(S==null?void 0:S.name)||A} est maintenant actif`}),B==="theme"&&setTimeout(()=>window.location.reload(),1e3)}catch(S){$({title:"Erreur",description:S.message,variant:"destructive"})}finally{c(!1)}}},P=async A=>{if(s){p(!0);try{const B=await Ki(s.uid,A);h(B),v(!0),await j(),$({title:"ðŸŽ‰ Lootbox ouverte!",description:`Vous avez reÃ§u ${B.rewards.length} items et ${B.fortuneBonus}â‚¬!`})}catch(B){$({title:"Erreur",description:B.message,variant:"destructive"})}finally{p(!1)}}},C=()=>{const A=[];return ze.forEach(B=>{t[B.type]&&typeof t[B.type]=="object"?t[B.type][B.id]&&A.push(B):t[B.id]&&A.push(B)}),A},I=()=>{const A=[];return ze.forEach(B=>{if(B.type==="lootbox"){let S=0;t.lootbox&&t.lootbox[B.id]?S=t.lootbox[B.id]:t[B.id]&&(S=t[B.id]),S>0&&A.push({...B,count:S})}}),A},O=C().filter(A=>A.type!=="lootbox"),w=I(),E={avatar:O.filter(A=>A.type==="avatar"),theme:O.filter(A=>A.type==="theme"),banner:O.filter(A=>A.type==="banner"),title:O.filter(A=>A.type==="title"),effect:O.filter(A=>A.type==="effect")},V={total:O.length,avatars:E.avatar.length,themes:E.theme.length,banners:E.banner.length,titles:E.title.length,effects:E.effect.length,lootboxes:w.reduce((A,B)=>A+B.count,0)};return i?e.jsx(De,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ue,{className:"h-8 w-8 animate-spin text-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Chargement de l'inventaire..."})]})})}):e.jsx(De,{children:e.jsxs(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(_s,{className:"h-8 w-8 text-primary"}),"Mon Inventaire"]}),e.jsx("p",{className:"mt-1 text-muted-foreground",children:"GÃ©rez vos items et Ã©quipements"})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-6",children:[e.jsx(U,{children:e.jsxs(H,{className:"p-4 text-center",children:[e.jsx(_s,{className:"h-6 w-6 mx-auto mb-2 text-primary"}),e.jsx("p",{className:"text-2xl font-bold",children:V.total}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Items"})]})}),e.jsx(U,{children:e.jsxs(H,{className:"p-4 text-center",children:[e.jsx(ds,{className:"h-6 w-6 mx-auto mb-2 text-blue-500"}),e.jsx("p",{className:"text-2xl font-bold",children:V.avatars}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Avatars"})]})}),e.jsx(U,{children:e.jsxs(H,{className:"p-4 text-center",children:[e.jsx(Mt,{className:"h-6 w-6 mx-auto mb-2 text-purple-500"}),e.jsx("p",{className:"text-2xl font-bold",children:V.themes}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ThÃ¨mes"})]})}),e.jsx(U,{children:e.jsxs(H,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl mx-auto mb-2",children:"ðŸŽ¯"}),e.jsx("p",{className:"text-2xl font-bold",children:V.banners}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"BanniÃ¨res"})]})}),e.jsx(U,{children:e.jsxs(H,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl mx-auto mb-2",children:"ðŸ·ï¸"}),e.jsx("p",{className:"text-2xl font-bold",children:V.titles}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Titres"})]})}),e.jsx(U,{children:e.jsxs(H,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl mx-auto mb-2",children:"âš¡"}),e.jsx("p",{className:"text-2xl font-bold",children:V.effects}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Effets"})]})}),e.jsx(U,{children:e.jsxs(H,{className:"p-4 text-center",children:[e.jsx(ct,{className:"h-6 w-6 mx-auto mb-2 text-orange-500"}),e.jsx("p",{className:"text-2xl font-bold",children:V.lootboxes}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Lootboxes"})]})})]}),e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsxs(T,{variant:d==="items"?"default":"outline",onClick:()=>m("items"),children:[e.jsx(_s,{className:"h-4 w-4 mr-2"}),"Items (",V.total,")"]}),e.jsxs(T,{variant:d==="lootboxes"?"default":"outline",onClick:()=>m("lootboxes"),children:[e.jsx(ct,{className:"h-4 w-4 mr-2"}),"Lootboxes (",V.lootboxes,")"]})]}),e.jsx(rt,{mode:"wait",children:d==="items"?e.jsx(W.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},children:O.length===0?e.jsx(U,{children:e.jsxs(H,{className:"p-12 text-center",children:[e.jsx(_s,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium text-muted-foreground mb-2",children:"Inventaire vide"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Achetez des items dans la boutique pour les voir ici"})]})}):e.jsx("div",{className:"space-y-6",children:Object.entries(E).map(([A,B])=>B.length>0&&e.jsxs(U,{children:[e.jsx(he,{children:e.jsxs(fe,{className:"flex items-center gap-2 capitalize",children:[A==="avatar"&&e.jsx(ds,{className:"h-5 w-5 text-primary"}),A==="theme"&&e.jsx(Mt,{className:"h-5 w-5 text-primary"}),A==="banner"&&e.jsx("div",{className:"text-xl",children:"ðŸŽ¯"}),A==="title"&&e.jsx("div",{className:"text-xl",children:"ðŸ·ï¸"}),A==="effect"&&e.jsx("div",{className:"text-xl",children:"âš¡"}),A,"s (",B.length,")"]})}),e.jsx(H,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3",children:B.map(S=>{const J=n[A]===S.id,me=Lr[S.rarity||"common"];return e.jsxs(W.div,{whileHover:{scale:1.05},className:`p-3 rounded-lg border-2 transition-all text-center ${J?`${me.borderColor} bg-primary/5`:"border-border hover:border-primary/50"}`,children:[S.type==="theme"&&S.preview?e.jsx("div",{className:"w-16 h-16 rounded-lg mx-auto mb-2 border-2 border-white/20",style:{backgroundColor:S.preview}}):S.type==="banner"&&S.preview?e.jsx("div",{className:"w-full h-16 rounded-lg mx-auto mb-2 border-2 border-white/20 relative overflow-hidden",style:{background:S.preview},children:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:S.icon})})}):S.type==="title"&&S.preview?e.jsx("div",{className:"flex flex-col items-center gap-1 mb-1",children:e.jsxs("div",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-gradient-to-r from-sky-500/20 via-cyan-500/20 to-indigo-500/20 border border-cyan-400/50",children:[e.jsx("span",{className:"text-base",children:S.icon}),e.jsx("span",{className:"text-[9px] font-semibold tracking-wide uppercase text-cyan-100 line-clamp-1",children:S.preview})]})}):e.jsx("div",{className:"text-4xl mb-2",children:S.icon||S.preview}),e.jsx("p",{className:"text-xs font-medium mb-1 line-clamp-1",children:S.name}),J?e.jsx(le,{variant:"default",className:"w-full text-xs",children:"Ã‰quipÃ© âœ“"}):e.jsx(T,{size:"sm",variant:"outline",className:"w-full text-xs",onClick:()=>M(S.id,S.type),disabled:l,children:"Ã‰quiper"})]},S.id)})})})]},A))})},"items"):e.jsx(W.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},children:w.length===0?e.jsx(U,{children:e.jsxs(H,{className:"p-12 text-center",children:[e.jsx(ct,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium text-muted-foreground mb-2",children:"Aucune lootbox"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Achetez des lootboxes dans la boutique"})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:w.map(A=>{const B=Lr[A.rarity||"common"];return e.jsx(W.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},whileHover:{scale:1.03},children:e.jsxs(U,{className:`border-2 ${B.borderColor} relative overflow-hidden`,children:[A.count>1&&e.jsx("div",{className:"absolute top-2 right-2 bg-primary text-primary-foreground rounded-full w-8 h-8 flex items-center justify-center font-bold text-sm z-10",children:A.count}),e.jsxs(he,{children:[e.jsx(W.div,{className:"text-6xl text-center mb-2",animate:{rotate:[0,-10,10,-10,0]},transition:{duration:2,repeat:1/0,repeatDelay:1},children:A.icon||"ðŸŽ"}),e.jsx(fe,{className:"text-center",children:A.name}),e.jsx(le,{className:`${B.color} text-white mx-auto`,children:B.label})]}),e.jsxs(H,{children:[e.jsx("p",{className:"text-sm text-muted-foreground text-center mb-4",children:A.description}),e.jsx(T,{className:"w-full",onClick:()=>P(A.id),disabled:x,children:x?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"h-4 w-4 mr-2 animate-spin"}),"Ouverture..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ct,{className:"h-4 w-4 mr-2"}),"Ouvrir"]})})]})]})},A.id)})})},"lootboxes")}),e.jsx(rt,{children:g&&f&&e.jsx(W.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4",onClick:()=>v(!1),children:e.jsx(W.div,{initial:{scale:.8,y:50},animate:{scale:1,y:0},exit:{scale:.8,y:50},className:"max-w-2xl w-full",onClick:A=>A.stopPropagation(),children:e.jsxs(U,{className:"border-2 border-primary shadow-2xl",children:[e.jsxs(he,{className:"text-center pb-4",children:[e.jsx(W.div,{animate:{rotate:[0,360]},transition:{duration:1,ease:"easeInOut"},className:"text-6xl mb-4",children:"ðŸŽ‰"}),e.jsx(fe,{className:"text-3xl",children:"RÃ©compenses obtenues!"}),e.jsxs("p",{className:"text-muted-foreground mt-2",children:["Bonus de fortune: ",e.jsxs("span",{className:"text-primary font-bold",children:[f.fortuneBonus,"â‚¬"]})]})]}),e.jsxs(H,{children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 mb-6",children:f.rewards.map((A,B)=>{const S=ze.find(me=>me.id===A.itemId),J=Lr[A.rarity];return e.jsxs(W.div,{initial:{opacity:0,scale:0,rotateY:180},animate:{opacity:1,scale:1,rotateY:0},transition:{delay:B*.2,duration:.5},className:`p-4 rounded-lg border-2 ${J.borderColor} ${J.color} bg-opacity-10 text-center`,children:[e.jsx("div",{className:"text-5xl mb-2",children:(S==null?void 0:S.icon)||(S==null?void 0:S.preview)||"ðŸŽ"}),e.jsx("p",{className:"text-sm font-medium mb-1",children:S==null?void 0:S.name}),e.jsx(le,{className:`${J.color} text-white text-xs`,children:J.label})]},B)})}),e.jsxs(T,{className:"w-full",size:"lg",onClick:()=>v(!1),children:[e.jsx(Ql,{className:"h-4 w-4 mr-2"}),"GÃ©nial!"]})]})]})})})})]})})};function Yx(s,t){return{id:`match_round${t}_bye_${s.userId}`,round:t,team1:{playerIds:[s.userId],playerNames:[s.username],partnerId:s.partnerId||null,partnerName:s.partnerUsername||null},team2:{playerIds:[],playerNames:["BYE"],partnerId:null,partnerName:null},status:"completed",startTime:Date.now(),score1:10,score2:0,winnerId:s.userId,isBye:!0}}function Kx(s){const t=[...s];for(let r=t.length-1;r>0;r--){const n=Math.floor(Math.random()*(r+1));[t[r],t[n]]=[t[n],t[r]]}return t}async function Xx(s="active",t){var n,a;const r=k(_,`tournaments/${s}`);try{const i=await ci(r,c=>{var j;if(!c)return c;const d=Date.now();if((j=c.roundLock)!=null&&j.isLocked&&d-c.roundLock.lockedAt<3e4&&c.roundLock.lockedBy!==t)throw new Error("Un autre organisateur crÃ©e le round");const m=c.currentRound||1,x=c.matches||{},p=Object.values(x).filter(M=>M.round===m);if(!p.every(M=>M.status==="completed"))throw new Error("Tous les matchs du round actuel doivent Ãªtre terminÃ©s");let h=p.map(M=>{var I;const P=M.score1>M.score2?M.team1.playerIds[0]:M.team2.playerIds[0],C=M.score1>M.score2?M.team1:M.team2;return{userId:P,username:C.playerNames[0],eloRating:((I=c.players.find(O=>O.userId===P))==null?void 0:I.eloRating)||1e3,partnerId:C.partnerId,partnerUsername:C.partnerName}});if(h.length===1)return c.status="completed",c.winners=[h[0].userId],c.roundLock={isLocked:!1,lockedBy:"",lockedAt:0},c;c.roundLock={isLocked:!0,lockedBy:t,lockedAt:d},h=Kx(h);const g=m+1;let v=null;if(h.length%2!==0){v=h.pop();const M=Yx(v,g);x[M.id]=M}for(let M=0;M<h.length-1;M+=2){const P=h[M],C=h[M+1];if(P&&C){const I=`match_round${g}_${M}`;x[I]={id:I,round:g,team1:{playerIds:[P.userId],playerNames:[P.username],partnerId:P.partnerId||null,partnerName:P.partnerUsername||null},team2:{playerIds:[C.userId],playerNames:[C.username],partnerId:C.partnerId||null,partnerName:C.partnerUsername||null},status:"pending",startTime:d,score1:0,score2:0}}}return c.matches=x,c.currentRound=g,c.roundLock={isLocked:!1,lockedBy:"",lockedAt:0},c});if(!i.committed)return{success:!1,message:"Transaction annulÃ©e - rÃ©essayez"};const o=(n=i.snapshot.val())==null?void 0:n.currentRound,l=(a=i.snapshot.val())!=null&&a.matches?Object.values(i.snapshot.val().matches).filter(c=>c.round===o&&c.isBye).length:0;return{success:!0,message:`Round ${o} crÃ©Ã© avec succÃ¨s${l>0?` (${l} bye)`:""}`,newRound:o}}catch(i){return b.error("Erreur crÃ©ation round:",i),{success:!1,message:i.message||"Erreur lors de la crÃ©ation du round"}}}async function eh(s,t,r="active"){const n=k(_,`tournaments/${r}/matches/${s}`);try{return(await ci(n,i=>{if(!i)throw new Error("Match introuvable");if(i.status==="completed")throw new Error("Match dÃ©jÃ  terminÃ©");if(i.score1===i.score2)throw new Error("Le score ne peut pas Ãªtre une Ã©galitÃ©");const o=i.score1>i.score2?i.team1.playerIds[0]:i.team2.playerIds[0];return i.status="completed",i.winnerId=o,i})).committed?{success:!0,message:"Match terminÃ© avec succÃ¨s"}:{success:!1,message:"Transaction annulÃ©e"}}catch(a){return{success:!1,message:a.message||"Erreur lors de la fin du match"}}}async function th(s="active"){try{const t=k(_,`tournaments/${s}`),r=await q(t);if(!r.exists())return{isComplete:!1,winnersCount:0};const n=r.val(),a=n.currentRound||1,o=Object.values(n.matches||{}).filter(d=>d.round===a),l=o.every(d=>d.status==="completed"),c=o.length;return{isComplete:l,winnersCount:c}}catch(t){return b.error("Erreur vÃ©rification round:",t),{isComplete:!1,winnersCount:0}}}async function sh(s="active"){const t=k(_,`tournaments/${s}`);try{const r=await q(t);if(!r.exists())return{success:!1,message:"Tournoi introuvable"};const n=r.val();if(n.status!=="completed")return{success:!1,message:"Le tournoi n'est pas terminÃ©"};if(n.winners.length===0)return{success:!1,message:"Aucun gagnant trouvÃ©"};const a=Object.values(n.matches||{}),i=Math.max(...a.map(C=>C.round)),o=a.filter(C=>C.round===i&&C.status==="completed");if(o.length===0)return{success:!1,message:"Aucun match final trouvÃ©"};const l=n.winners[0],c=o[0],d=c.winnerId===c.team1.playerIds[0]?c.team2.playerIds[0]:c.team1.playerIds[0],m=i-1,p=a.filter(C=>C.round===m&&C.status==="completed").map(C=>C.winnerId===C.team1.playerIds[0]?C.team2.playerIds[0]:C.team1.playerIds[0]),f=Math.floor(n.prizePool*.5),h=Math.floor(n.prizePool*.3),g=Math.floor(n.prizePool*.2),v={},j=k(_,`users/${l}`),M=await q(j);if(M.exists()){const I=(M.val().fortune||0)+f;v[`users/${l}/fortune`]=I,await Be(l,I,f,"ðŸ† 1Ã¨re place - Tournoi Quotidien")}if(d){const C=k(_,`users/${d}`),I=await q(C);if(I.exists()){const w=(I.val().fortune||0)+h;v[`users/${d}/fortune`]=w,await Be(d,w,h,"ðŸ¥ˆ 2Ã¨me place - Tournoi Quotidien")}}const P=Math.floor(g/Math.max(p.length,1));for(const C of p){const I=k(_,`users/${C}`),O=await q(I);if(O.exists()){const E=(O.val().fortune||0)+P;v[`users/${C}/fortune`]=E,await Be(C,E,P,"ðŸ¥‰ 3Ã¨me place - Tournoi Quotidien")}}return v[`tournaments/${s}/prizesDistributed`]=!0,v[`tournaments/${s}/prizesDistributedAt`]=Date.now(),await ce(k(_),v),{success:!0,message:`Prix distribuÃ©s: 1er (${f}â‚¬), 2Ã¨me (${h}â‚¬), 3Ã¨me (${P}â‚¬)`}}catch(r){return b.error("Erreur distribution prix:",r),{success:!1,message:r.message||"Erreur distribution des prix"}}}const Ir=13,fn=14.25,Dr=50,pt=25,rh=()=>{var se;const{user:s,userProfile:t}=Me(),[r,n]=u.useState("overview"),[a,i]=u.useState(1),[o,l]=u.useState(null),[c,d]=u.useState(!1),[m,x]=u.useState("solo"),[p,f]=u.useState(""),[h,g]=u.useState([]),[v,j]=u.useState(!1),[M,P]=u.useState(!1),[C,I]=u.useState(!1),[O,w]=u.useState({hours:0,minutes:0,seconds:0}),[E,V]=u.useState(!1),[A,B]=u.useState(0);u.useEffect(()=>{if(!s)return;S();const N=setInterval(S,5e3);return()=>clearInterval(N)},[s]),u.useEffect(()=>{const N=setInterval(J,1e3);return()=>clearInterval(N)},[]),u.useEffect(()=>{o!=null&&o.currentRound&&i(o.currentRound)},[o==null?void 0:o.currentRound]),u.useEffect(()=>{const D=setTimeout(async()=>{if(p.length<2){g([]);return}j(!0);try{const y=(await Yi(p)).filter(G=>G.id!==(s==null?void 0:s.uid));g(y)}catch(Q){b.error("Erreur recherche partenaires:",Q),g([])}finally{j(!1)}},300);return()=>clearTimeout(D)},[p,s]);const S=async()=>{var N;if(s)try{const D=k(_,`users/${s.uid}`),Q=await q(D);Q.exists()&&B(Q.val().fortune||0);const y=k(_,"tournaments/active"),G=await q(y);if(G.exists()){const Y=G.val();(!Y.players||!Array.isArray(Y.players))&&(Y.players=[]),(!Y.matches||typeof Y.matches!="object")&&(Y.matches={}),l(Y);const ae=Y.players.some(Ce=>Ce.userId===s.uid);d(ae),Y.status==="completed"&&!Y.prizesDistributed&&((N=Y.winners)==null?void 0:N.length)>0&&(b.log("ðŸ† Tournoi terminÃ© dÃ©tectÃ©, distribution des prix..."),setTimeout(async()=>{const Ce=await sh("active");Ce.success&&($({title:"ðŸ† Prix distribuÃ©s!",description:Ce.message}),S())},1e3))}else l(null),d(!1)}catch(D){b.error("Erreur chargement tournoi:",D)}},J=()=>{const N=new Date,D=N.getHours()+N.getMinutes()/60;if(D>=Ir&&D<fn){const Q=fn-D,y=Math.floor(Q),G=Math.floor((Q-y)*60),Y=Math.floor(((Q-y)*60-G)*60);w({hours:y,minutes:G,seconds:Y})}else if(D<Ir){const Q=Ir-D,y=Math.floor(Q),G=Math.floor((Q-y)*60),Y=Math.floor(((Q-y)*60-G)*60);w({hours:y,minutes:G,seconds:Y})}else w({hours:0,minutes:0,seconds:0})},me=async()=>{if(!s||!t)return;const N=m==="duo"?pt:Dr;if(A<N){$({title:"Fonds insuffisants",description:`Il vous faut ${N}â‚¬ pour participer (vous avez ${A}â‚¬)`,variant:"destructive"});return}if(m==="duo"&&!p.trim()){$({title:"Partenaire requis",description:"Entrez le nom de votre partenaire",variant:"destructive"});return}V(!0);try{let D=null,Q=null,y=0;if(m==="duo"){const Xe=k(_,"users"),wt=await q(Xe);if(wt.exists()){const Xt=wt.val(),ht=Object.entries(Xt).find(([Cs,We])=>{var es;return((es=We.username)==null?void 0:es.toLowerCase())===p.toLowerCase()});if(!ht){$({title:"Partenaire introuvable",description:"Aucun joueur avec ce nom",variant:"destructive"}),V(!1);return}if(D=ht[0],Q=ht[1].username,y=ht[1].fortune||0,y<pt){$({title:"Partenaire sans fonds",description:`${Q} n'a pas assez de fortune (${y}â‚¬ / ${pt}â‚¬)`,variant:"destructive"}),V(!1);return}}}const G=k(_,"tournaments/active"),Y=await q(G);if(!Y.exists()){$({title:"Aucun tournoi actif",description:"Un admin doit d'abord crÃ©er le tournoi.",variant:"destructive"}),V(!1);return}const ae=Y.val();if((!ae.players||!Array.isArray(ae.players))&&(ae.players=[]),ae.players.some(Xe=>Xe.userId===s.uid)){$({title:"DÃ©jÃ  inscrit",description:"Vous Ãªtes dÃ©jÃ  inscrit Ã  ce tournoi",variant:"destructive"}),V(!1);return}if(D&&ae.players.some(Xe=>Xe.userId===D)){$({title:"Partenaire dÃ©jÃ  inscrit",description:`${Q} est dÃ©jÃ  inscrit au tournoi`,variant:"destructive"}),V(!1);return}const Ee={userId:s.uid,username:t.username,eloRating:t.eloRating||1e3,partnerId:D||null,partnerUsername:Q||null};ae.players.push(Ee);let Ue=N;m==="duo"&&D&&(Ue+=pt),ae.prizePool+=Ue;const tt=`reg_${s.uid}_${Date.now()}`;m==="duo"&&D&&await $e(k(_,`tournamentRegistrations/${tt}`),{userId:s.uid,partnerId:D,timestamp:Date.now()});const st={};st[`users/${s.uid}/fortune`]=A-N,m==="duo"&&D&&(st[`users/${D}/fortune`]=y-pt),st["tournaments/active/players"]=ae.players,st["tournaments/active/prizePool"]=ae.prizePool,await ce(k(_),st),m==="duo"&&await $e(k(_,`tournamentRegistrations/${tt}`),null),await Be(s.uid,-N,"tournament_entry",`Inscription tournoi ${m==="solo"?"solo":"duo"}`,{tournamentId:"active",mode:m,entryFee:N,...m==="duo"&&D&&{partnerId:D,partnerName:Q}}),m==="duo"&&D&&Q&&await Be(D,-pt,"tournament_entry","Inscription tournoi duo",{tournamentId:"active",mode:"duo",entryFee:pt,partnerId:s.uid,partnerName:t.username}),$({title:"Inscription rÃ©ussie! ðŸŽ‰",description:`Vous Ãªtes inscrit ${m==="duo"?`en duo (${Ue}â‚¬ total)`:`en solo (${N}â‚¬)`}`}),await Om(s.uid,"Tournoi Quotidien","dans quelques instants"),P(!1),f(""),x("solo"),S()}catch(D){b.error("Erreur inscription:",D),$({title:"Erreur",description:D.message||"Impossible de s'inscrire au tournoi",variant:"destructive"})}finally{V(!1)}},re=async(N,D,Q)=>{if(o)try{const y={},G=D==="team1"?"score1":"score2";y[`tournaments/active/matches/${N}/${G}`]=Q,await ce(k(_),y),await S(),$({title:"Score mis Ã  jour",description:`${D==="team1"?"Ã‰quipe 1":"Ã‰quipe 2"}: ${Q} points`})}catch(y){b.error("Erreur mise Ã  jour score:",y),$({title:"Erreur",description:y.message,variant:"destructive"})}},Se=async N=>{if(!o||!t)return;const D=o.matches[N];if(D){if(D.score1===D.score2){$({title:"Score invalide",description:"Le match ne peut pas se terminer par une Ã©galitÃ©",variant:"destructive"});return}if(confirm(`âœ… Terminer le match ${D.team1.playerNames[0]} vs ${D.team2.playerNames[0]} ?`))try{V(!0);const Q=await eh(N,s.uid);if(Q.success){$({title:"Match terminÃ©! ðŸ",description:`Score final: ${D.score1} - ${D.score2}`}),await S();const y=await th();y.isComplete&&y.winnersCount>1?setTimeout(()=>{confirm(`ðŸŽŠ Round terminÃ©! ${y.winnersCount} gagnants. CrÃ©er le prochain round ?`)&&ve()},1e3):y.winnersCount===1&&$({title:"ðŸ† TOURNOI TERMINÃ‰!",description:"Le vainqueur a Ã©tÃ© dÃ©terminÃ©!"})}else $({title:"Erreur",description:Q.message,variant:"destructive"})}catch(Q){b.error("Erreur fin de match:",Q),$({title:"Erreur",description:Q.message,variant:"destructive"})}finally{V(!1)}}},ve=async()=>{if(!(!s||!o))try{V(!0);const N=await Xx("active",s.uid);N.success?($({title:`ðŸŽ® Round ${N.newRound} crÃ©Ã©!`,description:N.message}),await S()):$({title:"Erreur",description:N.message,variant:"destructive"})}catch(N){b.error("Erreur crÃ©ation round:",N),$({title:"Erreur",description:N.message,variant:"destructive"})}finally{V(!1)}},je=async()=>{if(!o||!s){$({title:"Erreur",description:"Aucun tournoi actif",variant:"destructive"});return}if(o.players.length<2){$({title:"Erreur",description:"Il faut au moins 2 joueurs",variant:"destructive"});return}if(confirm(`âš ï¸ Lancer le tournoi avec ${o.players.length} joueurs ?`)){V(!0);try{const N=[...o.players],D=[];for(let G=N.length-1;G>0;G--){const Y=Math.floor(Math.random()*(G+1));[N[G],N[Y]]=[N[Y],N[G]]}for(let G=0;G<N.length-1;G+=2){const Y=N[G],ae=N[G+1];Y&&ae&&D.push({id:`match_round1_${G}`,round:1,team1:{playerIds:[Y.userId],playerNames:[Y.username],partnerId:Y.partnerId??null,partnerName:Y.partnerUsername??null},team2:{playerIds:[ae.userId],playerNames:[ae.username],partnerId:ae.partnerId??null,partnerName:ae.partnerUsername??null},status:"pending",startTime:Date.now(),score1:0,score2:0})}const Q={};D.forEach(G=>{Q[G.id]=G});const y={};y["tournaments/active/matches"]=Q,y["tournaments/active/status"]="in_progress",y["tournaments/active/currentRound"]=1,await ce(k(_),y),$({title:"ðŸŽ® Tournoi lancÃ©!",description:`${D.length} matchs crÃ©Ã©s pour le Round 1`}),await S()}catch(N){b.error("Erreur lancement tournoi:",N),$({title:"Erreur",description:N.message,variant:"destructive"})}finally{V(!1)}}},K=()=>{if(!(o!=null&&o.matches))return{};const N={};return Object.values(o.matches).forEach(D=>{N[D.round]||(N[D.round]=[]),N[D.round].push(D)}),N},ee=()=>{if(!o)return[];if(!o.players||!Array.isArray(o.players))return[];const N={};return o.players.forEach(Q=>{N[Q.userId]={name:Q.username+(Q.partnerUsername?` & ${Q.partnerUsername}`:""),wins:0,elo:Q.eloRating}}),o.matches&&typeof o.matches=="object"&&Object.values(o.matches).forEach(Q=>{Q.status==="completed"&&Q.winnerId&&N[Q.winnerId]&&N[Q.winnerId].wins++}),Object.entries(N).map(([Q,y])=>({...y,id:Q})).sort((Q,y)=>y.wins!==Q.wins?y.wins-Q.wins:y.elo-Q.elo).slice(0,10).map((Q,y)=>({...Q,rank:y+1,prize:y===0?Math.floor(o.prizePool*.5):y===1?Math.floor(o.prizePool*.3):y===2?Math.floor(o.prizePool*.2):0}))},z=N=>{switch(N){case"completed":return"bg-green-500/10 text-green-500 border-green-500/30";case"in_progress":return"bg-blue-500/10 text-blue-500 border-blue-500/30";case"pending":return"bg-gray-500/10 text-gray-400 border-gray-500/30";default:return"bg-gray-500/10 text-gray-400 border-gray-500/30"}},xe=({match:N,matchKey:D})=>{const Q=t&&(t.role==="admin"||t.role==="agent");return e.jsxs(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-gradient-to-br from-slate-900 to-slate-800 rounded-xl p-4 border border-slate-700 hover:border-blue-500/50 transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold border ${z(N.status)}`,children:N.status==="completed"?"âœ… TerminÃ©":N.status==="in_progress"?"ðŸŽ® En cours":"â³ Ã€ venir"}),e.jsxs("span",{className:"text-xs text-slate-400",children:["Round ",N.round]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg ${N.winnerId===N.team1.playerIds[0]?"bg-blue-500/20 border border-blue-500/50":"bg-slate-800/50"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:`w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-lg font-bold ${N.winnerId===N.team1.playerIds[0]?"ring-2 ring-blue-500":""}`,children:N.team1.playerNames[0][0]}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("p",{className:"font-semibold text-white truncate",children:[N.team1.playerNames[0],N.team1.partnerName&&` & ${N.team1.partnerName}`]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[Q&&N.status!=="completed"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>re(D,"team1",Math.max(0,N.score1-1)),disabled:N.score1<=0||E,className:"w-8 h-8 bg-slate-700 hover:bg-slate-600 rounded-lg font-bold disabled:opacity-50 disabled:cursor-not-allowed",children:"-"}),e.jsx("span",{className:"text-2xl font-bold w-12 text-center",children:N.score1}),e.jsx("button",{onClick:()=>re(D,"team1",N.score1+1),disabled:E,className:"w-8 h-8 bg-slate-700 hover:bg-slate-600 rounded-lg font-bold",children:"+"})]}),N.status==="completed"&&e.jsx("span",{className:`text-3xl font-bold ${N.winnerId===N.team1.playerIds[0]?"text-blue-400":"text-slate-600"}`,children:N.score1})]})]}),e.jsx("div",{className:"text-center text-slate-500 font-bold text-sm",children:"VS"}),e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg ${N.winnerId===N.team2.playerIds[0]?"bg-blue-500/20 border border-blue-500/50":"bg-slate-800/50"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:`w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-lg font-bold ${N.winnerId===N.team2.playerIds[0]?"ring-2 ring-blue-500":""}`,children:N.team2.playerNames[0][0]}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("p",{className:"font-semibold text-white truncate",children:[N.team2.playerNames[0],N.team2.partnerName&&` & ${N.team2.partnerName}`]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[Q&&N.status!=="completed"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>re(D,"team2",Math.max(0,N.score2-1)),disabled:N.score2<=0||E,className:"w-8 h-8 bg-slate-700 hover:bg-slate-600 rounded-lg font-bold disabled:opacity-50 disabled:cursor-not-allowed",children:"-"}),e.jsx("span",{className:"text-2xl font-bold w-12 text-center",children:N.score2}),e.jsx("button",{onClick:()=>re(D,"team2",N.score2+1),disabled:E,className:"w-8 h-8 bg-slate-700 hover:bg-slate-600 rounded-lg font-bold",children:"+"})]}),N.status==="completed"&&e.jsx("span",{className:`text-3xl font-bold ${N.winnerId===N.team2.playerIds[0]?"text-blue-400":"text-slate-600"}`,children:N.score2})]})]})]}),Q&&N.status!=="completed"&&e.jsx("button",{onClick:()=>Se(D),disabled:E,className:"w-full mt-3 px-4 py-2 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 rounded-lg font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:E?e.jsx(ue,{className:"h-4 w-4 animate-spin mx-auto"}):"ðŸ Terminer le match"}),N.status==="completed"&&N.winnerId&&e.jsx("div",{className:"mt-3 text-center p-2 bg-gradient-to-r from-blue-500/20 to-purple-500/20 rounded-lg",children:e.jsxs("p",{className:"text-sm font-semibold text-blue-400 flex items-center justify-center gap-2",children:[e.jsx(Te,{className:"h-4 w-4"}),N.winnerId===N.team1.playerIds[0]?N.team1.playerNames[0]:N.team2.playerNames[0]," remporte le match !"]})})]})},L=ee(),R=K(),Z=Object.keys(R).length;return e.jsx(De,{children:e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 text-white p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs(W.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"text-center mb-8",children:[e.jsx(W.div,{animate:{scale:[1,1.1,1],rotate:[0,5,-5,0]},transition:{duration:3,repeat:1/0},className:"text-8xl mb-4",children:"ðŸ†"}),e.jsx("h1",{className:"text-5xl font-bold mb-2 bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent",children:"Tournoi Quotidien"}),e.jsx("p",{className:"text-slate-400 text-lg",children:new Date().toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),(o==null?void 0:o.status)&&e.jsx("div",{className:"mt-3",children:e.jsx("span",{className:`px-4 py-2 rounded-full text-sm font-semibold border ${o.status==="completed"?"bg-green-500/10 text-green-500 border-green-500/30":o.status==="in_progress"?"bg-blue-500/10 text-blue-500 border-blue-500/30":"bg-gray-500/10 text-gray-400 border-gray-500/30"}`,children:o.status==="in_progress"?"ðŸŽ® En cours":o.status==="completed"?"âœ… TerminÃ©":"â³ En attente"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[e.jsxs(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-gradient-to-br from-blue-500/10 to-blue-600/10 rounded-xl p-6 border border-blue-500/20",children:[e.jsx(it,{className:"h-8 w-8 text-blue-400 mb-3"}),e.jsxs("p",{className:"text-3xl font-bold text-white mb-1",children:[String(O.hours).padStart(2,"0"),":",String(O.minutes).padStart(2,"0"),":",String(O.seconds).padStart(2,"0")]}),e.jsx("p",{className:"text-sm text-slate-400",children:"Temps restant"})]}),e.jsxs(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-gradient-to-br from-purple-500/10 to-purple-600/10 rounded-xl p-6 border border-purple-500/20",children:[e.jsx(Re,{className:"h-8 w-8 text-purple-400 mb-3"}),e.jsx("p",{className:"text-3xl font-bold text-white mb-1",children:(o==null?void 0:o.players.length)||0}),e.jsx("p",{className:"text-sm text-slate-400",children:"Participants"})]}),e.jsxs(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-gradient-to-br from-yellow-500/10 to-yellow-600/10 rounded-xl p-6 border border-yellow-500/20",children:[e.jsx(Te,{className:"h-8 w-8 text-yellow-400 mb-3"}),e.jsxs("p",{className:"text-3xl font-bold text-white mb-1",children:[(o==null?void 0:o.prizePool)||0,"â‚¬"]}),e.jsx("p",{className:"text-sm text-slate-400",children:"Cagnotte totale"})]}),e.jsxs(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-gradient-to-br from-pink-500/10 to-pink-600/10 rounded-xl p-6 border border-pink-500/20",children:[e.jsx(Ie,{className:"h-8 w-8 text-pink-400 mb-3"}),e.jsxs("p",{className:"text-3xl font-bold text-white mb-1",children:["Round ",(o==null?void 0:o.currentRound)||0,"/",Z||0]}),e.jsx("p",{className:"text-sm text-slate-400",children:"Progression"})]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2 mb-6 bg-slate-900/50 p-2 rounded-xl border border-slate-800",children:[{view:"overview",icon:"ðŸ“Š",label:"Vue"},{view:"matches",icon:"ðŸŽ®",label:"Matchs"},{view:"leaderboard",icon:"ðŸ…",label:"Classement"}].map(({view:N,icon:D,label:Q})=>e.jsxs("button",{onClick:()=>n(N),className:`py-3 px-2 rounded-lg font-semibold transition-all ${r===N?"bg-blue-500 text-white shadow-lg shadow-blue-500/50":"bg-transparent text-slate-400 hover:text-white hover:bg-slate-800"}`,children:[e.jsxs("span",{className:"hidden sm:inline",children:[D," ",Q]}),e.jsx("span",{className:"sm:hidden text-xl",children:D})]},N))}),e.jsxs(rt,{mode:"wait",children:[r==="overview"&&e.jsxs(W.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"space-y-6",children:[!c&&(o==null?void 0:o.status)!=="in_progress"&&(o==null?void 0:o.status)!=="completed"&&o&&e.jsxs(W.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 rounded-2xl p-6 sm:p-8 border border-white/10 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PHBhdHRlcm4gaWQ9ImdyaWQiIHdpZHRoPSI2MCIgaGVpZ2h0PSI2MCIgcGF0dGVyblVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+PHBhdGggZD0iTSAxMCAwIEwgMCAwIDAgMTAiIGZpbGw9Im5vbmUiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS1vcGFjaXR5PSIwLjA1IiBzdHJva2Utd2lkdGg9IjEiLz48L3BhdHRlcm4+PC9kZWZzPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9InVybCgjZ3JpZCkiLz48L3N2Zz4=')] opacity-30"}),e.jsxs("div",{className:"relative",children:[e.jsx(Mt,{className:"h-10 w-10 sm:h-12 sm:w-12 text-white mb-3 sm:mb-4"}),e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-white mb-2",children:"Rejoignez le tournoi !"}),e.jsxs("p",{className:"text-white/90 mb-4 sm:mb-6 text-base sm:text-lg",children:["Participez seul ou en duo et tentez de remporter la cagnotte de ",(o==null?void 0:o.prizePool)||0,"â‚¬"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("button",{onClick:()=>P(!0),disabled:E,className:"w-full sm:w-auto px-6 sm:px-8 py-3 sm:py-4 bg-white text-purple-600 rounded-xl font-bold hover:scale-105 transition-transform shadow-xl disabled:opacity-50 disabled:cursor-not-allowed",children:E?"Chargement...":"S'inscrire maintenant"}),e.jsx("button",{onClick:()=>I(!0),className:"w-full sm:w-auto px-6 sm:px-8 py-3 sm:py-4 bg-white/10 backdrop-blur-sm text-white rounded-xl font-bold hover:bg-white/20 transition-all border border-white/20",children:"Voir les rÃ¨gles"})]})]})]}),!o&&e.jsxs(W.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-gradient-to-r from-orange-600 via-red-600 to-orange-600 rounded-2xl p-8 border border-orange-500/30 text-center",children:[e.jsx(us,{className:"h-16 w-16 mx-auto mb-4 text-white"}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Aucun tournoi actif"}),e.jsx("p",{className:"text-white/90 mb-4",children:"Un administrateur doit crÃ©er le tournoi du jour depuis le panneau admin."}),t&&(t.role==="admin"||t.role==="agent")&&e.jsx("button",{onClick:async()=>{if(s)try{V(!0);const N={id:"active",startTime:Date.now(),endTime:0,isActive:!0,players:[],matches:{},winners:[],prizePool:0,status:"waiting",currentRound:0,organizerId:s.uid};await $e(k(_,"tournaments/active"),N),$({title:"Tournoi crÃ©Ã© ! ðŸŽ®",description:"Les joueurs peuvent maintenant s'inscrire"}),await S()}catch(N){$({title:"Erreur",description:N.message,variant:"destructive"})}finally{V(!1)}},disabled:E,className:"px-8 py-4 bg-white text-orange-600 rounded-xl font-bold hover:scale-105 transition-transform disabled:opacity-50",children:E?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx(ue,{className:"h-5 w-5 animate-spin"}),"CrÃ©ation..."]}):"CrÃ©er le tournoi"})]}),c&&e.jsx(W.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-gradient-to-r from-green-600 via-green-700 to-green-600 rounded-2xl p-8 border border-green-500/30",children:e.jsxs("div",{className:"text-center",children:[e.jsx(jr,{className:"h-16 w-16 mx-auto mb-4 text-white"}),e.jsx("h2",{className:"text-3xl font-bold text-white mb-2",children:"Vous Ãªtes inscrit ! âœ…"}),e.jsx("p",{className:"text-white/90 text-lg",children:"Bonne chance pour le tournoi"})]})}),t&&(t.role==="admin"||t.role==="agent")&&o&&o.status==="waiting"&&e.jsxs(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-orange-600 via-red-600 to-orange-600 rounded-2xl p-6 border border-orange-500/30",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"ðŸŽ® Panel Organisateur"}),e.jsx("button",{onClick:je,disabled:E||((o==null?void 0:o.players.length)||0)<2,className:"w-full px-6 py-3 bg-white text-orange-600 rounded-xl font-bold hover:scale-105 transition-transform disabled:opacity-50 disabled:cursor-not-allowed",children:E?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx(ue,{className:"h-5 w-5 animate-spin"}),"Lancement..."]}):`Lancer le tournoi (${(o==null?void 0:o.players.length)||0} joueurs)`})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-slate-900 to-slate-800 rounded-xl p-6 border border-slate-700",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(vs,{className:"h-5 w-5 text-blue-400"}),"Informations"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-slate-800/50 rounded-lg",children:[e.jsx("span",{className:"text-slate-400",children:"Horaires"}),e.jsx("span",{className:"font-semibold",children:"13h00 - 14h15"})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-slate-800/50 rounded-lg",children:[e.jsx("span",{className:"text-slate-400",children:"DurÃ©e des matchs"}),e.jsx("span",{className:"font-semibold",children:"5 minutes"})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-slate-800/50 rounded-lg",children:[e.jsx("span",{className:"text-slate-400",children:"Format"}),e.jsx("span",{className:"font-semibold",children:"Ã‰limination directe"})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-slate-800/50 rounded-lg",children:[e.jsx("span",{className:"text-slate-400",children:"Inscription"}),e.jsx("span",{className:"font-semibold text-blue-400",children:"50â‚¬ solo / 25â‚¬ duo"})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-slate-900 to-slate-800 rounded-xl p-6 border border-slate-700",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx($t,{className:"h-5 w-5 text-yellow-400"}),"RÃ©compenses"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gradient-to-r from-yellow-500/20 to-yellow-600/20 rounded-lg border border-yellow-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ut,{className:"h-5 w-5 text-yellow-400"}),e.jsx("span",{className:"font-semibold",children:"1er place"})]}),e.jsxs("span",{className:"font-bold text-yellow-400",children:[o?Math.floor(o.prizePool*.5):0,"â‚¬"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gradient-to-r from-slate-500/20 to-slate-600/20 rounded-lg border border-slate-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ut,{className:"h-5 w-5 text-slate-400"}),e.jsx("span",{className:"font-semibold",children:"2Ã¨me place"})]}),e.jsxs("span",{className:"font-bold text-slate-400",children:[o?Math.floor(o.prizePool*.3):0,"â‚¬"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gradient-to-r from-orange-500/20 to-orange-600/20 rounded-lg border border-orange-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ut,{className:"h-5 w-5 text-orange-400"}),e.jsx("span",{className:"font-semibold",children:"3Ã¨me place"})]}),e.jsxs("span",{className:"font-bold text-orange-400",children:[o?Math.floor(o.prizePool*.2):0,"â‚¬"]})]})]})]})]}),o&&Z>0&&e.jsxs("div",{className:"bg-gradient-to-br from-slate-900 to-slate-800 rounded-xl p-6 border border-slate-700",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Progression du tournoi"}),e.jsx("div",{className:"flex items-center gap-4",children:Array.from({length:Z},(N,D)=>D+1).map(N=>e.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[e.jsx("div",{className:`w-full h-3 rounded-full ${N<(o.currentRound||1)?"bg-green-500":N===(o.currentRound||1)?"bg-blue-500 animate-pulse":"bg-slate-700"}`}),N<Z&&e.jsx(Kn,{className:"h-5 w-5 text-slate-600 flex-shrink-0"})]},N))}),e.jsx("div",{className:"flex justify-between mt-2",children:Array.from({length:Z},(N,D)=>D+1).map(N=>e.jsxs("p",{className:"text-xs text-slate-400 flex-1 text-center",children:["Round ",N]},N))})]}),o&&o.players.length>0&&e.jsxs("div",{className:"bg-gradient-to-br from-slate-900 to-slate-800 rounded-xl p-6 border border-slate-700",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Participants (",o.players.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:o.players.map((N,D)=>e.jsx(W.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:D*.05},className:`p-4 rounded-lg ${N.userId===(s==null?void 0:s.uid)?"bg-gradient-to-r from-blue-500/20 to-purple-500/20 border border-blue-500/50":"bg-slate-800/50"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center font-bold",children:N.username[0]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold truncate",children:N.username}),N.partnerUsername&&e.jsxs("p",{className:"text-xs text-slate-400 flex items-center gap-1",children:[e.jsx(Re,{className:"h-3 w-3"}),"avec ",N.partnerUsername]}),e.jsxs("p",{className:"text-xs text-slate-400 flex items-center gap-1 mt-1",children:[e.jsx(vt,{className:"h-3 w-3"}),N.eloRating," ELO"]})]})]})},N.userId))})]})]},"overview"),r==="matches"&&e.jsx(W.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},children:Object.keys(R).length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6 flex gap-2 overflow-x-auto pb-2",children:Object.keys(R).sort((N,D)=>Number(D)-Number(N)).map(N=>e.jsxs("button",{onClick:()=>i(Number(N)),className:`px-6 py-3 rounded-xl font-semibold whitespace-nowrap transition-all ${a===Number(N)?"bg-blue-500 text-white shadow-lg shadow-blue-500/50":"bg-slate-800 text-slate-400 hover:text-white hover:bg-slate-700"}`,children:["Round ",N,Number(N)===(o==null?void 0:o.currentRound)&&e.jsx("span",{className:"ml-2 inline-block w-2 h-2 bg-green-500 rounded-full animate-pulse"})]},N))}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:(se=R[a])==null?void 0:se.map(N=>{const D=Object.keys((o==null?void 0:o.matches)||{}).find(Q=>(o==null?void 0:o.matches[Q].id)===N.id);return D?e.jsx(xe,{match:N,matchKey:D},N.id):null})})]}):e.jsxs("div",{className:"text-center py-12 bg-slate-900/50 rounded-xl border border-slate-800",children:[e.jsx(Te,{className:"h-16 w-16 mx-auto mb-4 text-slate-600"}),e.jsx("p",{className:"text-xl text-slate-400",children:"Aucun match pour le moment"}),e.jsx("p",{className:"text-sm text-slate-500 mt-2",children:"Les matchs apparaÃ®tront une fois le tournoi lancÃ©"})]})},"matches"),r==="leaderboard"&&e.jsxs(W.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"bg-gradient-to-br from-slate-900 to-slate-800 rounded-xl p-6 border border-slate-700",children:[e.jsxs("h3",{className:"text-2xl font-bold mb-6 flex items-center gap-2",children:[e.jsx(Te,{className:"h-6 w-6 text-yellow-400"}),"Classement"]}),L.length>0?e.jsx("div",{className:"space-y-3",children:L.map((N,D)=>e.jsxs(W.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:D*.1},className:`flex items-center justify-between p-4 rounded-xl ${N.rank===1?"bg-gradient-to-r from-yellow-500/20 to-yellow-600/20 border border-yellow-500/30":N.rank===2?"bg-gradient-to-r from-slate-500/20 to-slate-600/20 border border-slate-500/30":N.rank===3?"bg-gradient-to-r from-orange-500/20 to-orange-600/20 border border-orange-500/30":"bg-slate-800/50"}`,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:`w-12 h-12 rounded-full flex items-center justify-center font-bold text-lg ${N.rank===1?"bg-gradient-to-br from-yellow-400 to-yellow-600 text-white":N.rank===2?"bg-gradient-to-br from-slate-400 to-slate-600 text-white":N.rank===3?"bg-gradient-to-br from-orange-400 to-orange-600 text-white":"bg-slate-700 text-slate-300"}`,children:["#",N.rank]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-lg",children:N.name}),e.jsxs("p",{className:"text-sm text-slate-400 flex items-center gap-2",children:[e.jsx(jr,{className:"h-4 w-4 text-green-500"}),N.wins," victoire",N.wins>1?"s":"",e.jsxs("span",{className:"ml-2 flex items-center gap-1",children:[e.jsx(vt,{className:"h-4 w-4"}),N.elo]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-2xl font-bold text-yellow-400",children:[N.prize,"â‚¬"]}),e.jsx("p",{className:"text-xs text-slate-400",children:"Gains potentiels"})]})]},N.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ut,{className:"h-16 w-16 mx-auto mb-4 text-slate-600"}),e.jsx("p",{className:"text-xl text-slate-400",children:"Aucun classement disponible"}),e.jsx("p",{className:"text-sm text-slate-500 mt-2",children:"Le classement apparaÃ®tra une fois les matchs commencÃ©s"})]})]},"leaderboard")]}),e.jsx(rt,{children:M&&e.jsx(W.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50",onClick:()=>P(!1),children:e.jsxs(W.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},onClick:N=>N.stopPropagation(),className:"bg-gradient-to-br from-slate-900 to-slate-800 rounded-2xl p-8 border border-slate-700 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Inscription au Tournoi"}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("p",{className:"text-slate-400 mb-2",children:["Votre fortune : ",e.jsxs("span",{className:"font-bold text-white",children:[A,"â‚¬"]})]}),e.jsx("p",{className:"text-slate-400 mb-4",children:"Choisissez votre mode de jeu :"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:()=>x("solo"),className:`p-6 rounded-xl border-2 transition-all ${m==="solo"?"border-blue-500 bg-blue-500/20":"border-slate-700 hover:border-slate-600"}`,children:[e.jsx(Te,{className:"h-8 w-8 mx-auto mb-2 text-blue-400"}),e.jsx("p",{className:"font-bold mb-1",children:"Solo"}),e.jsx("p",{className:"text-sm text-slate-400",children:"50â‚¬"})]}),e.jsxs("button",{onClick:()=>x("duo"),className:`p-6 rounded-xl border-2 transition-all ${m==="duo"?"border-purple-500 bg-purple-500/20":"border-slate-700 hover:border-slate-600"}`,children:[e.jsx(Re,{className:"h-8 w-8 mx-auto mb-2 text-purple-400"}),e.jsx("p",{className:"font-bold mb-1",children:"Duo"}),e.jsx("p",{className:"text-sm text-slate-400",children:"25â‚¬ / joueur"})]})]})]}),m==="duo"&&e.jsxs(W.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Rechercher un partenaire"}),e.jsxs("div",{className:"relative",children:[e.jsx(ot,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-slate-400 z-10"}),v&&e.jsx(ue,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-5 w-5 animate-spin text-slate-400 z-10"}),e.jsx("input",{type:"text",value:p,onChange:N=>f(N.target.value),placeholder:"Nom du joueur...",className:"w-full pl-10 pr-10 py-3 bg-slate-800 border border-slate-700 rounded-xl focus:outline-none focus:border-blue-500 transition-colors text-white"})]}),p.length>=2&&h.length>0&&e.jsx(W.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mt-3 space-y-2 max-h-48 overflow-y-auto",children:h.map(N=>e.jsx("button",{onClick:()=>f(N.username),className:"w-full p-3 bg-slate-800 hover:bg-slate-700 rounded-lg border border-slate-700 hover:border-blue-500/50 transition-all text-left",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:N.username}),e.jsxs("p",{className:"text-xs text-slate-400 flex items-center gap-2 mt-1",children:[e.jsx(vt,{className:"h-3 w-3"}),N.eloRating," ELO",e.jsxs("span",{className:"ml-2",children:["ðŸ’° ",N.fortune,"â‚¬"]})]})]}),e.jsx(jr,{className:"h-5 w-5 text-green-500"})]})},N.id))}),p.length>0&&p.length<2&&e.jsx("p",{className:"text-xs text-slate-400 mt-2",children:"Tapez au moins 2 lettres pour rechercher"})]}),e.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-slate-400",children:"Frais d'inscription"}),e.jsx("span",{className:"font-bold text-blue-400",children:m==="solo"?"50â‚¬":"25â‚¬"})]}),A<(m==="solo"?Dr:pt)&&e.jsx("p",{className:"text-xs text-red-400 mt-2",children:"âš ï¸ Vous n'avez pas assez de fortune pour participer"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>P(!1),className:"flex-1 px-6 py-3 bg-slate-800 hover:bg-slate-700 rounded-xl font-semibold transition-colors",children:"Annuler"}),e.jsx("button",{onClick:me,disabled:E||A<(m==="solo"?Dr:pt)||m==="duo"&&!p.trim(),className:"flex-1 px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 rounded-xl font-semibold transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100",children:E?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4 animate-spin"}),"Inscription..."]}):"Confirmer"})]})]})})}),e.jsx(rt,{children:C&&e.jsx(W.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50",onClick:()=>I(!1),children:e.jsxs(W.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},onClick:N=>N.stopPropagation(),className:"bg-gradient-to-br from-slate-900 to-slate-800 rounded-2xl p-8 border border-slate-700 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(us,{className:"h-6 w-6 text-blue-400"}),e.jsx("h2",{className:"text-2xl font-bold",children:"RÃ¨gles du Tournoi"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg mb-2 flex items-center gap-2",children:[e.jsx(it,{className:"h-5 w-5 text-blue-400"}),"Horaires"]}),e.jsxs("p",{className:"text-slate-300",children:["Le tournoi se dÃ©roule tous les jours de ",e.jsx("strong",{className:"text-white",children:"13h00 Ã  14h15"})," (1h15 de compÃ©tition)"]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg mb-2 flex items-center gap-2",children:[e.jsx(Re,{className:"h-5 w-5 text-purple-400"}),"Modes de jeu"]}),e.jsxs("ul",{className:"space-y-2 text-slate-300",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-400 mt-1",children:"â€¢"}),e.jsxs("span",{children:[e.jsx("strong",{className:"text-white",children:"Solo :"})," Affrontez les autres joueurs individuellement (50â‚¬)"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-purple-400 mt-1",children:"â€¢"}),e.jsxs("span",{children:[e.jsx("strong",{className:"text-white",children:"Duo :"})," Formez une Ã©quipe avec un partenaire (25â‚¬ par personne)"]})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg mb-2 flex items-center gap-2",children:[e.jsx(Te,{className:"h-5 w-5 text-yellow-400"}),"DÃ©roulement"]}),e.jsxs("ul",{className:"space-y-2 text-slate-300",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-green-400 mt-1",children:"â€¢"}),e.jsxs("span",{children:["Chaque match dure exactement ",e.jsx("strong",{className:"text-white",children:"5 minutes"})]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-green-400 mt-1",children:"â€¢"}),e.jsxs("span",{children:["Les matchs sont organisÃ©s en ",e.jsx("strong",{className:"text-white",children:"Ã©limination directe"})]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-green-400 mt-1",children:"â€¢"}),e.jsx("span",{children:"Le gagnant de chaque match passe au round suivant"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-green-400 mt-1",children:"â€¢"}),e.jsx("span",{children:"Le tournoi continue jusqu'Ã  ce qu'il ne reste qu'un seul vainqueur"})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg mb-2 flex items-center gap-2",children:[e.jsx($t,{className:"h-5 w-5 text-yellow-400"}),"RÃ©compenses"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-yellow-500/10 rounded-lg border border-yellow-500/30",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Ut,{className:"h-4 w-4 text-yellow-400"}),e.jsx("span",{className:"font-semibold text-yellow-400",children:"1er place"})]}),e.jsx("span",{className:"font-bold text-yellow-400",children:"50% de la cagnotte"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-500/10 rounded-lg border border-slate-500/30",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Ut,{className:"h-4 w-4 text-slate-400"}),e.jsx("span",{className:"font-semibold text-slate-400",children:"2Ã¨me place"})]}),e.jsx("span",{className:"font-bold text-slate-400",children:"30% de la cagnotte"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-orange-500/10 rounded-lg border border-orange-500/30",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Ut,{className:"h-4 w-4 text-orange-400"}),e.jsx("span",{className:"font-semibold text-orange-400",children:"3Ã¨me place"})]}),e.jsx("span",{className:"font-bold text-orange-400",children:"20% de la cagnotte"})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg mb-2 flex items-center gap-2",children:[e.jsx(Mt,{className:"h-5 w-5 text-pink-400"}),"Bonus"]}),e.jsx("p",{className:"text-slate-300",children:"Les bonus de club sont actifs pendant le tournoi !"})]})]}),e.jsx("button",{onClick:()=>I(!1),className:"w-full mt-6 px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 rounded-xl font-semibold transition-all",children:"J'ai compris"})]})})}),(o==null?void 0:o.status)==="completed"&&o.winners.length>0&&e.jsx(W.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsxs(W.div,{initial:{y:50},animate:{y:0},className:"bg-gradient-to-br from-yellow-600 via-yellow-500 to-yellow-600 rounded-2xl p-12 border border-yellow-400/50 text-center max-w-lg",children:[e.jsx(W.div,{animate:{rotate:[0,10,-10,0],scale:[1,1.2,1]},transition:{duration:2,repeat:1/0},className:"text-9xl mb-6",children:"ðŸ†"}),e.jsx("h2",{className:"text-4xl font-bold text-white mb-4",children:"Tournoi terminÃ© !"}),e.jsx("p",{className:"text-xl text-white/90 mb-6",children:"FÃ©licitations au vainqueur ! ðŸŽ‰"}),e.jsxs("div",{className:"bg-white/20 backdrop-blur-sm rounded-xl p-6 mb-6",children:[e.jsxs("p",{className:"text-5xl font-bold text-white mb-2",children:[Math.floor(o.prizePool*.5),"â‚¬"]}),e.jsx("p",{className:"text-white/80",children:"Gain du vainqueur"})]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-8 py-4 bg-white text-yellow-600 rounded-xl font-bold hover:scale-105 transition-transform",children:"Retour Ã  l'accueil"})]})})]})})})},Mo=async()=>{try{const s=k(_,"suspicious_activities"),t=await q(s);if(!t.exists())return[];const r=t.val();return Object.entries(r).map(([a,i])=>({id:a,...i})).sort((a,i)=>i.timestamp-a.timestamp)}catch(s){throw b.error("Erreur rÃ©cupÃ©ration activitÃ©s suspectes:",s),new Error("Impossible de rÃ©cupÃ©rer les activitÃ©s suspectes")}},ah=async()=>{try{const s=await Mo(),t={total:s.length,unresolved:s.filter(r=>!r.resolved).length,bySeverity:{low:s.filter(r=>r.severity==="low").length,medium:s.filter(r=>r.severity==="medium").length,high:s.filter(r=>r.severity==="high").length},byType:{}};return s.forEach(r=>{t.byType[r.type]||(t.byType[r.type]=0),t.byType[r.type]++}),t}catch(s){throw b.error("Erreur rÃ©cupÃ©ration stats anti-cheat:",s),new Error("Impossible de rÃ©cupÃ©rer les statistiques")}},nh=async(s,t)=>{try{const r=k(_,`suspicious_activities/${s}`);if(!(await q(r)).exists())throw new Error("ActivitÃ© introuvable");await ce(r,{resolved:!0,resolvedAt:Date.now(),resolvedBy:t||"admin"})}catch(r){throw b.error("Erreur rÃ©solution activitÃ©:",r),new Error("Impossible de rÃ©soudre l'activitÃ©")}},ih=async s=>{try{const t=k(_,`suspicious_activities/${s}`);await Ms(t)}catch(t){throw b.error("Erreur suppression activitÃ©:",t),new Error("Impossible de supprimer l'activitÃ©")}},oh=()=>{var P;const[s,t]=u.useState([]),[r,n]=u.useState(null),[a,i]=u.useState(!0),[o,l]=u.useState("unresolved"),[c,d]=u.useState("all"),[m,x]=u.useState(null);u.useEffect(()=>{p()},[]);const p=async()=>{i(!0);try{const[C,I]=await Promise.all([Mo(),ah()]);t(C),n(I)}catch(C){b.error("Erreur chargement anti-cheat:",C),$({title:"Erreur",description:"Impossible de charger les donnÃ©es anti-cheat",variant:"destructive"})}finally{i(!1)}},f=async C=>{x(C);try{await nh(C),$({title:"âœ… ActivitÃ© rÃ©solue",description:"L'activitÃ© a Ã©tÃ© marquÃ©e comme rÃ©solue"}),await p()}catch(I){$({title:"Erreur",description:I.message,variant:"destructive"})}finally{x(null)}},h=async C=>{if(confirm("âš ï¸ Supprimer dÃ©finitivement cette activitÃ© ?")){x(C);try{await ih(C),$({title:"ðŸ—‘ï¸ ActivitÃ© supprimÃ©e",description:"L'activitÃ© a Ã©tÃ© supprimÃ©e"}),await p()}catch(I){$({title:"Erreur",description:I.message,variant:"destructive"})}finally{x(null)}}},g=C=>{switch(C){case"high":return{label:"Critique",color:"text-red-500",bg:"bg-red-500/10",border:"border-red-500"};case"medium":return{label:"Moyen",color:"text-yellow-500",bg:"bg-yellow-500/10",border:"border-yellow-500"};case"low":return{label:"Faible",color:"text-blue-500",bg:"bg-blue-500/10",border:"border-blue-500"};default:return{label:"Inconnu",color:"text-gray-500",bg:"bg-gray-500/10",border:"border-gray-500"}}},v=C=>{switch(C){case"fortune_spike":return e.jsx(Zt,{className:"h-4 w-4"});case"elo_spike":return e.jsx(Ie,{className:"h-4 w-4"});case"rapid_actions":return e.jsx(vt,{className:"h-4 w-4"});case"negative_value":return e.jsx(sr,{className:"h-4 w-4"});default:return e.jsx(ls,{className:"h-4 w-4"})}},j=C=>{switch(C){case"fortune_spike":return"Pic de fortune";case"elo_spike":return"Pic d'ELO";case"rapid_actions":return"Actions rapides";case"negative_value":return"Valeur nÃ©gative";default:return C}},M=s.filter(C=>!(o==="resolved"&&!C.resolved||o==="unresolved"&&C.resolved||c!=="all"&&C.type!==c));return a?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ue,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsx(U,{children:e.jsxs(H,{className:"p-4 text-center",children:[e.jsx(ls,{className:"mx-auto mb-2 h-6 w-6 text-yellow-500"}),e.jsx("p",{className:"text-2xl font-bold",children:(r==null?void 0:r.total)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total"})]})}),e.jsx(U,{className:"border-red-500/30 bg-red-500/5",children:e.jsxs(H,{className:"p-4 text-center",children:[e.jsx(sr,{className:"mx-auto mb-2 h-6 w-6 text-red-500"}),e.jsx("p",{className:"text-2xl font-bold text-red-500",children:(r==null?void 0:r.unresolved)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Non rÃ©solues"})]})}),e.jsx(U,{className:"border-green-500/30 bg-green-500/5",children:e.jsxs(H,{className:"p-4 text-center",children:[e.jsx(zr,{className:"mx-auto mb-2 h-6 w-6 text-green-500"}),e.jsx("p",{className:"text-2xl font-bold text-green-500",children:((r==null?void 0:r.total)||0)-((r==null?void 0:r.unresolved)||0)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"RÃ©solues"})]})}),e.jsx(U,{children:e.jsxs(H,{className:"p-4 text-center",children:[e.jsx(Qt,{className:"mx-auto mb-2 h-6 w-6 text-primary"}),e.jsx("p",{className:"text-2xl font-bold",children:((P=r==null?void 0:r.bySeverity)==null?void 0:P.high)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Critiques"})]})})]}),(r==null?void 0:r.byType)&&Object.keys(r.byType).length>0&&e.jsxs(U,{children:[e.jsx(he,{children:e.jsx(fe,{className:"text-sm",children:"Distribution par type"})}),e.jsx(H,{children:e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(r.byType).map(([C,I])=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded bg-muted",children:[e.jsxs("span",{className:"text-xs flex items-center gap-2",children:[v(C),j(C)]}),e.jsx(le,{variant:"outline",children:I})]},C))})})]}),e.jsx(U,{children:e.jsxs(H,{className:"p-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[e.jsxs("span",{className:"text-sm font-medium self-center flex items-center gap-1",children:[e.jsx(mr,{className:"h-3 w-3"}),"Statut:"]}),e.jsx(T,{size:"sm",variant:o==="all"?"default":"outline",onClick:()=>l("all"),children:"Tout"}),e.jsx(T,{size:"sm",variant:o==="unresolved"?"default":"outline",onClick:()=>l("unresolved"),children:"Non rÃ©solues"}),e.jsx(T,{size:"sm",variant:o==="resolved"?"default":"outline",onClick:()=>l("resolved"),children:"RÃ©solues"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("span",{className:"text-sm font-medium self-center",children:"Type:"}),e.jsx(T,{size:"sm",variant:c==="all"?"default":"outline",onClick:()=>d("all"),children:"Tout"}),e.jsx(T,{size:"sm",variant:c==="fortune_spike"?"default":"outline",onClick:()=>d("fortune_spike"),children:"Fortune"}),e.jsx(T,{size:"sm",variant:c==="elo_spike"?"default":"outline",onClick:()=>d("elo_spike"),children:"ELO"}),e.jsx(T,{size:"sm",variant:c==="rapid_actions"?"default":"outline",onClick:()=>d("rapid_actions"),children:"Actions rapides"})]})]})}),e.jsx("div",{className:"space-y-2",children:M.length===0?e.jsx(U,{children:e.jsxs(H,{className:"p-12 text-center",children:[e.jsx(jt,{className:"h-16 w-16 text-green-500 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:o==="unresolved"?"âœ… Aucune activitÃ© suspecte non rÃ©solue":"Aucune activitÃ© trouvÃ©e"})]})}):M.map((C,I)=>{const O=g(C.severity);return e.jsx(W.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:I*.05},children:e.jsx(U,{className:`${C.resolved?"opacity-60":""} ${O.bg} border ${O.border}`,children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`rounded-lg ${O.bg} p-2 ${O.color}`,children:v(C.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-start justify-between gap-2 mb-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1 flex-wrap",children:[e.jsx(le,{variant:"outline",className:`${O.color} ${O.border}`,children:O.label}),e.jsx(le,{variant:"outline",children:j(C.type)}),C.resolved&&e.jsx(le,{variant:"default",className:"bg-green-500",children:"âœ“ RÃ©solu"})]}),e.jsxs("p",{className:"font-medium text-sm mb-1",children:[e.jsx(Us,{className:"inline h-3 w-3 mr-1"}),C.username]}),e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:C.description}),(C.oldValue!==void 0||C.newValue!==void 0)&&e.jsxs("div",{className:"flex items-center gap-3 text-xs",children:[C.oldValue!==void 0&&e.jsxs("span",{className:"text-muted-foreground",children:["Ancien: ",e.jsx("span",{className:"font-mono font-bold",children:C.oldValue})]}),C.oldValue!==void 0&&C.newValue!==void 0&&e.jsx("span",{children:"â†’"}),C.newValue!==void 0&&e.jsxs("span",{className:O.color,children:["Nouveau: ",e.jsx("span",{className:"font-mono font-bold",children:C.newValue})]})]})]})}),e.jsxs("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-border",children:[e.jsxs("span",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(it,{className:"h-3 w-3"}),new Date(C.timestamp).toLocaleString("fr-FR")]}),e.jsxs("div",{className:"flex gap-1",children:[!C.resolved&&e.jsx(T,{size:"sm",variant:"default",onClick:()=>f(C.id),disabled:m===C.id,className:"h-7 text-xs",children:m===C.id?e.jsx(ue,{className:"h-3 w-3 animate-spin"}):e.jsx(zr,{className:"h-3 w-3"})}),e.jsx(T,{size:"sm",variant:"destructive",onClick:()=>h(C.id),disabled:m===C.id,className:"h-7 text-xs",children:m===C.id?e.jsx(ue,{className:"h-3 w-3 animate-spin"}):e.jsx(as,{className:"h-3 w-3"})})]})]})]})]})})})},C.id)})})]})},lh=El,ch=Rl,To=u.forwardRef(({className:s,children:t,...r},n)=>e.jsxs(qn,{ref:n,className:de("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...r,children:[t,e.jsx(Nl,{asChild:!0,children:e.jsx(oi,{className:"h-4 w-4 opacity-50"})})]}));To.displayName=qn.displayName;const Po=u.forwardRef(({className:s,...t},r)=>e.jsx(Vn,{ref:r,className:de("flex cursor-default items-center justify-center py-1",s),...t,children:e.jsx(Jl,{className:"h-4 w-4"})}));Po.displayName=Vn.displayName;const Oo=u.forwardRef(({className:s,...t},r)=>e.jsx(Gn,{ref:r,className:de("flex cursor-default items-center justify-center py-1",s),...t,children:e.jsx(oi,{className:"h-4 w-4"})}));Oo.displayName=Gn.displayName;const Lo=u.forwardRef(({className:s,children:t,position:r="popper",...n},a)=>e.jsx(Cl,{children:e.jsxs(Hn,{ref:a,className:de("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:r,...n,children:[e.jsx(Po,{}),e.jsx(Sl,{className:de("p-1",r==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),e.jsx(Oo,{})]})}));Lo.displayName=Hn.displayName;const dh=u.forwardRef(({className:s,...t},r)=>e.jsx(Zn,{ref:r,className:de("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...t}));dh.displayName=Zn.displayName;const sa=u.forwardRef(({className:s,children:t,...r},n)=>e.jsxs(Wn,{ref:n,className:de("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",s),...r,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(kl,{children:e.jsx(nt,{className:"h-4 w-4"})})}),e.jsx(_l,{children:t})]}));sa.displayName=Wn.displayName;const uh=u.forwardRef(({className:s,...t},r)=>e.jsx(Qn,{ref:r,className:de("-mx-1 my-1 h-px bg-muted",s),...t}));uh.displayName=Qn.displayName;function mh(s){return{id:s.id,userId:s.ui,username:s.un,text:s.tx,timestamp:s.ts}}function xh(s,t){return[s,t].sort().join("_")}async function hh(s){try{const t=k(_,"chats/admin_chat");if((await q(t)).exists())return;const n={id:"admin_chat",t:"group",n:"ðŸ’¬ Chat Administrateur",m:[s],mn:{},ca:Date.now(),cb:s,ac:!0};await $e(t,n),await $e(k(_,`userChats/${s}/admin_chat`),!0),b.log("âœ… Chat admin crÃ©Ã©")}catch(t){throw b.error("Erreur crÃ©ation chat admin:",t),t}}async function Io(s){try{const t=k(_,"chats/admin_info");if((await q(t)).exists()){b.log("âœ… Canal info admin existe dÃ©jÃ ");return}const n={id:"admin_info",t:"admin_info",n:"ðŸ“¢ Informations Admin",m:[],mn:{},ca:Date.now(),cb:s,ac:!0};await $e(t,n),b.log("âœ… Canal info admin crÃ©Ã©")}catch(t){throw b.error("Erreur crÃ©ation canal info:",t),t}}async function fh(s,t,r,n){try{const a=xh(s,t),i=k(_,`chats/${a}`);if((await q(i)).exists())return a;const l={id:a,t:"private",m:[s,t],mn:{[s]:r,[t]:n},ca:Date.now(),cb:s};return await $e(i,l),await Promise.all([$e(k(_,`userChats/${s}/${a}`),!0),$e(k(_,`userChats/${t}/${a}`),!0)]),a}catch(a){throw b.error("Erreur crÃ©ation chat privÃ©:",a),a}}async function ph(s,t,r,n,a){try{if(!r||r.trim().length===0)throw new Error("Le nom du groupe est requis");if(n.length<1)throw new Error("Un groupe doit contenir au moins 1 autre membre");const i=[...new Set([s,...n])],o={[s]:t,...a},l=xt(k(_,"chats")),c=l.key,d={id:c,t:"group",n:r.trim(),m:i,mn:o,ca:Date.now(),cb:s,ac:!1};return await $e(l,d),await Promise.all(i.map(m=>$e(k(_,`userChats/${m}/${c}`),!0))),c}catch(i){throw b.error("Erreur crÃ©ation groupe:",i),i}}async function Do(s,t,r,n){try{if(!n||n.trim().length===0)throw new Error("Le message ne peut pas Ãªtre vide");const a=k(_,`chats/${s}`),i=await q(a);if(!i.exists())throw new Error("Chat introuvable");const o=i.val(),l=Array.isArray(o.m)?o.m:[];if(o.ac&&!l.includes(t)){const p={};p[`chats/${s}/m`]=[...l,t],p[`chats/${s}/mn/${t}`]=r,p[`userChats/${t}/${s}`]=!0,await ce(k(_),p)}else if(!o.ac&&!l.includes(t))throw new Error("Vous n'Ãªtes pas membre de ce chat");const c=k(_,`chats/${s}/messages`),m={id:xt(c).key,ui:t,un:r,tx:n.trim(),ts:Date.now()},x={};x[`chats/${s}/messages/${m.id}`]=m,x[`chats/${s}/lm`]={tx:m.tx,ts:m.ts,ui:m.ui,un:m.un},await ce(k(_),x)}catch(a){throw b.error("Erreur envoi message:",a),a}}async function gh(s,t,r,n){try{if(n!=="admin")throw new Error("Seuls les administrateurs peuvent envoyer des infos");await Io(s),await Do("admin_info",s,`ðŸ“¢ ${t}`,r)}catch(a){throw b.error("Erreur envoi info admin:",a),a}}async function Fr(s,t){try{const r=k(_,`userChats/${s}`),n=await q(r),a=n.exists()?Object.keys(n.val()):[];a.includes("admin_info")||(a.push("admin_info"),await $e(k(_,`userChats/${s}/admin_info`),!0));const i=[],o=a.map(async c=>{const d=k(_,`chats/${c}`),m=await q(d);if(m.exists()){const x=m.val();return Array.isArray(x.m)||(x.m=[]),{id:c,...x}}return null}),l=await Promise.all(o);return i.push(...l.filter(c=>c!==null)),i.sort((c,d)=>{var p,f;if(c.id==="admin_info")return-1;if(d.id==="admin_info")return 1;if(c.id==="admin_chat")return-1;if(d.id==="admin_chat")return 1;const m=((p=c.lm)==null?void 0:p.ts)||c.ca;return(((f=d.lm)==null?void 0:f.ts)||d.ca)-m})}catch(r){return b.error("Erreur rÃ©cupÃ©ration chats:",r),[]}}async function bh(s,t=50){try{const r=k(_,`chats/${s}/messages`);let n;try{n=rr(r,di("ts"),ar(t))}catch(o){b.warn("Index non configurÃ©, utilisation de orderByKey",o),n=rr(r,ar(t))}const a=await q(n);return a.exists()?Object.values(a.val()).sort((o,l)=>o.ts-l.ts):[]}catch(r){return b.error("Erreur rÃ©cupÃ©ration messages:",r),[]}}function yh(s,t,r=50){const n=k(_,`chats/${s}/messages`);let a;try{a=rr(n,di("ts"),ar(r))}catch{a=rr(n,ar(r))}const i=et(a,o=>{if(!o.exists()){t([]);return}const l=Object.values(o.val());t(l.sort((c,d)=>c.ts-d.ts))},o=>{b.error("Erreur Ã©coute messages:",o),t([])});return()=>ia(a,"value",i)}function vh(s,t){const r=k(_,`userChats/${s}`),n=et(r,async a=>{const i=a.exists()?Object.keys(a.val()):[];i.includes("admin_info")||(i.push("admin_info"),await $e(k(_,`userChats/${s}/admin_info`),!0));const o=i.map(async d=>{const m=k(_,`chats/${d}`),x=await q(m);if(x.exists()){const p=x.val();return Array.isArray(p.m)||(p.m=[]),{id:d,...p}}return null}),c=(await Promise.all(o)).filter(d=>d!==null);c.sort((d,m)=>{var f,h;if(d.id==="admin_info")return-1;if(m.id==="admin_info")return 1;if(d.id==="admin_chat")return-1;if(m.id==="admin_chat")return 1;const x=((f=d.lm)==null?void 0:f.ts)||d.ca;return(((h=m.lm)==null?void 0:h.ts)||m.ca)-x}),t(c)},a=>{b.error("Erreur Ã©coute chats:",a),t([])});return()=>ia(r,"value",n)}async function jh(s,t,r,n){try{const a=k(_,`chats/${s}`),i=await q(a);if(!i.exists())throw new Error("Chat introuvable");const o=i.val(),l=Array.isArray(o.m)?o.m:[];if(o.ac)throw new Error("Impossible de modifier les chats systÃ¨me");if(o.t!=="group")throw new Error("Ce n'est pas un groupe");if(!l.includes(n))throw new Error("Vous n'Ãªtes pas membre de ce groupe");if(l.includes(t))throw new Error("L'utilisateur est dÃ©jÃ  membre");const c={};c[`chats/${s}/m`]=[...l,t],c[`chats/${s}/mn/${t}`]=r,c[`userChats/${t}/${s}`]=!0,await ce(k(_),c)}catch(a){throw b.error("Erreur ajout membre:",a),a}}async function wh(s,t,r){try{const n=k(_,`chats/${s}`),a=await q(n);if(!a.exists())throw new Error("Chat introuvable");const i=a.val(),o=Array.isArray(i.m)?i.m:[];if(i.ac)throw new Error("Impossible de modifier les chats systÃ¨me");if(i.t!=="group")throw new Error("Ce n'est pas un groupe");if(o.length<=2)throw new Error("Un groupe doit contenir au moins 2 membres");const l={};l[`chats/${s}/m`]=o.filter(c=>c!==t),l[`chats/${s}/mn/${t}`]=null,l[`userChats/${t}/${s}`]=null,await ce(k(_),l)}catch(n){throw b.error("Erreur retrait membre:",n),n}}async function Nh(s,t,r){try{const n=k(_,`chats/${s}`),a=await q(n);if(!a.exists())throw new Error("Chat introuvable");const i=a.val(),o=Array.isArray(i.m)?i.m:[];if(i.ac)throw new Error("Les chats systÃ¨me ne peuvent pas Ãªtre supprimÃ©s");if(i.t!=="group")throw new Error("Seuls les groupes peuvent Ãªtre supprimÃ©s");if(i.cb!==t&&r!=="admin")throw new Error("Permission refusÃ©e");const l={};o.forEach(c=>{l[`userChats/${c}/${s}`]=null}),l[`chats/${s}`]=null,await ce(k(_),l)}catch(n){throw b.error("Erreur suppression groupe:",n),n}}async function Ch(s,t){try{const r=k(_,"users"),n=await q(r);if(!n.exists())return[];const a=n.val(),i=[],o=s.toLowerCase().trim();return Object.entries(a).forEach(([l,c])=>{if(l===t)return;const d=c.username||"";d.toLowerCase().includes(o)&&i.push({id:l,username:d})}),i.slice(0,20)}catch(r){return b.error("Erreur recherche utilisateurs:",r),[]}}const Sh=()=>{var Na,Ca;const{user:s,userProfile:t}=Me(),r=mt(),[n,a]=u.useState(!1),[i,o]=u.useState(!1),[l,c]=u.useState([]),[d,m]=u.useState([]),[x,p]=u.useState([]),[f,h]=u.useState([]),[g,v]=u.useState(""),[j,M]=u.useState({totalUsers:0,totalMatches:0,totalTournaments:0,totalBets:0,totalFortune:0,activeUsers:0}),[P,C]=u.useState(!1),[I,O]=u.useState(!1),[w,E]=u.useState(!1),[V,A]=u.useState(!1),[B,S]=u.useState(!1),[J,me]=u.useState(!1),[re,Se]=u.useState(null),[ve,je]=u.useState(null),[K,ee]=u.useState(""),[z,xe]=u.useState(""),[L,R]=u.useState(""),[Z,se]=u.useState("1000"),[N,D]=u.useState(""),[Q,y]=u.useState(""),[G,Y]=u.useState(""),[ae,Ce]=u.useState(""),[Ee,Ue]=u.useState("add"),[tt,st]=u.useState(""),[Xe,wt]=u.useState(""),[Xt,ht]=u.useState(!1),Cs=[{id:"founder",name:"Fondateur",icon:"ðŸ‘‘",color:"gold"},{id:"veteran",name:"VÃ©tÃ©ran",icon:"âš”ï¸",color:"silver"},{id:"champion",name:"Champion",icon:"ðŸ†",color:"gold"},{id:"collector",name:"Collectionneur",icon:"ðŸŽ´",color:"purple"},{id:"millionaire",name:"Millionnaire",icon:"ðŸ’°",color:"green"}];u.useEffect(()=>{s&&t&&(a(t.role==="admin"),t.role==="admin"&&We())},[s,t]);const We=async()=>{o(!0);try{const F=k(_,"users"),ie=await q(F);if(ie.exists()){const Ne=ie.val(),Ye=Object.entries(Ne).map(([zt,Bt])=>({id:zt,...Bt}));c(Ye);const Ft=Ye.reduce((zt,Bt)=>zt+(Bt.fortune||0),0),Yo=Ye.filter(zt=>{const Bt=zt.lastActive||0;return Date.now()-Bt<24*60*60*1e3}).length,Ko=k(_,"matches"),Sa=await q(Ko);let ka=0,yr=[];if(Sa.exists()){const zt=Sa.val();yr=Object.entries(zt).map(([Bt,el])=>({id:Bt,...el})),ka=yr.length}m(yr);const Xo=k(_,"tournaments"),_a=await q(Xo);let Ea=0;_a.exists()&&(Ea=Object.keys(_a.val()).length),M({totalUsers:Ye.length,totalMatches:ka,totalTournaments:Ea,totalBets:0,totalFortune:Ft,activeUsers:Yo})}o(!1)}catch(F){b.error("Erreur chargement donnÃ©es admin:",F),$({title:"Erreur",description:"Impossible de charger les donnÃ©es",variant:"destructive"}),o(!1)}},es=async()=>{if(!s||!t||!Xe.trim()){$({title:"Erreur",description:"Le message ne peut pas Ãªtre vide",variant:"destructive"});return}if(t.role!=="admin"){$({title:"AccÃ¨s refusÃ©",description:"Seuls les administrateurs peuvent envoyer des messages d'info",variant:"destructive"});return}ht(!0);try{await gh(s.uid,t.username,Xe,t.role),$({title:"ðŸ“¢ Message envoyÃ©",description:"Le message d'information a Ã©tÃ© diffusÃ© Ã  tous les joueurs"}),wt(""),me(!1)}catch(F){b.error("Erreur envoi message info:",F),$({title:"Erreur",description:F.message||"Impossible d'envoyer le message",variant:"destructive"})}finally{ht(!1)}},zo=async()=>{if(!K||!z||!L){$({title:"Erreur",description:"Remplissez tous les champs",variant:"destructive"});return}o(!0);try{const F=na(),Ne=(await li(F,K,z)).user.uid,Ye=k(_,`users/${Ne}`);await $e(Ye,{username:L,email:K,eloRating:parseInt(Z),fortune:100,wins:0,losses:0,role:"player",banned:!1,createdAt:new Date().toISOString()}),$({title:"âœ… Utilisateur crÃ©Ã©",description:`${L} a Ã©tÃ© ajoutÃ©`}),C(!1),ee(""),xe(""),R(""),se("1000"),We()}catch(F){b.error("Erreur crÃ©ation utilisateur:",F),$({title:"Erreur",description:F.message,variant:"destructive"})}finally{o(!1)}},Bo=async()=>{if(re){o(!0);try{const F=k(_,`users/${re.id}`),ie={};if(N&&(ie.eloRating=parseInt(N)),Q&&(ie.fortune=parseInt(Q)),G&&(ie.role=G),await ce(F,ie),Q){const Ne=re.fortune||0,Ye=parseInt(Q),Ft=Ye-Ne;await Be(re.id,Ye,Ft,`Ajustement admin par ${(t==null?void 0:t.username)||"Admin"}`)}$({title:"âœ… Utilisateur modifiÃ©",description:"Les modifications ont Ã©tÃ© sauvegardÃ©es"}),O(!1),Se(null),D(""),y(""),Y(""),We()}catch(F){b.error("Erreur modification utilisateur:",F),$({title:"Erreur",description:F.message,variant:"destructive"})}finally{o(!1)}}},Uo=async(F,ie)=>{if(confirm(`âš ï¸ Supprimer dÃ©finitivement ${ie} ?

Cette action est irrÃ©versible.`)){o(!0);try{const Ne=k(_,`users/${F}`);await Ms(Ne),$({title:"ðŸ—‘ï¸ Utilisateur supprimÃ©",description:`${ie} a Ã©tÃ© retirÃ© de la base de donnÃ©es`}),We()}catch(Ne){b.error("Erreur suppression utilisateur:",Ne),$({title:"Erreur",description:Ne.message,variant:"destructive"})}finally{o(!1)}}},qo=async()=>{if(!re||!ae)return;const F=parseInt(ae);if(isNaN(F)||F<=0){$({title:"Erreur",description:"Montant invalide",variant:"destructive"});return}o(!0);try{const ie=k(_,`users/${re.id}`),Ne=await q(ie);if(Ne.exists()){const Ye=Ne.val().fortune||0,Ft=Ee==="add"?Ye+F:Math.max(0,Ye-F);await ce(ie,{fortune:Ft}),$({title:"ðŸ’° Fortune mise Ã  jour",description:`${Ee==="add"?"+":"-"}${F}â‚¬`}),E(!1),Ce(""),We()}}catch(ie){b.error("Erreur gestion fortune:",ie),$({title:"Erreur",description:ie.message,variant:"destructive"})}finally{o(!1)}},Vo=async()=>{var F;if(!(!re||!tt)){o(!0);try{const ie=k(_,`users/${re.id}`),Ne=await q(ie);if(Ne.exists()){const Ye=Ne.val().badges||[];Ye.includes(tt)?$({title:"Badge dÃ©jÃ  possÃ©dÃ©",description:"L'utilisateur a dÃ©jÃ  ce badge",variant:"destructive"}):(await ce(ie,{badges:[...Ye,tt]}),$({title:"ðŸ… Badge attribuÃ©",description:`Badge "${(F=Cs.find(Ft=>Ft.id===tt))==null?void 0:F.name}" donnÃ© Ã  ${re.username}`})),A(!1),st(""),We()}}catch(ie){b.error("Erreur attribution badge:",ie),$({title:"Erreur",description:ie.message,variant:"destructive"})}finally{o(!1)}}},Go=async(F,ie)=>{if(confirm(`âš ï¸ Bannir ${ie} ?

L'utilisateur ne pourra plus se connecter.`)){o(!0);try{const Ne=k(_,`users/${F}`);if(!(await q(Ne)).exists()){$({title:"Erreur",description:"Utilisateur introuvable",variant:"destructive"});return}await ce(Ne,{banned:!0,bannedAt:new Date().toISOString(),bannedBy:(s==null?void 0:s.uid)||"admin"}),$({title:"ðŸš« Utilisateur banni",description:`${ie} a Ã©tÃ© banni et ne peut plus se connecter`}),await We()}catch(Ne){b.error("Erreur bannissement:",Ne),$({title:"Erreur",description:Ne.message||"Impossible de bannir l'utilisateur",variant:"destructive"})}finally{o(!1)}}},Ho=async(F,ie)=>{if(confirm(`âœ… DÃ©bannir ${ie} ?

L'utilisateur pourra Ã  nouveau se connecter.`)){o(!0);try{const Ne=k(_,`users/${F}`);if(!(await q(Ne)).exists()){$({title:"Erreur",description:"Utilisateur introuvable",variant:"destructive"});return}await ce(Ne,{banned:!1,unbannedAt:new Date().toISOString(),unbannedBy:(s==null?void 0:s.uid)||"admin"}),$({title:"âœ… Utilisateur dÃ©banni",description:`${ie} peut maintenant se reconnecter`}),await We()}catch(Ne){b.error("Erreur dÃ©bannissement:",Ne),$({title:"Erreur",description:Ne.message||"Impossible de dÃ©bannir l'utilisateur",variant:"destructive"})}finally{o(!1)}}},Zo=async F=>{if(confirm(`âš ï¸ Supprimer ce match ?

Cette action est irrÃ©versible.`)){o(!0);try{const ie=k(_,`matches/${F}`);await Ms(ie),$({title:"ðŸ—‘ï¸ Match supprimÃ©",description:"Le match a Ã©tÃ© supprimÃ©"}),We()}catch(ie){b.error("Erreur suppression match:",ie),$({title:"Erreur",description:ie.message,variant:"destructive"})}finally{o(!1)}}},Wo=async()=>{if(confirm(`âš ï¸ ATTENTION : Remettre tous les ELO Ã  1000 ?

Cette action est irrÃ©versible.`)){o(!0);try{const F={};l.forEach(ie=>{F[`users/${ie.id}/eloRating`]=1e3}),await ce(k(_),F),$({title:"ðŸ”„ ELO reset",description:"Tous les joueurs sont Ã  1000 ELO"}),We()}catch(F){b.error("Erreur reset ELO:",F),$({title:"Erreur",description:F.message,variant:"destructive"})}finally{o(!1)}}},Qo=async()=>{if(confirm("ðŸ’° Ajouter 500â‚¬ Ã  tous les joueurs ?")){o(!0);try{const F={};l.forEach(ie=>{F[`users/${ie.id}/fortune`]=(ie.fortune||0)+500}),await ce(k(_),F),$({title:"ðŸ’° Fortune distribuÃ©e",description:"500â‚¬ ajoutÃ©s Ã  tous les joueurs"}),We()}catch(F){b.error("Erreur ajout fortune:",F),$({title:"Erreur",description:F.message,variant:"destructive"})}finally{o(!1)}}},wa=async()=>{if(confirm(`âš ï¸ DANGER : Supprimer TOUS les matchs ?

Cette action est IRRÃ‰VERSIBLE.`)){o(!0);try{const F=k(_,"matches");await Ms(F),$({title:"ðŸ—‘ï¸ Matchs supprimÃ©s",description:"Tous les matchs ont Ã©tÃ© effacÃ©s"}),We()}catch(F){b.error("Erreur suppression matchs:",F),$({title:"Erreur",description:F.message,variant:"destructive"})}finally{o(!1)}}},Jo=l.filter(F=>{var ie,Ne;return((ie=F.username)==null?void 0:ie.toLowerCase().includes(g.toLowerCase()))||((Ne=F.email)==null?void 0:Ne.toLowerCase().includes(g.toLowerCase()))});return t?n?i&&l.length===0?e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-background",children:e.jsx(ue,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"container mx-auto p-3 sm:p-4 max-w-7xl",children:[e.jsx(W.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-4 sm:mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"rounded-xl bg-primary/20 p-2 sm:p-3",children:e.jsx(jt,{className:"h-6 w-6 sm:h-8 sm:w-8 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl font-bold",children:"Admin Panel"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Gestion complÃ¨te"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(T,{variant:"default",onClick:()=>me(!0),size:"sm",className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(Aa,{className:"mr-1 sm:mr-2 h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"text-xs sm:text-sm",children:"Message Info"})]}),e.jsxs(T,{variant:"outline",onClick:()=>r("/"),size:"sm",children:[e.jsx(Ze,{className:"mr-1 sm:mr-2 h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"text-xs sm:text-sm",children:"Retour"})]})]})]})}),e.jsxs(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"mb-4 sm:mb-6 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-2 sm:gap-3",children:[e.jsx(U,{children:e.jsxs(H,{className:"p-2 sm:p-3 text-center",children:[e.jsx(Re,{className:"mx-auto mb-1 h-4 w-4 sm:h-5 sm:w-5 text-primary"}),e.jsx("p",{className:"text-base sm:text-lg md:text-xl font-bold",children:j.totalUsers}),e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground",children:"Users"})]})}),e.jsx(U,{children:e.jsxs(H,{className:"p-2 sm:p-3 text-center",children:[e.jsx(Yl,{className:"mx-auto mb-1 h-4 w-4 sm:h-5 sm:w-5 text-green-500"}),e.jsx("p",{className:"text-base sm:text-lg md:text-xl font-bold",children:j.activeUsers}),e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground",children:"Actifs"})]})}),e.jsx(U,{children:e.jsxs(H,{className:"p-2 sm:p-3 text-center",children:[e.jsx(Te,{className:"mx-auto mb-1 h-4 w-4 sm:h-5 sm:w-5 text-yellow-500"}),e.jsx("p",{className:"text-base sm:text-lg md:text-xl font-bold",children:j.totalMatches}),e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground",children:"Matchs"})]})}),e.jsx(U,{children:e.jsxs(H,{className:"p-2 sm:p-3 text-center",children:[e.jsx(Gt,{className:"mx-auto mb-1 h-4 w-4 sm:h-5 sm:w-5 text-purple-500"}),e.jsx("p",{className:"text-base sm:text-lg md:text-xl font-bold",children:j.totalTournaments}),e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground",children:"Tournois"})]})}),e.jsx(U,{children:e.jsxs(H,{className:"p-2 sm:p-3 text-center",children:[e.jsx(ys,{className:"mx-auto mb-1 h-4 w-4 sm:h-5 sm:w-5 text-blue-500"}),e.jsx("p",{className:"text-base sm:text-lg md:text-xl font-bold",children:j.totalBets}),e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground",children:"Paris"})]})}),e.jsx(U,{children:e.jsxs(H,{className:"p-2 sm:p-3 text-center",children:[e.jsx(Vt,{className:"mx-auto mb-1 h-4 w-4 sm:h-5 sm:w-5 text-green-500"}),e.jsxs("p",{className:"text-base sm:text-lg md:text-xl font-bold",children:[j.totalFortune,"â‚¬"]}),e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground",children:"Total"})]})})]}),e.jsx(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:e.jsxs(Ns,{defaultValue:"users",className:"space-y-3 sm:space-y-4",children:[e.jsxs(Kt,{className:"grid w-full grid-cols-3 lg:grid-cols-5 gap-1 h-auto p-1",children:[e.jsxs(qe,{value:"users",className:"text-xs sm:text-sm px-2 py-1.5",children:[e.jsx(Re,{className:"h-3 w-3 sm:h-4 sm:w-4 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Users"})]}),e.jsxs(qe,{value:"anticheat",className:"text-xs sm:text-sm px-2 py-1.5",children:[e.jsx(jt,{className:"h-3 w-3 sm:h-4 sm:w-4 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Anti-Cheat"})]}),e.jsxs(qe,{value:"matches",className:"text-xs sm:text-sm px-2 py-1.5",children:[e.jsx(Te,{className:"h-3 w-3 sm:h-4 sm:w-4 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Matchs"})]}),e.jsxs(qe,{value:"stats",className:"text-xs sm:text-sm px-2 py-1.5",children:[e.jsx(Qt,{className:"h-3 w-3 sm:h-4 sm:w-4 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Stats"})]}),e.jsxs(qe,{value:"actions",className:"text-xs sm:text-sm px-2 py-1.5 hidden lg:flex",children:[e.jsx(vt,{className:"h-3 w-3 sm:h-4 sm:w-4 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Actions"})]}),e.jsxs(qe,{value:"logs",className:"text-xs sm:text-sm px-2 py-1.5 hidden lg:flex",children:[e.jsx(it,{className:"h-3 w-3 sm:h-4 sm:w-4 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Logs"})]})]}),e.jsxs(Qe,{value:"users",className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 items-stretch sm:items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ot,{className:"absolute left-2 sm:left-3 top-1/2 -translate-y-1/2 h-3 w-3 sm:h-4 sm:w-4 text-muted-foreground"}),e.jsx(ye,{placeholder:"Rechercher...",value:g,onChange:F=>v(F.target.value),className:"pl-8 sm:pl-10 text-xs sm:text-sm h-8 sm:h-10"})]}),e.jsxs(T,{onClick:()=>C(!0),size:"sm",className:"text-xs sm:text-sm h-8 sm:h-10 shrink-0",children:[e.jsx(ns,{className:"mr-1 h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"hidden xs:inline",children:"Ajouter"})]})]}),e.jsx("div",{className:"space-y-2",children:Jo.map(F=>e.jsx(U,{className:F.banned?"opacity-50 border-destructive border-2":"",children:e.jsx(H,{className:"p-2 sm:p-3",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-start gap-2 sm:gap-3",children:[e.jsx("div",{className:"rounded-full bg-primary/20 p-1.5 sm:p-2 shrink-0",children:e.jsx(Re,{className:"h-3 w-3 sm:h-4 sm:w-4 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 flex-wrap",children:[e.jsx("p",{className:"font-bold text-xs sm:text-sm truncate",children:F.username}),F.role==="admin"&&e.jsx(le,{variant:"default",className:"text-[10px] px-1 py-0",children:"Admin"}),F.banned&&e.jsx(le,{variant:"destructive",className:"text-[10px] px-1 py-0",children:"Banni"})]}),e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground truncate",children:F.email}),e.jsxs("div",{className:"flex gap-2 text-[10px] sm:text-xs text-muted-foreground flex-wrap",children:[e.jsxs("span",{children:["âš¡",F.eloRating||1e3]}),e.jsxs("span",{children:["ðŸ’°",F.fortune||0,"â‚¬"]}),e.jsxs("span",{children:["ðŸ†",F.wins||0,"W-",F.losses||0,"L"]})]})]})]}),e.jsxs("div",{className:"flex gap-1 flex-wrap",children:[e.jsx(T,{size:"sm",variant:"outline",onClick:()=>{Se(F),E(!0)},className:"h-7 w-7 p-0",title:"Fortune",children:e.jsx(Vt,{className:"h-3 w-3"})}),e.jsx(T,{size:"sm",variant:"outline",onClick:()=>{Se(F),A(!0)},className:"h-7 w-7 p-0",title:"Badge",children:e.jsx(Gt,{className:"h-3 w-3"})}),e.jsx(T,{size:"sm",variant:"outline",onClick:()=>{var ie,Ne;Se(F),D(((ie=F.eloRating)==null?void 0:ie.toString())||"1000"),y(((Ne=F.fortune)==null?void 0:Ne.toString())||"0"),Y(F.role||"player"),O(!0)},className:"h-7 w-7 p-0",title:"Modifier",children:e.jsx(ti,{className:"h-3 w-3"})}),F.banned?e.jsx(T,{size:"sm",variant:"default",onClick:()=>Ho(F.id,F.username),disabled:F.role==="admin",className:"bg-green-600 hover:bg-green-700 h-7 w-7 p-0",title:"DÃ©bannir",children:e.jsx(nt,{className:"h-3 w-3"})}):e.jsx(T,{size:"sm",variant:"destructive",onClick:()=>Go(F.id,F.username),disabled:F.role==="admin",className:"h-7 w-7 p-0",title:"Bannir",children:e.jsx(Kl,{className:"h-3 w-3"})}),e.jsx(T,{size:"sm",variant:"destructive",onClick:()=>Uo(F.id,F.username),disabled:F.role==="admin",className:"h-7 w-7 p-0",title:"Supprimer",children:e.jsx(as,{className:"h-3 w-3"})})]})]})})},F.id))})]}),e.jsxs(Qe,{value:"matches",className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2",children:[e.jsxs("h2",{className:"text-sm sm:text-base font-bold",children:["Matchs (",d.length,")"]}),e.jsxs(T,{variant:"destructive",onClick:wa,disabled:i||d.length===0,size:"sm",className:"text-xs",children:[e.jsx(as,{className:"mr-1 h-3 w-3"}),"Supprimer"]})]}),e.jsx("div",{className:"space-y-2",children:d.length===0?e.jsx(U,{children:e.jsx(H,{className:"p-6 text-center text-xs sm:text-sm text-muted-foreground",children:"Aucun match"})}):d.slice(0,50).map(F=>{var ie,Ne;return e.jsx(U,{children:e.jsx(H,{className:"p-2 sm:p-3",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 text-xs sm:text-sm",children:[e.jsxs("div",{className:"text-center flex-1",children:[e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Ã‰quipe 1"}),e.jsx("p",{className:"font-bold text-xs truncate",children:((ie=F.team1Names)==null?void 0:ie.join(" & "))||"?"}),e.jsx("p",{className:"text-lg sm:text-xl font-bold text-primary",children:F.score1||0})]}),e.jsx("div",{className:"text-muted-foreground text-xs",children:"VS"}),e.jsxs("div",{className:"text-center flex-1",children:[e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Ã‰quipe 2"}),e.jsx("p",{className:"font-bold text-xs truncate",children:((Ne=F.team2Names)==null?void 0:Ne.join(" & "))||"?"}),e.jsx("p",{className:"text-lg sm:text-xl font-bold text-primary",children:F.score2||0})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground",children:new Date(F.date||F.timestamp).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(T,{size:"sm",variant:"outline",onClick:()=>{je(F),S(!0)},className:"h-7 w-7 p-0",children:e.jsx(js,{className:"h-3 w-3"})}),e.jsx(T,{size:"sm",variant:"destructive",onClick:()=>Zo(F.id),className:"h-7 w-7 p-0",children:e.jsx(as,{className:"h-3 w-3"})})]})]})]})})},F.id)})})]}),e.jsx(Qe,{value:"anticheat",className:"space-y-3",children:e.jsx(oh,{})}),e.jsxs(Qe,{value:"stats",className:"space-y-3",children:[e.jsx("h2",{className:"text-sm sm:text-base font-bold",children:"Statistiques"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs(U,{children:[e.jsx(he,{className:"pb-2",children:e.jsxs(fe,{className:"text-sm sm:text-base flex items-center gap-2",children:[e.jsx(Qt,{className:"h-4 w-4 text-primary"}),"Top 5 ELO"]})}),e.jsx(H,{className:"space-y-1.5",children:l.sort((F,ie)=>(ie.eloRating||1e3)-(F.eloRating||1e3)).slice(0,5).map((F,ie)=>e.jsxs("div",{className:"flex items-center justify-between p-1.5 rounded bg-muted text-xs sm:text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(le,{variant:"outline",className:"text-[10px] px-1",children:["#",ie+1]}),e.jsx("span",{className:"font-medium truncate",children:F.username})]}),e.jsx("span",{className:"font-bold text-primary",children:F.eloRating||1e3})]},F.id))})]}),e.jsxs(U,{children:[e.jsx(he,{className:"pb-2",children:e.jsxs(fe,{className:"text-sm sm:text-base flex items-center gap-2",children:[e.jsx(Vt,{className:"h-4 w-4 text-green-500"}),"Top 5 Fortune"]})}),e.jsx(H,{className:"space-y-1.5",children:l.sort((F,ie)=>(ie.fortune||0)-(F.fortune||0)).slice(0,5).map((F,ie)=>e.jsxs("div",{className:"flex items-center justify-between p-1.5 rounded bg-muted text-xs sm:text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(le,{variant:"outline",className:"text-[10px] px-1",children:["#",ie+1]}),e.jsx("span",{className:"font-medium truncate",children:F.username})]}),e.jsxs("span",{className:"font-bold text-green-500",children:[F.fortune||0,"â‚¬"]})]},F.id))})]})]})]}),e.jsxs(Qe,{value:"actions",className:"space-y-3",children:[e.jsx("h2",{className:"text-sm sm:text-base font-bold",children:"Actions"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs(U,{children:[e.jsx(he,{className:"pb-2",children:e.jsxs(fe,{className:"text-sm flex items-center gap-2",children:[e.jsx(ls,{className:"h-4 w-4 text-yellow-500"}),"Dangereuses"]})}),e.jsxs(H,{className:"space-y-2",children:[e.jsxs(T,{variant:"destructive",className:"w-full text-xs h-8",onClick:Wo,children:[e.jsx(Ie,{className:"mr-2 h-3 w-3"}),"Reset ELO"]}),e.jsxs(T,{variant:"destructive",className:"w-full text-xs h-8",onClick:wa,children:[e.jsx(as,{className:"mr-2 h-3 w-3"}),"Supprimer matchs"]})]})]}),e.jsxs(U,{children:[e.jsx(he,{className:"pb-2",children:e.jsxs(fe,{className:"text-sm flex items-center gap-2",children:[e.jsx(nt,{className:"h-4 w-4 text-green-500"}),"SÃ©curisÃ©es"]})}),e.jsxs(H,{className:"space-y-2",children:[e.jsxs(T,{variant:"outline",className:"w-full text-xs h-8",onClick:Qo,children:[e.jsx(Zt,{className:"mr-2 h-3 w-3"}),"+500â‚¬ Ã  tous"]}),e.jsxs(T,{variant:"outline",className:"w-full text-xs h-8",onClick:We,children:[e.jsx(Gt,{className:"mr-2 h-3 w-3"}),"Recharger"]})]})]})]})]}),e.jsx(Qe,{value:"logs",className:"space-y-3",children:e.jsx(U,{children:e.jsxs(H,{className:"p-6 text-center",children:[e.jsx(it,{className:"h-12 w-12 mx-auto mb-3 text-muted-foreground"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Logs en dÃ©veloppement"})]})})})]})}),e.jsx(Fe,{open:J,onOpenChange:me,children:e.jsxs(Pe,{className:"max-w-[95vw] sm:max-w-lg",children:[e.jsxs(Oe,{children:[e.jsxs(Le,{className:"text-sm sm:text-base flex items-center gap-2",children:[e.jsx(Aa,{className:"h-5 w-5 text-blue-500"}),"Envoyer un message d'information"]}),e.jsx(Je,{children:'Ce message sera diffusÃ© Ã  tous les joueurs dans le canal "ðŸ“¢ Informations Admin"'})]}),e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsx("div",{className:"p-3 rounded-lg bg-blue-500/10 border border-blue-500/20",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Is,{className:"h-4 w-4 text-blue-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-xs text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"Conseils d'utilisation :"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Utilisez pour les annonces importantes"}),e.jsx("li",{children:"Maintenances, Ã©vÃ©nements, mises Ã  jour"}),e.jsx("li",{children:"Tous les joueurs recevront la notification"})]})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Message"}),e.jsx(ja,{placeholder:`Ã‰crivez votre message d'information ici...

Exemple :
ðŸŽ‰ Nouveau tournoi ce week-end !
Inscriptions ouvertes dÃ¨s maintenant.`,value:Xe,onChange:F=>wt(F.target.value),className:"min-h-[150px] text-sm",maxLength:500}),e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Maximum 500 caractÃ¨res"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[Xe.length,"/500"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(T,{variant:"outline",onClick:()=>{me(!1),wt("")},className:"flex-1",disabled:Xt,children:"Annuler"}),e.jsx(T,{onClick:es,disabled:Xt||!Xe.trim(),className:"flex-1 bg-blue-600 hover:bg-blue-700",children:Xt?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"mr-2 h-4 w-4 animate-spin"}),"Envoi..."]}):e.jsxs(e.Fragment,{children:[e.jsx(xr,{className:"mr-2 h-4 w-4"}),"Envoyer"]})})]})]})]})}),e.jsx(Fe,{open:P,onOpenChange:C,children:e.jsxs(Pe,{className:"max-w-[95vw] sm:max-w-md",children:[e.jsxs(Oe,{children:[e.jsx(Le,{className:"text-sm sm:text-base",children:"Ajouter utilisateur"}),e.jsx(Je,{children:"CrÃ©ez un nouveau compte utilisateur."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(ye,{type:"text",placeholder:"Nom d'utilisateur",value:L,onChange:F=>R(F.target.value),className:"text-xs sm:text-sm h-8 sm:h-10"}),e.jsx(ye,{type:"email",placeholder:"Email",value:K,onChange:F=>ee(F.target.value),className:"text-xs sm:text-sm h-8 sm:h-10"}),e.jsx(ye,{type:"password",placeholder:"Mot de passe",value:z,onChange:F=>xe(F.target.value),className:"text-xs sm:text-sm h-8 sm:h-10"}),e.jsx(ye,{type:"number",placeholder:"ELO (1000)",value:Z,onChange:F=>se(F.target.value),className:"text-xs sm:text-sm h-8 sm:h-10"}),e.jsxs(T,{className:"w-full text-xs sm:text-sm h-8 sm:h-10",onClick:zo,disabled:i,children:[i?e.jsx(ue,{className:"mr-2 h-3 w-3 sm:h-4 sm:w-4 animate-spin"}):e.jsx(ns,{className:"mr-2 h-3 w-3 sm:h-4 sm:w-4"}),"CrÃ©er"]})]})]})}),e.jsx(Fe,{open:I,onOpenChange:O,children:e.jsxs(Pe,{className:"max-w-[95vw] sm:max-w-md",children:[e.jsxs(Oe,{children:[e.jsxs(Le,{className:"text-sm sm:text-base",children:["Modifier ",re==null?void 0:re.username]}),e.jsx(Je,{children:"Modifiez les informations de cet utilisateur."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium mb-1 block",children:"ELO"}),e.jsx(ye,{type:"number",value:N,onChange:F=>D(F.target.value),className:"text-xs sm:text-sm h-8 sm:h-10"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium mb-1 block",children:"Fortune"}),e.jsx(ye,{type:"number",value:Q,onChange:F=>y(F.target.value),className:"text-xs sm:text-sm h-8 sm:h-10"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium mb-1 block",children:"RÃ´le"}),e.jsxs(lh,{value:G,onValueChange:Y,children:[e.jsx(To,{className:"text-xs sm:text-sm h-8 sm:h-10",children:e.jsx(ch,{})}),e.jsxs(Lo,{children:[e.jsx(sa,{value:"player",className:"text-xs sm:text-sm",children:"Joueur"}),e.jsx(sa,{value:"admin",className:"text-xs sm:text-sm",children:"Admin"})]})]})]}),e.jsxs(T,{className:"w-full text-xs sm:text-sm h-8 sm:h-10",onClick:Bo,disabled:i,children:[i?e.jsx(ue,{className:"mr-2 h-3 w-3 animate-spin"}):e.jsx(nt,{className:"mr-2 h-3 w-3"}),"Sauvegarder"]})]})]})}),e.jsx(Fe,{open:w,onOpenChange:E,children:e.jsxs(Pe,{className:"max-w-[95vw] sm:max-w-md",children:[e.jsxs(Oe,{children:[e.jsxs(Le,{className:"text-sm sm:text-base",children:["Fortune - ",re==null?void 0:re.username]}),e.jsx(Je,{children:"GÃ©rez la fortune de cet utilisateur."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground",children:["Actuelle: ",e.jsxs("span",{className:"font-bold text-foreground",children:[(re==null?void 0:re.fortune)||0,"â‚¬"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(T,{variant:Ee==="add"?"default":"outline",onClick:()=>Ue("add"),size:"sm",className:"text-xs h-8",children:[e.jsx(ns,{className:"mr-1 h-3 w-3"}),"Ajouter"]}),e.jsxs(T,{variant:Ee==="remove"?"default":"outline",onClick:()=>Ue("remove"),size:"sm",className:"text-xs h-8",children:[e.jsx(Ze,{className:"mr-1 h-3 w-3"}),"Retirer"]})]}),e.jsx(ye,{type:"number",placeholder:"Montant",value:ae,onChange:F=>Ce(F.target.value),className:"text-xs sm:text-sm h-8 sm:h-10"}),e.jsxs(T,{className:"w-full text-xs sm:text-sm h-8 sm:h-10",onClick:qo,disabled:i,children:[i?e.jsx(ue,{className:"mr-2 h-3 w-3 animate-spin"}):e.jsx(Zt,{className:"mr-2 h-3 w-3"}),"Confirmer"]})]})]})}),e.jsx(Fe,{open:V,onOpenChange:A,children:e.jsxs(Pe,{className:"max-w-[95vw] sm:max-w-md",children:[e.jsxs(Oe,{children:[e.jsxs(Le,{className:"text-sm sm:text-base",children:["Badge - ",re==null?void 0:re.username]}),e.jsx(Je,{children:"Ajoutez ou retirez des badges Ã  cet utilisateur."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"grid grid-cols-1 gap-2",children:Cs.map(F=>e.jsxs(T,{variant:tt===F.id?"default":"outline",onClick:()=>st(F.id),className:"justify-start text-xs sm:text-sm h-auto py-2",children:[e.jsx("span",{className:"text-xl mr-2",children:F.icon}),e.jsx("span",{className:"font-bold",children:F.name})]},F.id))}),e.jsxs(T,{className:"w-full text-xs sm:text-sm h-8 sm:h-10",onClick:Vo,disabled:i||!tt,children:[i?e.jsx(ue,{className:"mr-2 h-3 w-3 animate-spin"}):e.jsx(ct,{className:"mr-2 h-3 w-3"}),"Donner"]})]})]})}),e.jsx(Fe,{open:B,onOpenChange:S,children:e.jsxs(Pe,{className:"max-w-[95vw] sm:max-w-md",children:[e.jsxs(Oe,{children:[e.jsx(Le,{className:"text-sm sm:text-base",children:"DÃ©tails du match"}),e.jsx(Je,{children:"Consultez les dÃ©tails complets de ce match."})]}),ve&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-3",children:[e.jsxs("div",{className:"text-center p-2 sm:p-3 rounded-lg bg-primary/10",children:[e.jsx("p",{className:"text-[10px] text-muted-foreground mb-1",children:"Ã‰quipe 1"}),e.jsx("p",{className:"font-bold text-xs mb-1 truncate",children:((Na=ve.team1Names)==null?void 0:Na.join(" & "))||"?"}),e.jsx("p",{className:"text-2xl font-bold text-primary",children:ve.score1||0})]}),e.jsxs("div",{className:"text-center p-2 sm:p-3 rounded-lg bg-secondary/10",children:[e.jsx("p",{className:"text-[10px] text-muted-foreground mb-1",children:"Ã‰quipe 2"}),e.jsx("p",{className:"font-bold text-xs mb-1 truncate",children:((Ca=ve.team2Names)==null?void 0:Ca.join(" & "))||"?"}),e.jsx("p",{className:"text-2xl font-bold text-secondary",children:ve.score2||0})]})]}),e.jsxs("div",{className:"p-2 sm:p-3 rounded-lg bg-muted",children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground",children:"Date"}),e.jsx("p",{className:"font-medium text-xs sm:text-sm",children:new Date(ve.date||ve.timestamp).toLocaleString("fr-FR")})]}),ve.eloChanges&&e.jsxs("div",{className:"p-2 sm:p-3 rounded-lg bg-muted",children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground mb-2",children:"Changements ELO"}),e.jsx("div",{className:"space-y-1 text-xs",children:Object.entries(ve.eloChanges).map(([F,ie])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"truncate",children:F}),e.jsxs("span",{className:ie>0?"text-green-500":"text-red-500",children:[ie>0?"+":"",ie]})]},F))})]})]})]})})]})}):e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-background px-4",children:e.jsxs(W.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-destructive/20",children:e.jsx(jt,{className:"h-8 w-8 text-destructive"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"AccÃ¨s refusÃ©"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Vous n'avez pas les permissions d'administrateur"}),e.jsx(T,{onClick:()=>r("/"),children:"Retour Ã  l'accueil"})]})}):e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-background",children:e.jsx(ue,{className:"h-8 w-8 animate-spin text-primary"})})},kh=()=>{const{user:s}=Me(),t=mt(),[r,n]=u.useState([]),[a,i]=u.useState([]),[o,l]=u.useState([]),[c,d]=u.useState(0),[m,x]=u.useState(0),[p,f]=u.useState(!1),[h,g]=u.useState(!0),[v,j]=u.useState([]),[M,P]=u.useState(!1);u.useEffect(()=>{(async()=>{g(!0);try{const A=(await oo()).map(B=>({id:B.id,username:B.username,eloRating:B.elo2v2}));n(A)}catch{$({title:"Erreur",description:"Impossible de charger la liste des joueurs.",variant:"destructive"})}finally{g(!1)}})()},[]);const C=async E=>{if(E.preventDefault(),!s){$({title:"Erreur",description:"Vous devez Ãªtre connectÃ©.",variant:"destructive"});return}if(a.length===0||o.length===0){$({title:"Erreur",description:"Veuillez sÃ©lectionner les joueurs des deux Ã©quipes.",variant:"destructive"});return}if(c===m){$({title:"Erreur",description:"Le score final ne peut pas Ãªtre une Ã©galitÃ©.",variant:"destructive"});return}if(c<0||m<0||!Number.isInteger(c)||!Number.isInteger(m)){$({title:"Erreur",description:"Les scores doivent Ãªtre des nombres entiers positifs.",variant:"destructive"});return}if(a.filter(A=>o.includes(A)).length>0){$({title:"Erreur",description:"Un joueur ne peut pas Ãªtre dans les deux Ã©quipes.",variant:"destructive"});return}f(!0),P(!1);try{const A=await nm(a,o,c,m,s.uid),B=c>m?"Ã‰quipe 1":"Ã‰quipe 2",S=[...a,...o];for(const J of A.eloUpdates){const me=c>m&&a.includes(J.userId)||m>c&&o.includes(J.userId);await Pm(J.userId,`${B} a gagnÃ© ${c}-${m}`,J.eloChange)}j(A.eloUpdates),P(!0),$({title:"Match enregistrÃ© avec succÃ¨s! ðŸ†",description:`${B} a gagnÃ©. Les ELO ont Ã©tÃ© mis Ã  jour.`,duration:5e3}),i([]),l([]),d(0),x(0)}catch(A){b.error("Erreur lors de l'enregistrement du match:",A),$({title:"Erreur d'enregistrement",description:A.message||"Une erreur est survenue.",variant:"destructive"})}finally{f(!1)}},I=(E,V)=>{V===1&&o.includes(E)&&l(o.filter(S=>S!==E)),V===2&&a.includes(E)&&i(a.filter(S=>S!==E));const A=V===1?a:o,B=V===1?i:l;A.includes(E)?B(A.filter(S=>S!==E)):A.length<2?B([...A,E]):$({title:"Limite atteinte",description:"Maximum 2 joueurs par Ã©quipe.",variant:"default"})},O=E=>{var V;return((V=r.find(A=>A.id===E))==null?void 0:V.username)||"Inconnu"},w=E=>{if(E.length===0)return 0;const V=E.reduce((A,B)=>{const S=r.find(J=>J.id===B);return A+((S==null?void 0:S.eloRating)||0)},0);return Math.round(V/E.length)};return h?e.jsx(De,{children:e.jsxs("div",{className:"flex justify-center items-center h-96",children:[e.jsx(ue,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"ml-2 text-muted-foreground",children:"Chargement des joueurs..."})]})}):e.jsxs(De,{children:[e.jsx(W.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-4 sm:mb-6 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx(T,{variant:"ghost",size:"icon",onClick:()=>t("/match"),className:"rounded-xl",children:e.jsx(ur,{className:"h-4 w-4 sm:h-5 sm:w-5"})}),e.jsx("div",{className:"rounded-xl bg-primary/20 p-2 sm:p-3",children:e.jsx(vt,{className:"h-5 w-5 sm:h-6 sm:w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg sm:text-2xl font-bold text-foreground",children:"Enregistrer un Match"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Match 2v2"})]})]})}),e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[(a.length>0||o.length>0)&&e.jsx(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsx(U,{className:"border-primary/30",children:e.jsx(H,{className:"p-3 sm:p-4",children:e.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-4 items-center",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Ã‰quipe 1"}),e.jsx("div",{className:"space-y-1",children:a.length>0?e.jsxs(e.Fragment,{children:[a.map(E=>e.jsx("div",{className:"text-sm font-medium",children:O(E)},E)),e.jsxs("p",{className:"text-xs text-primary mt-2",children:["ELO moyen: ",w(a)]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun joueur"})})]}),e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-lg sm:text-2xl font-bold text-primary",children:"VS"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Ã‰quipe 2"}),e.jsx("div",{className:"space-y-1",children:o.length>0?e.jsxs(e.Fragment,{children:[o.map(E=>e.jsx("div",{className:"text-sm font-medium",children:O(E)},E)),e.jsxs("p",{className:"text-xs text-red-500 mt-2",children:["ELO moyen: ",w(o)]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun joueur"})})]})]})})})}),e.jsx(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsxs(U,{children:[e.jsx(he,{children:e.jsxs(fe,{className:"text-xl flex items-center gap-2",children:[e.jsx(Re,{className:"h-5 w-5 text-primary"}),"SÃ©lection des Ã©quipes"]})}),e.jsx(H,{children:e.jsxs("form",{onSubmit:C,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"space-y-2 sm:space-y-3 p-2 sm:p-3 rounded-lg border border-primary/20 bg-primary/5",children:[e.jsxs("label",{className:"font-semibold text-lg flex items-center justify-between text-primary",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(Re,{className:"h-4 w-4 mr-1"})," Ã‰quipe 1"]}),e.jsxs("span",{className:"text-sm",children:["(",a.length,"/2)"]})]}),e.jsx("div",{className:"space-y-1 max-h-64 overflow-y-auto pr-2",children:r.map(E=>{const V=a.includes(E.id),A=o.includes(E.id);return e.jsxs("div",{onClick:()=>I(E.id,1),className:`flex justify-between items-center p-2 rounded-md cursor-pointer transition-colors ${V?"bg-primary text-primary-foreground font-bold shadow-md":A?"bg-red-500/20 opacity-50 cursor-not-allowed":"bg-surface-alt hover:bg-surface-alt/70"}`,children:[e.jsx("span",{className:"truncate",children:E.username}),e.jsx("span",{className:`text-sm ml-2 ${V?"text-primary-foreground/80":"text-muted-foreground"}`,children:E.eloRating})]},E.id)})})]}),e.jsxs("div",{className:"space-y-2 sm:space-y-3 p-2 sm:p-3 rounded-lg border border-red-500/20 bg-red-500/5",children:[e.jsxs("label",{className:"font-semibold text-lg flex items-center justify-between text-red-500",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(Re,{className:"h-4 w-4 mr-1"})," Ã‰quipe 2"]}),e.jsxs("span",{className:"text-sm",children:["(",o.length,"/2)"]})]}),e.jsx("div",{className:"space-y-1 max-h-64 overflow-y-auto pr-2",children:r.map(E=>{const V=o.includes(E.id),A=a.includes(E.id);return e.jsxs("div",{onClick:()=>I(E.id,2),className:`flex justify-between items-center p-2 rounded-md cursor-pointer transition-colors ${V?"bg-red-500 text-primary-foreground font-bold shadow-md":A?"bg-primary/20 opacity-50 cursor-not-allowed":"bg-surface-alt hover:bg-surface-alt/70"}`,children:[e.jsx("span",{className:"truncate",children:E.username}),e.jsx("span",{className:`text-sm ml-2 ${V?"text-primary-foreground/80":"text-muted-foreground"}`,children:E.eloRating})]},E.id)})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t border-border",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"score1",className:"block text-sm font-medium text-primary",children:"Score Ã‰quipe 1"}),e.jsx(ye,{id:"score1",type:"number",value:c,onChange:E=>d(Number(E.target.value)),min:"0",required:!0,className:"text-lg font-bold"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"score2",className:"block text-sm font-medium text-red-500",children:"Score Ã‰quipe 2"}),e.jsx(ye,{id:"score2",type:"number",value:m,onChange:E=>x(Number(E.target.value)),min:"0",required:!0,className:"text-lg font-bold"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(T,{type:"button",variant:"outline",className:"flex-1",onClick:()=>{i([]),l([]),d(0),x(0)},disabled:p,children:[e.jsx(Ze,{className:"mr-2 h-4 w-4"}),"RÃ©initialiser"]}),e.jsx(T,{type:"submit",className:"flex-1",variant:"neon",disabled:p||a.length===0||o.length===0,children:p?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"mr-2 h-4 w-4 animate-spin"}),"Enregistrement..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"mr-2 h-4 w-4"}),"Enregistrer le Match"]})})]})]})})]})}),M&&v.length>0&&e.jsx(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:e.jsxs(U,{className:"border-primary/30 bg-primary/5",children:[e.jsx(he,{children:e.jsxs(fe,{className:"text-lg flex items-center gap-2",children:[e.jsx(Te,{className:"h-5 w-5 text-primary"}),"Mises Ã  jour ELO"]})}),e.jsx(H,{className:"space-y-2",children:v.map(E=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-surface-alt",children:[e.jsx("span",{className:"font-medium",children:E.username}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-muted-foreground",children:E.oldElo}),e.jsx("span",{className:"text-muted-foreground",children:"â†’"}),e.jsx("span",{className:"font-bold text-primary",children:E.newElo}),e.jsx("span",{className:`flex items-center gap-1 font-semibold min-w-[80px] justify-end ${E.eloChange>0?"text-green-500":"text-red-500"}`,children:E.eloChange>0?e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"h-4 w-4"}),"+",E.eloChange]}):e.jsxs(e.Fragment,{children:[e.jsx(cs,{className:"h-4 w-4"}),E.eloChange]})})]})]},E.userId))})]})})]})]})},_h=()=>{const{user:s,userProfile:t}=Me(),[r,n]=u.useState([]),[a,i]=u.useState(null),[o,l]=u.useState([]),[c,d]=u.useState(""),[m,x]=u.useState(!0),[p,f]=u.useState(!1),[h,g]=u.useState(!1),[v,j]=u.useState(""),[M,P]=u.useState(""),[C,I]=u.useState([]),[O,w]=u.useState([]),[E,V]=u.useState(!1),[A,B]=u.useState(!1),S=u.useRef(null);u.useEffect(()=>{if(!s)return;(t==null?void 0:t.role)==="admin"&&(hh(s.uid).catch(console.error),Io(s.uid).catch(console.error)),me();const y=vh(s.uid,G=>{n(G)});return()=>y()},[s,t]),u.useEffect(()=>{if(!a||!s)return;re();const y=yh(a.id,G=>{l(G),J()});return()=>y()},[a,s]),u.useEffect(()=>{J()},[o]);const J=()=>{var y;(y=S.current)==null||y.scrollIntoView({behavior:"smooth"})},me=async()=>{if(s){x(!0);try{const y=await Fr(s.uid,t==null?void 0:t.role);n(y),y.length>0&&!a&&i(y[0])}catch(y){b.error("Erreur chargement chats:",y)}finally{x(!1)}}},re=async()=>{if(a)try{const y=await bh(a.id);l(y)}catch(y){b.error("Erreur chargement messages:",y)}},Se=async()=>{if(!(!a||!s||!t||!c.trim())){if(a.id==="admin_info"&&t.role!=="admin"){$({title:"AccÃ¨s refusÃ©",description:"Seuls les administrateurs peuvent envoyer des messages ici",variant:"destructive"});return}f(!0);try{await Do(a.id,s.uid,t.username,c);const G=(Array.isArray(a.m)?a.m:[]).filter(Y=>Y!==s.uid).map(Y=>Tm(Y,t.username,c.substring(0,50)+(c.length>50?"...":""),a.id).catch(ae=>{b.error(`âŒ Erreur notification pour ${Y}:`,ae)}));await Promise.allSettled(G),d(""),b.log(`âœ… Message envoyÃ© avec ${G.length} notification(s)`)}catch(y){b.error("âŒ Erreur envoi message:",y),$({title:"Erreur",description:y.message||"Impossible d'envoyer le message",variant:"destructive"})}finally{f(!1)}}},ve=async y=>{if(!s||y.length<2){I([]);return}try{const G=await Ch(y,s.uid);I(G)}catch(G){b.error("Erreur recherche:",G)}},je=async(y,G)=>{if(!(!s||!t))try{const Y=await fh(s.uid,y,t.username,G);await me();const ae=r.find(Ce=>Ce.id===Y)||await Fr(s.uid).then(Ce=>Ce.find(Ee=>Ee.id===Y));ae&&(i(ae),B(!0)),P(""),I([]),$({title:"Chat crÃ©Ã©",description:`Chat avec ${G} crÃ©Ã©`})}catch(Y){$({title:"Erreur",description:Y.message||"Impossible de crÃ©er le chat",variant:"destructive"})}},K=async()=>{if(!s||!t||!v.trim()||O.length===0){$({title:"Erreur",description:"Nom du groupe et au moins un membre requis",variant:"destructive"});return}try{const y=O.map(Ce=>Ce.id),G=O.reduce((Ce,Ee)=>(Ce[Ee.id]=Ee.username,Ce),{}),Y=await ph(s.uid,t.username,v,y,G);await me();const ae=r.find(Ce=>Ce.id===Y)||await Fr(s.uid).then(Ce=>Ce.find(Ee=>Ee.id===Y));ae&&(i(ae),B(!0)),g(!1),j(""),w([]),$({title:"Groupe crÃ©Ã©",description:`Groupe "${v}" crÃ©Ã©`})}catch(y){$({title:"Erreur",description:y.message||"Impossible de crÃ©er le groupe",variant:"destructive"})}},ee=async(y,G)=>{if(!(!a||!s))try{await jh(a.id,y,G,s.uid),await me(),V(!1),P(""),I([]),$({title:"Membre ajoutÃ©",description:`${G} a Ã©tÃ© ajoutÃ© au groupe`})}catch(Y){$({title:"Erreur",description:Y.message||"Impossible d'ajouter le membre",variant:"destructive"})}},z=async y=>{if(!(!a||!s))try{await wh(a.id,y,s.uid),await me(),$({title:"Membre retirÃ©",description:"Le membre a Ã©tÃ© retirÃ© du groupe"})}catch(G){$({title:"Erreur",description:G.message||"Impossible de retirer le membre",variant:"destructive"})}},xe=async()=>{if(!a||!s||!t)return;const y=L(a);if(confirm(`âš ï¸ Supprimer le groupe "${y}" ?`))try{await Nh(a.id,s.uid,t.role),await me(),i(null),B(!1),$({title:"Groupe supprimÃ©",description:"Le groupe a Ã©tÃ© supprimÃ©"})}catch(G){$({title:"Erreur",description:G.message||"Impossible de supprimer le groupe",variant:"destructive"})}},L=y=>{if(y.t==="admin_info")return"ðŸ“¢ Infos Admin";if(y.t==="group")return y.n||"Groupe sans nom";if(y.mn&&s){const Y=(Array.isArray(y.m)?y.m:[]).find(ae=>ae!==s.uid);return Y?y.mn[Y]||"Utilisateur":"Chat privÃ©"}return"Chat privÃ©"},R=y=>y.id==="admin_info"?e.jsx(Ht,{className:"h-3 w-3 md:h-4 md:w-4 text-blue-500 flex-shrink-0"}):y.t==="group"?e.jsx(Re,{className:"h-3 w-3 md:h-4 md:w-4 text-primary flex-shrink-0"}):e.jsx(Es,{className:"h-3 w-3 md:h-4 md:w-4 text-muted-foreground flex-shrink-0"}),Z=y=>{const G=new Date(y),ae=new Date().getTime()-G.getTime(),Ce=Math.floor(ae/(1e3*60*60*24));return Ce===0?G.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}):Ce===1?"Hier":Ce<7?G.toLocaleDateString("fr-FR",{weekday:"short"}):G.toLocaleDateString("fr-FR",{day:"numeric",month:"short"})},se=y=>{i(y),B(!0)},N=()=>{B(!1)},D=(a==null?void 0:a.id)==="admin_info",Q=D&&(t==null?void 0:t.role)!=="admin";return m?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(ue,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"flex flex-col md:flex-row h-[calc(100vh-8rem)] gap-2 md:gap-4",children:[e.jsxs(U,{className:`${A?"hidden md:flex":"flex"} w-full md:w-80 flex-shrink-0 flex-col`,children:[e.jsx(he,{className:"border-b p-3 md:p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(fe,{className:"flex items-center gap-2 text-base md:text-lg",children:[e.jsx(Es,{className:"h-4 w-4 md:h-5 md:w-5 text-primary"}),"Messages"]}),e.jsxs(Fe,{open:h,onOpenChange:g,children:[e.jsx(nr,{asChild:!0,children:e.jsx(T,{size:"sm",variant:"outline",title:"CrÃ©er un groupe",children:e.jsx(Re,{className:"h-4 w-4"})})}),e.jsxs(Pe,{className:"max-w-[90vw] md:max-w-md",children:[e.jsxs(Oe,{children:[e.jsx(Le,{children:"CrÃ©er un groupe"}),e.jsx(Je,{children:"CrÃ©ez un nouveau groupe de discussion."})]}),e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsx(ye,{placeholder:"Nom du groupe",value:v,onChange:y=>j(y.target.value)}),e.jsxs("div",{children:[e.jsx(ye,{placeholder:"Rechercher des membres...",value:M,onChange:y=>{P(y.target.value),ve(y.target.value)}}),C.length>0&&e.jsx("div",{className:"mt-2 space-y-1 max-h-40 overflow-y-auto",children:C.map(y=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded hover:bg-surface-alt cursor-pointer",onClick:()=>{O.find(G=>G.id===y.id)||w([...O,y])},children:[e.jsx("span",{className:"text-sm",children:y.username}),O.find(G=>G.id===y.id)&&e.jsx("span",{className:"text-xs text-primary",children:"âœ“"})]},y.id))})]}),O.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Membres sÃ©lectionnÃ©s:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:O.map(y=>e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded bg-primary/10 text-xs",children:[y.username,e.jsx("button",{onClick:()=>w(O.filter(G=>G.id!==y.id)),className:"ml-1",children:e.jsx(Ze,{className:"h-3 w-3"})})]},y.id))})]}),e.jsx(T,{onClick:K,className:"w-full",disabled:!v.trim()||O.length===0,children:"CrÃ©er le groupe"})]})]})]})]})}),e.jsxs(H,{className:"flex-1 overflow-y-auto p-0",children:[e.jsxs("div",{className:"p-2 border-b",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ot,{className:"absolute left-2 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(ye,{placeholder:"Rechercher...",value:M,onChange:y=>{P(y.target.value),ve(y.target.value)},className:"pl-8 text-sm"})]}),C.length>0&&e.jsx("div",{className:"mt-2 space-y-1 max-h-32 md:max-h-40 overflow-y-auto",children:C.map(y=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded hover:bg-surface-alt cursor-pointer",onClick:()=>je(y.id,y.username),children:[e.jsx("span",{className:"text-xs md:text-sm",children:y.username}),e.jsx(Es,{className:"h-3 w-3 md:h-4 md:w-4 text-primary"})]},y.id))})]}),e.jsx("div",{className:"space-y-1",children:r.length===0?e.jsx("div",{className:"p-4 text-center text-muted-foreground text-xs md:text-sm",children:"Aucun chat. Recherchez un utilisateur ou crÃ©ez un groupe !"}):r.map(y=>e.jsx("div",{onClick:()=>se(y),className:`p-2 md:p-3 cursor-pointer hover:bg-surface-alt transition ${(a==null?void 0:a.id)===y.id?"bg-primary/10 border-l-2 border-primary":""} ${y.id==="admin_info"?"bg-blue-500/5":""}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[R(y),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-xs md:text-sm truncate",children:L(y)}),y.lm&&e.jsxs("p",{className:"text-xs text-muted-foreground truncate",children:[y.lm.un,": ",y.lm.tx]})]})]}),y.lm&&e.jsx("span",{className:"text-xs text-muted-foreground flex-shrink-0 ml-2",children:Z(y.lm.ts)})]})},y.id))})]})]}),a?e.jsxs(U,{className:`${A?"flex":"hidden md:flex"} flex-1 flex-col`,children:[e.jsxs(he,{className:"border-b p-3 md:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx(T,{variant:"ghost",size:"sm",className:"md:hidden -ml-2",onClick:N,children:e.jsx(ur,{className:"h-4 w-4"})}),e.jsxs(fe,{className:"flex items-center gap-2 text-base md:text-lg min-w-0",children:[R(a),e.jsx("span",{className:"truncate",children:L(a)}),a.t==="group"&&a.m&&e.jsxs("span",{className:"text-xs md:text-sm text-muted-foreground font-normal flex-shrink-0",children:["(",a.m.length,")"]})]})]}),a.t==="group"&&!a.ac&&e.jsxs("div",{className:"flex gap-1 md:gap-2",children:[e.jsxs(Fe,{open:E,onOpenChange:V,children:[e.jsx(nr,{asChild:!0,children:e.jsx(T,{size:"sm",variant:"outline",children:e.jsx(rs,{className:"h-3 w-3 md:h-4 md:w-4"})})}),e.jsxs(Pe,{className:"max-w-[90vw] md:max-w-md",children:[e.jsxs(Oe,{children:[e.jsx(Le,{children:"Ajouter un membre"}),e.jsx(Je,{children:"Recherchez et ajoutez un joueur au groupe."})]}),e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsx(ye,{placeholder:"Rechercher un utilisateur...",value:M,onChange:y=>{P(y.target.value),ve(y.target.value)}}),C.length>0&&e.jsx("div",{className:"space-y-1 max-h-60 overflow-y-auto",children:C.filter(y=>!a.m.includes(y.id)).map(y=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded hover:bg-surface-alt cursor-pointer",onClick:()=>ee(y.id,y.username),children:[e.jsx("span",{className:"text-sm",children:y.username}),e.jsx(T,{size:"sm",variant:"ghost",children:e.jsx(rs,{className:"h-4 w-4"})})]},y.id))})]})]})]}),a.cb===(s==null?void 0:s.uid)&&e.jsx(T,{size:"sm",variant:"destructive",onClick:xe,children:e.jsx(as,{className:"h-3 w-3 md:h-4 md:w-4"})})]})]}),D&&e.jsxs("div",{className:"mt-2 p-2 rounded-lg bg-blue-500/10 text-xs text-blue-700 dark:text-blue-300",children:["ðŸ“¢ Canal d'informations officiel - ",(t==null?void 0:t.role)==="admin"?"Vous pouvez envoyer des messages":"Lecture seule"]}),a.t==="group"&&a.mn&&!D&&e.jsxs("div",{className:"flex flex-wrap gap-1 md:gap-2 mt-2",children:[a.m.slice(0,5).map(y=>{var Y;const G=((Y=a.mn)==null?void 0:Y[y])||"Utilisateur";return e.jsxs("div",{className:"flex items-center gap-1 px-2 py-0.5 rounded bg-surface-alt text-xs",children:[G,!a.ac&&y!==(s==null?void 0:s.uid)&&a.cb===(s==null?void 0:s.uid)&&e.jsx("button",{onClick:()=>z(y),className:"ml-1 text-destructive",children:e.jsx(Ze,{className:"h-3 w-3"})})]},y)}),a.m.length>5&&e.jsxs("div",{className:"px-2 py-0.5 rounded bg-surface-alt text-xs",children:["+",a.m.length-5]})]})]}),e.jsxs(H,{className:"flex-1 flex flex-col p-0",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-2 md:p-4 space-y-2 md:space-y-3",children:[o.length===0?e.jsx("div",{className:"text-center text-muted-foreground py-8 text-sm",children:D?"Aucune annonce pour le moment":"Aucun message. Commencez la conversation !"}):o.map(y=>{const G=mh(y);return e.jsx(W.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex ${G.userId===(s==null?void 0:s.uid)?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[85%] md:max-w-[70%] rounded-lg p-2 md:p-3 ${G.userId===(s==null?void 0:s.uid)?"bg-primary text-primary-foreground":D?"bg-blue-500/10 border border-blue-500/20":"bg-surface-alt"}`,children:[G.userId!==(s==null?void 0:s.uid)&&e.jsx("p",{className:"text-xs font-medium mb-1 opacity-70",children:G.username}),e.jsx("p",{className:"text-xs md:text-sm break-words whitespace-pre-wrap",children:G.text}),e.jsx("p",{className:`text-xs mt-1 ${G.userId===(s==null?void 0:s.uid)?"opacity-70":"text-muted-foreground"}`,children:Z(G.timestamp)})]})},y.id)}),e.jsx("div",{ref:S})]}),!Q&&e.jsx("div",{className:"border-t p-2 md:p-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ye,{placeholder:D?"Message d'information...":"Tapez un message...",value:c,onChange:y=>d(y.target.value),onKeyPress:y=>{y.key==="Enter"&&!y.shiftKey&&(y.preventDefault(),Se())},disabled:p,className:"text-sm"}),e.jsx(T,{onClick:Se,disabled:p||!c.trim(),size:"sm",children:p?e.jsx(ue,{className:"h-3 w-3 md:h-4 md:w-4 animate-spin"}):e.jsx(xr,{className:"h-3 w-3 md:h-4 md:w-4"})})]})})]})]}):e.jsx(U,{className:"hidden md:flex flex-1 items-center justify-center",children:e.jsxs(H,{className:"text-center",children:[e.jsx(Es,{className:"h-16 w-16 mx-auto mb-4 text-muted-foreground opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:"SÃ©lectionnez un chat ou crÃ©ez-en un nouveau"})]})})]})},Eh=()=>{const{user:s}=Me(),[t,r]=u.useState([]),[n,a]=u.useState([]),[i,o]=u.useState(!1),[l,c]=u.useState(null),[d,m]=u.useState(!1),[x,p]=u.useState(null),[f,h]=u.useState(""),g=async()=>{if(s){o(!0);try{const[w,E]=await Promise.all([ho(s.uid),fo(s.uid)]);r(w),a(E)}catch(w){b.error("Erreur chargement offres:",w),$({title:"Erreur",description:"Impossible de charger les offres.",variant:"destructive"})}finally{o(!1)}}};u.useEffect(()=>{g()},[s]);const v=async w=>{if(s){c(w);try{await uo(s.uid,w),$({title:"Offre acceptÃ©e âœ…",description:"La transaction a Ã©tÃ© effectuÃ©e avec succÃ¨s."}),await g()}catch(E){$({title:"Erreur",description:E.message||"Impossible d'accepter l'offre.",variant:"destructive"})}finally{c(null)}}},j=async w=>{if(s){c(w);try{await mo(s.uid,w),$({title:"Offre rejetÃ©e",description:"L'acheteur a Ã©tÃ© notifiÃ©."}),await g()}catch(E){$({title:"Erreur",description:E.message||"Impossible de rejeter l'offre.",variant:"destructive"})}finally{c(null)}}},M=w=>{p(w),h((w.amount*1.1).toFixed(0)),m(!0)},P=async()=>{if(!s||!x)return;const w=Number(f);if(isNaN(w)||w<=0){$({title:"Erreur",description:"Montant invalide",variant:"destructive"});return}try{await xo(s.uid,x.id,w),$({title:"Contre-offre envoyÃ©e âœ…",description:"L'acheteur a Ã©tÃ© notifiÃ©."}),m(!1),await g()}catch(E){$({title:"Erreur",description:E.message||"Impossible d'envoyer la contre-offre.",variant:"destructive"})}},C=w=>{const E=w-Date.now();if(E<=0)return"ExpirÃ©e";const V=Math.floor(E/(1e3*60*60));return V<24?`${V}h restantes`:`${Math.floor(V/24)}j restantes`},I=w=>{switch(w){case"pending":return e.jsx(le,{variant:"outline",className:"bg-yellow-500/10 text-yellow-600 border-yellow-500",children:"En attente"});case"accepted":return e.jsx(le,{variant:"outline",className:"bg-green-500/10 text-green-600 border-green-500",children:"AcceptÃ©e"});case"rejected":return e.jsx(le,{variant:"outline",className:"bg-red-500/10 text-red-600 border-red-500",children:"RejetÃ©e"});case"countered":return e.jsx(le,{variant:"outline",className:"bg-blue-500/10 text-blue-600 border-blue-500",children:"Contre-offre"});case"expired":return e.jsx(le,{variant:"outline",className:"bg-gray-500/10 text-gray-600 border-gray-500",children:"ExpirÃ©e"});default:return null}},O=({offer:w,isReceived:E})=>{const V=Date.now()>w.expiresAt,A=w.status==="pending"&&!V;return e.jsx(W.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:e.jsxs(U,{className:A&&E?"border-yellow-500/50":"",children:[e.jsx(he,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs(fe,{className:"text-sm",children:["Listing #",w.listingId.slice(-6)]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:E?e.jsxs(e.Fragment,{children:["De: ",w.buyerId.slice(0,6),"..."]}):e.jsxs(e.Fragment,{children:["Ã€: ",w.sellerId.slice(0,6),"..."]})})]}),I(w.status)]})}),e.jsxs(H,{className:"space-y-3 text-xs",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Montant proposÃ©"}),e.jsxs("span",{className:"font-semibold text-lg",children:[w.amount,"â‚¬"]})]}),w.counterOffer&&e.jsxs("div",{className:"flex items-center justify-between bg-blue-500/10 p-2 rounded",children:[e.jsxs("span",{className:"text-blue-600 flex items-center gap-1",children:[e.jsx(Ie,{className:"h-3 w-3"}),"Contre-offre"]}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[w.counterOffer,"â‚¬"]})]}),w.message&&e.jsx("div",{className:"bg-muted p-2 rounded",children:e.jsxs("p",{className:"text-xs italic",children:['"',w.message,'"']})}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(it,{className:"h-3 w-3"}),C(w.expiresAt)]}),e.jsx("span",{className:"text-muted-foreground",children:new Date(w.createdAt).toLocaleDateString("fr-FR")})]})]}),A&&E&&e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(T,{size:"sm",variant:"outline",className:"flex-1 text-xs",onClick:()=>j(w.id),disabled:l===w.id,children:[e.jsx(Ze,{className:"h-4 w-4 mr-1"}),"Rejeter"]}),e.jsxs(T,{size:"sm",variant:"outline",className:"flex-1 text-xs",onClick:()=>M(w),disabled:l===w.id,children:[e.jsx(Ie,{className:"h-4 w-4 mr-1"}),"Contre-offre"]}),e.jsxs(T,{size:"sm",className:"flex-1 text-xs bg-green-600 hover:bg-green-700",onClick:()=>v(w.id),disabled:l===w.id,children:[e.jsx(nt,{className:"h-4 w-4 mr-1"}),"Accepter"]})]}),w.status==="countered"&&!E&&e.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded p-3 text-center",children:[e.jsx(us,{className:"h-4 w-4 text-blue-600 mx-auto mb-1"}),e.jsxs("p",{className:"text-blue-600 text-xs",children:["Le vendeur a proposÃ© ",w.counterOffer,"â‚¬"]})]})]})]})})};return e.jsxs(De,{children:[e.jsxs("div",{className:"container mx-auto max-w-6xl p-4",children:[e.jsxs("div",{className:"mb-6 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(Is,{className:"h-7 w-7 text-blue-400"}),"Mes Offres"]}),e.jsx("p",{className:"mt-1 text-muted-foreground text-sm",children:"GÃ©rez vos offres d'achat et de vente."})]}),e.jsx(T,{variant:"outline",size:"icon",onClick:g,disabled:i,children:e.jsx(ii,{className:`h-4 w-4 ${i?"animate-spin":""}`})})]}),e.jsxs(Ns,{defaultValue:"received",className:"w-full",children:[e.jsxs(Kt,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsxs(qe,{value:"received",className:"relative",children:["Offres ReÃ§ues",t.filter(w=>w.status==="pending").length>0&&e.jsx(le,{className:"ml-2 h-5 w-5 p-0 flex items-center justify-center bg-red-500",children:t.filter(w=>w.status==="pending").length})]}),e.jsxs(qe,{value:"sent",children:["Offres EnvoyÃ©es",n.filter(w=>w.status==="countered").length>0&&e.jsx(le,{className:"ml-2 h-5 w-5 p-0 flex items-center justify-center bg-blue-500",children:n.filter(w=>w.status==="countered").length})]})]}),e.jsx(Qe,{value:"received",className:"space-y-4",children:i?e.jsx("div",{className:"flex justify-center py-12 text-muted-foreground text-sm",children:"Chargement..."}):t.length===0?e.jsx(U,{children:e.jsx(H,{className:"py-12 text-center text-muted-foreground text-sm",children:"Aucune offre reÃ§ue pour le moment."})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(w=>e.jsx(O,{offer:w,isReceived:!0},w.id))})}),e.jsx(Qe,{value:"sent",className:"space-y-4",children:i?e.jsx("div",{className:"flex justify-center py-12 text-muted-foreground text-sm",children:"Chargement..."}):n.length===0?e.jsx(U,{children:e.jsx(H,{className:"py-12 text-center text-muted-foreground text-sm",children:"Aucune offre envoyÃ©e pour le moment."})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:n.map(w=>e.jsx(O,{offer:w,isReceived:!1},w.id))})})]})]}),e.jsx(Fe,{open:d,onOpenChange:m,children:e.jsxs(Pe,{children:[e.jsxs(Oe,{children:[e.jsx(Le,{children:"Faire une contre-offre"}),e.jsx(Je,{children:"Proposez un nouveau prix Ã  l'acheteur"})]}),e.jsxs("div",{className:"space-y-4",children:[x&&e.jsxs("div",{className:"bg-muted p-3 rounded-lg space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Offre initiale:"}),e.jsxs("span",{className:"font-semibold",children:[x.amount,"â‚¬"]})]}),x.message&&e.jsxs("div",{className:"text-xs italic text-muted-foreground pt-2 border-t",children:['"',x.message,'"']})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Votre contre-offre (â‚¬)"}),e.jsx(ye,{type:"number",placeholder:"Montant",value:f,onChange:w=>h(w.target.value)}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:"ðŸ’¡ Proposez un prix intermÃ©diaire pour maximiser vos chances"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(T,{variant:"outline",onClick:()=>m(!1),className:"flex-1",children:"Annuler"}),e.jsxs(T,{onClick:P,className:"flex-1",children:[e.jsx(xr,{className:"h-4 w-4 mr-2"}),"Envoyer"]})]})]})]})})]})},Rh=()=>{const{user:s}=Me(),[t,r]=u.useState(""),[n,a]=u.useState(null),[i,o]=u.useState(!1),[l,c]=u.useState([]),d=async()=>{const f=t.trim().toLowerCase();if(!f){$({title:"Erreur",description:"Veuillez entrer un nom ou un code."});return}o(!0);try{let h="";const g=Ui(f.toUpperCase());if(b.log("ðŸ“‡ Carte directe trouvÃ©e:",g),g.found)h=g.code;else{b.log("ðŸ”Ž Recherche par nom dans codeToCardMap...");for(const j of Object.keys(hs)){const M=hs[j],P=Object.keys(M).find(C=>M[C].nom.toLowerCase().replace(".png","").includes(f)||M[C].nom.toLowerCase().includes(f));if(P){h=P,b.log("âœ… Code trouvÃ©:",P,"dans la saison:",j);break}}}if(b.log("ðŸŽ¯ Code cible final:",h),!h){$({title:"Non trouvÃ©",description:"Aucune carte ne correspond Ã  ce nom ou code."});return}b.log("ðŸ“Š Appel getMarketStats pour:",h);const v=await br(h);b.log("ðŸ“ˆ Stats rÃ©cupÃ©rÃ©es:",v),b.log("ðŸ’° Prix history:",v==null?void 0:v.priceHistory),v?(a(v),l.find(j=>j.cardCode===v.cardCode)||c(j=>[v,...j].slice(0,5))):(b.log("âŒ Aucune stats retournÃ©e"),$({title:"Aucune donnÃ©e",description:"Cette carte n'a pas encore de transactions enregistrÃ©es."}))}catch(h){b.error("âŒ Erreur lors de la recherche:",h),$({title:"Erreur",description:"Erreur lors de la recherche."})}finally{o(!1)}},m=f=>{if(f.length<2)return null;const h=f[0].price,g=f[f.length-1].price,v=(g-h)/h*100;return{percentage:Math.abs(v).toFixed(1),isIncrease:v>0,value:g-h}},x=({history:f})=>{if(!f||f.length===0)return e.jsx("div",{className:"h-48 bg-muted/50 rounded-lg p-4 flex items-center justify-center",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun historique disponible"})});const h=f.filter(P=>P&&typeof P.price=="number"&&P.price>0);if(h.length===0)return e.jsx("div",{className:"h-48 bg-muted/50 rounded-lg p-4 flex items-center justify-center",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"DonnÃ©es invalides"})});const g=Math.max(...h.map(P=>P.price)),v=Math.min(...h.map(P=>P.price)),j=g-v||1,M=h.reduce((P,C)=>P+C.price,0)/h.length;return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative h-48 bg-gradient-to-b from-muted/30 to-muted/50 rounded-lg p-4 overflow-hidden",children:[e.jsxs("svg",{className:"w-full h-full",viewBox:"0 0 100 100",preserveAspectRatio:"none",children:[e.jsxs("defs",{children:[e.jsx("pattern",{id:"grid",width:"20",height:"20",patternUnits:"userSpaceOnUse",children:e.jsx("path",{d:"M 20 0 L 0 0 0 20",fill:"none",stroke:"currentColor",strokeOpacity:"0.1",strokeWidth:"0.5"})}),e.jsxs("linearGradient",{id:"areaGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"rgb(168, 85, 247)",stopOpacity:"0.4"}),e.jsx("stop",{offset:"100%",stopColor:"rgb(168, 85, 247)",stopOpacity:"0.05"})]})]}),e.jsx("rect",{width:"100",height:"100",fill:"url(#grid)"}),h.map((P,C)=>{const I=h.length>1?C/(h.length-1)*100:50,O=100-(P.price-v)/j*100,w=C===h.length-1;return e.jsxs("g",{children:[C>0&&e.jsx("line",{x1:(C-1)/(h.length-1)*100,y1:100-(h[C-1].price-v)/j*100,x2:I,y2:O,stroke:"rgb(168, 85, 247)",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("circle",{cx:I,cy:O,r:w?"3":"2",fill:w?"rgb(34, 197, 94)":"rgb(168, 85, 247)",className:"drop-shadow-md"}),w&&e.jsxs("circle",{cx:I,cy:O,r:"3",fill:"none",stroke:"rgb(34, 197, 94)",strokeWidth:"1",opacity:"0.5",children:[e.jsx("animate",{attributeName:"r",from:"3",to:"8",dur:"1.5s",repeatCount:"indefinite"}),e.jsx("animate",{attributeName:"opacity",from:"0.5",to:"0",dur:"1.5s",repeatCount:"indefinite"})]})]},C)})]}),e.jsx("div",{className:"absolute bottom-2 left-4 right-4 flex justify-between text-[10px] text-muted-foreground",children:h.map((P,C)=>C===0||C===h.length-1?e.jsx("span",{children:new Date(P.date).toLocaleDateString("fr-FR",{day:"2-digit",month:"short"})},C):null)})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-green-500/10 rounded-lg p-2 text-center border border-green-500/20",children:[e.jsx("p",{className:"text-muted-foreground mb-1",children:"Min"}),e.jsxs("p",{className:"font-bold text-green-600",children:[v,"â‚¬"]})]}),e.jsxs("div",{className:"bg-purple-500/10 rounded-lg p-2 text-center border border-purple-500/20",children:[e.jsx("p",{className:"text-muted-foreground mb-1",children:"Moyenne"}),e.jsxs("p",{className:"font-bold text-purple-600",children:[M.toFixed(2),"â‚¬"]})]}),e.jsxs("div",{className:"bg-red-500/10 rounded-lg p-2 text-center border border-red-500/20",children:[e.jsx("p",{className:"text-muted-foreground mb-1",children:"Max"}),e.jsxs("p",{className:"font-bold text-red-600",children:[g,"â‚¬"]})]})]})]})},p=({stats:f})=>{const h=m(f.priceHistory);return e.jsx(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsxs(U,{className:"overflow-hidden",children:[e.jsx(he,{className:"bg-gradient-to-r from-purple-500/10 to-blue-500/10 border-b",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs(fe,{className:"text-xl flex items-center gap-2",children:[f.cardCode,h&&e.jsxs(le,{variant:"outline",className:h.isIncrease?"bg-green-500/10 text-green-600 border-green-500":"bg-red-500/10 text-red-600 border-red-500",children:[h.isIncrease?e.jsx(ri,{className:"h-3 w-3 mr-1"}):e.jsx(ai,{className:"h-3 w-3 mr-1"}),h.percentage,"%"]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["DonnÃ©es sur ",f.priceHistory.length," vente(s)"]})]}),e.jsxs(le,{className:"bg-primary",children:[e.jsx(Et,{className:"h-3 w-3 mr-1"}),f.totalSales," ventes"]})]})}),e.jsxs(H,{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-500/10 to-blue-600/5 rounded-lg p-4 border border-blue-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-600 text-sm mb-2",children:[e.jsx(Zt,{className:"h-4 w-4"}),"Prix Moyen"]}),e.jsxs("div",{className:"text-2xl font-bold text-foreground",children:[f.averagePrice.toFixed(2),"â‚¬"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-500/10 to-green-600/5 rounded-lg p-4 border border-green-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-600 text-sm mb-2",children:[e.jsx(cs,{className:"h-4 w-4"}),"Prix Min"]}),e.jsxs("div",{className:"text-2xl font-bold text-foreground",children:[f.lowestPrice,"â‚¬"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-red-500/10 to-red-600/5 rounded-lg p-4 border border-red-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm mb-2",children:[e.jsx(Ie,{className:"h-4 w-4"}),"Prix Max"]}),e.jsxs("div",{className:"text-2xl font-bold text-foreground",children:[f.highestPrice,"â‚¬"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-500/10 to-purple-600/5 rounded-lg p-4 border border-purple-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2 text-purple-600 text-sm mb-2",children:[e.jsx(vs,{className:"h-4 w-4"}),"DerniÃ¨re Vente"]}),e.jsxs("div",{className:"text-2xl font-bold text-foreground",children:[f.lastSalePrice||"N/A","â‚¬"]}),f.lastSaleDate&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:new Date(f.lastSaleDate).toLocaleDateString("fr-FR")})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold mb-3 flex items-center gap-2",children:[e.jsx(Qt,{className:"h-4 w-4"}),"Historique des Prix (30 derniers jours)"]}),e.jsx(x,{history:f.priceHistory})]}),h&&e.jsxs("div",{className:`rounded-lg p-4 ${h.isIncrease?"bg-green-500/10 border border-green-500/20":"bg-red-500/10 border border-red-500/20"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[h.isIncrease?e.jsx(Ie,{className:"h-5 w-5 text-green-600"}):e.jsx(cs,{className:"h-5 w-5 text-red-600"}),e.jsxs("span",{className:`font-semibold ${h.isIncrease?"text-green-600":"text-red-600"}`,children:["Tendance ",h.isIncrease?"HaussiÃ¨re":"BaissiÃ¨re"]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Le prix a ",h.isIncrease?"augmentÃ©":"diminuÃ©"," de"," ",e.jsxs("span",{className:"font-semibold",children:[h.percentage,"%"]})," (",h.isIncrease?"+":"",h.value.toFixed(2),"â‚¬) sur la pÃ©riode."]})]}),e.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-blue-600 mb-2 flex items-center gap-2",children:"ðŸ’¡ Recommandation de Prix"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Pour vendre rapidement, fixez votre prix entre"," ",e.jsxs("span",{className:"font-semibold text-foreground",children:[(f.averagePrice*.9).toFixed(2),"â‚¬"]})," ","et"," ",e.jsxs("span",{className:"font-semibold text-foreground",children:[(f.averagePrice*1.1).toFixed(2),"â‚¬"]})]})]})]})]})})};return e.jsx(De,{children:e.jsxs("div",{className:"container mx-auto max-w-6xl p-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(Qt,{className:"h-7 w-7 text-purple-400"}),"Statistiques de MarchÃ©"]}),e.jsx("p",{className:"mt-1 text-muted-foreground text-sm",children:"Analysez les tendances et l'historique des prix des cartes."})]}),e.jsx(U,{className:"mb-6",children:e.jsx(H,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ye,{placeholder:"Nom du joueur ou code (ex: Lilwenn, N831...)",value:t,onChange:f=>r(f.target.value),onKeyPress:f=>f.key==="Enter"&&d(),className:"flex-1"}),e.jsx(T,{onClick:d,disabled:i,children:i?e.jsx(ue,{className:"h-4 w-4 animate-spin"}):e.jsx(ot,{className:"h-4 w-4"})})]})})}),n&&e.jsx(p,{stats:n}),l.length>0&&!n&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Recherches RÃ©centes"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:l.map(f=>{const h=m(f.priceHistory);return e.jsxs(U,{className:"cursor-pointer hover:border-primary transition-colors",onClick:()=>{r(f.cardCode),a(f)},children:[e.jsx(he,{className:"pb-3",children:e.jsxs(fe,{className:"text-sm flex items-center justify-between",children:[e.jsx("span",{children:f.cardCode}),h&&e.jsxs(le,{variant:"outline",className:h.isIncrease?"bg-green-500/10 text-green-600 border-green-500":"bg-red-500/10 text-red-600 border-red-500",children:[h.isIncrease?"+":"-",h.percentage,"%"]})]})}),e.jsxs(H,{className:"space-y-2 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Prix Moyen"}),e.jsxs("span",{className:"font-semibold",children:[f.averagePrice.toFixed(2),"â‚¬"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Ventes Totales"}),e.jsx("span",{className:"font-semibold",children:f.totalSales})]})]})]},f.cardCode)})})]}),!n&&l.length===0&&e.jsx(U,{children:e.jsxs(H,{className:"py-12 text-center",children:[e.jsx(ot,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:"Recherchez une carte pour voir ses statistiques de marchÃ©"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Exemple: Lilwenn, N831, Romane, etc."})]})})]})})},pn=({quest:s,onClaim:t,isClaiming:r})=>{const n=Math.round(s.progress/s.target*100),a=s.completed,i=!!s.claimedAt,o=()=>{switch(s.category){case"match":return e.jsx(Te,{className:"h-4 w-4"});case"social":return e.jsx(ys,{className:"h-4 w-4"});case"collection":return e.jsx(ct,{className:"h-4 w-4"});case"progression":return e.jsx(vs,{className:"h-4 w-4"})}},l=()=>{switch(s.category){case"match":return"text-rarity-gold";case"social":return"text-primary";case"collection":return"text-rarity-epic";case"progression":return"text-rarity-legendary"}};return e.jsx(W.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"group",children:e.jsxs(U,{className:`relative overflow-hidden transition-all ${a&&!i?"border-primary/50 bg-gradient-to-br from-primary/5 to-transparent":""}`,children:[a&&!i&&e.jsx("div",{className:"absolute top-0 right-0 w-20 h-20 bg-primary/10 rounded-bl-full"}),e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg bg-surface ${l()}`,children:o()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-start justify-between gap-2 mb-1",children:e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-sm text-foreground flex items-center gap-2",children:[s.title,a&&e.jsxs(le,{variant:"outline",className:"text-xs",children:[e.jsx(nt,{className:"h-3 w-3 mr-1"}),i?"RÃ©clamÃ©":"TerminÃ©"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.description})]})}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs mb-1",children:[e.jsxs("span",{className:"text-muted-foreground",children:[s.progress," / ",s.target]}),e.jsxs("span",{className:"font-medium text-foreground",children:[n,"%"]})]}),e.jsx(Jt,{value:n,className:"h-1.5"})]}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[s.reward.fortune&&e.jsxs(le,{variant:"secondary",className:"font-medium",children:["ðŸ’° ",s.reward.fortune]}),s.reward.packs&&e.jsxs(le,{variant:"secondary",className:"font-medium",children:["ðŸ“¦ ",s.reward.packs]}),s.reward.badge&&e.jsx(le,{variant:"secondary",className:"font-medium",children:"ðŸ… Badge"})]}),a&&!i&&e.jsxs(T,{size:"sm",onClick:t,disabled:r,className:"text-xs h-7",children:[e.jsx(ct,{className:"h-3 w-3 mr-1"}),"RÃ©clamer"]})]})]})]})})]})})},$h=()=>{const{user:s}=Me(),{quests:t,isLoading:r,isClaiming:n,claimReward:a,stats:i}=pa(s==null?void 0:s.uid);return r?e.jsx(U,{children:e.jsx(H,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})}):t?e.jsxs("div",{className:"space-y-4",children:[e.jsx(W.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},children:e.jsxs(U,{children:[e.jsx(he,{children:e.jsxs(fe,{className:"flex items-center gap-2",children:[e.jsx(ys,{className:"h-5 w-5 text-primary"}),"QuÃªtes"]})}),e.jsx(H,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Quotidiennes"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Jt,{value:(i==null?void 0:i.dailyProgress)||0,className:"flex-1"}),e.jsxs("span",{className:"text-sm font-medium",children:[i==null?void 0:i.dailyCompleted,"/",i==null?void 0:i.dailyTotal]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Hebdomadaires"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Jt,{value:(i==null?void 0:i.weeklyProgress)||0,className:"flex-1"}),e.jsxs("span",{className:"text-sm font-medium",children:[i==null?void 0:i.weeklyCompleted,"/",i==null?void 0:i.weeklyTotal]})]})]})]})})]})}),e.jsxs(Ns,{defaultValue:"daily",className:"w-full",children:[e.jsxs(Kt,{className:"grid w-full grid-cols-2",children:[e.jsxs(qe,{value:"daily",className:"gap-2",children:[e.jsx(it,{className:"h-4 w-4"}),"Quotidiennes",((i==null?void 0:i.dailyCompleted)||0)>0&&e.jsx(le,{variant:"secondary",className:"ml-1 h-5 text-xs",children:i==null?void 0:i.dailyCompleted})]}),e.jsxs(qe,{value:"weekly",className:"gap-2",children:[e.jsx(vs,{className:"h-4 w-4"}),"Hebdomadaires",((i==null?void 0:i.weeklyCompleted)||0)>0&&e.jsx(le,{variant:"secondary",className:"ml-1 h-5 text-xs",children:i==null?void 0:i.weeklyCompleted})]})]}),e.jsx(Qe,{value:"daily",className:"space-y-3 mt-4",children:t.daily.length===0?e.jsx(U,{children:e.jsx(H,{className:"p-6 text-center text-muted-foreground",children:"Aucune quÃªte quotidienne disponible"})}):t.daily.map(o=>e.jsx(pn,{quest:o,onClaim:()=>a("daily",o.id),isClaiming:n},o.id))}),e.jsx(Qe,{value:"weekly",className:"space-y-3 mt-4",children:t.weekly.length===0?e.jsx(U,{children:e.jsx(H,{className:"p-6 text-center text-muted-foreground",children:"Aucune quÃªte hebdomadaire disponible"})}):t.weekly.map(o=>e.jsx(pn,{quest:o,onClaim:()=>a("weekly",o.id),isClaiming:n},o.id))})]})]}):null},Ah=()=>e.jsxs(De,{children:[e.jsx(W.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"rounded-xl bg-primary/20 p-3",children:e.jsx(ys,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"QuÃªtes"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"ComplÃ¨te des quÃªtes pour gagner des rÃ©compenses"})]})]})}),e.jsx($h,{})]}),Mh=new Xl,Th=()=>{xu();const s=qs();return e.jsxs(e.Fragment,{children:[e.jsx(rt,{mode:"wait",children:e.jsxs(nc,{location:s,children:[e.jsx(Ve,{path:"/auth",element:e.jsx(Ge,{children:e.jsx(Ix,{})})}),e.jsx(Ve,{path:"/reset-password/:token",element:e.jsx(Ge,{children:e.jsx(zx,{})})}),e.jsx(Ve,{path:"/",element:e.jsx(Ke,{children:e.jsx(Ge,{children:e.jsx(Iu,{})})})}),e.jsx(Ve,{path:"/inventory",element:e.jsx(Ke,{children:e.jsx(Ge,{children:e.jsx(Jx,{})})})}),e.jsx(Ve,{path:"/admin",element:e.jsx(Ke,{children:e.jsx(Ge,{children:e.jsx(Sh,{})})})}),e.jsx(Ve,{path:"/leaderboard",element:e.jsx(Ke,{children:e.jsx(Ge,{children:e.jsx(xm,{})})})}),e.jsx(Ve,{path:"/match",element:e.jsx(Ke,{children:e.jsx(Ge,{children:e.jsx(fm,{})})})}),e.jsx(Ve,{path:"/record-match",element:e.jsx(Ke,{children:e.jsx(Ge,{children:e.jsx(kh,{})})})}),e.jsx(Ve,{path:"/babydex",element:e.jsx(Ke,{children:e.jsx(Ge,{children:e.jsx(Sm,{})})})}),e.jsx(Ve,{path:"/market",element:e.jsx(Ke,{children:e.jsx(Ge,{children:e.jsx(qx,{})})})}),e.jsx(Ve,{path:"/my-offers",element:e.jsx(Ke,{children:e.jsx(Ge,{children:e.jsx(Eh,{})})})}),e.jsx(Ve,{path:"/card-statistics",element:e.jsx(Ke,{children:e.jsx(Ge,{children:e.jsx(Rh,{})})})}),e.jsx(Ve,{path:"/betting",element:e.jsx(Ke,{children:e.jsx(Ge,{children:e.jsx(Bx,{})})})}),e.jsx(Ve,{path:"/profile",element:e.jsx(Ke,{children:e.jsx(Ge,{children:e.jsx(lx,{})})})}),e.jsx(Ve,{path:"/shop",element:e.jsx(Ke,{children:e.jsx(Ge,{children:e.jsx(Gx,{})})})}),e.jsx(Ve,{path:"/clubs",element:e.jsx(Ke,{children:e.jsx(Ge,{children:e.jsx(Qx,{})})})}),e.jsx(Ve,{path:"/tournament",element:e.jsx(Ke,{children:e.jsx(Ge,{children:e.jsx(rh,{})})})}),e.jsx(Ve,{path:"/chat",element:e.jsx(Ke,{children:e.jsx(Ge,{children:e.jsx(_h,{})})})}),e.jsx(Ve,{path:"/quests",element:e.jsx(Ke,{children:e.jsx(Ge,{children:e.jsx(Ah,{})})})}),e.jsx(Ve,{path:"*",element:e.jsx(Ge,{children:e.jsx(Dx,{})})})]},s.pathname)}),e.jsx(Ti,{})]})},Ph=()=>e.jsx(lu,{children:e.jsx(ec,{client:Mh,children:e.jsxs(cd,{children:[e.jsx(ac,{children:e.jsx(au,{children:e.jsx(iu,{children:e.jsx(Th,{})})})}),e.jsx(rd,{}),e.jsx(ld,{})]})})});Gd();const Fo=document.getElementById("root");if(!Fo)throw new Error("Root element not found");document.body.classList.add("loaded");al(Fo).render(e.jsx(u.StrictMode,{children:e.jsx(Ph,{})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/",updateViaCache:"none"}).then(s=>{b.log("âœ… [FCM] Service Worker enregistrÃ© !",s.scope),setInterval(()=>{s.update()},60*60*1e3),s.addEventListener("updatefound",()=>{const r=s.installing;r==null||r.addEventListener("statechange",()=>{r.state==="installed"&&navigator.serviceWorker.controller&&confirm("Une nouvelle version est disponible ! Voulez-vous recharger ?")&&(r.postMessage({type:"SKIP_WAITING"}),window.location.reload())})});let t=!1;navigator.serviceWorker.addEventListener("controllerchange",()=>{t||(t=!0,window.location.reload())})}).catch(s=>{b.error("âŒ [FCM] Erreur d'enregistrement du Service Worker:",s)}),window.addEventListener("online",()=>{}),window.addEventListener("offline",()=>{})});
